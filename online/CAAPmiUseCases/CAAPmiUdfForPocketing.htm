<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
<title>Managing User Features in Pocketing Operations through Machining Process
Instantiation</title>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>Machining</h1>
    </td>
    <td valign="top">
      <h2>Prismatic Machining</h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>Managing User Features in Pocketing Operations
      through Machining Process Instantiation</h3>
      <em>Implementing the CATIMfgMappingForPocketing interface</em></td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This article discusses the CAAPmiUdfForPocketing use case and explains
      how to implement the <em>CATIMfgMappingForPocketing </em>manufacturing
      interface.</p>
      <ul>
        <li><a href="#Learn"><strong>What You Will Learn With This Use Case</strong></a></li>
        <li><strong><a href="#UseCase">The <u>CAAPmiUdfForPocketing U</u>se Case</a></strong>
          <ul>
            <li><a href="#What">What Does CAAPmiUdfForPocketing Do</a></li>
            <li><a href="#How">How to Use CAAPmiUdfForPocketing</a></li>
            <li><a href="#Where">Where to Find the CAAPmiUdfForPocketing Code</a></li>
          </ul>
        <li><a href="#Step"><strong>Step-by-Step</strong></a></li>
        <li><b><a href="#InShort">In Short</a></b></li>
        <li><b><a href="#References">References</a></b></li>
      </ul>
    </td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>This use case is intended to help you to execute the geometrical mapping of a
User Defined Feature to a Pocketing operation through the Machining Process
instantiation functionality, by implementing the <em>CATIMfgMappingForPocketing </em>manufacturing
interface. This involves the following:</p>
<ul>
  <li>Overviewing the User Defined Features functionality in a manufacturing
    context</li>
  <li>Implementing some methods of <em>CATIMfgMappingForPocketing </em>to:
    <ul>
      <li>To machine a User Defined feature by using a Pocketing operation,</li>
      <li>See how to use the methods of the <i>CATIUdfFeatureInstance</i>
        interface in a manufacturing context.</li>
    </ul>
  </li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="UseCase"></a>The CAAPmiUdfForPocketing Use Case</h3>
<p>CAAPmiUdfForPocketing is a use case of the CAAPrismaticMachiningItf.edu
framework in the CAAPmiUserDefFeatureMappedWithMfgFeature.m module that
illustrates ManufacturingInterfaces framework capabilities.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="What"></a>What Does CAAPmiUdfForPocketing Do</h4>
<p>CAAPmiUdfForPocketing illustrates an implementation of
CATIMfgMappingForPocketing interface for the User Defined Features identified by
the UdfFeature type. This implementation enables to machine any design feature
by using a pocketing operation, but it cannot answer to the all industrial
cases.</p>
<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->
<h4><a name="How"></a>How to Use CAAPmiUdfForPocketing</h4>
<p>To use CAAPmiUdfForPocketing, you will need to:</p>
<ul>
  <li>Set up the build time environment, then compile
    CAAPmiUserDefFeatureMappedWithMfgFeature.m module along with its
    prerequisites [<a href="#References">1</a>]</li>
  <li>Edit the interface dictionary, that is, the
    CAAPrismaticMachiningItf.edu.dico file located in:
    <table width="100%">
      <tr>
        <td>Windows</td>
        <td><code>InstallRootDirectory\CAADoc\CAAPrismaticMachiningItf.edu\CNext\code\dictionary\</code></td>
      </tr>
      <tr>
        <td>Unix</td>
        <td><code>InstallRootDirectory/CAADoc/CAAPrismaticMachiningItf.edu/CNext/code/dictionary/</code></td>
      </tr>
    </table>
    <p>where <code>InstallRootDirectory</code> is the directory where the CAA
    CD-ROM is installed, and decomment the following line by removing the '#CAA#'
    character:</p>
    <pre>UdfFeature CATIMfgMappingForPocketing libCAAPmiUserDefFeatureMappedWithMfgFeature</pre>
  </li>
  <li>Set up the run time environment</li>
  <li>Launch a CATIA V5 session</li>
  <li>Open the CAAPmiDoublePocketUdfInstance.CATProcess file located in:
    <table width="100%">
      <tr>
        <td>Windows</td>
        <td><code>InstallRootDirectory\CAADoc\CAAPrismaticMachiningItf.edu\CNext\resources\graphic\</code></td>
      </tr>
      <tr>
        <td>Unix</td>
        <td><code>InstallRootDirectory/CAADoc/CAAPrismaticMachiningItf.edu/CNext/resources/graphic/</code></td>
      </tr>
    </table>
  </li>
  <li>Open the CAAPmiMachiningProcessesForDoublePocket.catalog catalog and
    navigate to select the DoublePocketByPocketing machining process inside the
    PocketingMachiningProcesses family.</li>
  <li>Select as Geometrical Input the DoublePocket.1 feature, then select the OK
    command</li>
  <li>Replay the toolpath and verify that the 2 pockets are well computed.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Where"></a>Where to Find the CAAPmiUdfForPocketing Code</h4>
<p>The CAAPmiUdfForPocketing use case is made of a class named <i>CAAPmiUdfForPocketing</i>
located in the CAAPmiUserDefFeatureMappedWithMfgFeature.m module of the
CAAPrismaticMachiningItf.edu framework:</p>
<table width="100%">
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAADoc\CAAPrismaticMachiningItf.edu\</code>CAAPmiUserDefFeatureMappedWithMfgFeature<code>.m</code></td>
  </tr>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAADoc/CAAPrismaticMachiningItf.edu/</code>CAAPmiUserDefFeatureMappedWithMfgFeature<code>.m</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Step"></a>Step-by-Step</h4>
<p>There are three logical steps in CAAPmiUdfForPocketing:</p>
<ol>
  <li><a href="#Step1">Implementing the CATIMfgMappingForPocketing Interface for
    UdfFeature Types</a>: the Coding Step</li>
  <li><a href="#Step2">Creating a User Feature Template and Associated Machining
    Processes</a>: the Build Time Step</li>
  <li><a href="#Step3">Creating User Feature Instances and Applying the
    Dedicated Machining Processes on these User Feature Instances</a>: the Run
    Time Step</li>
</ol>
<p>Note that the the coding step and the build time step are linked (see below).</p>
<p>We now comment each of those sections by looking at the code.</p>
<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="Step1"></a>Implementing the CATIMfgMappingForPocketing Interface
for UdfFeature Types</h4>
<ol>
  <li>
    <p>The CAAPmiUdfForPocketing.cpp file uses the
    &quot;CATIUdfFeatureInstance.h&quot; interface to access to the User Feature
    information. Then, the right data is accessed by its right role name. Refer
    also to the <a href="CAAPmiUdfForMfgHole.htm#Step1">CATIMfgDesignHoleParameters</a>
    documentation for detailed documentation on this interface.<br>
  </li>
  <li>
    <p>The CAAPmiUdfForPocketing.cpp file uses the
    &quot;CATIMfgMappingRuleName.h&quot; interface to find the right input
    defining the driving curve for a given pocketing operation: This interface
    enables to access to the Mapping Rule name associated to the pocketing
    operation.</p>
    <table class="code">
      <tr>
        <td>
          <pre>...
CATUnicodeString role = &quot;&quot;;
CATBaseUnknown_var spInputGeom;

//----------------------------------------------------------------------
// Read the Inputs number: this is the geometrical inputs of your Udf
// defined when creating the Udf template
//----------------------------------------------------------------------
int InputNb = 0;
RC = piUdfFeatureInstance-&gt;GetInputsNumber(InputNb);

//----------------------------------------------------------------------
// Read the mapping rule name associated to the Pocketing operation 
//----------------------------------------------------------------------
CATUnicodeString MappingRuleName = &quot;&quot;;
CATIMfgMappingRuleName *piMappRuleName = NULL;
RC = this-&gt;QueryInterface(IID_CATIMfgMappingRuleName,(void **)&amp;piMappRuleName);
if (SUCCEEDED(RC) &amp;&amp; NULL != piMappRuleName) 
{
  MappingRuleName = piMappRuleName-&gt;GetMappingRuleName();
  piMappRuleName-&gt;Release();
  piMappRuleName = NULL;
}

//----------------------------------------------------------------------
// Scan all the Udf Inputs to find the right input 
// identified by their role names are well defined. This right role
// name is &quot;Drive&quot; or &quot;Upper_Drive&quot; if either the mapping rule name is &quot;Upper_Drive&quot; or
// not defined
//----------------------------------------------------------------------
int i =1;
if (MappingRuleName == &quot;Upper_Drive_Rule&quot; || MappingRuleName == &quot;&quot;)
{
  while (SUCCEEDED(RC) &amp;&amp; i &lt;= InputNb &amp;&amp; (role != &quot;Drive&quot; &amp;&amp; role != &quot;Upper_Drive&quot;))
  {
    RC = piUdfFeatureInstance-&gt;GetInputRole(i, role);
    if (role == &quot;Drive&quot; || role == &quot;Upper_Drive&quot;)
    {
      RC = piUdfFeatureInstance-&gt;GetInput(i,spInputGeom);
    }
    i++;
  }
  //----------------------------------------------------------------------
  // The right Input is found
  //----------------------------------------------------------------------
  if (SUCCEEDED(RC) &amp;&amp; (role == &quot;Drive&quot; || role == &quot;Upper_Drive&quot;))
  {
    oGuidingCurves.Append(spInputGeom);
    RetCode = S_OK;
  }
}
//----------------------------------------------------------------------
// The right role name is &quot;Lower_Drive&quot; in case of &quot;Lower_Drive_Rule&quot; mapping rule name
//----------------------------------------------------------------------
else if (MappingRuleName == &quot;Lower_Drive_Rule&quot;)
{
  while (SUCCEEDED(RC) &amp;&amp; i &lt;= InputNb &amp;&amp; role != &quot;Lower_Drive&quot;)
  {
    RC = piUdfFeatureInstance-&gt;GetInputRole(i, role);
    if (SUCCEEDED(RC) &amp;&amp; role == &quot;Lower_Drive&quot;)
    {
      RC = piUdfFeatureInstance-&gt;GetInput(i,spInputGeom);
    }
    i++;
  }
  //----------------------------------------------------------------------
  // The right Input is found
  //----------------------------------------------------------------------
  if (SUCCEEDED(RC) &amp;&amp; role == &quot;Lower_Drive&quot;)
  {
    oGuidingCurves.Append(spInputGeom);
    RetCode = S_OK;
  }
}
    ...</pre>
        </td>
      </tr>
    </table>
  </li>
  <li>
    <p>Update the interface dictionary, that is a file named, for example in
    this case, CAAPrismaticMachiningItf.edu.dico, whose directory's pathname is
    concatenated at run time in the CATDictionaryPath environment variable, and
    containing the following declaration to state that the <i>UdfFeature</i>
    feature implements the <i>CATIMfgMappingForPocketing</i> interface, and
    whose code is located in the libCAAPmiUserDefFeatureMappedWithMfgFeature
    shared library or DLL. Pay attention to remove the comment (#) in the
    supplied dictionary.</p>
    <pre>UdfFeature CATIMfgMappingForCOntouring libCAAPmiUserDefFeatureMappedWithMfgFeature</pre>
    <p>The CAAPrismaticMachiningItf.edu.dico file is located in:<br>
    <table width="100%">
      <tr>
        <td>Windows</td>
        <td><code>InstallRootDirectory\CAADoc\CAAPrismaticMachiningItf.edu\CNext\code\dictionary\</code></td>
      </tr>
      <tr>
        <td>Unix</td>
        <td><code>InstallRootDirectory/CAADoc/CAAPrismaticMachiningItf.edu/Cnext/code/dictionary/</code></td>
      </tr>
    </table>
  </li>
</ol>
<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="Step2"></a>Creating a User Feature Template and Associated
Machining Processes</h4>
<p>Here, you will find specific informations according to the implementation of
the <i>CATIMfgMappingForPocketing</i> interface. You can access to the User
Feature functionalities under the Part Design or Shape Design Workbench, then
create a DoublePocket under the UserFeatures tree, and display the different
tab-pages, specially Inputs, Outputs and Parameters one:</p>
<ul>
  <li>The User Feature template Inputs are defined and identified to easily
    access to the geometry. In this case, the feature must have two necessary
    inputs: Lower_Drive and Upper_Drive inputs which are used in the
    CAAPmiUdfForPocketing.cpp file to extract the support plane (defining the
    bottom and relimiting elements) and to define the right drive element
    according to the defined Mapping Rule name</li>
  <li>The necessary attributes are published and identified by a specific name :
    these are not necessary for the CAA sample, but for the manufacturing
    expressions computations (Formulas, Checks and Tool Queries)</li>
  <li>Creation of a Machining Process with two pocketing operations: A Mapping
    Rule name is associated to each pocketing operation:
    &quot;Upper_Drive_Rule&quot; to the first one, &quot;Lower_Drive_Rule&quot;
    to the second one which will be used to return the right driving curve when
    instantiating the Machining Process (&quot;Mapping Rule Name&quot;
    contextual menu item of the operation).</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="Step3"></a>Creating User Feature Instances and Applying a Dedicated
Machining Process</h4>
<ul>
  <li>Open the &quot;Manufacturing Features View&quot; of a CATProcess file
    referencing a Product containing a DoublePocket User Feature</li>
  <li>Open the catalog containing a machining process dedicated to your feature</li>
  <li>Select either in the model, or in the Manufacturing View, your User
    Feature.</li>
  <li>Select the &quot;OK&quot; command: Note that two pocketing operations are
    created in the Machining Program</li>
  <li>Replay the Tool Path.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="InShort"></a>In Short</h3>
<p>This article provides an example on how to use the manufacturing interface
classes, to machine User Features. It shows how to implement the <i>CATIMfgMappingForPocketing</i>
interface to be authorized to machine any geometry by using a pocketing
operation. This is an elementary step to do this.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td valign="top">[1]</td>
    <td><a href="../CAADocUseCases/CAADocRunSample.htm">Building
      and Launching a CAA V5 Use Case</a></td>
  </tr>
  <tr>
    <td valign="top"></td>
    <td></td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <strong>1</strong> [April 2001]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<p><i>Copyright © 2000, Dassault Systèmes. All rights reserved.</i></p>

</body>

</html>
