<html>

 <head>
 <meta http-equiv="Content-Language" content="en-gb">
 <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
 <meta name="GENERATOR" content="Microsoft FrontPage 6.0">
 <meta name="ProgId" content="FrontPage.Editor.Document">
 <link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
 <script language="JavaScript" src="../CAADocJavaScript/submit.js">
 </script>
 <title>Creating a View from 3D</title>
 </head>

 <body>

 <table width="100%">
   <tr>
     <td valign="top">
     <h1>Mechanical Design</h1>
     </td>
     <td valign="top">
     <h2>Drafting</h2>
     </td>
     <td rowspan="2" align="right" valign="top">
     <h3><a name="Top"></a>Creating a View from 3D</h3>
     <p><em>How </em><i>to create a view from 3D with annotations created by the 
     Functional and Tolerancing and Annotation workbench</i></td>
   </tr>
   <tr>
     <td class="use" colspan="2">Use Case</td>
   </tr>
 </table>
 <hr>
 <!---------------------------------comment------------------------------------->
 <table class="abstract">
   <tr>
     <td>
     <h3>Abstract</h3>
     <p>This article discusses the CAADrwCreateViewFrom3D use case. This use 
     case explains how to create <i>a view from 3D</i> with annotations created 
     by Functional and Tolerancing and Annotation workbench.</p>
     <ul>
       <li><a href="#Learn"><strong>What You Will Learn With This Use Case</strong></a></li>
       <li><a href="#UseCase"><strong>The CAADrwCreateViewFrom3D Use Case</strong></a></li>
       <ul>
         <li><a href="#What">What Does CAADrwCreateViewFrom3D Do</a></li>
         <li><a href="#How">How to Launch </a><a href="#What">
         CAADrwCreateViewFrom3D</a></li>
         <li><a href="#Where">Where to Find the </a><a href="#What">
         CAADrwCreateViewFrom3D</a><a href="#Where"> Code</a></li>
       </ul>
       </li>
       <li><a href="#Step"><strong>Step-by-Step</strong></a></li>
       <li><a href="#InShort"><strong>In Short</strong></a></li>
       <li><a href="#References"><strong>References</strong></a></li>
     </ul>
     </td>
   </tr>
 </table>
 <hr>
 <!---------------------------------comment------------------------------------->
 <h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
 <p>This use case is intended to show you how to create a Drawing generative 
 view from a TPS view. A TPS view<i> </i>is defined in a 3D part, product or 
 process that is assigned 3D tolerance specifications and annotations. The 
 Drawing generative View will be associated to the part document and the TPS 
 view. All the modifications applied in the TPS view will be propagated in the 
 Drawing generative view by update. </p>
 <table border="0" style="border-collapse: collapse" bordercolor="#111111" id="AutoNumber1">
   <tr>
     <td width="100%">
     <p align="center"><i>Fig 1: The part document containing a TPS View (Front 
     View.1)</i></td>
   </tr>
   <tr>
     <td width="100%">
     <img border="0" src="images/CAACreateVIewFrom3D1.jpg" width="624" height="371"></td>
   </tr>
 </table>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h3><a name="UseCase"></a>The CAADrwCreateViewFrom3D Use Case</h3>
 <p>CAADrwCreateViewFrom3D is a use case of the CAADraftingInterfaces.edu 
 framework that illustrates DraftingInterfaces framework capabilities.</p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h4><a name="What"></a>What Does CAADrwCreateViewFrom3D Do?</h4>
 <table>
   <caption>&nbsp;</caption>
   <tr>
     <td>
     <p align="center"><i>Fig. 2: Drawing Document with the view from 3D </i>
     </td>
   </tr>
   <tr>
     <td>
     <img border="0" src="images/CAACreateVIewFrom3D2.jpg" width="582" height="304"></td>
   </tr>
 </table>
 <p>Fig. 2 represents the Drawing document in which a front view has been 
 created from the active TPS view of Annotation Set in the Part document. Note: 
 A red cross is created to inform the end user that the text leader is 
 associative to hidden geometry in the view.</p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h4><a name="How"></a>How to Launch CAADrwCreateViewFrom3D</h4>
 <p>To launch CAADrwCreateViewFrom3D, you will need to set up the build time 
 environment, then compile CAADrwCreateViewFrom3D along with its prerequisites, 
 set up the run time environment, and then execute the use case [<a href="#References">1</a>].</p>
 <p>When you launch the use case, pass the full pathname of the Drawing file as 
 argument. A Part file is delivery in the following path: 
 CAADraftingInterfaces.edu\CNext\resources\graphic\PadWith3DAnnotations.CATPart.
 </p>
 <ul>
   <li>With Windows
   <table width="90%">
     <tr>
       <td>
       <pre>e:&gt; mkrun -c cmd
CAADrwCreateViewFrom3D c:\...\PadWith3DAnnotations.CATPart c:\DrawingTestOutput.CATDrawing</pre>
       </td>
     </tr>
   </table>
   </li>
   <li>With UNIX
   <table width="90%">
     <tr>
       <td>
       <pre>$ mkrun -c cmd
CAADrwCreateViewFrom3D /u/users/.../PadWith3DAnnotations.CATPart /u/users/DrawingTestOutput.CATDrawing</pre>
       </td>
     </tr>
   </table>
   </li>
 </ul>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h4><a name="Where"></a>Where to Find the CAADrwCreateViewFrom3D Code</h4>
 <p>The CAADrwCreateViewFrom3D use case is made of a single source file named 
 CAADrwCreateViewFrom3D .cpp located in the CAADrwCreateViewFrom3D.m module of 
 the CAADraftingInterfaces.edu framework:</p>
 <table>
   <tr>
     <td>Windows</td>
     <td><code>
     InstallRootDirectory\CAADraftingInterfaces.edu\CAADrwCreateViewFrom3D.m\</code></td>
   </tr>
   <tr>
     <td>Unix</td>
     <td><code>
     InstallRootDirectory/CAADraftingInterfaces.edu/CAADrwCreateViewFrom3D.m/</code></td>
   </tr>
 </table>
 <p>where <code>InstallRootDirectory</code> is the directory where the CAA 
 CD-ROM is installed.</p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h3><a name="Step"></a>Step-by-Step</h3>
 <p>There are five steps in CAADrwCreatViewFrom3D:</p>
 <ol>
   <li><a href="#CreatingAndInitiliazing">Creating and Initializing the Document</a></li>
   <li><a href="#Acces">Creating the Drawing in the Document</a></li>
   <li><a href="#GettingPart">Retrieving the Part Document and the Active TPS 
   View</a></li>
   <li><a href="#CreateViewFrom3DInDrawingDoc">Creating the View from 3D</a></li>
   <li><a href="#Saving">Saving the Document and Exiting</a></li>
 </ol>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h4><a name="CreatingAndInitiliazing"></a>Creating and Initializing the 
 Document</h4>
 <table class="code">
   <tr>
     <td>
     <pre>int main(int iArgc, // Number of arguments (2) 
char** iArgv) // Path to the new *.CATDrawing document
{
// Check arguments
if(3 != iArgc) return 1;
const char *pfileNamePart = iArgv[1];
const char *pfileNameOut = iArgv[2];
int code_err = 1;


// CREATE THE SESSION
// ==================
CATSession *pSampleSession = NULL;
HRESULT hr = ::Create_Session(&quot;SampleSession&quot;,pSampleSession);
if (FAILED(hr)) return 1;</pre>
     <pre>...
</pre>
     </td>
   </tr>
 </table>
 <p>This section represents the usual sequence for loading a CATIA document [<a href="#References">2</a>].</p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h4><a name="Acces"></a>Creating the Drawing in the Document</h4>
 <table class="code">
   <tr>
     <td>
     <pre>...
   // DRAWING DOCUMENT CREATION
   // ===============================
   CATDocument* pNewDoc = NULL;
   CATDocumentServices::New(&quot;CATDrawing&quot;, pNewDoc); 
...</pre>
     </td>
   </tr>
 </table>
 <p>The other steps to fully initialize the Drawing document are included in the 
 specific sub program, <code>CreateViewFrom3DInDrawingDoc</code>.</p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h4><a name="GettingPart"></a>Retrieving the Part Document and&nbsp; the Active 
 View of the TPS Annotation Set</h4>
 <table class="code">
   <tr>
     <td>
     <pre>...
// READ THE PART DOCUMENT AND GET ACTIVE TPS VIEW
// ====================================================
  CATDocument *pDocPart = NULL;
  if( SUCCEEDED(CATDocumentServices::OpenDocument(pfileNamePart, pDocPart)) )
  {
    CATInit *piDocAsInit = 0;
    if( SUCCEEDED(pDocPart-&gt;QueryInterface(IID_CATInit, (void**)&amp;piDocAsInit)) )
    {
      CATITPSDocument *piTPSDoc= NULL;
      if (SUCCEEDED(piDocAsInit-&gt;QueryInterface(IID_CATITPSDocument,(void **)&amp;piTPSDoc)))
      {
        CATITPSList *piTPSList = NULL;
        if (SUCCEEDED(piTPSDoc-&gt;GetSets(&amp;piTPSList)))
        {
          unsigned int nbSet;
          piTPSList-&gt;Count(&amp;nbSet);
          if (nbSet &gt; 0)
          {
            CATITPSComponent *piTPSCmp = NULL;
            if (SUCCEEDED(piTPSList-&gt;Item(0,&amp;piTPSCmp)))
            {
              if (piTPSCmp)
              {
                CATITPSSet *piTPSSet = NULL;
                if (SUCCEEDED(piTPSCmp-&gt;QueryInterface(IID_CATITPSSet,(void **)&amp;piTPSSet)))
                {
                  CATITPSView *piTPSActiveView = NULL;
                  if (SUCCEEDED(piTPSSet-&gt;GetActiveView (&amp;piTPSActiveView)) &amp;&amp; piTPSActiveView)
                  {
                    IUnknown *pTPSViewUk = NULL;
                    if (SUCCEEDED(piTPSActiveView-&gt;QueryInterface(IID_IUnknown,(void **)&amp;pTPSViewUk)))
                    {
                      // Call a Sub Program to Create a Drawing View from TPS View in a Drawing Document
                      // =========================================================================
                      hr = CreateViewFrom3DInDrawingDoc(pNewDoc,piTPSActiveView);

...</pre>
     </td>
   </tr>
 </table>
 <p>&nbsp;</p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h4><a name="CreateViewFrom3DInDrawingDoc"></a>Creating the View from 3D</h4>
 <table class="code">
   <tr>
     <td>
     <pre>...
// Sub program to create a Drawing Generative View from TPS View.
// =========================================================
HRESULT CreateViewFrom3DInDrawingDoc(CATDocument *ipNewDoc, CATITPSView *ipiTPSActiveView)
{
  HRESULT hr = E_FAIL;

  if (ipNewDoc &amp;&amp; ipiTPSActiveView)
  {
  // DRAWING STANDARD CREATION
  // ===============================

  // Gets the drawing feature using the CATIDftDocumentServices interface
  CATIDftDrawing *piDftDrawing = NULL;
  CATIDftDocumentServices *piDftDocServices = NULL;
  CATIContainer_var spDrwCont;
  if (SUCCEEDED(ipNewDoc-&gt;QueryInterface(IID_CATIDftDocumentServices, (void **)&amp;piDftDocServices)))
  {
    piDftDocServices-&gt;GetDrawing(IID_CATIDftDrawing, (void **)&amp;piDftDrawing);
    piDftDocServices-&gt;Release(); 
    piDftDocServices = NULL;
    if (piDftDrawing)
    {
      CATISpecObject *piDrawingSO=NULL;
      if (SUCCEEDED(piDftDrawing-&gt;QueryInterface(IID_CATISpecObject,(void **)&amp;piDrawingSO)))
      {
        spDrwCont = piDrawingSO-&gt;GetFeatContainer();
        if (NULL_var != spDrwCont)
        {
          CATIDftStandardManager *piStdmgr = NULL;
          hr = spDrwCont-&gt;QueryInterface(IID_CATIDftStandardManager,(void**)&amp;piStdmgr);
          if (SUCCEEDED(hr))
          {
            // Find a standard in the list of allowed standards
            CATIStringList *piListstd = NULL;
            if ( SUCCEEDED(piStdmgr-&gt;GetAvailableStandards(&amp;piListstd)) &amp;&amp; piListstd )
            {
              unsigned int nbrstd = 0;
              piListstd-&gt;Count(&amp;nbrstd);
              for (unsigned int indice = 0; indice &lt; nbrstd; indice ++)
              {
                wchar_t *wstd = NULL;
                if ( SUCCEEDED ( piListstd-&gt;Item ( indice, &amp;wstd ) ) &amp;&amp; wstd )
                {
		  CATUnicodeString stdname;
		  const CATUnicodeString ISO_UncS = &quot;ISO&quot;;
		  stdname.BuildFromWChar(wstd);
		  if ( stdname == ISO_UncS ) 
                  {
                    // Import the ANSI standard in the document
                    piStdmgr-&gt;ImportStandard (wstd);
                    break;
                  }
                  delete[] wstd; wstd = NULL;
                }
              }
              piListstd-&gt;Release(); piListstd=NULL; 
            }
            piStdmgr-&gt;Release (); piStdmgr=NULL;
          }
        }

        // Creation of new generative view from TPS view in the active sheet of the Drawing Document
        CATIDftView *piDftViewFrom3D = NULL;
        CATIDftSheet *piDftSheet = NULL;
        piDftDrawing-&gt;GetActiveSheet(&amp;piDftSheet);

        // View anchor point definition
        double ptOrigin[2] = {150.0,150.0};
        IUnknown *pTPSViewUk = NULL;
        if (SUCCEEDED(ipiTPSActiveView-&gt;QueryInterface(IID_IUnknown,(void **)&amp;pTPSViewUk)))
        {
          CATIDftGenViewFactory *piDftGenViewFact = NULL;
          if (piDftSheet &amp;&amp; SUCCEEDED(piDftSheet-&gt;QueryInterface(IID_CATIDftGenViewFactory,(void **)&amp;piDftGenViewFact))) 
          {
            hr = piDftGenViewFact-&gt;CreateViewFrom3D(ptOrigin, pTPSViewUk, &amp;piDftViewFrom3D);
            piDftGenViewFact-&gt;Release();piDftGenViewFact=NULL;
          }
          pTPSViewUk-&gt;Release();
          pTPSViewUk=NULL;
        }
        piDrawingSO-&gt;Release();
        piDrawingSO=NULL;
      }
      piDftDrawing-&gt;Release(); 
      piDftDrawing = NULL;
    }
   }
   } 
  return hr;
}

...</pre>
     </td>
   </tr>
 </table>
 <p>The sub program <code>CreateViewFrom3DInDrawingDoc</code> creates a View 
 from 3D by using the method <code>CreateViewFrom3D</code> of the <i>
 CATIDftGenViewFactory</i> interface. This interface is implemented by the 
 Sheet.</p>
 <p><b>Note</b>: Before the creation of the Drawing View, the Drawing Standard 
 has to be correctly initialized. <b>It must be identical to the Standard used 
 by the Annotation Set aggregating the TPS View in the 3D document</b> [<a href="#References">3</a>].<br>
 </p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <!---------------------------------comment------------------------------------->
 <h4><a name="Saving"></a>Saving the Document and Exiting</h4>
 <table class="code">
   <tr>
     <td>
     <pre>...
// SAVE THE RESULT
// =================
if (pNewDoc)
{
  CATDocumentServices::SaveAs(*pNewDoc, (char *)pfileNameOut);
  CATDocumentServices::Remove (*pNewDoc);
}

//ENDS SESSION AND DROPS DOCUMENT
//===================================== 
if (pDocPart)
  CATDocumentServices::Remove (*pDocPart);

::Delete_Session(&quot;SampleSession&quot;);
</pre>
     </td>
   </tr>
 </table>
 <p>This section represents the usual sequence for saving a newly created CATIA 
 document.</p>
 <p align="right">[<a href="#Top">Top</a>]</p><hr>
 <!---------------------------------comment------------------------------------->
 <h3><a name="InShort"></a>In Short</h3>
 <p>This use case shows the way to:</p>
 <ol>
   <li>Open a Part document</li>
   <li>Retrieve the active TPS view in the Annotation Set</li>
   <li>Create a Drawing document, and initialize the standard</li>
   <li>Create a view from 3D by using the <code>CreateViewFrom3D</code> method 
   defined in CATIDftGenViewFactory</li>
   <li>Save the Drawing document.</li>
 </ol>
 <p align="right">[<a href="#Top">Top</a>]</p><hr>
 <!---------------------------------comment------------------------------------->
 <h3><a name="References"></a>References</h3>
 <table width="100%">
   <tr>
     <td valign="top">[1]</td>
     <td>
     <a href="../CAADocUseCases/CAADocRunSample.htm">
     Building and Launching a CAA Use Case</a></td>
   </tr>
   <tr>
     <td valign="top">[2]</td>
     <td>
     <a href="../CAAOmbUseCases/CAAOmbLoadDoc.htm">
     Loading a Document</a></td>
   </tr>
   <tr>
     <td valign="top">[3]</td>
     <td>
     <a href="#" onclick="javascript:CAAlinkHtm('../CAATpiTechArticles/CAATpiTPSOverview.htm');return false">
     Technological Product Specification Overview</a></td>
   </tr>
   <tr>
     <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
   </tr>
 </table>
 <hr>
 <!---------------------------------comment------------------------------------->
 <h3><a name="History"></a>History</h3>
 <table width="100%">
   <tr>
     <td valign="top">Version: <strong>1</strong> [Jan 2005]</td>
     <td valign="top">Document created</td>
   </tr>
   <tr>
     <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
   </tr>
 </table>
 <hr>
 <!---------------------------------comment------------------------------------->
 <p><i>Copyright © 2005, Dassault Systèmes. All rights reserved.</i></p>

 </body>

</html>
