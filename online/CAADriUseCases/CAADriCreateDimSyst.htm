<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 6.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
<title>Creating Center Lines in a CATDrawing Document</title>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>Mechanical Design</h1>
    </td>
    <td valign="top">
      <h2>Drafting</h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>Creating Dimension System in a CATDrawing Document</h3>
      <em>How to create dimension system on interactive </em></td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This article discusses the CAADrwCreateDimSyst use case. This use case
      explains how to create dimension system on interactive in a CATDrawing document.</p>
      <ul>
        <li><a href="#Learn"><strong>What You Will Learn With This Use Case</strong></a>
        <li><a href="#UseCase"><strong>The CAADrwCreateDimSyst Use Case</strong></a>
          <ul>
            <li><a href="#What">What Does CAADrwCreateDimSyst Do</a>
            <li><a href="#How">How to Launch CAADrwCreateDimSyst</a></li>
            <li><a href="#Where">Where to Find the CAADrwCreateDimSyst Code</a></li>
          </ul>
        </li>
        <li><a href="#Step"><strong>Step-by-Step</strong></a><li><strong><a href="#RetrieveSel">Retrieving the Selection and Creating 
		the dimension system</a></strong>
        <li><strong><a href="#ModifyDimSyst">Modifying a dimension system</a></strong>
        <li><a href="#InShort"><strong>In Short</strong></a></li>
        <li><a href="#References"><strong>References</strong></a></li>
      </ul>
    </td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>In this use case you will learn how to create dimension system on
interactive geometry. The dimension system is a set of dimensions. The 
positioning of these dimensions depend of the type of the dimension system: 
Cumulated, Stacked or Chained. This sample is an interactive command which 
create a Stacked dimension system, from extremity points of line put in the CSO.</p>
<!---------------------------------comment------------------------------------->
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="UseCase"></a>The CAADrwCreateDimSyst Use Case</h3>
<p>CAADrwCreateDimSyst is a use case of the CAADraftingInterfaces.edu framework
that illustrates DraftingInterfaces framework capabilities.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="What"></a>What Does CAADrwCreateDimSyst Do</h4>
<p>This use case is made of a state command that creates a dimension system from 
points already put in the CSO.</p>
<table>
  <caption>Fig. 1: The Drawing with geometry on which the dimensions will be 
	created</caption>
  <tr>
    <td>
	<img border="0" src="images/CAADrwCreateDimSyst1.jpg" width="560" height="578"></td>
  </tr>
</table>
<p>This picture represents geometry created by Interactive Drafting product</p>
<p>&nbsp;</p>
<table id="table1">
  <caption>Fig. 2: The Drawing with selected points used to create dimension 
	system (red square)</caption>
  <tr>
    <td>
	<img border="0" src="images/CAADrwCreateDimSyst2.jpg" width="529" height="542"></td>
  </tr>
</table>
<table id="table2">
  <caption>Fig. 3: The Drawing with geometry on which the dimensions will be 
	created</caption>
  <tr>
    <td>
	<img border="0" src="images/CAADrwCreateDimSyst3.jpg" width="531" height="723"></td>
  </tr>
</table>
<p>This picture shows the dimension system created&nbsp; by the CAA command 
CreateDimSystem.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="How"></a>How to Launch CAADrwCreateDimSyst</h4>
<p>To launch CAADrwCreateDimSyst, you will need to set up the build time
environment, then compile CAADrwCreateDimSyst and CAADrwAddin along with its prerequisites, set up
the run time environment.[<a href="#References">1</a>].</p>
<ol>
  <li>Launch CATIA session.</li>
  <li>Right-click on Drafting workshop to activate CAAUseCaseCommands toolbar.</li>
	<li>Select geometry on which dimension system will be created</li>
  <li>Launch the CreateDimSystem use case command to create the dimension system.</li>
</ol>
<p align="right"><a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Where"></a>Where to Find the CAADrwCreateDimSyst Code</h4>
<p>The CAADrwCreateDimSyst use case is made of two source files named 
CAADrwCreateDimSystCmd.h and CAADrwCreateDimSystCmd.cpp located in the 
CAADrwCreateDimSyst.m
module of the CAADraftingInterfaces.edu framework:</p>
<table>
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAADraftingInterfaces.edu\CAADrwCreateDimSyst.m\</code></td>
  </tr>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAADraftingInterfaces.edu/CAADrwCreateDimSyst.m/</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="Step"></a>Step-by-Step</h3>
<p>There are two steps in CAADrwCreateDimSyst:</p>
<ol>
  <li><a href="#BuildingState">Building the State Chart and Creating the Appropriate
    Selection Agent.</a>
  <li><a href="#RetrieveSel">Retrieving the Selection and Creating the Center Line</a></li>
</ol>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="BuildingState"></a>Building the State Chart and Creating the Appropriate
Selection Agent</h3>
<table class="code">
  <tr>
    <td>
      <pre>void CAADrwCreateDimSystCmd::BuildGraph()
{ 
  // Creation of the acquisition agent
  _pObjectAgent = new CATPathElementAgent(&quot;_pObjectAgent A&quot;);
  _pObjectAgent -&gt;SetBehavior( CATDlgEngWithPrevaluation | 
  CATDlgEngMultiAcquisition | 
  CATDlgEngWithCSO); 

  // We only want to get points
  _pObjectAgent -&gt;AddElementType(&quot;IDMPoint2D&quot;);
  AddCSOClient(_pObjectAgent);

  // States definition
  CATDialogState* pState1 = GetInitialState(&quot;Sel points&quot;);
  pState1-&gt;AddDialogAgent(_pObjectAgent);

  // Transition definition 
  AddTransition(pState1, NULL, IsOutputSetCondition(_pObjectAgent),
  Action((ActionMethod)&amp;CAADrwCreateDimSystCmd::CreateDimSyst, NULL, NULL));
}</pre>
    </td>
  </tr>
</table>
<p>In this section we create a CATPathElementAgent and set the corresponding
element type to IDMPoint.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="RetrieveSel"></a>Retrieving the Selection and Creating the dimension 
system</h3>
<table class="code">
  <tr>
    <td>
      <pre>boolean CAADrwCreateDimSystCmd::CreateDimSyst(void *iData)
{ 
  CATSO* pObjSO = _pObjectAgent-&gt;GetListOfValues(); 
  CATPathElement *pElemPath = NULL;

  // Dimension System creation:
  // ==========================
  if (NULL != pObjSO) 
  {
    // We will scan the CSO from the begining
    pObjSO-&gt;InitElementList();
    CATIDrwAnnotationFactory *piDrwFact = NULL;
    IDMPoint2D *piFirstElem = NULL;
    IDMPoint2D *piSecondElem = NULL;
    IDMPoint2D *piNextElem = NULL;
    CATIDrwDimSystem *piDimSyst = NULL;
    CATIDrwDimDimension *piDim = NULL;
    CATDimSystemDefinition sysDef;
    sysDef.SystemType = StackedDimSystem;
    sysDef.SetOffsetMode(ConstantOffsetSystem);
    sysDef.SetValueAlignmentMode(OnRefLineSide);
    sysDef.SetValueOffset(100.0);
    while (NULL != (pElemPath = (CATPathElement*)pObjSO-&gt;NextElement()) )
    {
      if (NULL == piFirstElem)
      {
        piFirstElem = (IDMPoint2D *)pElemPath-&gt;FindElement(IID_IDMPoint2D);
        piDrwFact = (CATIDrwAnnotationFactory *)pElemPath-&gt;FindElement(IID_CATIDrwAnnotationFactory);
      }
      else if (NULL == piSecondElem)
      {
        piSecondElem = (IDMPoint2D *)pElemPath-&gt;FindElement(IID_IDMPoint2D);
        // Dimension creation
        if (piSecondElem &amp;&amp; piFirstElem)
        {
          CATDrwDimType dimType = DrwDimDistance;
          CATDimDefinition dimDef;
          dimDef.OrientationReference = ParallelDim;
          dimDef.Orientation = DrwDimAuto;
          CATIUnknownList * piSelectionsList =NULL;
          CATIUnknownListImpl * piListsel = new CATIUnknownListImpl();
          piListsel-&gt;QueryInterface(IID_CATIUnknownList, (void **) &amp;piSelectionsList);
          piListsel-&gt;Release(); piListsel=NULL;

          IUnknown * piLine1 = NULL;
          IUnknown * piLine2 = NULL;
          piFirstElem-&gt;QueryInterface(IID_IUnknown, (void **)&amp;piLine1);
          piSecondElem-&gt;QueryInterface(IID_IUnknown, (void **)&amp;piLine2);
          if (piSelectionsList)
          {
            piSelectionsList-&gt;Add(0, piLine1);
            piSelectionsList-&gt;Add(1, piLine2);
          }
          double pt1[2],pt2[2];
          piFirstElem-&gt;GetPointData(pt1);
          piSecondElem-&gt;GetPointData(pt2);
          double * pts[2] = { NULL, NULL };
          pts[0] = pt1;
          pts[1] = pt2;
          dimDef.Orientation = DrwDimAuto;
          if (piDrwFact)
          {
            piDrwFact-&gt;CreateDimension(piSelectionsList,pts,dimType,&amp;dimDef,&amp;piDim);
            piDrwFact-&gt;CreateDimSystem(piDim,&amp;sysDef,&amp;piDimSyst);
          }
          if (piLine1) piLine1-&gt;Release(),piLine1 = NULL;
          if (piLine2) piLine2-&gt;Release(),piLine2 = NULL;
          if (piSelectionsList) piSelectionsList-&gt;Release(),piSelectionsList=NULL;
        } 
      }
      else if (NULL == piNextElem)
      {
        piNextElem = (IDMPoint2D *)pElemPath-&gt;FindElement(IID_IDMPoint2D);
        // Dimension system creation
        if (piNextElem &amp;&amp; piDimSyst &amp;&amp; piDim)
        {
          double pt1[2];
          piNextElem-&gt;GetPointData(pt1);
          CATMathPoint2D ptSel(pt1[0],pt1[1]);
          CATIDrwDimDimension *myDimToAdd = NULL;
          piDimSyst-&gt;AddDimension((CATBaseUnknown *)piNextElem,myDimToAdd,&amp;ptSel);
        }
        if (piNextElem) piNextElem-&gt;Release(),piNextElem=NULL;
      }
      else
        cout &lt;&lt; &quot;invalid input&quot; &lt;&lt; endl;
    }
  </pre>
    </td>
  </tr>
</table>
<p>The acquisition agent did put the selected points into the CSO. So we get
the SO and loop on it. A dimension is created from the 2 first points in the SO, 
then the dimension system is created from this dimension by using <code>
 CreateDimSystem</code> method defined in CATIDrwAnnotationFactory interface, 
Others dimensions are created in the dimension system by using <code>
 AddDimension </code>method defined in CATIDrwDimSystem interface. 
CATDimSystemDefinition class allows to initialize a set of parameters for the 
dimension system definition as the type of the dimension system (Chained, 
Cumulated, Stacked).</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<h3><a name="ModifyDimSyst"></a>Modifying a dimension system</h3>
<table class="code" id="table3">
  <tr>
    <td>
      <pre>// Dimension System modifications:
// ===============================
if (piDimSyst)
{
  // Get the master dimension for dimension system moving
  CATIDrwDimDimension *piMasterDim=NULL;
  CATMathPoint2D ptPos(150.0,230);
  piDimSyst-&gt;GetMasterDimension(&amp;piMasterDim);
  if (piMasterDim)
  {
    piMasterDim-&gt;MoveDimensionLine (ptPos);
    CATISpecObject_var spDimSpec = piMasterDim;
    if (!!spDimSpec)
      spDimSpec-&gt;Update();
    piMasterDim-&gt;Release();piMasterDim=NULL;
  }
  // Dimension system properties modification
  CATIDrwStackedDimSystem *piDrwStkSyst=NULL;
  if (SUCCEEDED(piDimSyst-&gt;QueryInterface(IID_CATIDrwStackedDimSystem,(void **)&amp;piDrwStkSyst)))
  {
    double valueoffset = 12.0;
    piDrwStkSyst-&gt;SetValueAlignmentMode(AlignedOnCenter); 
    piDrwStkSyst-&gt;SetOffset(valueoffset);
    piDrwStkSyst-&gt;Release();piDrwStkSyst=NULL;
  }
  piDimSyst-&gt;LineUp(2);
}

  </pre>
    </td>
  </tr>
</table>
<p>The modification of dimension system dimensions line is insured by the moving 
of the dimension line of the &quot;master&quot; dimension. At the end of this operation, 
LineUp method allows to update the positioning of all others dimension line of 
the dimensions system.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<p align="right">&nbsp;</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="InShort"></a>In Short</h3>
<p>This use case shows how to create a state command creating and modifying a 
dimension system.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td valign="top">[1]</td>
    <td><a href="../CAADocUseCases/CAADocRunSample.htm">Building
      and Lauching a CAA V5 Use Case</a></td>
  </tr>
  <tr>
    <td valign="top">[2]</td>
    <td><a href="../CAADegUseCases/CAADegSampleGraph.htm">Implementing
      the Statechart Diagram</a></td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <strong>1</strong> [March 2008]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<p><i>Copyright © 2000, Dassault Systèmes. All rights reserved.</i></p>

</body>

</html>
