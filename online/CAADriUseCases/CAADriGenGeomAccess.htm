<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 12.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
<title>Editing Generated Geometry in a Generative View</title>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>Mechanical Design</h1>
    </td>
    <td valign="top">
      <h2>Drafting</h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>Editing Generated Geometry in a Generative View</h3>
      <em>How to access generated geometry</em></td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This article discusses the CAADrwGeomAccess use case. This use case
      explains how to a geometrical elements generated from 3D elements in a
      Drawing document. From now on, These elements will be called GenItem.</p>
      <ul>
        <li><a href="#Learn"><strong>What You Will Learn With This Use Case</strong></a></li>
        <li><a href="#UseCase"><strong>The CAADrwGeomAccess Use Case</strong></a></li>
        <ul>
          <li><a href="#What">What Does CAADrwGeomAccess Do</a></li>
          <li><a href="#How">How to Launch CAADrwGeomAccess</a></li>
          <li><a href="#Where">Where to Find the CAADrwGeomAccess Code</a></li>
        </ul>
        <li><a href="#Step"><strong>Step-by-Step</strong></a></li>
        <li><a href="#InShort"><strong>In Short</strong></a></li>
        <li><a href="#References"><strong>References</strong></a></li>
      </ul>
    </td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>This use case is intended to show you how to access to a GenItem elements in
generative view.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="UseCase"></a>The CAADrwGeomAccess Use Case</h3>
<p>CAADrwGeomAccess is a use case of the CAADraftingInterfaces.edu framework
that illustrates DraftingInterfaces framework capabilities.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="What"></a>What Does CAADrwGeomAccess Do?</h4>
<table>
  <caption>Fig. 1: Initial Document</caption>
  <tr>
    <td><img border="0" src="images/CAADrwGeomAccess1.jpg" width="531" height="554"></td>
  </tr>
</table>
<p>Fig. 1 represents the Drawing document on which a front view has been created
from a Part document. The document is not provided with the use case.</p>
<p>&nbsp;</p>
<table>
  <caption>Fig. 2 The Document modified by the Use Case</caption>
  <tr>
    <td><img border="0" src="images/CAADrwGeomAccess2.jpg" width="531" height="554"></td>
  </tr>
</table>
<p>Fig. 2 represents the Drawing document modified by the use case program:</p>
        <ul>
          <li>The red color has be been applied to all GenItem 
elements generated by the section plane.</li>
          <li>The
green color has been applied to all GenItem elements generated by the 
projection.</li>
        </ul>

<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="How"></a>How to Launch CAADrwGeomAccess</h4>
<p>To launch CAADrwGeomAccess, you will need to set up the build time
environment, then compile CAADrwGeomAccess along with its prerequisites, set up
the run time environment, and then execute the use case [<a href="#References">1</a>].</p>
<p>When you launch the use case, pass the full pathname of the Drawing file as
argument. A Drawing file is deliverry in the following path:
CAADraftingInterfaces.edu\CNext\resources\graphic\DrawingForGenGeomAccessUseCase.CATDrawing.
<ul>
  <li>With Windows
    <table width="90%">
      <tr>
        <td>
          <pre>e:&gt; mkrun -c cmd
CAADrwGeomAccess c:\...\DrawingForGenGeomAccessUseCase.CATDrawing c:\DrawingTestOutput.CATDrawing</pre>
        </td>
      </tr>
    </table>
  </li>
  <li>With UNIX
    <table width="90%">
      <tr>
        <td>
          <pre>$ mkrun -c cmd
CAADrwGeomAccess /u/users/.../DrawingForGenGeomAccessUseCase.CATDrawing  /u/users/DrawingTestOutput.CATDrawing</pre>
        </td>
      </tr>
    </table>
  </li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Where"></a>Where to Find the CAADrwGeomAccess Code</h4>
<p>The CAADrwGeomAccess use case is made of a single source file named
CAADrwGeomAccess.cpp located in the CAADrwGeomAccess.m module of the
CAADraftingInterfaces.edu framework:</p>
<table>
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAADraftingInterfaces.edu\CAADrwGeomAccess.m\</code></td>
  </tr>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAADraftingInterfaces.edu/CAADrwGeomAccess.m/</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="Step"></a>Step-by-Step</h3>
<p>There are six steps in CAADRWGeomAccess:</p>
<ol>
  <li><a href="#Creating">Creating and Initializing the Document</a></li>
  <li><a href="#Acces">Accessing the Drawing in the Document</a></li>
  <li><a href="#Navigating">Navigating through the Drawing and Get the current
    View</a></li>
  <li><a href="#Fact2D">Getting the Part document pointed by the Current View</a></li>
  <li><a href="#FactAnn">Reading and Coloring the Generated Geometry in the
    Current View</a></li>
  <li><a href="#Saving">Saving the Document and Exiting</a></li>
</ol>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Creating"></a>Creating and Initializing the Document</h4>
<table class="code">
  <tr>
    <td>
      <pre>int main(int    iArgc,   // Number of arguments (1) 
         char** iArgv)   // Path to the new *.CATDrawing document
{
  // Check arguments
  if(3 != iArgc) return 1;
  const char *fileName = iArgv[1];
  const char *fileNameOut = iArgv[2];

  // CREATE  SESSION
  // ==================

  CATSession *pSampleSession = NULL;
  HRESULT hr = ::Create_Session(&quot;SampleSession&quot;,pSampleSession);
  if (FAILED(hr)) return 1;
...</pre>
    </td>
  </tr>
</table>
<p>This section represents the usual sequence for loading a CATIA document [<a href="#References">2</a>].</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Acces"></a>Accessing the Drawing in the Document</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
  CATDocument* pDoc = NULL;
  if (!SUCCEEDED(CATDocumentServices::OpenDocument(fileName, pDoc)))
  {
    // Ends session
    ::Delete_Session(&quot;SampleSession&quot;);
    return 2;
  }</pre>
      <pre>  // Gets the drawing feature using the CATIDftDocumentServices interface
  CATIDrawing *piDrawing = NULL;
  <b>CATIDftDocumentServices</b> *piDftDocServices = NULL;
  if (SUCCEEDED(pDoc-&gt;QueryInterface(IID_CATIDftDocumentServices, (void **)&amp;piDftDocServices)))
  {
    piDftDocServices-&gt;<b>GetDrawing</b>(IID_<b>CATIDrawing</b>, (void **)&amp;piDrawing);
    piDftDocServices-&gt;<b>Release</b>();
  }

  if (NULL == piDrawing)
    return 1;
...</pre>
    </td>
  </tr>
</table>
<p>The root feature of a drawing document is the Drawing, that is, the feature
that implements the <i>CATIDrawing</i> interface. We can get a pointer to <i>CATIDrawing</i>
using the <i>CATIDftDocumentServices</i> interface, which is implemented by the
document. The <code>GetDrawing</code> method first argument is the <i>CATIDrawing</i>
interface IID.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Navigating"></a>Navigating through the Drawing and Sheet to Get the
Current View</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
  // We are working in front view of the current sheet
   CATISheet_var spSheet = piDrawing-&gt;GetCurrentSheet();
   piDrawing-&gt;Release();
   piDrawing=NULL;

   CATIDftSheet *piSheet = NULL;
   CATIDftView *piCurrentView = NULL;

   if (SUCCEEDED(spSheet-&gt;QueryInterface(IID_CATIDftSheet,(void**) &amp; piSheet) ) )
   {
      piSheet-&gt;GetDefaultActiveView (&amp;piCurrentView);
      piSheet-&gt;Release();
      piSheet=NULL;
   }
...</pre>
    </td>
  </tr>
</table>
<p>A drawing may contain several sheets, but only one is current at a time. The
current sheet is the sheet containing the active view, that is the view
currently edited. The methods of the <i>CATISheet</i> and <i>CATIView</i>
interfaces do return handlers, so we don&#8217;t need to care about releasing them.
The drawing variable is a pointer to <i>CATIDrawing</i>, so we have to release
when it's no longer used.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Fact2D"></a>Getting the Part Document Pointed by Current View</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
   CATIView_var spCurrentView = spSheet-&gt;GetCurrentView();
   CATILinkableObject_var spLink;
   CATDocument* pDocPart = NULL; 
   if (NULL_var != spCurrentView)
      spLink = spCurrentView-&gt;GetDoc();

   if (NULL_var != spLink)
       pDocPart = spLink-&gt;GetDocument();

   if (pDocPart)
   {
      CATInit_var spInitOnDoc(pDocPart);
      if(NULL_var == spInitOnDoc) return 5;
      
      // Retrieves the root container
      CATIPrtContainer * piPrtCont =  (CATIPrtContainer*) spInitOnDoc-&gt;GetRootContainer(&quot;CATIPrtContainer&quot;);	
      if (!piPrtCont)
      {
         // Ends session
         ::Delete_Session(&quot;SampleSession&quot;);
         return 6;
      }
      // Get the part feature of the container.
      CATIPrtPart_var spPart = piPrtCont-&gt;GetPart();
      piPrtCont-&gt;Release();
      piPrtCont=NULL;
   }
...</pre>
    </td>
  </tr>
</table>
<p>A link is created between a generative view&nbsp; and the CATPart document
associated&nbsp; to keep the 2D/3D associativity. So, we have to load the
CATPart document from this link.<br>
</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="FactAnn"></a>Reading and Coloring the Generated Geometry in the
Current View&nbsp;&nbsp;</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
  CATIDftGenGeomAccess *piGenGeomAccess = NULL;
   IUnknown *piGenView = NULL;
   if (NULL != piCurrentView) 
   {
      if (SUCCEEDED( piCurrentView-&gt;GetApplicativeExtension(IID_CATIDftGenView,&amp;piGenView)))
      {
         if (SUCCEEDED( piGenView-&gt;QueryInterface(IID_CATIDftGenGeomAccess, (void**) &amp; piGenGeomAccess) ) )
         {
            CATIUnknownList * piList = NULL;
            
            // Get a list containing all Generated Geometry of the view.
            if( SUCCEEDED( piGenGeomAccess-&gt;GetAllGeneratedItems(IID_CATIDftGenGeom, &amp;piList) ) )
            {
               unsigned int piListSize = 0;
               piList-&gt;Count(&amp;piListSize);
               
               CATIDftGenGeom * piGenGeom = NULL;
               IUnknown * item = NULL;
               CATUnicodeString  PartName;
               CATIVisProperties *piVisProp = NULL;
               CATVisPropertiesValues ioValues;
               CATVisPropertyType       iPropertyType = CATVPColor;
               
               // Loop on all Generated Geometry of the view.
               for(unsigned int i=0 ; i&lt;piListSize ; i++)
               {
                  if( SUCCEEDED( piList-&gt;Item(i, &amp;item) ) )
                  {
                     if(SUCCEEDED( item-&gt;QueryInterface(IID_CATIDftGenGeom, (void**) &amp; piGenGeom) ) )
                     {
                        CATCurve * Curve = NULL;
                        if (SUCCEEDED(piGenGeom-&gt;GetUnderlyingGeometry(&amp;Curve))) 
                        {
                           // Color modification
                           if(SUCCEEDED( piGenGeom-&gt;QueryInterface(IID_CATIVisProperties, (void**) &amp; piVisProp) ) )
                           {
			     CATBoolean cutInfo = FALSE;
			     if (SUCCEEDED(piGenGeom-&gt;IsCut(&amp;cutInfo)))
			     {
			       // Red color is applied for generated geometry coming from section 
			       if (cutInfo)
			         ioValues.SetColor( 255,0,0);
			       // Greeen color is applied for generated geometry coming from projection
			       else
                                 ioValues.SetColor( 0,255,0);

                               piVisProp-&gt;SetPropertiesAtt( ioValues, iPropertyType, CATVPLine);
                             }
                             piVisProp-&gt;Release();
                             piVisProp=NULL; 
                           }
                           Curve-&gt;Release(); Curve = NULL;
                        }
                        
                        // Memory clean                     
                        piGenGeom-&gt;Release(); piGenGeom = NULL;
                        item-&gt;Release(); item = NULL;
                     }
                  }
               }
               // Memory clean                     
               piList-&gt;Release(); piList = NULL;	
            }
            // Memory clean                     
            piGenGeomAccess-&gt;Release(), piGenGeomAccess = NULL;
         }
         // Memory clean                     
         piGenView-&gt;Release() , piGenView=NULL;
      }
      // Memory clean                     
      piCurrentView-&gt;Release() , piCurrentView=NULL;
   }

...</pre>
    </td>
  </tr>
</table>
<p>Note:&nbsp;</p>
<ol>
  <li>Color modification is done by using CATIVisProperties interface
    capabilities [<a href="#References">4</a>].</li>
  <li>These modifications are not kept after view update process because GenItem
    elements are deleted and recreated.</li>
</ol>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Saving"></a>Saving the Document and Exiting</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
  // Save the result
  rc = CATDocumentServices::<b>SaveAs</b>(*pDoc, (char *)fileName);
  ... // Check rc
  rc = CATDocumentServices::<b>Remove</b> (*pDoc);
  ... // Check rc
  // Ends session and drops document	
  rc = ::<b>Delete_Session</b>(&quot;SampleSession&quot;);
  ... // Check rc

  return 0;
}</pre>
    </td>
  </tr>
</table>
<p>This section represents the usual sequence for saving a newly created CATIA
document [<a href="#References">3</a>].</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="InShort"></a>In Short</h3>
<p>This use case shows the way to :</p>
<ol>
  <li>Open a Drawing document.</li>
  <li>Get the current view.</li>
  <li>Get the Part Document pointed by the generative view and open it.</li>
  <li>Scan all the generated geometry of the view.</li>
  <li>Modify the color of the aggregated curve to the GenItem elements by using
    CATVisProperties interfaces.</li>
</ol>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td valign="top">[1]</td>
    <td><a href="../CAADocUseCases/CAADocRunSample.htm">Building
      and Lauching CAA V5 Samples</a></td>
  </tr>
  <tr>
    <td valign="top">[2]</td>
    <td><a href="../CAAOmbUseCases/CAAOmbLoadDoc.htm">Load
      an existing Document</a></td>
  </tr>
  <tr>
    <td valign="top">[3]</td>
    <td><a href="../CAAVisUseCases/CAAVisSampleUseCATIVisProperties.htm">Modifying
      Object Graphical Properties</a></td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <strong>1</strong> [Dec 2002]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<p><i>Copyright © 2002, Dassault Systèmes. All rights reserved.</i></p>

</body>

</html>
