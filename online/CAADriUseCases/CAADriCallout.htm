<html>

 <head>
 <meta http-equiv="Content-Language" content="en-gb">
 <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
 <meta name="GENERATOR" content="Microsoft FrontPage 12.0">
 <meta name="ProgId" content="FrontPage.Editor.Document">
 <link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
 <title>Editing Callout in Generative Views</title>
 </head>

 <body>

 <table width="100%">
   <tr>
     <td valign="top">
     <h1>Mechanical Design</h1>
     </td>
     <td valign="top">
     <h2>Drafting</h2>
     </td>
     <td rowspan="2" align="right" valign="top">
     <h3><a name="Top"></a>Editing Callout in Generative Views</h3>
     <p><em>How to access and modify callouts in generative view</em></td>
   </tr>
   <tr>
     <td class="use" colspan="2">Use Case</td>
   </tr>
 </table>
 <hr>
 <!---------------------------------comment------------------------------------->
 <table class="abstract">
   <tr>
     <td>
     <h3>Abstract</h3>
     <p>This article discusses the CAADrwCallout use case. This use case 
     explains how to retrieve these elements in a generative view.</p>
     <ul>
       <li><a href="#Learn"><strong>What You Will Learn With This Use Case</strong></a></li>
       <li><a href="#UseCase"><strong>The CAADrwCallout Use Case</strong></a></li>
       <ul>
         <li><a href="#What">What Does CAADrwCallout Do</a></li>
         <li><a href="#How">How to Launch CAADrwCallout</a></li>
         <li><a href="#Where">Where to Find the CAADrwCallout Code</a></li>
       </ul>
       </li>
       <li><a href="#Step"><strong>Step-by-Step</strong></a></li>
       <li><a href="#InShort"><strong>In Short</strong></a></li>
       <li><a href="#References"><strong>References</strong></a></li>
     </ul>
     </td>
   </tr>
 </table>
 <hr>
 <!---------------------------------comment------------------------------------->
 <h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
 <p>This use case is intended to show you how to access callouts in generative 
 views.</p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h3><a name="UseCase"></a>The CAADrwCallout Use Case</h3>
 <p>CAADrwCallout is a use case of the CAADraftingInterfaces.edu framework that 
 illustrates DraftingInterfaces framework capabilities.</p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h4><a name="What"></a>What Does CAADrwCallout Do?</h4>
 <table height="657" width="100%">
   <tr>
     <td height="31">
     <p align="left">Fig. 1: Initial Document</td>
   </tr>
   <tr>
     <td height="14">
     <p align="center">
     <img border="0" src="images/CAADrwCallout1.jpg" align="left" width="919" height="659"></td>
   </tr>
   <tr>
     <td height="14">
     <p align="center">Fig. 1 represents a Drawing document containing 
     generative views created from a Part document.</td>
   </tr>
 </table>
 <p>&nbsp;</p>
 <p>&nbsp;</p>
 <table height="640" width="100%">
   <tr>
     <td height="14">
     <p align="center">Fig. 2 The Document modified by the Use Case</td>
   </tr>
   <tr>
     <td height="14">
     <p align="left">
     <img border="0" src="images/CAADrwCallout2.jpg" width="950" height="679"></td>
   </tr>
   <tr>
     <td height="14">
     <p align="center">Fig. 2 represents the Drawing document modified by the 
     use case program. </p>
     <p align="center">All Callouts have been modified by ApplyStyle internal 
     method defined in this Use Case, thus, arrows of callout have been changed.</td>
   </tr>
 </table>
 <p>&nbsp;</p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h4><a name="How"></a>How to Launch CAADrwCallout</h4>
 <p>To launch CAADrwCallout, you will need to set up the build time environment, 
 then compile CAADrwCallout along with its prerequisites, set up the run time 
 environment, and then execute the use case [<a href="#References">1</a>].</p>
 <p>When you launch the use case, pass the full pathname of the Drawing file as 
 argument. A Drawing file is delivery in the following path: 
 CAADraftingInterfaces.edu\CNext\resources\graphic\DrawingForCalloutUseCase.CATDrawing.
 </p>
 <ul>
   <li>With Windows
   <table width="100%">
     <tr>
       <td>
       <pre>e:&gt; mkrun -c cmd
CAADrwCallout c:\...\DrawingForCalloutUseCase.CATDrawing c:\DrawingTestOutput.CATDrawing</pre>
       </td>
     </tr>
   </table>
   </li>
   <li>With UNIX
   <table width="100%">
     <tr>
       <td>
       <pre>$ mkrun -c cmd
CAADrwCallout /u/users/.../DrawingForCalloutUseCase.CATDrawing  /u/users/DrawingTestOutput.CATDrawing</pre>
       </td>
     </tr>
   </table>
   </li>
 </ul>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h4><a name="Where"></a>Where to Find the CAADrwCallout Code</h4>
 <p>The CAADrwCallout use case is made of a single source file named 
 CAADrwCallout.cpp located in the CAADrwCallout.m module of the 
 CAADraftingInterfaces.edu framework:</p>
 <table>
   <tr>
     <td>Windows</td>
     <td><code>InstallRootDirectory\CAADraftingInterfaces.edu\CAADrwCallout.m\</code></td>
   </tr>
   <tr>
     <td>Unix</td>
     <td><code>InstallRootDirectory/CAADraftingInterfaces.edu/CAADrwCallout.m/</code></td>
   </tr>
 </table>
 <p>where <code>InstallRootDirectory</code> is the directory where the CAA 
 CD-ROM is installed.</p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h3><a name="Step"></a>Step-by-Step</h3>
 <p>There are seven steps in CAADrwCallout:</p>
 <ol>
   <li><a href="#Opening">Opening a Drawing Document</a></li>
   <li><a href="#Accessing">Accessing the Drawing Root in the Document</a></li>
   <li><a href="#Accessing Callouts">Accessing all Callouts in all Views</a></li>
   <li><a href="#Fact2D">Getting the View from Callout</a></li>
   <li><a href="#Getting Geometric">Getting Geometric Informations of Profile 
   Associated with a Generative View</a></li>
   <li><a href="#FactAnn">Modifying Callout Representation</a></li>
   <li><a href="#Saving">Saving the Document and Exiting</a></li>
 </ol>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h4><a name="Opening"></a>Opening a Drawing Document</h4>
 <table class="code">
   <tr>
     <td>
     <pre>int main(int iArgc, // Number of arguments (3) 
char** iArgv) // Path to the existing file *.CATDrawing document
{
// Check arguments
if(3 != iArgc) return 1;
const char *pfileNameDrawing = iArgv[1];
const char *pfileNameOut = iArgv[2];

// return code error
int rc =0;

// CREATE THE SESSION
// =====================

CATSession *pSampleSession = NULL;
HRESULT hr = ::Create_Session(&quot;SampleSession&quot;,pSampleSession);
if (FAILED(hr)) return 1;</pre>
     <pre>CATIDftDrawing *piDrawing = NULL;
CATIDftDocumentServices *piDftDocServices = NULL;
CATDocument* pDocDrawing = NULL;

if (FAILED(CATDocumentServices::OpenDocument(pfileNameDrawing, pDocDrawing)))
{
// Ends session
::Delete_Session(&quot;SampleSession&quot;);
return 2;
}
...</pre>
     </td>
   </tr>
 </table>
 <p>This section represents the usual sequence for loading a CATIA document [<a href="#References">2</a>].</p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h4><a name="Accessing"></a>Accessing the Drawing Root in the Document</h4>
 <table class="code">
   <tr>
     <td>
     <pre>...
CATIDftDrawing *piDrawing = NULL;
CATIDftDocumentServices *piDftDocServices = NULL;
if (SUCCEEDED(pDocDrawing-&gt;QueryInterface(IID_CATIDftDocumentServices,(void **)&amp;piDftDocServices)))
{
  if (SUCCEEDED(piDftDocServices-&gt;GetDrawing(IID_CATIDftDrawing, (void **)&amp;piDrawing)))
  {
    piDftDocServices-&gt;Release();
    piDftDocServices=NULL;
  }
...</pre>
     </td>
   </tr>
 </table>
 <p>The root feature of a Drawing document is the Drawing itself, that is, the 
 feature that implements the <i>CATIDftDrawing</i> interface. We can get a 
 pointer to <i>CATIDftDrawing</i> using the <i>CATIDftDocumentServices</i> 
 interface, which is implemented by the document. The <code>GetDrawing</code> 
 method first argument is the <i>CATIDftDrawing</i> interface IID.</p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <h4><a name="Accessing Callouts"></a>Accessing all Callout in the Drawing 
 Document</h4>
 <table class="code">
   <tr>
     <td>
     <pre>...
// LOOP ON ALL VIEWS IN DRAWING
// ================================
CATIUnknownList * piListOfView = NULL;
if (SUCCEEDED(piDrawing-&gt;GetViews(&amp;piListOfView)))
{
  unsigned int piViewListSize = 0;
  piListOfView-&gt;Count(&amp;piViewListSize);

  IUnknown * itemView = NULL;
  CATIDftView *piCurrentView = NULL;

  // Loop on all callouts of the processed view 
  // -----------------------------------------------
  for(unsigned int numview=0 ; numview&lt;piViewListSize ; numview++)
  {
    if( SUCCEEDED( piListOfView-&gt;Item(numview, &amp;itemView) ) )
    {
      if (itemView)
      {
        if (SUCCEEDED(itemView-&gt;QueryInterface(IID_CATIDftView,(void **)&amp;piCurrentView)))
        {
          CATIUnknownList * piListOfCallout = NULL;

          // Get list of callouts of the view processed
          // ----------------------------------------------
          if( SUCCEEDED( piCurrentView-&gt;GetComponents(IID_CATIDrwCalloutAccess, &amp;piListOfCallout) ) )
          {
            if (piListOfCallout)
            {
              unsigned int piListSize = 0;
              piListOfCallout-&gt;Count(&amp;piListSize);

              CATIDrwCalloutAccess* piCallout = NULL;
              IUnknown * item = NULL;

              // Loop on all callouts of the view processed
              // ----------------------------------------------
              for(unsigned int i=0 ; i&lt;piListSize ; i++)
              {
                if( SUCCEEDED( piListOfCallout-&gt;Item(i, &amp;item) ) )
                {
                  if(SUCCEEDED( item-&gt;QueryInterface(IID_CATIDrwCalloutAccess, (void**) &amp; piCallout) ) )
                  {
</pre>
     <pre>...</pre>
     </td>
   </tr>
 </table>
 <p>The GetViews method returns the list of all views in Drawing document. The 
 GetComponents method of CATIDftView interface is a generic method to return 
 elements identified by his IID.</p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h4><a name="Fact2D"></a>Getting the View from Associated Callout</h4>
 <table class="code">
   <tr>
     <td>
     <pre>...
// Get the view associated with the callout
// -------------------------------------------
CATIDftView *piDefView=NULL;

if (SUCCEEDED(piCallout-&gt;GetAssociatedView(&amp;piDefView)))
{
  piDefView-&gt;GetViewName(&amp;pViewName);
  ViewName.BuildFromWChar(pViewName);
  cerr &lt;&lt; &quot; View name associated to the processed callout: &quot; &lt;&lt; ViewName.CastToCharPtr() &lt;&lt; endl;
...</pre>
     </td>
   </tr>
 </table>
 <p>GetAssociatedView method defined in CATIDrwCalloutAccess interface returns 
 the View from which Callout is defined. In case of Broken View, Callout are 
 created in the same View, So GetAssociatedView is useless.</p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h4><a name="Getting Geometric"></a>Getting Geometric Information of a Profile 
 Associated to a Generative View</h4>
 <table class="code">
   <tr>
     <td>
     <pre>...

CATIGenerSpec *piGenerSpec=NULL;
if (SUCCEEDED(piDefView-&gt;GetGenerSpec(&amp;piGenerSpec)))
{</pre>
     <pre>  // Get callout type
  // -------------------
  CATIDrwCalloutAccess::CATDrwCalloutType calloutType;
  piCallout-&gt;GetCalloutType(calloutType);

  if (calloutType == CATIDrwCalloutAccess::SectionCallout)
  {
    CATListPtrCATMathPoint2D ListOfPoints;    
    int depli=0;
    CATMathDirection vecpro;

    // Get geometric informations about section profile
    // ---------------------------------------------------------
    if (SUCCEEDED(piGenerSpec-&gt;GetSectionProfile(ListOfPoints,depli,vecpro)))
    {
      int NbPt = ListOfPoints.Size();
      for (int numpt=1 ; numpt&lt;=NbPt ; numpt++)
      {
        CATMathPoint2D *tmpt = ListOfPoints[numpt];
        cerr &lt;&lt; &quot; Number point = &quot; &lt;&lt; numpt &lt;&lt; &quot;, X= &quot;&lt;&lt; tmpt-&gt;GetX() &lt;&lt; &quot;Y = &quot; &lt;&lt; tmpt-&gt;GetY() &lt;&lt; endl;

        // Memory clean
        if (tmpt) delete tmpt , tmpt=NULL;
      }
    } 
  }</pre>
     <pre>...</pre>
     </td>
   </tr>
 </table>
 <p>From the Associated view to the Callout, It is possible to retrieve the 
 definition of the View. For example for a Section View, the Cutting Profile may 
 be obtained by GetSectionProfile method defined in CATIGenerSpec Interface.</p>
 <p>Note: depli and vecpro arguments are dedicated to give information about the 
 type of the profile (Aligned Section View or Offset Section View)</p>
 <p>&nbsp;</p>
 <!---------------------------------comment------------------------------------->
 <h4><a name="FactAnn"></a>Modifying the Callout Representation.</h4>
 <table class="code">
   <tr>
     <td>
     <pre>...
int NbTexts;
rc = piCallout-&gt;GetNumberOfTexts(NbTexts);
if (SUCCEEDED(rc))
{
  for (int iNumText = 1; iNumText &lt;= NbTexts ; iNumText++)
  {
    CATIDrwAnnotationComponent *piAnnot=NULL;
    rc = piCallout-&gt;GetCalloutText(iNumText,&amp;piAnnot);
    if (SUCCEEDED(rc))
    {
      CATIDrwSimpleText *piText=NULL;
      CATIDftText *piDftText = NULL;</pre>
     <pre>      // Callout texts may be based on simple text instance until V5R13 CATIA level.
      if (SUCCEEDED(piAnnot-&gt;QueryInterface(IID_CATIDrwSimpleText,(void **)&amp;piText)))
      {
        CATIDrwSubText_var spSubText;
        spSubText = piText-&gt;GetSubText(1);
        CATUnicodeString textName = spSubText-&gt;GetText();
        cerr &lt;&lt; &quot; texte name = &quot; &lt;&lt; textName.CastToCharPtr() &lt;&lt; endl;

        piText-&gt;Release(); piText=NULL;
      }
      else if(SUCCEEDED(piAnnot-&gt;QueryInterface(IID_CATIDftText,(void **)&amp;piDftText)))
      {
        wchar_t *ptextName=NULL;
        if (SUCCEEDED(piDftText-&gt;GetString(&amp;ptextName)))
        {
          CATUnicodeString strTextName;
          strTextName.BuildFromWChar(ptextName);
          cerr &lt;&lt; &quot; texte name = &quot; &lt;&lt;strTextName.CastToCharPtr() &lt;&lt; endl;
          if (ptextName) delete[] ptextName; ptextName = NULL;
        }
        piDftText-&gt;Release();piDftText=NULL;
      }
      piAnnot-&gt;Release();piAnnot=NULL;
    }
  }</pre>
     <pre>  // Modification of the callout Representation</pre>
     <pre>  int thickness = 2;
  rc = piCallout-&gt;SetProfileThickness(thickness);

  int linetype = 3;
  rc = piCallout-&gt;SetProfileLineType(linetype);


  int NbArrows;
  rc =piCallout-&gt;GetNumberOfArrow(NbArrows);
  if (SUCCEEDED(rc))
  {
    for (int iNumArrow = 1; iNumArrow &lt;= NbArrows ; iNumArrow++)
    {
      double ArrowLength,ArrowLengthSymb,ArrowAngleSymb,ArrowOrientation;
      CATSymbolType ArrowTypeSymb;
      ArrowLength=35.0;
      ArrowTypeSymb=FILLED_ARROW;
      ArrowLengthSymb=6.0;
      ArrowAngleSymb=45.0;

      rc = piCallout-&gt;SetInfoOfArrow(iNumArrow,ArrowLength,ArrowTypeSymb,ArrowLengthSymb,ArrowAngleSymb);
    }

    if (NbArrows != 0)
    {
      CATDftArrowExtremity calloutAttachment;
      rc = piCallout-&gt;GetArrowsAttachment(calloutAttachment);
      calloutAttachment= CATDftArrowTail;
      rc = piCallout-&gt;SetArrowsAttachment(calloutAttachment);
    }
  }
}
...</pre>
     </td>
   </tr>
 </table>
 <p>Note: Up to V5R13, associated texts to the Callout may be based on simple 
 text instance.</p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <!---------------------------------comment------------------------------------->
 <h4><a name="Saving"></a>Saving the Document and Exiting</h4>
 <table class="code">
   <tr>
     <td>
     <pre>...
  // Save the result
  rc = CATDocumentServices::<b>SaveAs</b>(*pDoc, (char *)fileName);
  ... // Check rc
  rc = CATDocumentServices::<b>Remove</b> (*pDoc);
  ... // Check rc
  // Ends session and drops document	
  rc = ::<b>Delete_Session</b>(&quot;SampleSession&quot;);
  ... // Check rc

  return 0;
}</pre>
     </td>
   </tr>
 </table>
 <p>This section represents the usual sequence for saving a newly created CATIA 
 document [<a href="#References">3</a>].</p>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <hr>
 <!---------------------------------comment------------------------------------->
 <h3><a name="InShort"></a>In Short</h3>
 <p>This use case shows the way to :</p>
 <ol>
   <li>Open a Drawing document.</li>
   <li>Scan all Callout in the document</li>
   <li>Retrieve Associated View to the Callout.</li>
   <li>Retrieve Geometric Definition of a Generative View linked to a Callout.</li>
   <li>Read and modify representation of a Callout</li>
   <li>Save the document.</li>
 </ol>
 <p align="right">[<a href="#Top">Top</a>]</p>
 <hr>
 <!---------------------------------comment------------------------------------->
 <h3><a name="References"></a>References</h3>
 <table width="100%">
   <tr>
     <td valign="top">[1]</td>
     <td>
     <a href="../CAADocUseCases/CAADocRunSample.htm">
     Building and Lauching CAA V5 Samples</a></td>
   </tr>
   <tr>
     <td valign="top">[2]</td>
     <td>
     <a href="../CAAOmbUseCases/CAAOmbLoadDoc.htm">
     Load an existing Document</a></td>
   </tr>
   <tr>
     <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
   </tr>
 </table>
 <hr>
 <!---------------------------------comment------------------------------------->
 <h3><a name="History"></a>History</h3>
 <table width="100%">
   <tr>
     <td valign="top">Version: <strong>1</strong> [May 2004]</td>
     <td valign="top">Document created</td>
   </tr>
   <tr>
     <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
   </tr>
 </table>
 <hr>
 <!---------------------------------comment------------------------------------->
 <p><i>Copyright © 2004, Dassault Systèmes. All rights reserved.</i></p>

 </body>

</html>
