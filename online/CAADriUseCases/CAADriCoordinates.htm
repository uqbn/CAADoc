<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 6.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
<title>Creating Annotations on View Components</title>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>Mechanical Design</h1>
    </td>
    <td valign="top">
      <h2>Drafting</h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>Creating Annotations on View Components</h3>
      <em>How to retrieve view components</em></td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This article discusses the CAADrwCoordinates use case. This use case
      explains how to retrieve the view components.</p>
      <ul>
        <li><a href="#Learn"><strong>What You Will Learn With This Use Case</strong></a></li>
        <li><a href="#UseCase"><strong>The CAADrwCoordinates Use Case</strong></a></li>
        <ul>
          <li><a href="#What">What Does CAADrwCoordinates Do</a></li>
          <li><a href="#How">How to Launch CAADrwCoordinates</a></li>
          <li><a href="#Where">Where to Find the CAADrwCoordinates Code</a></li>
        </ul>
        <li><a href="#Step"><strong>Step-by-Step</strong></a></li>
        <li><a href="#InShort"><strong>In Short</strong></a></li>
        <li><a href="#References"><strong>References</strong></a></li>
      </ul>
    </td>
  </tr>
</table>
<!---------------------------------comment------------------------------------->
<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>This use case is intended to retrieve the view components. These components
can be :</p>
<ul>
  <li>Geometry</li>
  <li>Annotations</li>
  <li>Generative results.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="UseCase"></a>The CAADrwCoordinates Use Case</h3>
<p>CAADrwCoordinates is a use case of the CAADraftingInterfaces.edu framework
that illustrates DraftingInterfaces framework capabilities.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="What"></a>What Does CAADrwCoordinates Do</h4>
<table width="100%">
  <caption><a name="Fig1"></a>Fig. 1 The Document Before Running
    CAADrwCoordinates</caption>
  <tr>
    <td><img src="images/CAADrwCoordinates1.jpg" width="582" height="455"></td>
  </tr>
</table>
<p>Fig. 1 represents a CATDrawing document containing 2D points.</p>
<table width="100%">
  <caption>Fig. 2 The Document After Running CAADrwCoordinates</caption>
  <tr>
    <td><img src="images/CAADrwCoordinates2.jpg" width="581" height="455"></td>
  </tr>
</table>
<p>Fig. 2 represents the previous CATDrawing after CAADrwCoordinates processing.<br>
A text has been created near each point. This text is formatted like follows :</p>
<p><u>Point <i>point index</i><br>
</u>X = <i>the x point coordinate<br>
</i>Y = <i>the y point coordinate</i></p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="How"></a>How to Launch CAADrwCoordinates</h4>
<p>To launch CAADrwCoordinates, you will need to set up the build time
environment, then compile CAADrwCoordinates along with its prerequisites, set up
the run time environment, and then execute the use case [<a href="#References">1</a>].</p>
<p>The CATDrawing document <a href="#Fig1">Fig. 1</a> is saved in the Framework
CAADraftingInterfaces.edu/Cnext/Resources/graphic/CAADrwCoordinates.CATDrawing.
<p>When you launch the use case, pass the full pathname of the file into which
you you want to store the created document as argument: for example
Result.CATDrawing.
<ul>
  <li>With Windows
    <table width="90%">
      <tr>
        <td>
          <pre>e:&gt; CAADrwCoordinates CAADrwCoordinates.CATDrawing Result.CATDrawing</pre>
        </td>
      </tr>
    </table>
  </li>
  <li>With UNIX
    <table width="90%">
      <tr>
        <td>
          <pre>$ CAADrwCoordinates /u/users/CAADrwCoordinates.CATDrawing Result.CATDrawing</pre>
        </td>
      </tr>
    </table>
  </li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Where"></a>Where to Find the CAADrwCoordinates Code</h4>
<p>The CAADrwCoordinates use case is made of a single source file named
CAADrwCoordinates.cpp located in the CAADrwCoordinates.m module of the
CAADraftingInterfaces.edu framework:</p>
<table>
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAADraftingInterfaces.edu\CAADrwCoordinates.m\</code></td>
  </tr>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAADraftingInterfaces.edu/CAADrwCoordinates.m/</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="Step"></a>Step-by-Step</h3>
<p>There are six steps in CAADRWCoordinates:</p>
<ol>
  <li><a href="#Creating">Reading the Document</a></li>
  <li><a href="#Acces">Accessing the Drawing in the Document</a></li>
  <li><a href="#Navigating">Navigating through the Drawing and Sheet to Get the
    Active View</a></li>
  <li><a href="#Fact2D">Getting the View Points</a></li>
  <li><a href="#FactAnn">Scanning Points and Creating Texts</a></li>
  <li><a href="#Saving">Saving the Document and Exiting</a></li>
</ol>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Creating"></a>Reading the Document</h4>
<table class="code">
  <tr>
    <td>
      <pre>int main(int    iArgc,   // Number of arguments (1) 
         char** iArgv)   // Path to the *.CATDrawing document
{
   // Check arguments
   if(2 != iArgc) return 1;
   const char *fileName = iArgv[1];
   

   // READ THE DRAWING DOCUMENT
   // =========================

   // creates a session
   <b>CATSession</b> *pSampleSession = NULL;
   HRESULT hr = <b>::Create_Session</b>(&quot;SampleSession&quot;,pSampleSession);
   if (FAILED(hr)) return 1;

   // read the document
   <b>CATDocument</b>* pDoc = NULL;
   if (!SUCCEEDED(<b>CATDocumentServices::OpenDocument</b>(fileName, pDoc)))
   {
      // Ends session
      ::Delete_Session(&quot;SampleSession&quot;);
      return 2;
   }
...</pre>
    </td>
  </tr>
</table>
<p>This section represents the usual sequence for reading a CATIA document [<a href="#References">2</a>].</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Acces"></a>Accessing the Drawing in the Document</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
   // Gets the drawing feature using the CATIDftDocumentServices interface
   <b>CATIDrawing</b> *piDrawing = NULL;
   <b>CATIDftDocumentServices</b> *piDftDocServices = NULL;
   if (SUCCEEDED(pDoc-&gt;QueryInterface(IID_CATIDftDocumentServices, (void **)&amp;piDftDocServices)))
   {
      piDftDocServices-&gt;<b>GetDrawing</b>(IID_CATIDrawing, (void **)&amp;piDrawing);
      piDftDocServices-&gt;Release();
   }

   if (NULL == piDrawing)
      return 3;
...</pre>
    </td>
  </tr>
</table>
<p>The root feature of a drawing document is the Drawing, that is, the feature
that implements the <i>CATIDrawing</i> interface. We can get a pointer to <i>CATIDrawing</i>
using the <i>CATIDftDocumentServices</i> interface, which is implemented by the
document. The <code>GetDrawing</code> method first argument is the <i>CATIDrawing</i>
interface IID.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Navigating"></a>Navigating through the Drawing and Sheet to Get the
Active View</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
   // We can get the current sheet
   <b>CATISheet</b>_var spSheet = piDrawing-&gt;<b>GetCurrentSheet</b>();
   // And the sheet current view
   <b>CATIView</b>_var spCurrentView = spSheet-&gt;<b>GetCurrentView</b>();

   // Memory cleaning
   piDrawing-&gt;Release();
...</pre>
    </td>
  </tr>
</table>
<p>A drawing may contain several sheets, but only one is the current one. The
current sheet is the sheet containing the active view, that is the view
currently edited. The methods of the <i>CATISheet</i> and <i>CATIView</i>
interfaces do return handlers, so we do not need to care about releasing them.
The drawing variable is a pointer to <i>CATIDrawing</i>, so we have to release
it when it is no longer used.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Fact2D"></a>Getting the View Points</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
   // Now we do seek all the points in the view
   <b>CATIDescendants</b>_var spDesc = spCurrentView;
   CATListValCATISpecObject_var pointList;
   spDesc-&gt;<b>GetDirectChildren</b> (&quot;CATI2DPoint&quot;,pointList);
...</pre>
    </td>
  </tr>
</table>
<p>The view geometry can be retrieved using the <i>CATIDescendants</i>
interface. The first argument of the <i>GetDirectChildren</i> method is a scan
filter. In this example, we only get points.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="FactAnn"></a>Scanning Points and Creating Texts</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
 // loop on points
 for (int ii=1; ii&lt;=pointList.Size(); ii++)
 {
   // Gets the coordinates
   CATI2DPoint_var spPoint = pointList[ii];
   double coord[2];
   spPoint-&gt;GetPointData(coord);
   // Compute the string
   CATUnicodeString textString(&quot;Point &quot;);
   CATUnicodeString index;
   index.BuildFromNum(ii);
   textString += index;
   int titleLength = textString.GetLengthInChar();
   textString.Append(&quot;\n&quot;);
   textString.Append(&quot;X = &quot;);
   CATUnicodeString coordText[2];
   coordText[0].BuildFromNum(coord[0]);
   textString.Append(coordText[0]);
   textString.Append(&quot;\n&quot;);
   textString.Append(&quot;Y = &quot;);
   coordText[1].BuildFromNum(coord[1]);
   textString.Append(coordText[1]);

   // Creates the Text
   CATIDrwAnnotationFactory_var spAnnFactory = spCurrentView;
   CATIDftText *piDftText = NULL;
   const double txtpos[2] = {coord[0]+10.0,coord[1]+10.0};
   if (SUCCEEDED(spAnnFactory-&gt;CreateDftText(txtpos, &amp;piDftText)))
   {
     wchar_t *ptxtChar = new wchar_t[textString.GetLengthInChar()+1];
     textString.ConvertToWChar(ptxtChar);
     piDftText-&gt;SetString(ptxtChar);
     delete [] ptxtChar;
     ptxtChar = NULL; 
     CATIDrwSubString *piDrwSubString = NULL;
     if (SUCCEEDED(piDftText-&gt;QueryInterface(IID_CATIDrwSubString,(void **)&amp;piDrwSubString)))
     {
       // Select the sub string to modifiable.
       piDrwSubString-&gt;SetSelection(1,8);

       // Modify the properties
       CATIDftTextProperties *piTextProp = NULL;
       if (SUCCEEDED(piDftText-&gt;GetTextProperties(&amp;piTextProp)))
       {
         piTextProp-&gt;SetBold(TRUE);
         piTextProp-&gt;SetUnderline(TRUE);
         piTextProp-&gt;Release();piTextProp=NULL;
       }
       piDrwSubString-&gt;Release();piDrwSubString=NULL;
     }
     piDftText-&gt;Release();piDftText=NULL;
   }
  }

...</pre>
    </td>
  </tr>
</table>
<p>We loop on the points and get the coordinates using <i>CATI2DPoint::GetPointData</i>.
The text string is computed using <i>CATUnicodeString</i> operators.<br>
The <i>CATIDrwAnnotationFactory</i> annotation factory is implemented by the
view and so the coordinates passed in <code>CreateDrwText</code> are view
coordinates. The <i>CATIDrwTextProperties</i> interface allows text property
modifications, such as setting the text with a bold typeface using the <code>SetBold</code>
method.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Saving"></a>Saving the Document and Exiting</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
   // Save the result
   hr = CATDocumentServices::SaveAs(*pDoc, (char *)fileNameOut);
   if (FAILED(hr)) return 4;</pre>
      <pre>   // Ends session and drops document	
   CATDocumentServices::Remove (*pDoc);
   ::Delete_Session(&quot;SampleSession&quot;);


   return 0;
}</pre>
    </td>
  </tr>
</table>
<p>This section represents the usual sequence for saving a CATIA document [<a href="#References">2</a>].</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="InShort"></a>In Short</h3>
<p>This use case shows how to get the view components. The view implements the <i>CATIDescendants</i>
interface and the components can be retrieved by using the <i>GetDirectChildren</i>
method.</p>
<p>This use case shows also how to open a CATDrawing document, get the root
feature which implements the <i>CATIDrawing</i> interface. A pointer to this
interface is the key to enter and navigate inside the drawing structure, and can
be retrieved using the <code>GetDrawing</code> method of the <i>CATIDftDocumentServices</i>
interface implemented by the document. Retrieving the active view is performed
first by retrieving the current sheet thanks to the <code>GetCurrentSheet</code>
method of the <i>CATIDrawing</i> interface, and then asking the current sheet
for the current view using the <code>GetCurrentView</code> of <i>CATISheet</i>.
This current view is scanned using the <i>GetDirectChildren</i> method of <i>CATIDescendants</i>.<br>
The view also implements the <i>CATIDrwAnnotationFactory</i> interface and the
texts are created using its <code>CreateDrwText</code> method, and set with a
bold typeface using the <code>SetBold</code> method.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td valign="top">[1]</td>
    <td><a href="../CAADocUseCases/CAADocRunSample.htm">Building
      and Lauching CAA V5 Samples</a></td>
  </tr>
  <tr>
    <td valign="top">[2]</td>
    <td><a href="../CAAOmbUseCases/CAAOmbNewDoc.htm">Creating
      a New Document</a></td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <strong>1</strong> [Jan 2000]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<p><i>Copyright © 2000, Dassault Systèmes. All rights reserved.</i></p>

</body>

</html>
