<html>



<head>

<meta http-equiv="Content-Language" content="en-us">

<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<meta name="GENERATOR" content="Microsoft FrontPage 6.0">

<meta name="ProgId" content="FrontPage.Editor.Document">

<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">

<title>File Based Import in Batch</title>

</head>



<body>



<table width="100%">

  <tr>

    <td valign="top">

      <h1>3D PLM PPR Hub Open Gateway</h1>

    </td>

    <td>

      <h2>CATIA - ENOVIA VPM V4 Interoperability</h2>

    </td>

    <td rowspan="2" align="right" valign="top">

      <h3><a name="Top"></a>File Based Import</h3>

      <em>Importing an assembly in Structure Exploded mode</em></td>

  </tr>

  <tr>

    <td class="use" colspan="2">Use Case</td>

  </tr>

</table>

<hr>

<!---------------------------------comment------------------------------------->

<table class="abstract">

  <tr>

    <td>

      <h3>Abstract</h3>

      <p>This article discusses the CAAPsnUseCase1 use case. This use case

      explains how to import a file based assembly in the ENOVIA VPM V4 database in Structure Exposed mode. The import

      is performed in batch from Windows platform.

      This use case makes reference to the <a href="./CAAPsnUECreate.htm">CAAPsnUECreate use case</a> which explains

      how implement the <tt>CATIPDMUECreate</tt> user exit required to set the attributes for the parts and documents 

      that will be created in ENOVIA vpm V4. It also contains an implementation of the <tt>CATIPDMUECreate</tt> 

      and <tt>CATIPDMUnixNTMapping</tt> interfaces that are not explained in detail in this use case.</p>

      <ul>

        <li><strong><a href="#Learn">What You Will Learn With This Use Case</a></strong></li>

        <li><a href="#UseCase"><strong>The <i>CAAPsnUseCase1</i> Use Case</strong></a>

          <ul>

            <li><a href="#What">What Does <i>CAAPsnUseCase1</i> Do</a></li>

            <li><a href="#How">How to Launch <i>CAAPsnUseCase1</i></a></li>

            <li><a href="#Where">Where to Find the <i>CAAPsnUseCase1</i> Code</a></li>

          </ul>

        </li>

        <li><strong><a href="#Step">Step-by-Step</a></strong></li>

        <li><strong><a href="#InShort">In Short</a></strong></li>

        <li><strong><a href="#References">References</a></strong></li>

      </ul>

    </td>

  </tr>

</table>

<hr>

<!---------------------------------comment------------------------------------->

<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>

<p>This use case is an example of how to use the <tt>SetPDMProperties</tt> method.</p>

<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h3><a name="UseCase"></a>The <i><b>CAAPsnUseCase1</b></i> Use Case</h3>

<p><i>CAAPsnUseCase1</i>&nbsp;is a use case of the <b>CAAPSNInteroperability.edu</b>

framework that illustrates the PSNInteroperability framework capabilities.</p>

<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="What"></a>What Does <i>CAAPsnUseCase1</i> Do</h4>

<p>The goal of <i>CAAPsnUseCase1</i>&nbsp; is to import in ENOVIA VPM V4 a file based assembly in Structure Exploded mode:

<ul>

<li>for a CATProduct, the document is saved in Structure Exploded mode</li>

<li>for a CATPart or any other type than a CATProduct, the document is saved in Publication Exposed mode.</li>

</ul>

   <table border="0" style="border-collapse: collapse" bordercolor="#111111"  id="AutoNumber1">

     <caption><a name="Fig.1">Fig.1</a>: &nbsp; Sample product structure&nbsp; 

     </caption>

     <tr>

       <td width=75%><img border="2" src="images/UseCase1-2.jpg" width="497" height="185"> </td>

       <td width=25%><img border="0" src="images/UseCase1-1.jpg" width="193" height="87"> </td>

     </tr>

   </table>

   </p>

<p>As a result of the execution of the use case, the following product structure is created in ENOVIA vpm V4</p>

 <table border="0" style="border-collapse: collapse" bordercolor="#111111" id="AutoNumber2">

     <caption><a name="Fig.1">Fig.2</a>: &nbsp; Imported product structure in ENOVIA vpm  V4&nbsp; 

     </caption>

     <tr>

       <td width=50%><img border="2" src="images/UseCase1-3.jpg" width="1057" height="255"> </td>

     </tr>

   </table>

 <p><b>Note</b>Running this use case creates new data in ENOVIA vpm V4. Prior to running it, we advise you

 to check if similar part number already exist in ENOVIA vpm as shown in the following panels:</p>

 <table border="0" style="border-collapse: collapse" bordercolor="#111111"   id="AutoNumber3">

     <tr>

       <td width=50%><img border="2" src="images/UseCase1-4a.jpg" width="567" height="237"> </td>

       <td width=50%><img border="0" src="images/UseCase1-4b.jpg" width="567" height="237"> </td>

     </tr>

   </table>

<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="How"></a>How to Launch <i>CAAPsnUseCase1</i></h4>

<p>To launch CAAPsnUseCase1, you will need to set up the build time environment,

then compile CAAPsnUseCase1 along with its prerequisites, set up the run time

environment, and then execute the use case [<a href="#References">1</a>].  

To launch it, execute the following command:</p>

   <pre>mkrun -c &quot;CAAPsnUseCase1 rootFilepath hostName user pwd role server &quot;</pre>

   <p>where </p>

   <ul>

     <li><code>rootFilepath </code> is&nbsp;the full path of the <b>root document</b> of the assembly. 

     This must be a CATProduct. All the documents referenced in this assembly are located

     in the same directory.</li>

     <li><code>hostName</code> is&nbsp;the name of the Unix host on which the communication 

     server will be launched.</li>

    <li><code>user</code> is&nbsp;the user name used for the database connection.</li>

    <li><code>pwd</code> is&nbsp;the password used for the database connection.</li>

    <li><code>role</code> is&nbsp;the ENOVIA vpm role used to access the database.</li>

    <li><code>server</code> is&nbsp;the name of the server in the option settings.</li>

   </ul>

<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="Where"></a>Where to Find the <i>CAAPsnUseCase1</i> Code</h4>

<p><i>CAAPsnUseCase1</i> code is located in the <b>CAAPsnUseCase1.m</b> use case

module of the <b>CAAPSNInteroperability.edu </b>framework:</p>

<table>

   <tr>

    <td>Windows</td>

    <td><code>InstallRootDirectory/CAAPSNInteroperability.edu/CAAPsnUseCase1.m</code></td>

  </tr>

  <tr>

    <td>Unix</td>

    <td><code>InstallRootDirectory\CAAPSNInteroperability.edu\CAAPsnUseCase1.m</code></td>

  </tr>

</table>

<p>where <i><code>InstallRoot</code></i> is the root directory of your CAA V5

installation. It is made of a unique source file named CAAPsnUseCase1.cpp.

</p>

<p align="right">[<a href="#Top">Top</a>]

<!---------------------------------comment------------------------------------->

<h3><a name="Step"></a>Step-by-Step</h3>

<p>There are eight logical steps in CAAPsnUseCase1:</p>

<ol>

  <li><a href="#Prolog">Prolog</a></li>

  <li><a href="#InitBatch">Initializing batch communication with ENOVIA vpm V4</a></li>

  <li><a href="#Connect">Connecting to ENOVIA vpm V4</a></li>

  <li><a href="#Load_doc">Loading file documents in session</a></li>

  <li><a href="#PDMProperties">Setting PDM properties on documents</a></li>

  <li><a href="#Save_doc">Saving the documents in ENOVIA vpm V4</a></li>

  <li><a href="#Disconnect_doc">Closing communication with ENOVIA vpm V4</a></li>

  <li><a href="#Epilog">Epilog</a></li>

</ol>

<p>We will now comment each of those sections by looking at the code.</p>

<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="Prolog"></a>Retrieving arguments</h4>

<ol>

  <li>Retrieves arguments

    <table class="code">

      <tr>

        <td>

          <pre>

            CATUnicodeString rootFilepath  = argv[1] ;

			CATUnicodeString hostName  = argv[2] ;

			char * pHostName = argv[2] ;

			CATUnicodeString user  = argv[3] ;

			CATUnicodeString pwd  = argv[4] ;	

			CATUnicodeString role  = argv[5] ;

			CATUnicodeString server  = argv[6] ;

		 </pre>

        </td>

      </tr>

    </table>

    <p>CAAPsnUseCase1 begins by retrieving the arguments from the command line. Arguments are extracted in sequence: the full path of the root assembly document,

    the name of the Unix host, 

    the ENOVIA vpm user and password used for database authentication, 

    the role of this user 

    and the option settings server name.</p>

  </li>

  <li>Check environment

    <table class="code">

      <tr>

        <td>

          <pre>

             char* pCAAPathToShell=NULL; 

             CATLibStatus result = ::CATGetEnvValue(&quot;<b>CV5VpmStart</b>&quot;, &pCAAPathToShell);

             if ( (CATLibError == result) || ( NULL == pCAAPathToShell) )

             {

	         cout &lt;&lt; &quot;CV5VpmStart environment variable is not set&quot; &lt;&lt; endl &lt;&lt; flush;

	         <b>return </b>1;

             }

             cout &lt;&lt; &quot; The unix shell script is &quot; &lt;&lt; pCAAPathToShell &lt;&lt; &quot; on host &quot; &lt;&lt; hostName.ConvertToChar() &lt;&lt;  endl;

          </pre>

        </td>

      </tr>

    </table>

    <p>Then the <code>CV5VpmStart</code> environment variable is checked. It contains the name of the Unix

     directory where the <code>StartVPMBatchFromV5Batch.sh</code> shell script is located.</p>

  </li>

  <li>Creates the session

    <table class="code">

      <tr>

        <td>

          <pre>

			char *sessionName = &quot;CAA2_Sample_Session&quot;;

			CATSession *pSession = NULL;

			HRESULT rc = <b>::Create_Session</b>(sessionName,

			                              pSession);

			if ((FAILED(rc)) || (NULL == pSession))

			{

			   cout &lt;&lt; &quot;ERROR in creating session&quot; &lt;&lt; endl &lt;&lt; flush;

			   <b>return </b>1;

			}

		 </pre>

        </td>

      </tr>

    </table>

    <p>Since this is a batch program, it is first necessary to open a new

    session before beginning to work with documents. Do not forget that this

    session needs to be deleted at the end of the program. 

    To open a new session, use the <code>Create_Session</code>

    global function.</p>

  </li>

</ol>

<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="InitBatch"></a>Initializing batch communication with ENOVIA vpm V4</h4>

<ol>



  <li>Initializes communication with ENOVIA vpm V4

    <table class="code">

      <tr>

        <td>

          <pre>

			rc = <b>::CATInitBatchOnHost</b>( pHostName );

			if (SUCCEEDED(rc)) cout &lt;&lt; &quot;Communication with ENOVIA vpm is set&quot; &lt;&lt; endl &lt;&lt; flush;

			else

			{

			   cout &lt;&lt; &quot;ERROR establishing communication with ENOVIA vpm&quot; &lt;&lt; endl &lt;&lt; flush;

			   //Always deleting session before exiting

			   ::Delete_Session(pSessionName);

			   <b>return</b> 1;

			}

		 </pre>

        </td>

      </tr>

    </table>

    <p>Now that the session is opened, you can establish the communication channel with ENOVIA vpm using

    the <code>CATInitBatchOnHost</code> global method. This method establishes the connection with ENOVIA VPM V4 

    running on indicated Unix host. 

    If there is no server running to which the application can connect to, 

    a new ENOVIA VPM V4 server is launched on the dedicated Unix host.</p>

  </li>

</ol>

<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="Connect"></a>Connecting to ENOVIA vpm V4</h4>

<ol>

  <li>Connects to ENOVIA vpm V4

      <table class="code">

      <tr>

        <td>

          <pre>

	        rc = <b>::CATConnectToVPM</b>(server, user, pwd, role );

			if (FAILED(rc))

				{	

   					cout &lt;&lt; &quot;ERROR in server authentication&quot; &lt;&lt; endl &lt;&lt; flush;

   					//Always deleting session before exiting

   					::Delete_Session(pSessionName);

   					<b>return</b> 1;

				}

		 </pre>

        </td>

      </tr>

    </table>

    <p>Now that the connection to ENOVIA vpm is established, you can connect to the database 

    using the <code>CATConnectToVPM</code> global method. This method establishes the database connection

    using user and password for authentication.</p>

  </li>

</ol>

<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="Load_doc"></a>Loading file based documents in session</h4>

<ol>

  <li>Load Root document 

     <table class="code">

       <tr>

         <td>

          <pre>

			CATDocument *pDocRoot = NULL;

			rc = <b>CATDocumentServices::OpenDocument</b>( rootFilepath.ConvertToChar(), pDocRoot);

			if (SUCCEEDED(rc) &amp;&amp; (NULL != pDocRoot)) 

			{

			   cout &lt;&lt; &quot;Document opened successfully&quot; &lt;&lt; endl &lt;&lt; flush;

			}

			else

			{

			   cout &lt;&lt; &quot;ERROR in opening the root document&quot; &lt;&lt; endl &lt;&lt; flush;

			   //Always deleting session before exiting

			   <b>::Delete_Session</b>(pSessionName);

			   <b>return</b> 1;

			}

		 </pre>

         </td>

       </tr>

     </table>

     <p>Now that the session is opened, you can load the root assembly document using 

     the <code>OpenDocument</code> static method of <i>CATDocumentServices</i>. 

     This method <b>requires</b>, as a first parameter, the entire 

     storage path name and document name of the existing document that we want 

     to load into the session. In this use case, we enter this information as an 

     argument to the program. The second parameter of the <code>Open</code> 

     method returns a <i>CATDocument</i> pointer to the document it has loaded.</p>

     <p>We assume that the pointed documents are loaded in session too. 

     Thanks to the "Load Reference documents" options setting.</p>

   </li>

</ol> 

<p align="right">[<a href="#Top">Top</a>]</p>



<!---------------------------------comment------------------------------------->

<h4><a name="PDMProperties"></a>Setting PDM properties on documents</h4>

<ol>

 <li>Retrieve the list of loaded documents 

     <table class="code">

       <tr>

         <td>

          <pre>

         	const CATLISTP(CATDocument)* DocList = ::<b>ListDocuments</b>();

			if (DocList)

			{

			   for (int k=1; k<=DocList->Size(); k++)

			   {

			      CATDocument* pDocument  = (*DocList)[k];

			      if  ( NULL  !=  pDocument )  

			      {  

			        CATIDocId    *  pIDocId  =  NULL  ;  

			        rc =  pDocument-><b>GetDocId</b>(&pIDocId);  

			        if  ( SUCCEEDED(rc) )  

			        {  

			            CATUnicodeString type  ;  

			            pIDocId-><b>GetType</b>(type) ;  

			            

			            if  (  CATUnicodeString(&quot;CATProduct&quot;)  ==  type ) {

			                rc = <b>CATVPMServices::SetPDMProperties</b>( pDocument, <b>CATVPMServices::VPM1</b>, <b>CATVPMServices::VolatileExposed</b> );

			            }

			            else if  (  CATUnicodeString(&quot;CATPart&quot;)  ==  type ) {

			                rc = <b>CATVPMServices::SetPDMProperties</b>( pDocument, <b>CATVPMServices::VPM1</b>, <b>CATVPMServices::PermanentBlackBox</b> );

			            }

			            pIDocId->Release(); pIDocId = NULL;              

		         }

        		 if (FAILED(rc))

			         {

			            cout &lt;&lt; &quot;ERROR in setting PDM properties&quot; &lt;&lt; endl &lt;&lt; flush;

			            <b>return</b> 1;

			         }

			      }

			   }

			}

         </pre>

         </td>

       </tr>

     </table>

     <p>The CATProduct documents are stored in Structure Exploded mode while CATPart are stored in Publication Exposed mode.

     You use the <code>SetPDMProperties</code> static method of <i>CATVPMServices</i> to set the right PDM property for each type of documents.

  </p>

  </li>

</ol>

<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="Save_doc"></a>Saving the documents in ENOVIA vpm V4</h4>

<ol>

 <li>Save the root document with the pointed documents

     <table class="code">

       <tr>

         <td>

          <pre>

			CATBoolean UnloadAfterSave = FALSE;

			rc = <b>::CATSaveInVPMFromCATIA</b>( pDocRoot, UnloadAfterSave );

			

			if (FAILED(rc))

			{

			   cout &lt;&lt; &quot;ERROR in Saving documents in Enovia vpm&quot; &lt;&lt; endl &lt;&lt; flush;

			}

			

			rc = <b>::CATCommitVPM</b>();

		  </pre>

         </td>

       </tr>

     </table>

     <p>

     You use the <code>CATSaveInVPMFromCATIA</code> global method to save the root product structure document. 

     The pointed documents are saved too. 

     You use the <code>CATCommitVPM</code> global method to commit the Save transaction in ENOVIA vpm.</p>

 </li>

</ol>

<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="Disconnect_doc"></a>Closing communication with ENOVIA vpm V4</h4>

<ol>

 <li>Disconnect from ENOVIA vpm V4

     <table class="code">

       <tr>

         <td>

          <pre>

			rc = <b>::CATDisconnectFromVPM</b>();

		 </pre>

        </td>

       </tr>

     </table>

     <p>

     You use the <code>CATDisconnectFromVPM</code> global method to disconnect from ENOVIA VPM V4 .</p>

  </li>

 <li>Terminate the V5 session

     <table class="code">

       <tr>

         <td>

         <pre>rc = <b>::CATTerminateBatch</b>();</pre>

         </td>

       </tr>

     </table>

     <p>

     You use the <code>CATTerminateBatch</code> global method to terminate the V5 session.</p>

  </li>

</ol>

<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="Epilog"></a>Deleting the session</h4>

<ol>

  <li>Deletes the session

    <table class="code">

      <tr>

        <td>

          <pre>rc = <b>::Delete_Session</b>(sessionName);</pre>

        </td>

      </tr>

    </table>

    <p>Do not forget to delete the session at the end of the program using the <code>Delete_Session</code>

    global function!</p>

  </li>

</ol>



<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h3><a name="InShort"></a>In Short</h3>

<p>This use case has demonstrated how to use the SetPDMProperties method for saving an assembly

in Structure Exploded mode.</p>

<p align="right">[<a href="#Top">Top</a>]</p>

<hr>

<!---------------------------------comment------------------------------------->

<h3><a name="References"></a>References</h3>

<table width="100%">

  <tr>

    <td valign="top">[1]</td>

    <td><a href="../CAADocUseCases/CAADocRunSample.htm">Building

      and Launching a CAA V5 Use Case</a></td>

  </tr>

  <tr>

    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>

  </tr>

</table>

<hr>

<!---------------------------------comment------------------------------------->

<h3><a name="History"></a>History</h3>

<table width="100%">

  <tr>

    <td valign="top">Version: <strong>1</strong> [Oct 2005]</td>

    <td valign="top">Document created</td>

  </tr>

  <tr>

    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>

  </tr>

</table>

<hr>

<!---------------------------------comment------------------------------------->

<p><i>Copyright © 2003, Dassault Systèmes. All rights reserved.</i></p>

<ul>

</ul>



</body>



</html>

