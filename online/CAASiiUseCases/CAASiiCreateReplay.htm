<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
<script language="JavaScript" src="../CAADocJavaScript/submit.js"></script>
<title>Creating a Product's Motion in a Document</title>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>Product Synthesis &amp; Knowledgeware</h1>
    </td>
    <td valign="top">
      <h2>DMU Navigator</h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>Creating a Product's Motion in a Document</h3>
      <em>From position values to simulation</em></td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      This article discusses the CAASiiCreateReplay use case. This use case
      explains how to open a CATProduct document and explore its content from a
      simulation perspective, down to the replay entities that capture the
      motion of a product contained in the document.
      <ul>
        <li><b><a href="#Learn">What You Will Learn With This Use Case</a></b></li>
        <li><b><a href="#Concepts">Simulation Concepts</a></b></li>
        <li><b><a href="#UseCase">The CAASiiCreateReplay Use Case</a></b></li>
        <ul>
          <li><a href="#What">What Does CAASiiCreateReplay Do</a></li>
          <li><a href="#How">How to Launch CAASiiCreateReplay</a></li>
          <li><a href="#Where">Where to Find the CAASiiCreateReplay Code</a></li>
        </ul>
        <li><a href="#Step"><strong>Step-by-Step</strong></a></li>
        <li><a href="#InShort"><strong>In Short</strong></a></li>
        <li><a href="#References"><strong>References</strong></a></li>
      </ul>
    </td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>This use case is intended to help you make your first steps in programming
the CATIA simulation modeler. Its main intent is to introduce the API of the
simulation modeler, and ways to use it.</p>
<p>The scenario is based on an industrial process:</p>
<ol>
  <li>users define a set of trajectories to move products within a given system,
    for instance a test bed</li>
  <li>a batch utility translate them in DMU Navigator</li>
  <li>translated data are used to validate and replay the trajectories in DMU
    Navigator.</li>
</ol>
<p>To perform the first and last operations, the user works with on-the-shelf
softwares. But a utility to translate trajectories from any system to another
does not exist on the shelf.</p>
<p>The target of this use case is to learn how to build such utility. To
simplify explanations, we will skip the parsing phasis.</p>
<p><img src="images/CAASiiCreateReplayIn.jpg" height="400" width="630"></p>
<p>This picture represents a CATProduct document containing trajectories: the
run of the use case will add one replay.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="Concepts"></a>Simulation Concepts</h3>
<p>Before getting to the use case itself, it is important to get an
understanding of some of the concepts that are at the heart of the Simulation,
since the use case basically navigates among objects that represent those
concepts. They are presented in Simulation Overview [<a href="#References">1</a>].</p>
<p>These concepts are:</p>
<ul>
  <li>Replay</li>
  <li>Channel</li>
  <li>Sample</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="UseCase"></a>The CAASiiCreateReplay Use Case</h3>
<p>CAASiiCreateReplay is a use case of the CAASimulationInterfaces.edu framework
that illustrates SimulationInterfaces framework capabilities.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="What"></a>What Does CAASiiCreateReplay Do</h4>
<p>The goal of CAASiiCreateReplay is to:</p>
<ul>
  <li>Open a CATProduct document, whose pathname is passed in argument</li>
  <li>Create a replay in the document</li>
  <li>Create a channel in the replay</li>
  <li>Create samples in the channel</li>
  <li>Set the information in samples</li>
  <li>Store the document.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="How"></a>How to Launch CAASiiCreateReplay</h4>
<p>To launch CAASiiCreateReplay, you will need to set up the build time
environment, then compile CAASiiCreateReplay along with its prerequisites, set
up the run time environment, and then execute the use case [<a href="#References">2</a>].</p>
<p>Launch the use case as follows:</p>
<ul>
  <li>With Windows
    <table class="code">
      <tr>
        <td>
          <pre>e:&gt; CAASiiCreateReplay inputDirectory inputFile.CATProduct outputDirectory</pre>
        </td>
      </tr>
    </table>
  </li>
  <li>With UNIX
    <table class="code">
      <tr>
        <td>
          <pre>$ CAASiiCreateReplay inputDirectory inputFile.CATProduct outputDirectory</pre>
        </td>
      </tr>
    </table>
  </li>
</ul>
<p>where:</p>
<table>
  <tr>
    <td><code>inputDirectory</code></td>
    <td>The directory in which <code>inputFile.CATProduct</code> is located</td>
  </tr>
  <tr>
    <td><code>inputFile.CATProduct</code>
    <td>The file that contains the use case CATProduct document</td>
  </tr>
  <tr>
    <td><code>outputDirectory</code></td>
    <td>The directory into which <code>inputFile.CATProduct</code> is stored
      after the mechanism is created</td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Where"></a>Where to Find the CAASiiCreateReplay Code</h4>
<p>The CAASiiCreateReplay use case is made of a single class named <i>CAASiiCreateReplay</i>
whose header and source files are located in the CAASiiCreateReplay.m module of
the CAASimulationInterfaces.edu framework:</p>
<table>
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAASimulationInterfaces.edu\CAASiiCreateReplay.m\</code></td>
  </tr>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAASimulationInterfaces.edu/CAASiiCreateReplay.m/</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed. The <i>CAASiiCreateReplay</i> class derives from <i>CATInteractiveApplication</i>.
The described code is located in the <code>BeginApplication</code> method.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="Step"></a>Step-by-Step</h3>
<p>There are five main steps in CAASiiCreateReplay:</p>
<ol>
  <li><a href="#Prolog">Prolog</a></li>
  <li><a href="#Replay">Creating the Replay</a></li>
  <li><a href="#Channel">Creating the Channel</a></li>
  <li><a href="#Saving">Saving the Document</a></li>
  <li><a href="#Epilog">Epilog</a></li>
</ol>
<p>We will now comment each of these steps by looking at the code.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Prolog"></a>Prolog</h4>
<p>The use case is the <i>CAAKiiCreateMechanism</i> class that derives from <i>CATInteractiveApplication</i>
and that is simply instantiated. It runs in one shot and the described code is
located in the <code>BeginApplication</code> method. It begins by creating a
session, and by opening the use case CATProduct document passed as an argument: <code>pDocument</code>
refers to it. This is the usual sequence for creating a CATIA document [<a href="#References">3</a>].</p>
<p>The last step is to simulate the parsing of a file containing the motion data
in a structure. This structure is a set of arrays containing references to the
moving products <code>apiProductOnProduct</code>, the numer of samples for each
products <code>aNumberOfSamples</code>, the times <code>aInputTime</code> and
the positions <code>aInputProductMove</code>. To fill the references to moving
products, one search the first product in the product structure.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Replay"></a>Creating the Replay</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
  //==========================================================================================
  // 4 - Create a replay in the document
  //==========================================================================================
  CATIReplay* piReplay = NULL;
  HR = CATCreateReplay (pDocument, &amp;piReplay);
  if (SUCCEEDED(HR))
  {
    // Search for the factory of channels
    CATIReplayChannelProductMoveFactory* piReplayChannelProductMoveFactory = NULL;
    HR = piReplay-&gt;QueryInterface(IID_CATIReplayChannelProductMoveFactory,(void**)&amp;piReplayChannelProductMoveFactory);
    if (SUCCEEDED(HR))
    {
      for (int j = 0; j &lt; numberOfProducts; j++)
      {
...</pre>
    </td>
  </tr>
</table>
<p>The creation of a replay in the document is made through the global function <code><a href="#" onclick="javascript:CAAlink('CPP', 'SimulationBaseLegacy', 'function', 'CATCreateReplay');return false;">CATCreateReplay</a></code>
using pDocument as an input.</p>
<p>This replay can be used as a factory of 'product move' channel finding its <code><a href="#" onclick="javascript:CAAlink('CPP', 'SimulationInterfaces', 'interface', 'CATIReplayChannelProductMoveFactory');return false;">CATIReplayChannelProductMoveFactory</a></code>
interface.</p>
<p>Then the use case loops on all products to create a channel for each.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Channel"></a>Creating the Channel</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
        //====================================================================================
        // 5 - Create a channel for each product and fill it
        //====================================================================================
        CATIReplayChannelProductMove* piReplayChannelProductMove = NULL;
        HR = piReplayChannelProductMoveFactory-&gt;CreateInstance ((CATBaseUnknown**)&amp;apiProductOnProduct[j],&amp;piReplayChannelProductMove);
        if (SUCCEEDED(HR))
        {
          // Create the samples
          for (int i = 0; i &lt; aNumberOfSamples[j] &amp;&amp; SUCCEEDED(HR); i++)
          {
            HR = piReplayChannelProductMove-&gt;AddSample (aInputTime[j][i], aInputProductMove[j][i]);
          }
          // Release the reference to the channel
          piReplayChannelProductMove-&gt;Release();
          piReplayChannelProductMove = NULL;
        }
        // Release the reference to the product
        apiProductOnProduct[j]-&gt;Release();
        apiProductOnProduct[j] = NULL;
      }
      // Release the reference to the factory
      piReplayChannelProductMoveFactory-&gt;Release();
      piReplayChannelProductMoveFactory = NULL;
    }
    // Release the reference to the replay
    piReplay-&gt;Release();
    piReplay = NULL;
  }
...</pre>
    </td>
  </tr>
</table>
<p>The channel is created using <code><a href="#" onclick="javascript:CAAlink('CPP', 'SimulationInterfaces', 'interface', 'CATIReplayChannelProductMoveFactory', 'CreateInstance');return false;">CATIReplayChannelProductMoveFactory::CreateInstance</a></code>
method using the reference to the moving product to indicate the product of the
channel.</p>
<p>Then the use case loops on all the samples and creates them using <code><a href="#" onclick="javascript:CAAlink('CPP', 'SimulationInterfaces', 'interface', 'CATIReplayChannelProductMove', 'AddSample');return false;">CATIReplayChannelProductMove::AddSample</a></code>
method with the corresponding time and position.</p>
<p>The next step consists in cleaning the environment and releasing all
resources. The technique is fairly simple: all references to interfaces have to
be released using <code>CATBaseUnknown::Release</code> and then the list is
deleted. All pointer are nullified.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Saving"></a>Saving the Document</h4>
<table class="code">
  <tr>
    <td>
      <pre>...  
  //==========================================================================================
  // 6 - save the document
  //==========================================================================================
  char outputPath[CATMaxPathSize]; 
  CATMakePath (argv[3], argv[2], outputPath);
  HR = CATDocumentServices::SaveAs(*pDocument, outputPath);
  if (!SUCCEEDED(HR))
  {
    cout &lt;&lt; outputPath &lt;&lt; &quot; could not be stored&quot;&lt;&lt; endl;
    _returnCode = 4;
    return;
  }
...</pre>
    </td>
  </tr>
</table>
<p>The document is saved using <code>CATDocumentServices::Saveas</code> method
with the right path, that is in the directory passed as the third argument when
launching the use case, and with the same name as the input document.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Epilog"></a>Epilog</h4>
<p>After being saved, it is is closed using the <code>remove</code> method of
its <i>LifeCycleObject</i> interface. The environment is cleaned, and the
session is deleted by the <code>Delete_Session</code> global function, which is
passed the same identifier that was used to open it. This is the usual sequence
for saving and closing a document, and for deleting the session [<a href="#References">3</a>].</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="InShort"></a>In Short</h3>
<p>This use case has demonstrated the way to programmatically create a product
motion in a CATProduct document.</p>
<p>More specifically, you have learn how to create:
<ul>
  <li><i>replays</i> in a CATProduct document</li>
  <li><i>channels</i> within a replay</li>
  <li><i>samples</i> within a channel.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------------------------------------------------->
<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td valign="top">[1]</td>
    <td><a href="../CAASiiTechArticles/CAASiiOverview.htm">Simulation
      Overview</a></td>
  </tr>
  <tr>
    <td valign="top">[2]</td>
    <td><a href="../CAADocUseCases/CAADocRunSample.htm">Building
      and Launching a CAA V5 Use Case</a></td>
  </tr>
  <tr>
    <td valign="top">[3]</td>
    <td><a href="../CAAOmbUseCases/CAAOmbNewDoc.htm">Creating
      a New Document</a></td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <strong>1</strong> [Jan 2000]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<p><i>Copyright © 2000, Dassault Systèmes. All rights reserved.</i></p>

</body>

</html>
