<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
<script language="JavaScript" src="../CAADocJavaScript/submit.js"></script>
<title>Reading a Product's Motion in a Replay</title>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>Product Synthesis &amp; Knowledgeware</h1>
    </td>
    <td valign="top">
      <h2>DMU Navigator</h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>Reading a Product's Motion in a Replay</h3>
      <em>From simulation to file</em></td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This article discusses the CAASiiReadReplay use case. This use case
      explains how to open a CATProduct document and explore its content from a
      simulation perspective, down to the replay entities that capture the
      motion of a product contained in the CATProduct document.
      <ul>
        <li><b><a href="#Learn">What You Will Learn With This Use Case</a></b></li>
        <li><b><a href="#Concepts">Simulation Concepts</a></b></li>
        <li><b><a href="#UseCase">The CAASiiReadReplay Use Case</a></b></li>
        <ul>
          <li><a href="#What">What Does CAASiiReadReplay Do</a></li>
          <li><a href="#How">How to Launch CAASiiReadReplay</a></li>
          <li><a href="#Where">Where to Find the CAASiiReadReplay Code</a></li>
        </ul>
        <li><a href="#Step"><strong>Step-by-Step</strong></a></li>
        <li><a href="#InShort"><strong>In Short</strong></a></li>
        <li><a href="#References"><strong>References</strong></a></li>
      </ul>
    </td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>This use case is intended to help you make your first steps in programming
the CATIA simulation modeler. Its main intent is to introduce the API of the
simulation modeler, and ways to use it.</p>
<p>The scenario is based on an industrial process:</p>
<ol>
  <li>users define and validate interactively a set of trajectories to move some
    products within DMU Navigator</li>
  <li>when trajectories are validated, a batch utility translate them in another
    system</li>
  <li>translated data are used to perform a task.</li>
</ol>
<p>To perform the first and last operations, the user works with on-the-shelf
softwares. But a utility to translate trajectories from any system to another
does not exist on the shelf.</p>
<p>The target of this use case is to learn how to build such utility. To
simplify explanations, we suppose the other system read a text file with a
dedicated format.</p>
<p><img src="images/CAASiiReadReplayIn.jpg" height="500" width="630"></p>
<p>This picture represents a *.CATProduct document containing some trajectories.</p>
<p><img src="images/CAASiiReadReplayOut.jpg" height="500" width="630"></p>
<p>This picture represents a text file which results from the use of the sample
on the *.CATProduct document.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="Concepts"></a>Simulation Concepts</h3>
<p>Before getting to the use case itself, it is important to get an
understanding of some of the concepts that are at the heart of the Simulation,
since the use case basically navigates among objects that represent those
concepts. They are presented in Simulation Overview [<a href="#References">1</a>].
<p>These concepts are :
<ul>
  <li>Replay</li>
  <li>Channel</li>
  <li>Sample</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="UseCase"></a>The CAASiiReadReplay Use Case</h3>
<p>CAASiiReadReplay is a use case of the CAASimulationInterfaces.edu framework
that illustrates SimulationInterfaces framework capabilities.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="What"></a>What Does CAASiiReadReplay Do</h4>
<p>The goal of CAASiiReadReplay is to:</p>
<ul>
  <li>Open a CATProduct document, whose pathname is passed in argument</li>
  <li>Obtain the list of replays from the document</li>
  <li>Request each channel from a replay</li>
  <li>Request each sample from a channel</li>
  <li>Get the information from one sample.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="How"></a>How to Launch CAASiiReadReplay</h4>
<p>To launch CAASiiReadReplay, you will need to set up the build time
environment, then compile CAASiiReadReplay along with its prerequisites, set up
the run time environment, and then execute the use case [<a href="#References">2</a>].</p>
<p>Launch the use case as follows:</p>
<ul>
  <li>With Windows
    <table class="code">
      <tr>
        <td>
          <pre>e:&gt; CAASiiReadReplay inputDirectory inputFile.CATProduct outputDirectory</pre>
        </td>
      </tr>
    </table>
  </li>
  <li>With UNIX
    <table class="code">
      <tr>
        <td>
          <pre>$ CAASiiReadReplay inputDirectory inputFile.CATProduct outputDirectory</pre>
        </td>
      </tr>
    </table>
  </li>
</ul>
<p>where:</p>
<table>
  <tr>
    <td><code>inputDirectory</code></td>
    <td>The directory in which <code>inputFile.CATProduct</code> is located</td>
  </tr>
  <tr>
    <td><code>inputFile.CATProduct</code>
    <td>The file that contains the use case CATProduct document</td>
  </tr>
  <tr>
    <td><code>outputFile</code>
    <td>The file that will contain the resulting file</td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Where"></a>Where to Find the CAASiiReadReplay Code</h4>
<p>The CAASiiReadReplay use case is made of a single class named <i>CAASiiReadReplay</i>
whose header and source files are located in the CAASiiReadReplay.m module of
the CAASimulationInterfaces.edu framework:</p>
<table>
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAASimulationInterfaces.edu\CAASiiReadReplay.m\</code></td>
  </tr>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAASimulationInterfaces.edu/CAASiiReadReplay.m/</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed. The <i>CAASiiReadReplay</i> class derives from <i>CATInteractiveApplication</i>.
The described code is located in the <code>BeginApplication</code> method.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="Step"></a>Step-by-Step</h3>
<p>There are seven main steps in CAASiiReadReplay:</p>
<ol>
  <li><a href="#Prolog">Prolog</a></li>
  <li><a href="#Replay">Getting Access to the Replays of the Document</a></li>
  <li><a href="#Channel">Getting Access to All Channels of the Replay</a></li>
  <li><a href="#Filter">Filtering the Product Move Channels</a></li>
  <li><a href="#Information">Getting the Channel Information</a></li>
  <li><a href="#Cleaning">Cleaning the Environment</a></li>
  <li><a href="#Epilog">Epilog</a></li>
</ol>
<p>We will now comment each of those sections by looking at the code.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Prolog"></a>Prolog</h4>
<p>The use case is the <i>CAASiiReadReplay</i> class that derives from <i>CATInteractiveApplication</i>
and that is simply instantiated. It runs in one shot and the described code is
located in the <code>BeginApplication</code> method. It begins by creating a
session, and by opening the use case CATProduct document passed as an argument: <code>pDocument</code>
refers to it. This is the usual sequence for creating a CATIA document [<a href="#References">3</a>].
It also opens the output file: <code>outputFile</code> refers to it.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Replay"></a>Getting Access to the Replays of the Document</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
  //==========================================================================================
  // 4 - Read all the replays of the document
  //==========================================================================================
  CATIReplayList* piListOfReplays = new CATIReplayList();
  HR = CATListReplays (pDocument, piListOfReplays);
  if (SUCCEEDED(HR))
  {
    for (int i = 1; i &lt;= piListOfReplays-&gt;Size(); i++)
    {
...</pre>
    </td>
  </tr>
</table>
<p>A CATProduct document contains from zero to many Replays. Access to the list
of all replays included in the document is made through the global function <code><a href="#" onclick="javascript:CAAlink('CPP', 'SimulationBaseLegacy', 'function', 'CATListReplays');return false;">CATListReplays</a></code>
using pDocument as an input. As a result, it provides a <code><a href="#" onclick="javascript:CAAlink('CPP', 'SimulationInterfaces', 'class', 'CATIReplayList');return false;">CATIReplayList</a></code>
collection.</p>
<p>The number of replays of a list is given by the <code><a href="#" onclick="javascript:CAAlink('CPP', 'SimulationInterfaces', 'class', 'CATIReplayList');return false;">CATIReplayList::Size</a></code>
method.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Channel"></a>Getting Access to All Channels of the Replay</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
      //======================================================================================
      // 5 - Read all the channels of the replay
      //======================================================================================
      int numberOfChannel = 0;
      HR = (*piListOfReplays)[i]-&gt;GetNumberOfChannel(&amp;numberOfChannel);
      if (SUCCEEDED(HR))
      {        
        // Print the name of the replay
        CATIAlias* piAliasOnReplay = NULL;
        if (SUCCEEDED((*piListOfReplays)[i]-&gt;QueryInterface(IID_CATIAlias,(void**)&amp;piAliasOnReplay)))
        {
          outputFile &lt;&lt; &quot;Replay &quot; &lt;&lt; piAliasOnReplay-&gt;GetAlias().ConvertToChar() &lt;&lt;endl &lt;&lt; flush;
          piAliasOnReplay-&gt;Release();
          piAliasOnReplay = NULL;
        }
        // Loop on all channels
        for (int j = 1; j &lt;= numberOfChannel; j++)
        {
...</pre>
    </td>
  </tr>
</table>
<p>Every replay of the list is accessible using <code><a href="#" onclick="javascript:CAAlink('CPP', 'SimulationInterfaces', 'class', 'CATIReplayList');return false;">CATIReplayList::operator[]</a></code>
like in <code>(*listOfReplays)[i]</code>. The rank varies from one to the number
of replays.</p>
<p>The number of channels which belong to a replay, is read through <code><a href="#" onclick="javascript:CAAlink('CPP', 'SimulationInterfaces', 'interface', 'CATIReplay', 'GetNumberOfChannel');return false;">CATIReplay::GetNumberOfChannel</a></code>
method.</p>
<p>The <i>CATIAlias</i> interface is used to retrieve the name of the replay to
be output on the file.</p>
<p>Then use case loops on all the channels of the replay.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Filter"></a>Filtering the Product Move Channels</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
          //==================================================================================
          // 6 - Filter the product motion channels
          //==================================================================================
          CATIReplayChannel* piChannel = NULL;
          HR = (*piListOfReplays)[i]-&gt;GetChannel(j, &amp;piChannel);
          if (SUCCEEDED(HR))
          {
            CATIReplayChannelProductMove* piProductMoveChannel = NULL;
            HR = piChannel-&gt;QueryInterface(IID_CATIReplayChannelProductMove,(void**)&amp;piProductMoveChannel);
            if (SUCCEEDED(HR))
            {
...</pre>
    </td>
  </tr>
</table>
<p>Each individual channel is accessible using <code><a href="#" onclick="javascript:CAAlink('CPP', 'SimulationInterfaces', 'interface', 'CATIReplay', 'GetChannel');return false;">CATIReplay::GetChannel</a></code>
method. The rank varies from one to the number of channels.</p>
<p>To find out the type of the channel, one might use the query interface method
: if it succeeds,the channel is from the right type. To access product motion,
the sample queries the <code><a href="#" onclick="javascript:CAAlink('CPP', 'SimulationInterfaces', 'interface', 'CATIReplayChannelProductMove');return false;">CATIReplayChannelProductMove</a></code>
interface.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Information"></a>Getting the Channel Information</h4>
<table class="code">
  <tr>
    <td>
      <pre>...
              //==============================================================================
              // 7 - Read product, time, position of all the samples of the channel and print the data
              //==============================================================================
              CATIProduct* piProduct = NULL;
              HR = piProductMoveChannel-&gt;GetProduct((CATBaseUnknown**)&amp;piProduct);
              if (SUCCEEDED(HR))
              {
                CATIAlias* piAliasOnProduct = NULL;
                HR = piProduct-&gt;QueryInterface(IID_CATIAlias,(void**)&amp;piAliasOnProduct);
                if (SUCCEEDED(HR))
                {  
                  // Print the name of the product
                  outputFile &lt;&lt; &quot;   Product &quot; &lt;&lt; piAliasOnProduct-&gt;GetAlias().ConvertToChar() &lt;&lt;endl &lt;&lt; flush;
                  piAliasOnProduct-&gt;Release();
                  piAliasOnProduct = NULL;
                  // Loop on the samples 
                  int numberOfSample = 0;
                  HR = piProductMoveChannel-&gt;GetNumberOfSample(&amp;numberOfSample);
                  for (int k = 1; k &lt;= numberOfSample; k++)
                  {
                    // Print sample information
                    double time;
                    HR = piProductMoveChannel-&gt;GetSampleTime(k, &amp;time);
                    double productMove[12];
                    HR = piProductMoveChannel-&gt;GetSample(k, productMove);
                    outputFile &lt;&lt; &quot;      &quot; &lt;&lt; time &lt;&lt; &quot; = &quot;;
                    for (int l = 0; l &lt; 12; l++) outputFile &lt;&lt; productMove[l] &lt;&lt; &quot;; &quot;;
                    outputFile &lt;&lt; endl &lt;&lt; flush;
                  }
                  outputFile &lt;&lt; &quot;   EndProduct&quot; &lt;&lt;endl &lt;&lt; flush; 
                }
...</pre>
    </td>
  </tr>
</table>
<p>The 'Product Move' channel refers the product to move : it can be read using
the <code><a href="#" onclick="javascript:CAAlink('CPP', 'SimulationInterfaces', 'interface', 'CATIReplayChannelProductMove', 'GetProduct');return false;">CATIReplayChannelProductMove::GetProduct
</a></code>method.</p>
<p>The <code>CATIAlias</code> interface is used to retrieve the name of the
product to be output on the file.</p>
<p>A channel is made of samples : the <code><a href="#" onclick="javascript:CAAlink('CPP', 'SimulationInterfaces', 'interface', 'CATIReplayChannel', 'GetNumberOfSample');return false;">CATIReplayChannel::GetNumberOfSample
</a></code>method is used to retrieve the number of samples in the channel.</p>
<p>Each sample is associated to a time value which can be read using the <code><a href="#" onclick="javascript:CAAlink('CPP', 'SimulationInterfaces', 'interface', 'CATIReplayChannel', 'GetSampleTime');return false;">CATIReplayChannel::GetSampleTime
</a></code>method.</p>
<p>For a product motion, the sample contains the position of the product : the
position matrix (with respect to the root product axis system) is accessible
thru the <code><a href="#" onclick="javascript:CAAlink('CPP', 'SimulationInterfaces', 'interface', 'CATIReplayChannelProductMove', 'GetSample');return false;">CATIReplayChannelProductMove::GetSample
</a></code>method.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Cleaning"></a>Cleaning the Environment</h4>
<table class="code">
  <tr>
    <td>
      <pre>...  
                // Release the reference to the product
                piProduct-&gt;Release();
                piProduct = NULL;
              }
              // Release the reference to the product move channel
              piProductMoveChannel-&gt;Release();
              piProductMoveChannel = NULL;
            }
            // Release the reference to the channel
            piChannel-&gt;Release();
            piChannel = NULL;
          }
        }
        outputFile &lt;&lt; &quot;EndReplay&quot; &lt;&lt;endl &lt;&lt; flush;
      }
      // Release the reference to the replay
      (*piListOfReplays)[i]-&gt;Release();
      (*piListOfReplays)[i] = NULL;
    }
  }
  // Clean the list
  delete piListOfReplays;
  piListOfReplays = NULL;

  // Close the output file
  outputFile.close();
...</pre>
    </td>
  </tr>
</table>
<p>The next step consist in cleaning the environment and releasing all
resources. The technique is fairly simple: all references to interfaces have to
be released using <code>CATBaseUnknown::Release()</code> and then the list is
deleted. All pointer are nullified.</p>
<p>The output file is closed using standard method.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Epilog"></a>Epilog</h4>
<p>The document is closed using its <i>LifeCycleObject</i> interface and more
specifically the <code>remove</code> method. The environment is cleaned, and the
session is deleted by the <code>Delete_Session</code> global function, which is
passed the same identifier that was used to open it. This is the usual sequence
for closing a document, and for deleting the session [<a href="#References">3</a>].</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="InShort"></a>In Short</h3>
<p>This use case has demonstrated the way to programmatically navigate a
CATProduct document, from the document itself down to the entities that hold the
motion associated with one of its' products.</p>
<p>More specifically, you have learn how to access:</p>
<ul>
  <li><i>replays</i> in a CATProduct document</li>
  <li><i>channels</i> within a replay</li>
  <li><i>product</i>, <i>times</i> and <i>positions</i> within a channel</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td valign="top">[1]</td>
    <td><a href="../CAASiiTechArticles/CAASiiOverview.htm">Simulation
      Overview</a></td>
  </tr>
  <tr>
    <td valign="top">[2]</td>
    <td><a href="../CAADocUseCases/CAADocRunSample.htm">Building
      and Launching a CAA V5 Use Case</a></td>
  </tr>
  <tr>
    <td valign="top">[3]</td>
    <td><a href="../CAAOmbUseCases/CAAOmbNewDoc.htm">Creating
      a New Document</a></td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <strong>1</strong> [Jan 2000]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<p><i>Copyright © 2000, Dassault Systèmes. All rights reserved.</i></p>

</body>
