<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
<title>Creating Combined Curve's Interface of Type</title>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>Mechanical Modeler</h1>
    </td>
    <td valign="top">
      <h2></h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>Creating Combined Curve's Interface of Type</h3>
      <i>Defining and implementing the interface to retrieve and modify the
      Combined Curve's specifications.</i></td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
  <tr>
    <td valign="top" colspan="3"><a href="CAAMmrCombinedCurveSamplesOverview.htm">Creating
      a New Geometrical Feature: the Combined Curve</a> &gt; <b>Creating Combined Curve's Interface of Type</b></td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This article explains how to create and implement an interface to
      retrieve and modify the attribute values of the Combined Curve.
      <ul>
        <li><strong><a href="#Learn">What You Will Learn With This Use Case</a></strong></li>
        <li><strong><a href="#UseCase">The CAAMmrCombinedCurve Use Case</a></strong>
          <ul>
            <li><a href="#What">What Does CAAMmrCombinedCurve Do</a>
            <li><a href="#How">How to Launch CAAMmrCombinedCurve</a></li>
            <li><a href="#Where">Where to Find the CAAMmrCombinedCurve Code</a></li>
          </ul>
        </li>
        <li><a href="#Step"><strong>Step-by-Step</strong></a></li>
        <li><a href="#InShort"><strong>In Short</strong></a></li>
        <li><a href="#References"><strong>References</strong></a></li>
      </ul>
    </td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>This use case shows how to <b>define and implement an interface on the Combined Curves</b>. This interface summarizes what is specific to this new
feature. Refer to the article entitled &quot;Creating a New StartUp from a
Mechanical StartUp&quot; for details [<a href="#References">1</a>].</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="UseCase"></a>The CAAMmrCombinedCurve Use Case</h3>
<p>CAAMmrCombinedCurve is a use case of the CAAMechanicalModeler.edu framework
that illustrates MechanicalModeler framework capabilities.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="What"></a>What Does the CAAMmrCombinedCurve Do</h4>
<p>This use case defines and implements a new interface modeling Combined Curves
specific attributes. As a matter of fact,
you only have to add methods to get and set the input Curves and Direction of
Combined Curves. This interface is called <i>CAAIMmrCombinedCurve</i>.</p>
<p>Consequently, <b>CAAIMmrCombinedCurve has four methods</b>:</p>
<ol>
  <li><code>GetCurve</code></li>
  <li><code>SetCurve</code></li>
  <li><code>GetDirection</code></li>
  <li><code>SetDirection</code></li>
</ol>
<p>To implement this new interface, you must define a new extension of the
Combined Curve late type. Logically, its class name is <i>CAAEMmrCombinedCurve</i>.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="How"></a>How to Launch CAAMmrCombinedCurve</h4>
<p>See the section entitled &quot;How to Launch the Combined Curve Use
Case&quot; in the &quot;<a href="CAAMmrCombinedCurveSamplesOverview.htm">Creating
a New Geometrical Feature: The Combined Curve</a>&quot; use case for a detailed
description of how this use case should be launched.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Where"></a>Where to Find the CAAMmrCombinedCurve Code</h4>
<p>The CAAMmrCombinedCurve use case is made of a several classes located in the
CAAMmrCombinedCurve.m module of the CAAMechanicalModeler.edu framework:</p>
<table>
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAAMechanicalModeler.edu\CAAMmrCombinedCurve.m\</code></td>
  </tr>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAAMechanicalModeler.edu/CAAMmrCombinedCurve.m/</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed.</p>
<ul>
  <li>in the src directory
    <ul>
      <li>CAAIMmrCombinedCurve.cpp
      <li>TIE_CAAIMmrCombinedCurve.cpp
      <li>CAAEMmrCombinedCurve.cpp, the implementation of the <i>CAAIMmrCombinedCurve</i>
        interface</li>
    </ul>
  <li>in the LocalInterfaces directory
    <ul>
      <li>CAAEMmrCombinedCurve.h</li>
    </ul>
  </li>
</ul>
<p>In the PrivateInterfaces of the <code>CAAMechanicalModeler.edu</code>
framework there is the CAAIMmrCombinedCurve.h file.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="Step"></a>Step-by-Step</h3>
<p>Combined Curve have their interface of type called <i>CAAIMmrCombinedCurve</i>.
This interface deals with specific properties of Combined Curve, that is to get
and set its two input curves and its two input directions. This interface is
implemented according to the following steps:</p>
<ul>
  <li><a href="#Step1">Defining the Combined Curve Interface</a></li>
  <li><a href="#Step2">Implementing the Combined Curve Interface</a>
    <ul>
      <li><a href="#Step3">Setting a Combined Curve Attribute Value</a></li>
      <li><a href="#Step4">Getting a Combined Curve Attribute Value</a></li>
    </ul>
  </li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Step1"></a>Defining the Combined Curve Behavior Interface</h4>
<p><i>CAAIMmrCombinedCurve</i>.h declares this new interface (associated with <i>CAAIMmrCombinedCurve</i>.cpp and TIE_CAAIMmrCombinedCurve.tsrc).</p>
<p>Four methods are declared to get/set input curves and to get/set input
directions. This is a good compromise between the interface's completeness and
shortness.</p>
<table class="code">
  <tr>
    <td>
      <pre>class ExportedByCAAMmrCombinedCurve CAAIMmrCombinedCurve : public CATBaseUnknown
{
  CATDeclareInterface;
  public:

   virtual HRESULT SetCurve     ( int iNum ,
                                  CATISpecObject *ipCurve )      = 0 ;
   virtual HRESULT GetCurve     ( int iNum ,
                                  CATISpecObject **opCurve )     = 0 ;
   virtual HRESULT SetDirection ( int iNum , 
                                  CATISpecObject *ipDirection )  = 0 ;
   virtual HRESULT GetDirection ( int iNum ,
                                  CATISpecObject **opDirection ) = 0 ;
}</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Step2"></a>Implementing the Combined Curve Behavior Interface</h4>
<p>The object chosen to implement Combined Curve Interface extends the
&quot;CombinedCurve&quot; late type. The following code extracted from
CAAEMmrCombinedCurve.cpp declares that CombinedCurve is extended to implement
the Combined Curve Interface.</p>
<table class="code">
  <tr>
    <td>
      <pre>...
CATImplementClass ( CAAEMmrCombinedCurve,
                    DataExtension,    
                    CATBaseUnknown,
                    <b>CombinedCurve</b> );

// Tie the implementation to its interface
// ---------------------------------------

#include &quot;TIE_CAAIMmrCombinedCurve.h&quot; // needed to tie the implementation to its interface
TIE_CAAIMmrCombinedCurve(CAAEMmrCombinedCurve);
...</pre>
    </td>
  </tr>
</table>
<p>Add to your dictionary the line declaring CombinedCurve implements
CAAIMmrCombinedCurve interface.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Step3"></a>Setting a Combined Curve Attribute Value</h4>
<p>Here is how to set a Combined Curve's Curve Attribute. You first have to get
the key of the attribute associating with the asking curve. This key, <code>piSpecAttrKeyOnInputCurve</code>,
will be then useful to valuate the attribute.&nbsp;</p>
<table class="code">
  <tr>
    <td>
      <pre>...
HRESULT CAAEMmrCombinedCurve::<b>SetCurve</b>(int iNum, CATISpecObject* ipiSpecOnCurve) 
{
    <b>CATISpecAttrAccess</b> * piSpecAttrAccessOnCC = NULL; 
    HRESULT rc = QueryInterface(IID_CATISpecAttrAccess, (void**) &amp; piSpecAttrAccessOnCC);
    if ( SUCCEEDED(rc) ) 
    { 
       <b>CATISpecAttrKey</b> * piSpecAttrKeyOnInputCurve = NULL;
       if ( 1 == iNum )
       {
          piSpecAttrKeyOnInputCurve = piSpecAttrAccessOnCC-&gt;<b>GetAttrKey</b>(&quot;Curve1&quot;);
       }
       else
       {
          piSpecAttrKeyOnInputCurve = piSpecAttrAccessOnCC-&gt;GetAttrKey(&quot;Curve2&quot;);
       }
 ...</pre>
    </td>
  </tr>
</table>
<p>If the input feature is a BRep feature it must be aggregated by the combined
curve. A BRep feature must always be aggregated by someone to be delete.&nbsp;
If it is already aggregated, it is an error.</p>
<table class="code">
  <tr>
    <td>
      <pre>...
   CATISpecObject_var spiSpecOnCurve(ipiSpecOnCurve);

    <b>CATIMfBRep</b> *pIMfBRep = NULL ;
    rc = ipiSpecOnCurve-&gt;QueryInterface(IID_CATIMfBRep, (void**) &amp; pIMfBRep);
    if ( SUCCEEDED(rc) )
    {
       CATISpecObject * pFather = ipiSpecOnCurve-&gt;<b>GetFather</b>() ;
       if ( NULL == pFather )
       {
          CATIDescendants * pIDescendantsOnCC = NULL ;
          rc = QueryInterface( IID_CATIDescendants , (void**) &amp;pIDescendantsOnCC );
                                                
          if ( SUCCEEDED(rc) )
          {
             pIDescendantsOnCC-&gt;<b>Append</b>(spiSpecOnCurve) ;
...</pre>
    </td>
  </tr>
</table>
<p>Then, the <code>SetSpecObject</code>  method of the <i>CATISpecAttrAccess</i>
interface sets the input feature (<code>spiSpecOnCurve</code>) as Combined Curve attribute.
The first argument <code>piSpecAttrKeyOnInputCurve</code>, is the key of the
attribute retrieved just above.</p>
<table class="code">
  <tr>
    <td>
      <pre>...
    piSpecAttrAccessOnCC-&gt;<b>SetSpecObject</b>(piSpecAttrKeyOnInputCurve,spiSpecOnCurve);
...    </pre>
    </td>
  </tr>
</table>
<p align="left">However, if the input parameter, <code>ipiSpecOnCurve</code>, is
NULL, the last two steps ( BRep management, and <code>SetSpecObject</code> call)
are not done. In particular, the <code>SetSpecObject</code> call will be without
effect if the second argument is NULL.&nbsp;</p>
<p align="left"><code>If piSpecOnCurve</code> is NULL, you have only to do the following
code.&nbsp;</p>
<table class="code">
  <tr>
    <td>
      <pre>...
    piSpecAttrAccessOnCC-&gt;<b>UnsetAttributeValue</b>(piSpecAttrKeyOnInputCurve);
...    </pre>
    </td>
  </tr>
</table>
<p align="left">the <code>UnsetAttributeValue </code>saids that the value of the
attribute is no more those of the feature, but those of its reference. Since the
Combined Curve instance is created from the CombinedCurve StartUp, the new value
of the attribute is those of the StartUp attribute. If you read the
CAAMmrCreateCombCrvCatalog use case [<a href="#References">2</a>], you can see
that there is no value for the Combined Curve StartUp, since the attribute is
created without valuation. Consequently, in the <a href="#Step4">GetCurve</a>
method, the <code>GetSpecObject</code> will return NULL.&nbsp;</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Step4"></a>Getting a Combined Curve Attribute Value</h4>
<p>The <code>GetCurve</code> method works just like the implementation of <code>CAAIMmrCombinedCurve::SetCurve</code>
method. The only difference is that it uses the <code>CATISpecAttribute::GetSpecObject</code>
method instead of <code>CATISpecAttribute::SetSpecObject</code>.</p>
<table class="code">
  <tr>
    <td>
      <pre>...
HRESULT CAAEMmrCombinedCurve::<b>GetCurve</b>(int iNum, CATISpecObject** opiSpecOnCurve) 
{
    HRESULT rc = E_FAIL;

    if ( NULL == opiSpecOnCurve )
       return E_FAIL ;

    <b>CATISpecAttrAccess</b> *piSpecAttrAccessOnCC = NULL;
    rc = QueryInterface( IID_CATISpecAttrAccess , (void**) &amp;piSpecAttrAccessOnCC );
    if ( SUCCEEDED(rc) )
    {
       CATISpecAttrKey * piSpecAttrKeyOnInputCurve = NULL;
       if ( 1 == iNum )
       {
          piSpecAttrKeyOnInputCurve = piSpecAttrAccessOnCC-&gt;<b>GetAttrKey</b>(&quot;Curve1&quot;);
       }
       else
       {
          piSpecAttrKeyOnInputCurve = piSpecAttrAccessOnCC-&gt;GetAttrKey(&quot;Curve2&quot;);
       }

       rc = E_FAIL;
       
       if ( NULL != piSpecAttrKeyOnInputCurve )
       {
          *opiSpecOnCurve = piSpecAttrAccessOnCC-&gt;<b>GetSpecObject</b>(piSpecAttrKeyOnInputCurve);

          if ( NULL != *opiSpecOnCurve )
          {
              rc = S_OK ;
          } 
...

    return rc ;
}</pre>
    </td>
  </tr>
</table>
<p align="left">You can note that if the value of the attribute is NULL or if
there is an internal problem to retrieve the key of the attribute, the method
returns E_FAIL. The caller will be sure that if the method is successful, it can
be sure that the output value is valid.&nbsp;</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="InShort"></a>In Short</h3>
<p>This use case explains how to define and implement a new interface enabling
to get and retrieve the Combined Curve's attributes.&nbsp; As a matter of fact, this interface makes it
possible to easily query and modify the input curves and directions of a
Combined Curve.&nbsp;</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td valign="top">[1]</td>
    <td><a href="../CAAMmrTechArticles/CAAMmrCreatingNewFeat.htm">Creating a New StartUp from a Mechanical StartUp</a></td>
  </tr>
  <tr>
    <td valign="top">[2]</td>
    <td><a href="CAAMmrCombCrvCatalog.htm">Creating Combined Curve's Catalog</a></td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <strong>1</strong> [Mar 2000]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top">Version: <strong>2</strong> [Jan 2003]</td>
    <td valign="top">Document updated</td>
  </tr>
  <tr>
    <td valign="top">Version: <strong>3</strong> [Dec 2003]</td>
    <td valign="top">Document updated</td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<p><i>Copyright © 2000, Dassault Systèmes. All rights reserved.</i></p>

</body>
