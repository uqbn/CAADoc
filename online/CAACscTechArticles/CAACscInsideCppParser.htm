<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
<title>Inside the mkCheckSource Parser</title>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>RADE</h1>
    </td>
    <td valign="top">
      <h2>C++ Source Checker</h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>Inside the mkCheckSource Parser</h3>
      <em>Testing source code in the CAA V5 environment</em></td>
  </tr>
  <tr>
    <td class="tech" colspan="2">Technical Article</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This article describes the choices of architecture made for the
      internal parser of CSC. Reading this article, you will better understand
      the technology used and the limitations inherent to this technology.
      <ul>
        <li><a href="#Positioning"><b>Positioning the parser in CSC architecture</b></a></li>
        <li><a href="#Similarities"><b>Similarities with a compiler</b></a></li>
        <li><a href="#Technology"><b>The technology</b></a></li>
        <li><a href="#Limitations"><b>Limitations</b></a>
          <ul>
            <li><a href="#Preprocessing">preprocessing</a></li>
            <li><a href="#Templates">templates</a></li>
            <li><a href="#Operators">operators overloading</a></li>
            <li><a href="#Multiple">multiple definitions</a></li>
            <li><a href="#Inner">inner classes</a></li>
            <li><a href="#File">file-tree</a></li>
          </ul>
        </li>
        <li><a href="#InShort"><b>In Short</b></a></li>
      </ul>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="Positioning"></a>Positioning the Parser in CSC architecture</h3>
<p>CSC is a static controller, i.e. it is a tool working on C++ source code and
analyzing it to reveal potential defects and logical errors existing inside.
This tool uses a C++ parser to analyze the source, to generate the syntax tree
of the source code and to create the symbol table. The extension modules of CSC
will then use these results in conjunction with pre-coded rules to report
potential bugs.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<h3><a name="Similarities"></a>Similarities with a compiler</h3>
<p>The following picture describes :</p>
<ul>
  <li>the different steps of generation of a standard executable program.</li>
  <li>more precisely the steps involved in program compilation.</li>
</ul>
<p align="left"><img border="0" src="images/CAACscTechArticles_Archi_PgmGeneration.jpg" width="700" height="523"></p>
<p>The C++ analyzer included in CSC (the engine of the tool, we call it
improperly &quot;the parser&quot;), is a cousin tool of a compiler. This parser
makes the front task of a compiler, plus an internal preprocessing. The final
task of the compiler is not implemented in CSC, but CSC uses the data structures
generated by the parser to implement its checks.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<h3><a name="Technology"></a>The technology</h3>
<p>CSC is a fully internal tool. No external software (like a lexical analyzer)
have been used for the analyzer. We can then have a complete control on the code
of the parser, to implement some choices of architecture. These choices are a
compromise between speed and reliability.</p>
<p>Next picture describes the different steps occurring when analyzing a C++
file.</p>
<p align="left"><img border="0" src="images/CAACscTechArticles_Archi_AnalyzeSteps.jpg" width="658" height="504"></p>
<p>Let's take an example with a very simple source :</p>
<p><i><u>CATBase.cpp</u></i></p>
<table class="code">
  <tr>
    <td>
      <pre>#include &quot;inc1.h&quot;
#include &quot;inc2.h&quot;
#include &quot;inc3.h&quot;

HRESULT CATBase::Run()
{
	HRESULT hr;
}</pre>
    </td>
  </tr>
</table>
<p>These steps are :</p>
<ul>
  <li><u>Loader</u></li>
</ul>
<p>This module loads the file from disk to memory. File loader is running in a
separate thread, thus preventing the program from waiting for file access.</p>
<ul>
  <li><u>Include analyzer</u></li>
</ul>
<p>This module analyzes the &quot;#include ...&quot; in the file to load
recursively every file included, according to CAA file tree.</p>
<table class="code">
  <tr>
    <td>
      <pre><i>CATBase.cpp</i>

CATBase.cpp
  -&gt; inc1.h
     -&gt; inc4.h
     -&gt; inc5.h
        -&gt; inc9.h
        -&gt; inc10.h
     -&gt; inc6.h
  -&gt; inc2.h
     -&gt; inc7.h
     -&gt; inc8.h
  -&gt; inc3.h</pre>
    </td>
  </tr>
</table>
<p align="left">The first file loaded will be inc4.h, then inc9.h, then inc10.h,
then inc5.h, ... and the last one will be inc3.h.</p>
<p align="left">All these files will be scanned, parsed and semantically
analyzed <b>before</b> file CATBase.cpp.</p>
<ul>
  <li>
    <p align="left"><u>Scan and macro expansion</u></li>
</ul>
<p>Linear analyze. This module scans the current file to keep only useful
characters. In this step, every preprocessor commands are removed, as well as
every return or unneeded blank.&nbsp;</p>
<p>The macro expansion is not systematic, only macros declared in the setting
files will be treated.These macros are expanded as follows: first, the source
code is scanned to find all their occurrences. Then, for each occurrence, the
macro definition&nbsp; is retrieved and the expansion is done, taking into
account the possible arguments. Finally, the occurrence of the macro is replaced
by the corresponding expanded code.</p>
<p>After this step, the program got in memory a single line describing the whole
source file.</p>
<table class="code">
  <tr>
    <td>
      <pre>HRESULT CATBase::Run(){HRESULT hr;}</pre>
    </td>
  </tr>
</table>
<ul>
  <li>
    <p align="left"><u>Parse</u></li>
</ul>
<p>This step creates the parse tree of the source from the buffer and the
lexical tokens.</p>
<p>The method used is a <b>predictive recursive-descent parsing</b> by <b>operators
precedence</b>. Neither backtracking, nor error recovery is done in this step.</p>
<table class="code">
  <tr>
    <td>
      <pre>Declaration  HRESULT CATBase::Run()
       TAPExpression [::]   HRESULT CATBase::Run()
         TAPExpression [dc]   HRESULT CATBase
           TAPExpression [id]   HRESULT
             TAPIdentifiant  HRESULT
           TAPExpression [id]   CATBase
             TAPIdentifiant  CATBase
         TAPExpression [mt]   Run()
           TAPExpression [id]   Run
             TAPIdentifiant  Run
     TAPBloc
       TAPInstruction  HRESULT hr
         TAPExpression [dc]   HRESULT hr
           TAPExpression [id]   HRESULT
             TAPIdentifiant  HRESULT
           TAPExpression [id]   hr
             TAPIdentifiant  hr</pre>
    </td>
  </tr>
</table>
<ul>
  <li><u>Semantic analysis</u></li>
</ul>
<p>This analyze builds the symbol table of the source. This is not a symbol
table in the common sense of the term, but rather the data structure of the
definitions found in the source (like class definition, method declaration,
method implementation, data member declaration, variable declaration,
...),&nbsp; with all links between them.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<h3><a name="Limitations"></a>Limitations</h3>
<h4><a name="Preprocessing"></a>preprocessing</h4>
<p>For performance reasons, no real preprocessing is done.&nbsp;</p>
<p>No preprocessor directives interpretation is done (like #ifdef, #ifndef,
#else, #endif...). The whole code is taken into account.</p>
<p>The included files are recursively analyzed, without any expansion (one
included file will be analyzed only once in one run, no matter the number of
files including this header, this is quite similar to incremental compilation
done by MSDev).</p>
<p>Nevertheless, if needed, expansion of some macros in source code can be done.
These macros must be declared in the setting file. For some reasons, some checks
need to take into account some other macros. Those are well defined, and their
behavior is pre-coded.</p>
<h4><a name="Templates"></a>templates</h4>
<p>Templates are not supported (templates are forbidden in CAA).</p>
<h4><a name="Operators"></a>operators overloading</h4>
<p>Operators overloading is not supported.</p>
<h4><a name="Multiple"></a>multiples definitions</h4>
<p>Multiple definitions are not supported. Only the first definition will be
taken into account.</p>
<h4><a name="Inner"></a>inner classes</h4>
<p>Inner classes are not supported (they are not seen by the semantic analyzer,
and not kept in the data structure).</p>
<h4><a name="File"></a>file tree</h4>
<p>Only the CAA file-tree is supported (structure with Frameworks, modules,
Interfaces directories...).</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<hr>
<!---------------------------------comment------------------------------------->


<h3><a name="InShort"></a>In Short</h3>
<p>The source analyzer is the engine of CSC. It is equivalent to the front part
of a compiler. The choices of architecture (speed of execution) implies that
little preprocessing is done (included files and expansion of some macros). For
that reason, it is strongly recommended to avoid using macros (except the macros
provided in CAA) to code a CAA application. Nevertheless, if needed, it is
possible to declare in the setting file [<a href="#References">1</a>] (see
section Global_OptionsLists - Macro2Expand)&nbsp; a list of macros to be
expanded by the tool.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td valign="top">[1]</td>
    <td><a href="CAACscSettingFile.htm">Setting Files</a></td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>

<!---------------------------------------------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <strong>1</strong> [Apr 2001]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<p><i>Copyright © 2000, Dassault Systèmes. All rights reserved.</i></p>

</body>

</html>
