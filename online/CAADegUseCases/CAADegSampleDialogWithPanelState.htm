<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Associating a Dialog Box with a State</title>
<link rel="stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>3D PLM Enterprise Architecture</h1>
    </td>
    <td valign="top">
      <h2>User Interface - Commands</h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>Associating a Dialog Box with a State</h3>
      <em>Using a dialog box to input data and to trigger several transition
      from a state</em></td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This article shows how to use a Dialog box associated with a state in a
      state dialog command.
      <ul>
        <li><a href="#Learn"><strong>What You Will Learn With This Use Case</strong></a></li>
        <li><a href="#UseCase"><strong>The Point Command Use Case</strong></a>
          <ul>
            <li><a href="#What">What Does the Point Command Do</a></li>
            <li><a href="#How">How to Launch the Point Command</a></li>
            <li><a href="#Where">Where to Find the Point Command Code</a></li>
          </ul>
        </li>
        <li><a href="#Step"><strong>Step-by-Step</strong></a></li>
        <li><a href="#InShort"><strong>In Short</strong></a></li>
        <li><a href="#References"><strong>References</strong></a></li>
      </ul>
    </td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>This use case is intended to show how to use a dialog box associated with a
state in a dialog command. This dialog box is used to input precise values
rather than indicating a point on the screen. In addition, you will learn how to
use the Cancel state.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="UseCase"></a>The Point Command Use Case</h3>
<p>The Point command is a use case of the CAADialogEngine.edu framework that
illustrates the DialogEngine framework capabilities.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="What"></a>What Does the Point Command Do</h4>
<p>The Point command is a state dialog command that creates a point in the 3D
space according to the following UML statechart diagram [<a href="#References">1</a>].</p>
<p><img src="images/CAACreatePointStatechart.jpg" alt="CAACreatePointStatechart.jpg (15193 bytes)" width="524" height="259"></p>
<p>The dialog is as follows:</p>
<table>
  <tr>
    <td><img src="images/CAACreatePoint1.jpg" alt="CAACreatePoint1.jpg (19413 bytes)" width="398" height="328"></td>
    <td>Select the Point command. The active state becomes GetPoint, and the
      dialog box is displayed. You can either indicate a point or use the dialog
      box.</td>
  </tr>
  <tr>
    <td><img src="images/CAACreatePoint2.jpg" alt="CAACreatePoint2.jpg (19490 bytes)" width="398" height="328"></td>
    <td>Click to indicate a point. The transition loops to GetPoint and creates
      the point. You can click another point or use the dialog box.</td>
  </tr>
  <tr>
    <td><img src="images/CAACreatePoint3.jpg" alt="CAACreatePoint3.jpg (19539 bytes)" width="398" height="328"></td>
    <td>Enter values in the dialog box spinners. Clicking Apply create the point
      whose coordinates were entered and you can again either click to indicate
      a point or use the dialog box. This is what's shown beside. Clicking OK
      creates the point and ends the command. Clicking Cancel doesn't create the
      point and ends the command.</td>
  </tr>
</table>
<p>Indicating a point [<a href="#References">2</a>] means clicking on the screen
at the desired location with the left mouse key. This is a very handy way, but
sometimes it is not accurate enough, and a dialog box in which numerical values
can be entered is often needed. The Point command enables both indication and
dialog box input. Only the latter is described here.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="How"></a>How to Launch the Point Command</h4>
<p>See the section entitled &quot;How to Launch the CAAGeometry Use Case&quot;
in the &quot;<a href="../CAASysUseCases/CAASysCAAGeometryOverview.htm">The
CAAGeometry Sample</a>&quot; use case for a detailed description of how this use
case should be launched [<a href="#References">3</a>].</p>
<p>Then, in the window where you run the mkrun command, do not type the module
name on the command line, but type CNEXT instead. When the application is ready,
do the following:
<ul>
  <li>Select <b>File</b>-&gt;<b>New</b>
  <li>In the New box, select <b>CAAGeometry</b> and click <b>OK</b>
  <li>Select <b>Insert</b>-&gt;<b>Point</b></li>
  <li>Click in the window background to create points, or enter the point
    coordinates in the dialog box and click OK or Apply.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Where"></a>Where to Find the Point Command Code</h4>
<p>The Point command is made of a single class named <i>CAADegCreatePointCmd</i>
located in the CAADegGeoCommands.m module of the CAADialogEngine.edu framework:</p>
<table>
  <tbody>
    <tr>
      <td>Windows</td>
      <td><code>InstallRootDirectory\CAADialogEngine.edu\CAADegGeoCommands.m\</code></td>
    </tr>
    <tr>
      <td>Unix</td>
      <td><code>InstallRootDirectory/CAADialogEngine.edu/CAADegGeoCommands.m/</code></td>
    </tr>
  </tbody>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed.</p>
<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->
<h3><a name="Step"></a>Step-by-Step</h3>
<p>To create the Point command, there are three steps:</p>
<table width="100%">
  <tr>
    <th>#</th>
    <th>Step</th>
    <th>Where</th>
  </tr>
  <tr>
    <td valign="top"><a href="#Step1">1</a></td>
    <td valign="top">Create the Point Command Class Header File</td>
    <td valign="top">Header file</td>
  </tr>
  <tr>
    <td valign="top"><a href="#Step3">2</a></td>
    <td valign="top">Implement the Statechart Diagram</td>
    <td valign="top"><code>BuildGraph</code> method [<a href="#References">4</a>]</td>
  </tr>
  <tr>
    <td valign="top"><a href="#Step4">3</a></td>
    <td valign="top">Releasing the Indication Agent and the Dialog Box</td>
    <td valign="top">Destructor</td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Step1"></a>Creating the CreatePoint Command Class Header File</h4>
<p>The CAADegCreatePointCmd state command class derives from CATStateCommand.</p>
<table class="code">
  <tr>
    <td>
      <pre>...
class CAADegCreatePointCmd : public CATStateCommand
{
  CmdDeclareResourceFile(CAADegFileCmd,CAADegCreatePointCmd,CATStateCommand);

  public :

    CAADegCreatePointCmd();
    virtual ~CAADegCreatePointCmd();  
    ...
    virtual void BuildGraph() ; <em>// Implements the statechart</em>

    CATBoolean  CheckPoint(void * iData); <em>// Checks if the point can be created</em>

    CATBoolean  CreatePointByIndication(void * iData); 
    CATBoolean  CreatePointByBox       (void * iData);

  private :
    CATIndicationAgent * _daIndication; <em>// Indication agent</em>
    CAADegPointEditor  * _PointEditor;  <em>// Dialog box</em>

    void NewPoint(const CATMathPoint &amp;iPoint); <em>// Action method to create a point</em>
    ...</pre>
    </td>
  </tr>
</table>
<p>This header file includes:
<ul>
  <li>The <code>CmdDeclareResource</code> macro states that the resources of the
    <i>CAADegCreatePointCmd</i> command are located in the CAADegFileCmd.CATNls
    file. If resources were assigned to the CATStateCommand class, they would be
    concatenated with the resources for CAADegCreatePointCmd</li>
  <li>The <code>BuildGraph</code> method implements the statechart diagram</li>
  <li>CheckPoint is a condition method of the transitions that create points
    from a point indication or a dialog box entry using the action methods <code>CreatePointByIndication</code>
    or <code>CreatePointByBox</code> respectively</li>
  <li>Private data members include the indication agent, the dialog box, and a
    method called by the action method that actually creates a 3D point in the
    document.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<!---------------------------------comment------------------------------------->

<h4><a name="Step3"></a>Implementing the Statechart Diagram</h4>
<p>This is done in the command <code>BuildGraph</code> method.</p>
<table class="code">
  <tr>
    <td>
      <pre>void CAADegCreatePointCmd::BuildGraph()
{
  //1- Creates the indication agent  
  _daIndication = new <strong>CATIndicationAgent</strong>(&quot;Indication&quot;);
  ...</pre>
    </td>
  </tr>
</table>
<p>The indication agent is instantiated. The default projection plane is used;
it is a plane parallel to the screen plane&nbsp;</p>
<p>Then, the dialog box is instantiated and built. It is an instance of the <i>CAADegPointEditor</i>
class that derives from the <i>CATDlgDialog</i> class and that simply includes a
spinner for each coordinate, and three push buttons OK, Apply, and Cancel.</p>
<table class="code">
  <tr>
    <td>
      <pre>  ...
  //2- Creates the dialog box to input xyz 
  
  CATApplicationFrame * pFrame = NULL ;
  CATDialog * pParent = NULL ;
  pFrame = CATApplicationFrame::<b>GetFrame</b>() ;
  if ( NULL != pFrame )
  {
       pParent = pFrame-&gt;<b>GetMainWindow</b>() ;
  }
  _PointEditor = new <strong>CAADegPointEditor</strong>(pParent);
  _PointEditor-&gt;<strong>Build</strong>();
  ...</pre>
    </td>
  </tr>
</table>
<p>The parent of this dialog box is an invisible dialog object which contains
all the windows of the same document. This object is returned by the <code>GetMainWindow</code>
method on the application frame. Refer to the article entitled
&quot;Understanding the Application Frame Layout&quot; [<a href="#References">5</a>]
for complete details about this object.</p>
<p>Dialog boxes should always be instantiated without controls (or other dialog
objects). Instantiating these controls in a <code>Build</code> method called
after the constructor has returned make sure that the control resources will be
correctly allocated.</p>
<p>The GetPoint state is an instance of the <i>CATPanelState</i> class,
dedicated to states associated with a dialog box.</p>
<table class="code">
  <tr>
    <td>
      <pre>  ...
  //3- Creates the state associated with the dialog box and containing the 
  //   Indication Agent
  CATPanelState * stState = new <strong>CATPanelState</strong>(this, &quot;GetPointId&quot;, _PointEditor);
  <strong>SetInitialState</strong>(stState);
  stState-&gt;<strong>AddDialogAgent</strong>(_daIndication);
...</pre>
    </td>
  </tr>
</table>
<p>The state is also a <i>CATCommand</i> instance and must be assigned a parent
in the command tree structure. This parent is set as <code>this</code> in the
first constructor argument, that is, as the state dialog command itself. A
pointer to the dialog box is passed as the third argument to associate the
dialog box with the state. Since the state is explicitly constructed, it must be
added as a the command initial state using <code>SetInitialState</code>.
Usually, this is <code>GetInitialState</code> that instantiates and sets the
state as the initial state.</p>
<p>Then the transition that loops on this state when the end user indicates a
point is defined as follows.</p>
<table class="code">
  <tr>
    <td>
      <pre>  ...
  //4-Defines the transition triggered by the Indication Agent
  CATDialogTransition *pFirstTransition = <strong>AddTransition</strong>(
    stState,
    stState,
    <strong>AndCondition</strong>(<strong>IsOutputSetCondition</strong>(_daIndication),
                 <strong>Condition</strong>((ConditionMethod)&amp;CAADegCreatePointCmd::CheckPoint)),
    <strong>Action</strong>((ActionMethod) &amp; CAADegCreatePointCmd::CreatePointByIndication)</pre>
      <pre>  );</pre>
    </td>
  </tr>
</table>
<p>The <code>AddTransition</code> method creates a transition and adds it to the
transitions managed by the dialog command. Pointers to the transition's source
and target states are the first and second arguments respectively. This self
transition goes from/to the same GetPoint state. The transition trigger is
defined in the guard condition as the first condition to be checked using the <code>IsOutputSetCondition</code>
method applied to the indication agent. A second condition uses the <code>CheckPoint</code>
method. Because we use <code>AndCondition</code> to create the guard condition,
both condition methods must return True to fire the transition. In this case,
the <code>CreatePointByIndication</code> action method is executed.</p>
<p>The <i>CATPanelState</i> class<strong> </strong>creates automatically
transitions depending on the style of the associated Dialog box:</p>
<ul>
  <li>An <b>Ok</b> transition which fires when the Ok button is selected and
    whose target state is the NULL state.</li>
  <li>An <b>Apply</b> transition which fires when the Apply button is selected
    and whose target state is the dialog state itself.</li>
  <li>A <b>Cancel</b> transition which fires when the Cancel button is selected
    and whose target state is the cancel state.</li>
</ul>
<p>The Apply and Ok transitions are retrieved from the state and assigned a
condition and an action.</p>
<table class="code">
  <tr>
    <td>
      <pre>  ... 
  //5- Completes the Apply transition
  // Sets a condition to the Apply transition
  (stState-&gt;<strong>GetApplyTransition</strong>())-&gt;<strong>SetCondition</strong>(<strong>Condition</strong>((ConditionMethod)&amp;CAADegCreatePointCmd::CheckPoint));
  // Sets an action to the Apply transition
  (stState-&gt;<strong>GetApplyTransition</strong>())-&gt;<strong>SetAction</strong>(<strong>Action</strong>((ActionMethod)&amp;CAADegCreatePointCmd::CreatePointByBox));

  //6- Completes the Ok transition
  // Sets a condition to the Ok transition
  (stState-&gt;<strong>GetOkTransition</strong>())-&gt;<strong>SetCondition</strong>(<strong>Condition</strong>((ConditionMethod)&amp;CAADegCreatePointCmd::CheckPoint));
  // Sets an action to the Ok transition
  (stState-&gt;<strong>GetOkTransition</strong>())-&gt;<strong>SetAction</strong>(<strong>Action</strong>((ActionMethod)&amp;CAADegCreatePointCmd::CreatePointByBox));
   ...
}</pre>
    </td>
  </tr>
</table>
<p>&nbsp;Don't forget to release the state before getting out of scope.</p>
<table class="code">
  <tr>
    <td>
      <pre>  ... 
  // As the state was created explicitly by &quot;new&quot; instead of the 
  // GetInitialState method, it must be released.
  stState-&gt;<strong>Release</strong>();
}</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Step4"></a>Releasing the Indication Agent and the Dialog Box</h4>
<p>A pointer to the indication agent was created in the command <code>BuildGraph</code>
method as a data member to be accessed and used in different methods. It should
be released when it becomes useless. This can be done in the command destructor,
as shown here. This could also be done in the <code>Cancel</code> method called
just before the destructor. In the same way, the dialog box should be destructed
as soon as possible. This is possible using the <code>RequestDelayedDestruction</code>
method.</p>
<table class="code">
  <tr>
    <td>
      <pre>CAADegCreatePointCmd::~CAADegCreatePointCmd()
{
  if (NULL != _daIndication) _daIndication-&gt;<b>RequestDelayedDestruction</b>();
  daIndication = NULL ;
  if (NULL !=_PointEditor)  _PointEditor-&gt;<b>RequestDelayedDestruction</b>();
  _PointEditor = NULL ;
  ...</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="InShort"></a>In Short</h3>
<p>This use case shows the objects involved when a dialog box is used in
conjunction with a specific state dedicated to it (the &quot;panel&quot; state):
the state dialog command, the statechart and its implementation in the <code>BuildGraph</code>
method, the &quot;panel&quot; state, and the specific way to assign condition
and action methods to transitions triggered when pressing the dialog box push
buttons.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="References"></a>References</h3>
<table border="0" width="100%">
  <tr>
    <td valign="top">[1]</td>
    <td><a href="../CAADegTechArticles/CAADegUMLDescription.htm">Describing
      State Dialog Commands Using UML</a></td>
  </tr>
  <tr>
    <td valign="top">[2]</td>
    <td><a href="../CAADegTechArticles/CAADegGraph.htm#510000">Managing
      Indication</a></td>
  </tr>
  <tr>
    <td valign="top">[3]</td>
    <td><a href="../CAASysUseCases/CAASysCAAGeometryOverview.htm">The
      CAAGeometry Sample</a></td>
  </tr>
  <tr>
    <td valign="top">[4]</td>
    <td><a href="../CAADegTechArticles/CAADegGraph.htm">Implementing
      the Command Statechart Diagram</a></td>
  </tr>
  <tr>
    <td valign="top">[5]</td>
    <td><a href="../CAAAfrTechArticles/CAAAfrLayoutV5.htm">Understanding
      the Application Frame Layout</a></td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table border="0" width="100%">
  <tr>
    <td valign="top">Version: <strong>1</strong> [Jan 2000]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<!---------------------------------comment------------------------------------->
<hr>
<p><i>Copyright © 2000, Dassault Systèmes. All rights reserved.</i></p>

</body>

</html>
