<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
<title>Placing Parts</title>
<style type="text/css">
  .highlight { color: #FF0000; }
  .comment { color: #009900; }
  .pre { color: #000099; }
  .string { color: #990000; }
  .char { color: #009900; }
  .float { color: #996600; }
  .int { color: #999900; }
  .bool { color: #000000; font-weight: bold; }
  .type { color: #0000FF; }
  .flow { color: #0000FF; }
  .keyword { color: #000000; font-weight: bold; }
  .operator { color: #000000; font-weight: bold; }
  div.abstract { background-color: #F0F0FF; width: 100%; margin-bottom: 2mm; margin-top: 2mm}
  ul.NoMarker {list-style-type: none}
  ul.code {list-style-type: none; background-color: #E0E0E0; width: 100%; margin-bottom: 2mm; margin-top: 2mm}
  div.code { background-color: #E0E0E0; width: 100%; margin-bottom: 2mm; margin-top: 2mm; font-family: Courier New, Courier; font-size: 110%; font-weight: normal;}
  span.code { background-color: #E0E0E0; font-family: Courier New, Courier; font-size: 110%; font-weight: normal;}
.style1 {
	font-weight: bold;
}
</style>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>Equipment &amp; Systems</h1>
    </td>
    <td valign="top">
      <h2>Distributive Systems</h2>
    </td>
    <td rowspan="2" align="right" valign="top" width="40%">
      <h3><a name="Top"></a>Placing Parts</h3>
      <em>How to place parts.</em></td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<div class="abstract">
  <h3>Abstract</h3>
  <p>This article discusses the CAACloPlacePart use case.</p>
  <ul>
    <li><strong><a href="#Overview">Overview</a></strong>
      <ul>
        <li><a href="#What You Will Learn">What You Will Learn</a></li>
        <li><a href="#What CAACloPlacePart Does">What CAACloPlacePart Does</a></li>
        <li><a href="#How to Launch CAACloPlacePart">How to Launch CAACloPlacePart</a></li>
        <li><a href="#Where to Find CAACloPlacePart Files">Where to Find CAACloPlacePart Files</a></li>
      </ul>
    </li>
    <li><strong><a href="#Step">Step-by-Step</a></strong></li>
      <ul>
        <li><a href="#Initialization">Initialization</a></li>
        <li><a href="#Use Case Execution">Use Case Execution</a></li>
        <li><a href="#Support Methods">Support Methods</a></li>
        <li><a href="#Parts in Space">Parts in Space</a></li>
        <li><a href="#Parts on Run Segments">Parts on Run Segments</a></li>
        <li><a href="#Parts on Run Nodes">Parts on Run Nodes</a></li>
        <li><a href="#Parts on Part Connectors">Parts on Part Connectors</a></li>
      </ul>
    <li><strong><a href="#InShort">In Short</a></strong></li>
    <li><strong><a href="#References">References</a></strong></li>
  </ul>
</div>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="Overview"></a>Overview</h3>
<p>
  CAACloPlacePart is a use case of the CAACommonLayoutItf.edu framework. 
  It illustrates a CATPlantShipInterfaces interface that is implemented by CATCommonLayout.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="What You Will Learn"></a>What You Will Learn</h4>
<p>This use case is intended to show you how to place parts using the CATIPspPlacePartOnRun interface.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="What CAACloPlacePart Does"></a>What CAACloPlacePart Does</h4>
  <p>
    CAACloPlacePart places tubing parts. 
    It places a valve and tube in space.
    It also places parts on run segments, run nodes and part connectors.
  </p>
<p align="right">&nbsp;[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="How to Launch CAACloPlacePart"></a>How to Launch CAACloPlacePart</h4>
<p>
  To launch CAACloPlacePart, you will need to set up the build time environment, 
  then compile CAACloPlacePart along with its prerequisites, 
  set up the run time environment, and then execute the sample. 
  This is fully described in the referenced article [<a href="#Reference 1">1</a>].
</p>
<p>
  Launch the use case with the following command.</p>
 <div class="code">
   CAACloPlacePart MyRootDirectory/CAACommonLayoutItf.edu/CNext/resources/graphic/CAACloEduRuns/CAACloEduRuns.CATProduct<a href="#Footnote 1"><sup>1</sup></a>
 </div>
  <p>where MyRootDirectory is the pathname of the root directory where you copied and built the use case.
</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Where to Find CAACloPlacePart Files"></a>Where to Find CAACloPlacePart Files</h4>
<p>
  The CAACloPlacePart code consists of three files located in the CAACloPlacePart.m use case module of the CAACommonLayoutItf.edu framework:</p>
  <div class="code">
    InstallRootDirectory/CAACommonLayoutItf.edu/CAACloPlacePart.m/LocalInterfaces/<span class="highlight">CAACloPlacePart.h</span><br>
    InstallRootDirectory/CAACommonLayoutItf.edu/CAACloPlacePart.m/src/<span class="highlight">CAACloPlacePart.cpp</span><br>
    InstallRootDirectory/CAACommonLayoutItf.edu/CAACloPlacePart.m/src/<span class="highlight">CAACloPlacePartMain.cpp</span><br>
  </div>
  <p>where <code>InstallRootDirectory</code> is the root directory of your CAA V5 installation<a href="#Footnote 1"><sup>1</sup></a>. 
</p>
<p>
  This sample uses two C++ source files: CAACloPlacePartMain.cpp and CAACloPlacePart.cpp. 
  CAACloPlacePartMain.cpp holds the main method which initiates the sample code.
  CAACloPlacePart.cpp defines the class that places parts.
  CAACloPlacePart has a corresponding header (.h) file.
</p>
<p>
  The CAACloPlacePart also uses three data files:</p>
  <div class="code">
    InstallRootDirectory/CAACommonLayoutItf.edu/CNext/resources/graphic/CAACloEduRuns/<span class="highlight">CAACloEduRuns.CATProduct</span><br>
    InstallRootDirectory/CAACommonLayoutItf.edu/CNext/resources/graphic/CAACloEduRuns/<span class="highlight">CATTubTubingLine20010507183018970.CATProduct</span><br>
    InstallRootDirectory/CAACommonLayoutItf.edu/CNext/resources/graphic/CAACloEduRuns/<span class="highlight">TubingWP.CATProduct</span><br>
  </div>
<p>
  CAACloEduRuns.CATProduct is the main data model for the use cases.
  It is the file which should be referenced in the execution command line.
  CATTubTubingLine20010507183018970.CATProduct and TubingWP.CATProduct are used by CAACloEduRuns.CATProduct.
</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="Step"></a>Step-by-Step</h3>
<p>The remainder of this document describes the various parts of CAACloPlacePartMain.cpp and CAACloPlacePart.cpp.</p>
<ul>
  <li><a href="#Initialization">Initialization</a></li>
  <li><a href="#Use Case Execution">Use Case Execution</a></li>
  <li><a href="#Support Methods">Support Methods</a></li>
  <li><a href="#Parts in Space">Parts in Space</a></li>
  <li><a href="#Parts on Run Segments">Parts on Run Segments</a></li>
  <li><a href="#Parts on Run Nodes">Parts on Run Nodes</a></li>
  <li><a href="#Parts on Part Connectors">Parts on Part Connectors</a></li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Initialization"></a>Initialization</h4>
<p>
  CAACloPlacePartMain.cpp contains the main method that initiates processing. 
  It reads the command line argument to find the path of the data file to be processed.
  It also creates the CAACloPlacePart class and calls the DoSample method of CAACloPlacePart.
</p>
<div class="code">
<pre><span class="comment">// COPYRIGHT DASSAULT SYSTEMES 2008
//=============================================================================
//
// CAACloPlacePartMain
//
//  This sample illustrates how to use the CAA Plant Ship interfaces to place parts.
//
//
//  Prerequisite: 
//  -------------------
//  This sample uses the input drawing CAACloEduRuns.CATProduct.
//
//  Running the program:
//  -------------------
//  To run this program, you can use the command:
//  
//        CAACloPlacePart MyRootDirectory/CAACommonLayoutItf.edu/CNext/resources/graphic/CAACloEduRuns/CAACloEduRuns.CATProduct
//  
//  where MyRootDirectory is the pathname of the root directory where you copied and built the use case.
//
//=============================================================================
//
</span><span class="pre">#include &lt;iostream.h&gt;
#include &lt;string.h&gt;

</span><span class="comment">
// This framework
</span><span class="pre">#include "CAACloPlacePart.h"
</span><span class="comment">
// System
</span><span class="pre">#include "CATErrorMacros.h"
#include "CATUnicodeString.h"
</span><span class="comment">
//=============================================================================
//   Main
//=============================================================================
</span><span class="type">int</span><span class="keyword"> main</span><span class="operator"> (</span><span class="type">int</span> argc<span class="operator">,</span><span class="type"> char</span><span class="operator"> **</span>argv<span class="operator">)
{</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string"> "Start main CAACloPlacePart"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;
  </span><span class="type">
  int</span> rc<span class="operator"> =</span><span class="int"> 0</span><span class="operator">;</span>

  HRESULT rcError<span class="operator"> =</span> CATReturnFailure<span class="operator">;</span>

  CATUnicodeString FileToBeLoaded<span class="operator"> =</span> NULL<span class="operator">;</span>

  CAACloPlacePart myObject<span class="operator">;</span>


  CATTry<span class="operator"> 
  {</span><span class="flow">
    if</span><span class="operator"> (</span>argc<span class="operator"> &gt;</span><span class="int"> 1</span><span class="operator">)
    {</span>

      FileToBeLoaded<span class="operator"> =</span> argv<span class="operator">[</span><span class="int">1</span><span class="operator">];
    }</span><span class="flow">

    if</span><span class="operator"> (</span>FileToBeLoaded<span class="operator">.</span>IsNull<span class="operator">())
    {</span>

       cout<span class="operator"> &lt;&lt;</span><span class="string"> "**** must input the file name of "</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
       cout<span class="operator"> &lt;&lt;</span><span class="string"> "a CATProduct with Piping application objects "</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;
    }</span><span class="flow">

    else</span><span class="operator">
    {</span>
      cout<span class="operator"> &lt;&lt;</span><span class="string"> "FileToBeLoaded = "</span><span class="operator"> &lt;&lt;</span> FileToBeLoaded<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

      rcError<span class="operator"> =</span> myObject<span class="operator">.</span>DoSample<span class="operator">(</span>FileToBeLoaded<span class="operator">);
    }
  }</span>

	CATCatch<span class="operator"> (</span>CATError<span class="operator">,</span> pError<span class="operator">)
	{</span>

    cout<span class="operator"> &lt;&lt;</span><span class="string"> "error in main "</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

    rcError<span class="operator"> =</span> CATReturnError<span class="operator">(</span>pError<span class="operator">);
	}</span><span class="comment"> // end CATCatch

</span>
  CATEndTry<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart rcError = "</span><span class="operator"> &lt;&lt;</span> rcError<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

  if</span><span class="operator"> (</span>FAILED<span class="operator">(</span>rcError<span class="operator">))
  {</span> 
    rc<span class="operator"> =</span><span class="int"> 999</span><span class="operator">;</span>
    CATError<span class="operator"> *</span>pError<span class="operator"> =</span> CATError<span class="operator">::</span>CATGetLastError<span class="operator">(</span>rcError<span class="operator">);</span><span class="flow">

    if</span><span class="operator"> (</span>pError<span class="operator">)
    {</span>
      cout<span class="operator"> &lt;&lt;</span> pError<span class="operator">;</span>
      Flush<span class="operator">(</span>pError<span class="operator">);
    }
  }</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart rc = "</span><span class="operator"> &lt;&lt;</span> rc<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string"> "End main CAACloPlacePart"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

  return</span> rc<span class="operator">;
}</span>
</pre>
</div>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Use Case Execution"></a>Use Case Execution</h4>
<p>
The CAACloPlacePart DoSample method runs the use cases.
It starts by calling CreateCATProductEnv to load the input data model and create a CATIA product enviroment.
CreateCATProductEnv is part of the CAAPspBaseEnvProtected class which is defined in these files.</p>
  <div class="code">
    InstallRootDirectory/CAAPlantShipInterfaces.edu/PublicInterfaces/<span class="highlight">CAAPspBaseEnvProtected.h</span><br>
    InstallRootDirectory/CAAPlantShipInterfaces.edu/CAAPspUtilities.m/src/<span class="highlight">CAAPspBaseEnvProtected.cpp</span><br>
  </div>
<p>After CAACloPlacePart calls CreateCATProductEnv it calls ApplicationInit to initialize the Tubing application.
ApplicationInit is also a part of the CAAPspBaseEnvProtected class.
With the data model and application properly initialized DoSample runs the use case.
The use case places parts in free space, on run segments, on run nodes and on part connectors.
The code for DoSample is shown below.
</p>
<div class="code">
<pre><span class="comment">//=============================================================================
//  Execute the CAACloPlacePart sample code.
//=============================================================================
</span>HRESULT CAACloPlacePart<span class="operator">::</span>DoSample<span class="operator">(</span><span class="keyword">const</span> CATUnicodeString<span class="operator"> &amp;</span>iuFileToBeLoaded<span class="operator">)
{</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">"===       CAACloPlacePart::DoSample                      ==="</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">" File: "</span><span class="operator"> &lt;&lt;</span> iuFileToBeLoaded<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

  HRESULT rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;</span><span class="comment">

  // Interface pointer variables used below in the try section.
</span>

  CATTry<span class="operator"> 
  {</span><span class="comment">

    //  Load input document
</span>    CreateCATProductEnv<span class="operator">(</span>iuFileToBeLoaded<span class="operator">);</span>
    cout<span class="operator"> &lt;&lt;</span><span class="string"> "Product environment created."</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">

    //  Initialize Tubing Design application
</span>    ApplicationInit<span class="operator">(</span><span class="string">"CATTubing"</span><span class="operator">);</span>
    cout<span class="operator"> &lt;&lt;</span><span class="string"> "Tubing application initialized."</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

    <span class="comment">// Place a part in space.</span>
    HRESULT rcSpace<span class="operator"> =</span> PlacePartInSpace<span class="operator">();</span>
    cout<span class="operator"> &lt;&lt;</span><span class="string"> "rcSpace = "</span><span class="operator"> &lt;&lt;</span> rcSpace<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">

    // Route a string in space.
</span>    HRESULT rcStringInSpace<span class="operator"> =</span> RouteStringPartInSpace<span class="operator">();</span>
    cout<span class="operator"> &lt;&lt;</span><span class="string"> "rcStringInSpace = "</span><span class="operator"> &lt;&lt;</span> rcStringInSpace<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">

    // Place parts on run segments.
</span>    HRESULT rcSegment<span class="operator"> =</span> PlacePartOnRunSegment<span class="operator">();</span>
    cout<span class="operator"> &lt;&lt;</span><span class="string"> "rcSegment = "</span><span class="operator"> &lt;&lt;</span> rcSegment<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">

    // Place parts on part conntectors.
</span>    HRESULT rcPartCtr<span class="operator"> =</span> PlacePartOnPartConnector<span class="operator">();</span>
    cout<span class="operator"> &lt;&lt;</span><span class="string"> "rcPartCtr = "</span><span class="operator"> &lt;&lt;</span> rcPartCtr<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">
    
    // Place parts on run nodes.
</span>    HRESULT rcNode<span class="operator"> =</span> PlacePartOnRunNode<span class="operator">();</span>
    cout<span class="operator"> &lt;&lt;</span><span class="string"> "rcNode = "</span><span class="operator"> &lt;&lt;</span> rcNode<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">
   
    // Place part on part conntector and reconnect run.
 </span>   HRESULT rcPartCtrNCnt<span class="operator"> =</span> PlacePartOnPartConnectorAndReconnectRun<span class="operator">();</span>
    cout <span class="operator"> &lt;&lt;</span><span class="string"> "rcPartCtrNCnt = "</span><span class="operator"> &lt;&lt;</span> rcPartCtrNCnt <span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">
 
    // Set return code.
</span><span class="flow">    if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rcSpace<span class="operator">) &amp;&amp;</span> 
        SUCCEEDED<span class="operator">(</span>rcStringInSpace<span class="operator">) &amp;&amp;</span> 
        SUCCEEDED<span class="operator">(</span>rcSegment<span class="operator">) &amp;&amp;</span> 
        SUCCEEDED<span class="operator">(</span>rcPartCtr<span class="operator">) &amp;&amp;</span> 
        SUCCEEDED<span class="operator">(</span>rcNode<span class="operator">) &amp;&amp;</span>
        SUCCEEDED<span class="operator">(</span>rcPartCtrNCnt<span class="operator">))</span>

      rc<span class="operator"> =</span> CATReturnSuccess<span class="operator">;
  }</span><span class="comment"> // end CATTry
</span>
	CATCatch<span class="operator"> (</span>CATError<span class="operator">,</span> pError<span class="operator">)
	{</span>

    cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::DoSample *** Error Caught ***"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
    cout<span class="operator"> &lt;&lt;</span> pError<span class="operator">;</span>

    rc<span class="operator"> =</span> CATReturnError<span class="operator">(</span>pError<span class="operator">);
	}</span><span class="comment"> // end CATCatch
</span>
  CATEndTry<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::DoSample rc = "</span><span class="operator"> &lt;&lt;</span> rc<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">
  return</span> rc<span class="operator">;
}</span></pre>
</div>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Support Methods"></a>Support Methods</h4>
<p>
The CAACloPlacePart has several methods that support the use scenario.</p>
<ul>
  <li><strong>GetPartConnector</strong> retrieves a part connector given a part and the connector number.</li>
  <li><strong>GetPartConnectorData</strong> gets connector position, alignment and up direction relative to an input axis object.</li>
  <li><strong>GetConnectedPart</strong> retrieves the connector and part connected to a part connector.</li>
  <li><strong>TestPartConnectorData</strong> tests connector position, alignment and up direction against expected values.</li>
  <li><strong>TestConnectedPart</strong> tests the connector and part connected to a part connector.</li>
</ul>
<p>The code for the support methods is shown below.</p>
<div class="code">
<pre><span class="comment">//=============================================================================
// Get a part connector.
//=============================================================================
</span>HRESULT CAACloPlacePart<span class="operator">::</span>GetPartConnector<span class="operator">(</span><span class="keyword">const</span> IUnknown<span class="operator"> *</span>ipiPartUnk<span class="operator">,</span><span class="keyword"> 
                                          const</span><span class="type"> int</span><span class="operator"> &amp;</span>iConnectorNumber<span class="operator">,</span> 
                                          IUnknown<span class="operator"> *&amp;</span>opiPartConnector<span class="operator">)
{</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"===    CAACloPlacePart::GetPartConnector                 ==="</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">" Part: "</span><span class="operator"> &lt;&lt;</span> ipiPartUnk<span class="operator"> &lt;&lt;</span><span class="string"> ": "</span><span class="operator"> &lt;&lt;</span> GetObjectName<span class="operator">(</span>ipiPartUnk<span class="operator">) &lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">" Connector number "</span><span class="operator"> &lt;&lt;</span> iConnectorNumber<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

  opiPartConnector<span class="operator"> =</span> NULL<span class="operator">;</span>

  HRESULT rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;</span><span class="comment">

  // Interface pointer variables used below in the try section.
</span>  CATIPspPhysicalProduct<span class="operator"> *</span>piPhysProd<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIUnknownList<span class="operator"> *</span>piListCtrs<span class="operator"> =</span> NULL<span class="operator">;</span><span class="type">

  int</span> NumOfCtrs<span class="operator"> =</span><span class="int"> 0</span><span class="operator">;</span><span class="type">

  unsigned int</span> ListSize<span class="operator"> =</span><span class="int"> 0</span><span class="operator">;</span>

  CATTry<span class="operator"> 
  {</span><span class="flow">
    if</span><span class="operator"> (</span>ipiPartUnk<span class="operator"> &amp;&amp;</span> 
        SUCCEEDED<span class="operator">(((</span>IUnknown<span class="operator">*)</span>ipiPartUnk<span class="operator">)-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIPspPhysicalProduct<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piPhysProd<span class="operator">)))
    {</span><span class="comment">

  
      //----------------------------------------------------------------------
      //  List part connectors
      //----------------------------------------------------------------------    
</span><span class="flow">      if</span><span class="operator"> (</span> SUCCEEDED<span class="operator">(</span>piPhysProd<span class="operator">-&gt;</span>ListConnectors<span class="operator">(</span>NULL<span class="operator">,&amp;</span>piListCtrs<span class="operator">))
           &amp;&amp;</span> NULL<span class="operator"> !=</span> piListCtrs<span class="operator"> )
      {</span><span class="comment">

         //  Get list of part connectors
</span><span class="flow">         if</span><span class="operator"> (</span> SUCCEEDED<span class="operator">(</span>piListCtrs<span class="operator">-&gt;</span>Count<span class="operator">(&amp;</span>ListSize<span class="operator">)) )</span> NumOfCtrs<span class="operator"> =</span> ListSize<span class="operator">;</span>

         cout<span class="operator"> &lt;&lt;</span><span class="string"> "Number of connectors on part: "</span><span class="operator"> &lt;&lt;</span> NumOfCtrs<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">
         if</span><span class="operator"> (</span><span class="int">0</span><span class="operator"> &lt;</span> iConnectorNumber<span class="operator"> &amp;&amp;</span> 
             NumOfCtrs<span class="operator"> &gt;=</span> iConnectorNumber<span class="operator">)
         {</span>

           rc<span class="operator"> =</span> piListCtrs<span class="operator">-&gt;</span>Item<span class="operator">(</span>iConnectorNumber<span class="operator">-</span><span class="int">1</span><span class="operator">,&amp;</span>opiPartConnector<span class="operator">);
         }</span><span class="comment"> // End if valid ctr number.

</span><span class="operator">       }</span><span class="comment"> // End if valid list of part ctrs.
</span><span class="operator">    }</span><span class="comment"> // End if valid input part.
</span><span class="operator">  }</span><span class="comment"> // end CATTry
</span>
	CATCatch<span class="operator"> (</span>CATError<span class="operator">,</span> pError<span class="operator">)
	{</span>

    cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::GetPartConnector *** Error Caught ***"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
    cout<span class="operator"> &lt;&lt;</span> pError<span class="operator">;</span>

    rc<span class="operator"> =</span> CATReturnError<span class="operator">(</span>pError<span class="operator">);
	}</span><span class="comment"> // end CATCatch
</span>
  CATEndTry<span class="operator">;</span><span class="flow">

  if</span><span class="operator"> (</span>piPhysProd<span class="operator">) {</span>piPhysProd<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPhysProd<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piListCtrs<span class="operator">) {</span>piListCtrs<span class="operator">-&gt;</span>Release<span class="operator">();</span> piListCtrs<span class="operator"> =</span> NULL<span class="operator">;}</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">" opiPartConnector = "</span><span class="operator"> &lt;&lt;</span> opiPartConnector<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::GetPartConnector rc = "</span><span class="operator"> &lt;&lt;</span> rc<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

  return</span> rc<span class="operator">;
}</span><span class="comment">

//=============================================================================
//  Get location data for a part connector.
//=============================================================================
</span>HRESULT CAACloPlacePart<span class="operator">::</span>GetPartConnectorData<span class="operator">(</span><span class="keyword">const</span> IUnknown<span class="operator"> *</span>ipiPartUnk<span class="operator">,</span><span class="keyword"> 
                                              const</span><span class="type"> int</span><span class="operator"> &amp;</span>iConnectorNumber<span class="operator">,</span> 
                                              IUnknown<span class="operator"> *</span>ipiRelAxisUnk<span class="operator">,</span> 
                                              CATMathPoint<span class="operator"> &amp;</span>oCtrPosition<span class="operator">,</span> 
                                              CATMathDirection<span class="operator"> &amp;</span>oCtrAlign<span class="operator">,</span> 
                                              CATMathDirection<span class="operator"> &amp;</span>oCtrUp<span class="operator">)
{</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"===    CAACloPlacePart::GetPartConnectorData             ==="</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">" Part: "</span><span class="operator"> &lt;&lt;</span> ipiPartUnk<span class="operator"> &lt;&lt;</span><span class="string"> ": "</span><span class="operator"> &lt;&lt;</span> GetObjectName<span class="operator">(</span>ipiPartUnk<span class="operator">) &lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">" Connector number "</span><span class="operator"> &lt;&lt;</span> iConnectorNumber<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

  HRESULT rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;</span><span class="comment">

  // Interface pointer variables used below in the try section.
</span>  CATIMovable<span class="operator"> *</span>piRelAxis<span class="operator"> =</span> NULL<span class="operator">;</span>
  IUnknown<span class="operator"> *</span>piCtrUnk<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIPspPartConnector<span class="operator"> *</span>piPartCntr<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATTry<span class="operator"> 
  {</span>

    rc<span class="operator"> =</span> GetPartConnector<span class="operator">(</span>ipiPartUnk<span class="operator">,</span> 
                          iConnectorNumber<span class="operator">,</span> 
                          piCtrUnk<span class="operator">);</span><span class="flow">
    if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> piCtrUnk<span class="operator">)
    {</span><span class="flow">

  
      if</span><span class="operator"> (</span>ipiRelAxisUnk<span class="operator">)
        ((</span>IUnknown<span class="operator">*)</span>ipiRelAxisUnk<span class="operator">)-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIMovable<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piRelAxis<span class="operator">);</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piRelAxis = "</span><span class="operator"> &lt;&lt;</span> piRelAxis<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

      if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>piCtrUnk<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIPspPartConnector<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piPartCntr<span class="operator">)))
      {</span>

        rc<span class="operator"> =</span> CATReturnSuccess<span class="operator">;</span><span class="comment">

        //  Get connector position
</span>        piPartCntr<span class="operator">-&gt;</span>GetPosition<span class="operator">(</span>piRelAxis<span class="operator">,</span>oCtrPosition<span class="operator">);</span><span class="comment">

        //  Get connector alignment direction
</span>        piPartCntr<span class="operator">-&gt;</span>GetAlignmentDirection<span class="operator">(</span>piRelAxis<span class="operator">,</span>oCtrAlign<span class="operator">);</span><span class="comment">

        //  Get connector up direction
</span>        piPartCntr<span class="operator">-&gt;</span>GetUpDirection<span class="operator">(</span>piRelAxis<span class="operator">,</span>oCtrUp<span class="operator">);</span><span class="flow">

        if</span><span class="operator"> (</span>piPartCntr<span class="operator">) {</span>piPartCntr<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPartCntr<span class="operator"> =</span> NULL<span class="operator">;}
      }</span><span class="comment"> // End if valid part connector.

</span><span class="flow">      if</span><span class="operator"> (</span>piCtrUnk<span class="operator">) {</span>piCtrUnk<span class="operator">-&gt;</span>Release<span class="operator">();</span> piCtrUnk<span class="operator"> =</span> NULL<span class="operator">;}
    }</span><span class="comment"> // End if valid part ctr.

</span><span class="operator">  }</span><span class="comment"> // end CATTry
</span>
	CATCatch<span class="operator"> (</span>CATError<span class="operator">,</span> pError<span class="operator">)
	{</span>
    cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::GetPartConnectorData *** Error Caught ***"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

    cout<span class="operator"> &lt;&lt;</span> pError<span class="operator">;</span>

    rc<span class="operator"> =</span> CATReturnError<span class="operator">(</span>pError<span class="operator">);
	}</span><span class="comment"> // end CATCatch

</span>
  CATEndTry<span class="operator">;</span><span class="flow">

  if</span><span class="operator"> (</span>piRelAxis<span class="operator">) {</span>piRelAxis<span class="operator">-&gt;</span>Release<span class="operator">();</span> piRelAxis<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piCtrUnk<span class="operator">) {</span>piCtrUnk<span class="operator">-&gt;</span>Release<span class="operator">();</span> piCtrUnk<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPartCntr<span class="operator">) {</span>piPartCntr<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPartCntr<span class="operator"> =</span> NULL<span class="operator">;}</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string"> "oCtrPosition = "</span><span class="operator"> &lt;&lt;</span> oCtrPosition<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string"> "oCtrAlign = "</span><span class="operator"> &lt;&lt;</span> oCtrAlign<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string"> "oCtrUp = "</span><span class="operator"> &lt;&lt;</span> oCtrUp<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::GetPartConnectorData rc = "</span><span class="operator"> &lt;&lt;</span> rc<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

  return</span> rc<span class="operator">;
}</span><span class="comment">

//=============================================================================
//  Get part connected to a part ctr.
//=============================================================================
</span>HRESULT CAACloPlacePart<span class="operator">::</span>GetConnectedPart<span class="operator">(</span><span class="keyword">const</span> IUnknown<span class="operator"> *</span>ipiPartUnk<span class="operator">,</span><span class="keyword"> 
                                          const</span><span class="type"> int</span><span class="operator"> &amp;</span>iConnectorNumber<span class="operator">,</span> 
                                          IUnknown<span class="operator"> *&amp;</span>opiConnectedCtr<span class="operator">,</span> 
                                          IUnknown<span class="operator"> *&amp;</span>opiConnectedPart<span class="operator">)
{</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"===    CAACloPlacePart::GetConnectedPart                 ==="</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">" Part: "</span><span class="operator"> &lt;&lt;</span> ipiPartUnk<span class="operator"> &lt;&lt;</span><span class="string"> ": "</span><span class="operator"> &lt;&lt;</span> GetObjectName<span class="operator">(</span>ipiPartUnk<span class="operator">) &lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">" Connector number "</span><span class="operator"> &lt;&lt;</span> iConnectorNumber<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

  opiConnectedCtr<span class="operator"> =</span> NULL<span class="operator">;</span>

  opiConnectedPart<span class="operator"> =</span> NULL<span class="operator">;</span>
  HRESULT rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;</span><span class="comment">

  // Interface pointer variables used below in the try section.
</span>  IUnknown<span class="operator"> *</span>piCtrUnk<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIPspConnection<span class="operator"> *</span>piPspConnection<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIPspConnector<span class="operator"> *</span>piPspConnector<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIUnknownList<span class="operator"> *</span>piListConnections<span class="operator">  =</span> NULL<span class="operator">;</span>

  IUnknown<span class="operator"> *</span>piUnk<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIUnknownList<span class="operator"> *</span>piListCtr<span class="operator">  =</span> NULL<span class="operator">;</span>

  CATIPspConnector<span class="operator"> *</span>piPspConnectedCtr<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIPspConnectable<span class="operator"> *</span>piPspConnectedPart<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATTry<span class="operator"> 
  {</span>
    rc<span class="operator"> =</span> GetPartConnector<span class="operator">(</span>ipiPartUnk<span class="operator">,</span> 
                          iConnectorNumber<span class="operator">,</span> 
                          piCtrUnk<span class="operator">);</span><span class="flow">

    if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> piCtrUnk<span class="operator">)
    {</span><span class="comment">
      // Get connected objects.
</span><span class="flow">      if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>piCtrUnk<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIPspConnector<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piPspConnector<span class="operator">)))
      {</span><span class="flow">

        if</span><span class="operator"> (</span> SUCCEEDED<span class="operator">(</span>piPspConnector<span class="operator">-&gt;</span>ListConnections<span class="operator"> (</span>NULL<span class="operator">, &amp;</span>piListConnections<span class="operator">)) &amp;&amp;</span>

             piListConnections<span class="operator"> )          
        {</span>
          cout<span class="operator"> &lt;&lt;</span><span class="string"> "piListConnections = "</span><span class="operator"> &lt;&lt;</span> piListConnections<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">

          // Get a connection 
</span><span class="type">          unsigned int</span> numCnx<span class="operator"> =</span><span class="int"> 0</span><span class="operator">;</span>
          piListConnections<span class="operator">-&gt;</span>Count<span class="operator">(&amp;</span>numCnx<span class="operator">);</span><span class="flow">

          for</span><span class="operator"> (</span><span class="type"> unsigned int</span> iiCnx<span class="operator"> =</span><span class="int"> 0</span><span class="operator">;</span> iiCnx<span class="operator"> &lt;</span> numCnx<span class="operator">;</span> iiCnx<span class="operator">++ )
          {</span><span class="flow">

            if</span><span class="operator"> (</span> SUCCEEDED<span class="operator">(</span>piListConnections<span class="operator">-&gt;</span>Item<span class="operator">(</span>iiCnx<span class="operator">,&amp;</span>piUnk<span class="operator">)) &amp;&amp; (</span>NULL<span class="operator"> !=</span> piUnk<span class="operator">) )
            {</span>

              piUnk<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIPspConnection<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piPspConnection<span class="operator">);</span>
              cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPspConnection = "</span><span class="operator"> &lt;&lt;</span> piPspConnection<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

              if</span><span class="operator"> (</span>piUnk<span class="operator">) {</span>piUnk<span class="operator">-&gt;</span>Release<span class="operator">();</span> piUnk<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">

              if</span><span class="operator"> (</span>piPspConnection<span class="operator"> &amp;&amp;</span> 
                  SUCCEEDED<span class="operator">(</span>piPspConnector<span class="operator">-&gt;</span>ListConnectedCntrs<span class="operator"> (</span>piPspConnection<span class="operator">, &amp;</span>piListCtr<span class="operator">)) &amp;&amp;</span>

                  piListCtr<span class="operator"> )          
              {</span><span class="type">
                unsigned int</span> numCtr<span class="operator"> =</span><span class="int"> 0</span><span class="operator">;</span>
                piListCtr<span class="operator">-&gt;</span>Count<span class="operator">(&amp;</span>numCtr<span class="operator">);</span><span class="flow">

                for</span><span class="operator"> (</span><span class="type"> unsigned int</span> iiCtr<span class="operator"> =</span><span class="int"> 0</span><span class="operator">;</span> iiCtr<span class="operator"> &lt;</span> numCtr<span class="operator">;</span> iiCtr<span class="operator">++ )
                {</span><span class="flow">

                  if</span><span class="operator"> (</span> SUCCEEDED<span class="operator">(</span>piListCtr<span class="operator">-&gt;</span>Item<span class="operator">(</span>iiCtr<span class="operator">,&amp;</span>piUnk<span class="operator">)) &amp;&amp; (</span>NULL<span class="operator"> !=</span> piUnk<span class="operator">) )
                  {</span>

                    piUnk<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIPspConnector<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piPspConnectedCtr<span class="operator">);</span>
                    cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPspConnectedCtr = "</span><span class="operator"> &lt;&lt;</span> piPspConnectedCtr<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

                    if</span><span class="operator"> (</span>piUnk<span class="operator">) {</span>piUnk<span class="operator">-&gt;</span>Release<span class="operator">();</span> piUnk<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">

                    if</span><span class="operator"> (</span>piPspConnectedCtr<span class="operator">)
                    {</span>
                      piPspConnectedCtr<span class="operator">-&gt;</span>GetAssociatedConnectable<span class="operator">(&amp;</span>piPspConnectedPart<span class="operator">);</span>
                      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPspConnectedPart = "</span><span class="operator"> &lt;&lt;</span> piPspConnectedPart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

                      if</span><span class="operator"> (</span>piPspConnectedPart<span class="operator">)
                      {</span>
                        piPspConnectedCtr<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_IUnknown<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>opiConnectedCtr<span class="operator">);</span>

                        piPspConnectedPart<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_IUnknown<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>opiConnectedPart<span class="operator">);</span><span class="flow">
                        break</span><span class="operator">;
                      }</span><span class="flow">
                      if</span><span class="operator"> (</span>piPspConnectedCtr<span class="operator">) {</span>piPspConnectedCtr<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPspConnectedCtr<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
                      if</span><span class="operator"> (</span>piPspConnectedPart<span class="operator">) {</span>piPspConnectedPart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPspConnectedPart<span class="operator"> =</span> NULL<span class="operator">;}
                    }
                  }</span><span class="comment"> // End if valid ctr list item.

</span><span class="operator">                }</span><span class="comment"> // End loop on connected ctrs.
</span><span class="flow">                if</span><span class="operator"> (</span>piListCtr<span class="operator">) {</span>piListCtr<span class="operator">-&gt;</span>Release<span class="operator">();</span> piListCtr<span class="operator"> =</span> NULL<span class="operator">;}
              }</span><span class="comment"> // End if valid list of ctrs.

</span><span class="flow">              if</span><span class="operator"> (</span>piPspConnection<span class="operator">) {</span>piPspConnection<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPspConnection<span class="operator"> =</span> NULL<span class="operator">;}
            }</span><span class="comment"> // End if valid cnx list item.

</span><span class="operator">          }</span><span class="comment"> // End loop on connections.
</span><span class="flow">          if</span><span class="operator"> (</span>piListConnections<span class="operator">) {</span>piListConnections<span class="operator">-&gt;</span>Release<span class="operator">();</span> piListConnections<span class="operator"> =</span> NULL<span class="operator">;}
        }</span><span class="comment"> // End if valid list of connections.

</span><span class="operator">      }</span><span class="comment"> // End if valid psp ctr
</span><span class="flow">      if</span><span class="operator"> (</span>piCtrUnk<span class="operator">) {</span>piCtrUnk<span class="operator">-&gt;</span>Release<span class="operator">();</span> piCtrUnk<span class="operator"> =</span> NULL<span class="operator">;}
    }</span><span class="comment"> // End if valid ctr.

</span><span class="operator">  }</span><span class="comment"> // end CATTry
</span>
	CATCatch<span class="operator"> (</span>CATError<span class="operator">,</span> pError<span class="operator">)
	{</span>
    cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::GetConnectedPart *** Error Caught ***"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

    cout<span class="operator"> &lt;&lt;</span> pError<span class="operator">;</span>

    rc<span class="operator"> =</span> CATReturnError<span class="operator">(</span>pError<span class="operator">);
	}</span><span class="comment"> // end CATCatch

</span>
  CATEndTry<span class="operator">;</span><span class="flow">

  if</span><span class="operator"> (</span>piCtrUnk<span class="operator">) {</span>piCtrUnk<span class="operator">-&gt;</span>Release<span class="operator">();</span> piCtrUnk<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPspConnection<span class="operator">) {</span>piPspConnection<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPspConnection<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPspConnector<span class="operator">) {</span>piPspConnector<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPspConnector<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piListConnections<span class="operator">) {</span>piListConnections<span class="operator">-&gt;</span>Release<span class="operator">();</span> piListConnections<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piUnk<span class="operator">) {</span>piUnk<span class="operator">-&gt;</span>Release<span class="operator">();</span> piUnk<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piListCtr<span class="operator">) {</span>piListCtr<span class="operator">-&gt;</span>Release<span class="operator">();</span> piListCtr<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPspConnectedCtr<span class="operator">) {</span>piPspConnectedCtr<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPspConnectedCtr<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPspConnectedPart<span class="operator">) {</span>piPspConnectedPart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPspConnectedPart<span class="operator"> =</span> NULL<span class="operator">;}</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">" opiConnectedCtr = "</span><span class="operator"> &lt;&lt;</span> opiConnectedCtr<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">" opiConnectedPart = "</span><span class="operator"> &lt;&lt;</span> opiConnectedPart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

  if</span><span class="operator"> (</span>opiConnectedCtr<span class="operator"> &amp;&amp;</span> opiConnectedCtr<span class="operator">)</span>
    rc<span class="operator"> =</span> CATReturnSuccess<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::GetConnectedPart rc = "</span><span class="operator"> &lt;&lt;</span> rc<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">
  return</span> rc<span class="operator">;
}</span><span class="pre">

#define PointTolerance  0.01 // mm
</span><span class="type">int</span> ArePointsEqual<span class="operator">(</span><span class="keyword">const</span> CATMathPoint<span class="operator"> &amp;</span>iPoint0<span class="operator">,</span><span class="keyword"> 
                   const</span> CATMathPoint<span class="operator"> &amp;</span>iPoint1<span class="operator">)
{</span><span class="flow">

  return</span><span class="operator"> (</span>iPoint0<span class="operator">.</span>DistanceTo<span class="operator">(</span>iPoint1<span class="operator">) &lt;=</span> PointTolerance<span class="operator">);
}</span><span class="type">

int</span> AreVectorsEqual<span class="operator">(</span><span class="keyword">const</span> CATMathVector<span class="operator"> &amp;</span>iVector0<span class="operator">,</span><span class="keyword"> 
                    const</span> CATMathVector<span class="operator"> &amp;</span>iVector1<span class="operator">)
{</span><span class="flow">

  return</span> ArePointsEqual<span class="operator">(</span>CATMathO<span class="operator">+</span>iVector0<span class="operator">,</span> CATMathO<span class="operator">+</span>iVector1<span class="operator">);
}</span><span class="comment">

//=============================================================================
//  Test location data for a part connector.
//=============================================================================

</span>HRESULT CAACloPlacePart<span class="operator">::</span>TestPartConnectorData<span class="operator">(</span><span class="keyword">const</span> IUnknown<span class="operator"> *</span>ipiPartUnk<span class="operator">,</span><span class="keyword"> 
                                               const</span><span class="type"> int</span><span class="operator"> &amp;</span>iConnectorNumber<span class="operator">,</span> 
                                               IUnknown<span class="operator"> *</span>ipiRelAxisUnk<span class="operator">,</span><span class="keyword"> 
                                               const</span> CATMathPoint<span class="operator"> &amp;</span>iCtrPosition<span class="operator">,</span><span class="keyword"> 
                                               const</span> CATMathDirection<span class="operator"> &amp;</span>iCtrAlign<span class="operator">,</span><span class="keyword"> 
                                               const</span> CATMathDirection<span class="operator"> &amp;</span>iCtrUp<span class="operator">)
{</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"===    CAACloPlacePart::TestPartConnectorData            ==="</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">" Part: "</span><span class="operator"> &lt;&lt;</span> ipiPartUnk<span class="operator"> &lt;&lt;</span><span class="string"> ": "</span><span class="operator"> &lt;&lt;</span> GetObjectName<span class="operator">(</span>ipiPartUnk<span class="operator">) &lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">" Connector number "</span><span class="operator"> &lt;&lt;</span> iConnectorNumber<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string"> "iCtrPosition = "</span><span class="operator"> &lt;&lt;</span> iCtrPosition<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string"> "iCtrAlign = "</span><span class="operator"> &lt;&lt;</span> iCtrAlign<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string"> "iCtrUp = "</span><span class="operator"> &lt;&lt;</span> iCtrUp<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

  HRESULT rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;</span><span class="comment">

  // Interface pointer variables used below in the try section.
</span>  CATIMovable<span class="operator"> *</span>piRelAxis<span class="operator"> =</span> NULL<span class="operator">;</span>

  IUnknown<span class="operator"> *</span>piCtrUnk<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIPspPartConnector<span class="operator"> *</span>piPartCntr<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATMathPoint ctrPosition<span class="operator">;</span>
  CATMathDirection ctrAlign<span class="operator">;</span>
  CATMathDirection ctrUp<span class="operator">;</span>

  CATTry<span class="operator"> 
  {</span><span class="flow">

    if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>GetPartConnectorData<span class="operator">(</span>ipiPartUnk<span class="operator">,</span> 
                                       iConnectorNumber<span class="operator">,</span> 
                                       ipiRelAxisUnk<span class="operator">,</span> 
                                       ctrPosition<span class="operator">,</span> 
                                       ctrAlign<span class="operator">,</span> 
                                       ctrUp<span class="operator">)))
    {</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "ctrPosition = "</span><span class="operator"> &lt;&lt;</span> ctrPosition<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
      cout<span class="operator"> &lt;&lt;</span><span class="string"> "ctrAlign = "</span><span class="operator"> &lt;&lt;</span> ctrAlign<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "ctrUp = "</span><span class="operator"> &lt;&lt;</span> ctrUp<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

      if</span><span class="operator"> (</span>ArePointsEqual<span class="operator">(</span>ctrPosition<span class="operator">,</span> iCtrPosition<span class="operator">) &amp;&amp;</span> 
          AreVectorsEqual<span class="operator">(</span>ctrAlign<span class="operator">,</span> iCtrAlign<span class="operator">) &amp;&amp;</span> 
          AreVectorsEqual<span class="operator">(</span>ctrUp<span class="operator">,</span> ctrUp<span class="operator">))
      {</span>

        rc<span class="operator"> =</span> CATReturnSuccess<span class="operator">;
      }
  
    }</span><span class="comment"> // End if get valid part ctr data succeeded.
</span><span class="operator">  }</span><span class="comment"> // end CATTry
</span>
	CATCatch<span class="operator"> (</span>CATError<span class="operator">,</span> pError<span class="operator">)
	{</span>

    cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::TestPartConnectorData *** Error Caught ***"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
    cout<span class="operator"> &lt;&lt;</span> pError<span class="operator">;</span>

    rc<span class="operator"> =</span> CATReturnError<span class="operator">(</span>pError<span class="operator">);
	}</span><span class="comment"> // end CATCatch
</span>
  CATEndTry<span class="operator">;</span><span class="flow">

  if</span><span class="operator"> (</span>piRelAxis<span class="operator">) {</span>piRelAxis<span class="operator">-&gt;</span>Release<span class="operator">();</span> piRelAxis<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piCtrUnk<span class="operator">) {</span>piCtrUnk<span class="operator">-&gt;</span>Release<span class="operator">();</span> piCtrUnk<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPartCntr<span class="operator">) {</span>piPartCntr<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPartCntr<span class="operator"> =</span> NULL<span class="operator">;}</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::TestPartConnectorData rc = "</span><span class="operator"> &lt;&lt;</span> rc<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">
  return</span> rc<span class="operator">;
}</span><span class="type">

int</span> AreObjectsEqual<span class="operator">(</span><span class="keyword">const</span> IUnknown<span class="operator"> *</span>ipiObject0<span class="operator">,</span><span class="keyword"> 
                    const</span> IUnknown<span class="operator"> *</span>ipiObject1<span class="operator">)
{</span><span class="type">

  int</span> rc<span class="operator"> =</span><span class="int"> 0</span><span class="operator">;</span>

  IUnknown<span class="operator"> *</span>piObjectUnk0<span class="operator"> =</span> NULL<span class="operator">;</span>

  IUnknown<span class="operator"> *</span>piObjectUnk1<span class="operator"> =</span> NULL<span class="operator">;</span><span class="flow">

  if</span><span class="operator"> (</span>ipiObject0<span class="operator"> ==</span> ipiObject1<span class="operator">)
  {</span>

    rc<span class="operator"> =</span><span class="int"> 1</span><span class="operator">;
  }</span><span class="flow">
  else if</span><span class="operator"> (!</span>ipiObject0<span class="operator"> || !</span>ipiObject1<span class="operator">)
  {</span>

    rc<span class="operator"> =</span><span class="int"> 0</span><span class="operator">;
  }</span><span class="flow">
  else if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(((</span>IUnknown<span class="operator">*)</span>ipiObject0<span class="operator">)-&gt;</span>QueryInterface<span class="operator">(</span>IID_IUnknown<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piObjectUnk0<span class="operator">)) &amp;&amp;</span> 
           SUCCEEDED<span class="operator">(((</span>IUnknown<span class="operator">*)</span>ipiObject1<span class="operator">)-&gt;</span>QueryInterface<span class="operator">(</span>IID_IUnknown<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piObjectUnk1<span class="operator">)) &amp;&amp;</span> 
           piObjectUnk0<span class="operator"> ==</span> piObjectUnk1<span class="operator">)
  {</span>

    rc<span class="operator"> =</span><span class="int"> 1</span><span class="operator">;
  }</span><span class="flow">

  if</span><span class="operator"> (</span>piObjectUnk0<span class="operator">) {</span>piObjectUnk0<span class="operator">-&gt;</span>Release<span class="operator">();</span> piObjectUnk0<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piObjectUnk1<span class="operator">) {</span>piObjectUnk1<span class="operator">-&gt;</span>Release<span class="operator">();</span> piObjectUnk1<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">

  return</span> rc<span class="operator">;
}</span><span class="comment">

//=============================================================================
//  Test part connected to a part ctr.
//=============================================================================
</span>HRESULT CAACloPlacePart<span class="operator">::</span>TestConnectedPart<span class="operator">(</span><span class="keyword">const</span> IUnknown<span class="operator"> *</span>ipiPartUnk<span class="operator">,</span><span class="keyword"> 
                                           const</span><span class="type"> int</span><span class="operator"> &amp;</span>iConnectorNumber<span class="operator">,</span><span class="keyword"> 
                                           const</span> IUnknown<span class="operator"> *</span>ipiConnectedPart<span class="operator">,</span><span class="keyword"> 
                                           const</span><span class="type"> int</span><span class="operator"> &amp;</span>iConnectedConnectorNumber<span class="operator">)
{</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"===    CAACloPlacePart::TestConnectedPart                ==="</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">" Part: "</span><span class="operator"> &lt;&lt;</span> ipiPartUnk<span class="operator"> &lt;&lt;</span><span class="string"> ": "</span><span class="operator"> &lt;&lt;</span> GetObjectName<span class="operator">(</span>ipiPartUnk<span class="operator">) &lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">" Connector number "</span><span class="operator"> &lt;&lt;</span> iConnectorNumber<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">" ipiConnectedPart = "</span><span class="operator"> &lt;&lt;</span> ipiConnectedPart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">" iConnectedConnectorNumber = "</span><span class="operator"> &lt;&lt;</span> iConnectedConnectorNumber<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

  HRESULT rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;</span><span class="comment">

  // Interface pointer variables used below in the try section.
</span>  IUnknown<span class="operator"> *</span>piConnectedCtr<span class="operator"> =</span> NULL<span class="operator">;</span>
  IUnknown<span class="operator"> *</span>piConnectedPart<span class="operator"> =</span> NULL<span class="operator">;</span>

  IUnknown<span class="operator"> *</span>piConnectedCtrExpected<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATTry<span class="operator"> 
  {</span><span class="flow">

    if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>GetConnectedPart<span class="operator">(</span>ipiPartUnk<span class="operator">,</span> 
                                   iConnectorNumber<span class="operator">,</span> 
                                   piConnectedCtr<span class="operator">,</span> 
                                   piConnectedPart<span class="operator">)) &amp;&amp;</span> 
        piConnectedCtr<span class="operator"> &amp;&amp;</span> 
        piConnectedPart<span class="operator"> &amp;&amp;</span> 
        AreObjectsEqual<span class="operator">(</span>piConnectedPart<span class="operator">,</span> ipiConnectedPart<span class="operator">))
    {</span> 
      cout<span class="operator"> &lt;&lt;</span><span class="string">" piConnectedCtr = "</span><span class="operator"> &lt;&lt;</span> piConnectedCtr<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

      if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>GetPartConnector<span class="operator">(</span>ipiConnectedPart<span class="operator">,</span> 
                                     iConnectedConnectorNumber<span class="operator">,</span> 
                                     piConnectedCtrExpected<span class="operator">)) &amp;&amp;</span> 
          piConnectedCtrExpected<span class="operator">)
      {</span>

        cout<span class="operator"> &lt;&lt;</span><span class="string">" piConnectedCtrExpected = "</span><span class="operator"> &lt;&lt;</span> piConnectedCtrExpected<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">
        if</span><span class="operator"> (</span>AreObjectsEqual<span class="operator">(</span>piConnectedCtr<span class="operator">,</span> piConnectedCtrExpected<span class="operator">))</span>

          rc<span class="operator"> =</span> CATReturnSuccess<span class="operator">;
      }
    }</span><span class="comment"> // End if valid ctr.
</span><span class="operator">  }</span><span class="comment"> // end CATTry
</span>
	CATCatch<span class="operator"> (</span>CATError<span class="operator">,</span> pError<span class="operator">)
	{</span>

    cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::TestConnectedPart *** Error Caught ***"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
    cout<span class="operator"> &lt;&lt;</span> pError<span class="operator">;</span>

    rc<span class="operator"> =</span> CATReturnError<span class="operator">(</span>pError<span class="operator">);
	}</span><span class="comment"> // end CATCatch
</span>
  CATEndTry<span class="operator">;</span><span class="flow">

  if</span><span class="operator"> (</span>piConnectedCtr<span class="operator">) {</span>piConnectedCtr<span class="operator">-&gt;</span>Release<span class="operator">();</span> piConnectedCtr<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piConnectedPart<span class="operator">) {</span>piConnectedPart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piConnectedPart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piConnectedCtrExpected<span class="operator">) {</span>piConnectedCtrExpected<span class="operator">-&gt;</span>Release<span class="operator">();</span> piConnectedCtrExpected<span class="operator"> =</span> NULL<span class="operator">;}</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::TestConnectedPart rc = "</span><span class="operator"> &lt;&lt;</span> rc<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">
  return</span> rc<span class="operator">;
}</span>
</pre>
</div>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Parts in Space"></a>Parts in Space</h4>
<p>
  CAACloPlacePart places a valve and a tube in space.
  The valve is placed by the method PlacePartInSpace.
  PlacePartInSpace first performs setup necessary for placing any part.
  It gets a tubing application object and derives a CATIPspPlacePartOnRun interface object from the application object.
  It calls GetChildObject to find the tubing work package (TubingWP.1) which is a child of the data model's root product.
  It finds the tubing line in TubingWP.1 using the method GetALogicalLine.
  Both GetChildObject and GetALogicalLine are part of CAAPspBaseEnvProtected.
</p>
<p>
  After accomplishing it's setup duties PlacePartInSpace begins it's major work of placing a valve.
  The first step is to find the correct valve in the catalog.
  The CATIPspPlacePartOnRun method GetReferencePartFromCatalog is used to find a reference part in the catalog.
  GetReferencePartFromCatalog takes standard as an input to help decode attribute values.
  It also can accept a specification ("spec").
  In the sample the spec is set to null so no specification is used.
  If spec is set the catalog search will be limited to parts that meet the given specification.
  Part type and part number are the key arguments that define the part which is being looked for.
  The parent product is also sent to GetReferencePartFromCatalog.
  This helps GetReferencePartFromCatalog decode various names more efficiently.
  The found reference product is returned in the argument, piReferencePart.
  And the corresponding catalog part name is returned in the last argument, uCatalogPartName.
</p>
<p>
  The second part placement step is to position and properly connect an instance product in the data model.
  This is accomplished using PlacePartInSpace.
  PlacePartInSpace accepts the same standard for input as was used for GetReferencePartFromCatalog.
  It accepts a function type which tracks the purpose of the instance part.
  The reference part is sent to PlacePartInSpace to define the part being placed.
  The logical line defines the tubing line into which the new part will become a member.
  The new part ID can be specified.
  In the sample code the ID is null which instructs the part placement engine to generate the part ID according to it's preset rules.
  Up direction, horizontal orientation and position all define how the new part is positioned.
  The new instance part is returned in piInstancePart.
</p>
<p>
  Catalog part name returned by GetReferencePartFromCatalog needs to be set on the new part. 
  Once the new part is placed the PlacePartInSpace tests part connector data to ensure that the part is positioned correctly.
  Connector data is tested using the TestPartConnectorData method.
</p>
<p>
  The code for PlacePartInSpace is shown below.
</p>
<div class="code">
<pre><span class="comment">//=============================================================================
//  Place parts in space.
//=============================================================================
</span>HRESULT CAACloPlacePart<span class="operator">::</span>PlacePartInSpace<span class="operator">()
{</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"===       CAACloPlacePart::PlacePartInSpace              ==="</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

  HRESULT rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;</span><span class="comment">

  // Interface pointer variables used below in the try section.
</span>  CATObject<span class="operator"> *</span>piAppObject<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIPspPlacePartOnRun<span class="operator"> *</span>piPlacePart<span class="operator"> =</span> NULL<span class="operator">;</span>

  IUnknown<span class="operator"> *</span>piReferencePart<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIProduct<span class="operator"> *</span>piParentProduct<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIPspLogicalLine<span class="operator"> *</span>piLogicalLine<span class="operator"> =</span> NULL<span class="operator">;</span>
  IUnknown<span class="operator"> *</span>piInstancePart<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATUnicodeString uCatalogPartName<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span>

  CATUnicodeString uPlacePartErrorMessage<span class="operator">;</span>
  CATUnicodeString uStandard<span class="operator"> =</span><span class="string"> "SSTL"</span><span class="operator">;</span>
  CATUnicodeString uSpecName<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span>

  CATUnicodeString uPartType<span class="operator">;</span>
  CATUnicodeString uPartNumber<span class="operator">;</span>
  CATUnicodeString uFunctionType<span class="operator">;</span>
  CATUnicodeString uPlacedPartID<span class="operator">;</span>
  CATMathDirection upDirection<span class="operator">;</span>

  CATMathDirection horizontalOrientation<span class="operator">;</span>
  CATMathPoint position<span class="operator">;</span>

  CATMathPoint ctrPosition<span class="operator">;</span>
  CATMathDirection ctrAlign<span class="operator">;</span>

  CATMathDirection ctrUp<span class="operator">;</span>

  CATTry<span class="operator"> 
  {</span><span class="comment">
    // Get application object.
</span>    piAppObject<span class="operator"> =</span><span class="keyword"> new</span> CATObject<span class="operator">(</span><span class="string">"CATTubing"</span><span class="operator">);</span>

    cout<span class="operator"> &lt;&lt;</span><span class="string"> "piAppObject = "</span><span class="operator"> &lt;&lt;</span> piAppObject<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

    if</span><span class="operator"> (</span>piAppObject<span class="operator"> &amp;&amp;</span> 
        SUCCEEDED<span class="operator">(</span>piAppObject<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIPspPlacePartOnRun<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piPlacePart<span class="operator">)))
    {</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPlacePart = "</span><span class="operator"> &lt;&lt;</span> piPlacePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

      piParentProduct<span class="operator"> = (</span>CATIProduct<span class="operator">*)</span>GetChildObject<span class="operator">(</span>IID_CATIProduct<span class="operator">,</span><span class="string"> "TubingWP.1"</span><span class="operator">);</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piParentProduct = "</span><span class="operator"> &lt;&lt;</span> piParentProduct<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

      piLogicalLine<span class="operator"> =</span> GetALogicalLine<span class="operator">(</span>piParentProduct<span class="operator">);</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piLogicalLine = "</span><span class="operator"> &lt;&lt;</span> piLogicalLine<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">

      // Get reference part
      //uPartType = "CATTubControlValve";</span>
      uPartType<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span><span class="comment"> // Null string option used to search entire catalog.</span>
      cout<span class="operator"> &lt;&lt;</span><span class="string"> "Part type null"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

      uPartNumber<span class="operator"> =</span><span class="string"> "V_BALL-TF-16S"</span><span class="operator">;</span>
      rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>GetReferencePartFromCatalog<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                     uSpecName<span class="operator">,</span> 
                                                     uPartType<span class="operator">,</span> 
                                                     uPartNumber<span class="operator">,</span> 
                                                     piParentProduct<span class="operator">,</span> 
                                                     piReferencePart<span class="style1">,</span>
                                                     uCatalogPartName<span class="style1">);</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piReferencePart = "</span><span class="operator"> &lt;&lt;</span> piReferencePart<span class="operator"> &lt;&lt;</span><span class="string"> "uCatalogPartName = "</span><span class="operator"> &lt;&lt;</span> uCatalogPartName<span class="operator">.</span>ConvertToChar<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

      if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> 
          piReferencePart<span class="operator">)
      {</span><span class="comment">

        // Place part in space.
</span>        uFunctionType<span class="operator"> =</span><span class="string"> "CATTubControlValveFunction"</span><span class="operator">;</span>
        uPlacedPartID<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span><span class="comment"> // Null string uses name generated by PP engine

</span>        upDirection<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int"> 0</span><span class="operator">,</span><span class="int"> 1</span><span class="operator">);</span><span class="comment"> // Part up direction parallel to z-axis.
</span>        horizontalOrientation<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span><span class="comment"> // Align part parallel to y-axis.

</span>        position<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1000</span><span class="operator">,</span><span class="int">2000</span><span class="operator">,</span><span class="int">4000</span><span class="operator">);</span><span class="comment"> // Position part at (1000, 2000, 4000) in mm.
</span>        rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>PlacePartInSpace<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                            uFunctionType<span class="operator">,</span> 
                                            piReferencePart<span class="operator">,</span> 
                                            piParentProduct<span class="operator">,</span> 
                                            piLogicalLine<span class="operator">,</span> 
                                            uPlacedPartID<span class="operator">,</span> 
                                            upDirection<span class="operator">,</span> 
                                            horizontalOrientation<span class="operator">,</span> 
                                            position<span class="operator">,</span> 
                                            piInstancePart<span class="operator">);</span>

        cout<span class="operator"> &lt;&lt;</span><span class="string"> "piInstancePart = "</span><span class="operator"> &lt;&lt;</span> piInstancePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

        if</span><span class="operator"> (</span>piInstancePart<span class="operator">)
        {</span>
        <span class="comment">  // Set catalog part name</span>
          piPlacePart<span class="operator">-&gt;</span>SetCatalogPartName<span class="operator">(</span>piInstancePart<span class="operator">,</span>uCatalogPartName<span class="operator">);</span>
        <span class="comment">
          // Test part connectors.
</span>          ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="float">1014.61</span><span class="operator">,</span><span class="int">2000</span><span class="operator">,</span><span class="int">4000</span><span class="operator">);</span>
          ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

          ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>
          rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                     1</span><span class="operator">,</span> 
                                     piParentProduct<span class="operator">,</span> 
                                     ctrPosition<span class="operator">,</span> 
                                     ctrAlign<span class="operator">,</span> 
                                     ctrUp<span class="operator">);</span><span class="flow">

          if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
          {</span>
            ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="float">985.395</span><span class="operator">,</span><span class="int">2000</span><span class="operator">,</span><span class="int">4000</span><span class="operator">);</span>

            ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
            ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>

            rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                       2</span><span class="operator">,</span> 
                                       piParentProduct<span class="operator">,</span> 
                                       ctrPosition<span class="operator">,</span> 
                                       ctrAlign<span class="operator">,</span> 
                                       ctrUp<span class="operator">);
          }
        }</span><span class="flow">

        else</span><span class="operator">
        {</span>
          rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;
        }
      }
<span class="flow">      if</span><span class="operator"> (</span>FAILED<span class="operator">(</span>rc<span class="operator">))
      {</span>

        piPlacePart<span class="operator">-&gt;</span>GetErrorMessage<span class="operator">(</span>uPlacePartErrorMessage<span class="operator">);</span>
        cout<span class="operator"> &lt;&lt;</span><span class="string"> "uPlacePartErrorMessage = "</span><span class="operator"> &lt;&lt;</span> uPlacePartErrorMessage<span class="operator"> &lt;&lt;</span> endl<span class="operator">;
      }</span>
    }</span><span class="comment"> // End if valid place part object.
</span><span class="operator">  }</span><span class="comment"> // end CATTry

</span>
	CATCatch<span class="operator"> (</span>CATError<span class="operator">,</span> pError<span class="operator">)
	{</span>
    cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::PlacePartInSpace *** Error Caught ***"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

    cout<span class="operator"> &lt;&lt;</span> pError<span class="operator">;</span>

    rc<span class="operator"> =</span> CATReturnError<span class="operator">(</span>pError<span class="operator">);
	}</span><span class="comment"> // end CATCatch

</span>
  CATEndTry<span class="operator">;</span><span class="flow">

  if</span><span class="operator"> (</span>piAppObject<span class="operator">) {</span>piAppObject<span class="operator">-&gt;</span>Release<span class="operator">();</span> piAppObject<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPlacePart<span class="operator">) {</span>piPlacePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPlacePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piReferencePart<span class="operator">) {</span>piReferencePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piReferencePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piParentProduct<span class="operator">) {</span>piParentProduct<span class="operator">-&gt;</span>Release<span class="operator">();</span> piParentProduct<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piLogicalLine<span class="operator">) {</span>piLogicalLine<span class="operator">-&gt;</span>Release<span class="operator">();</span> piLogicalLine<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piInstancePart<span class="operator">) {</span>piInstancePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePart<span class="operator"> =</span> NULL<span class="operator">;}</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::PlacePartInSpace rc = "</span><span class="operator"> &lt;&lt;</span> rc<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">
  return</span> rc<span class="operator">;
}</span>
</pre>
</div>
<p>
  After CAACloPlacePart places a valve in space it places a tube in space.
  The tube is placed by the method RouteStringPartInSpace.
  RouteStringPartInSpace is very similar to PlacePartInSpace.
  A minor difference is that RouteStringPartInSpace finds a tube in the catalog instead of a valve.
  Another relatively minor difference is that RouteStringPartInSpace sets an ID for the new part using the uPlacedPartID argument.
  The major difference is that RouteStringPartInSpace must define the tube node points and bend radii.
  The bend radii are defined with a list of double values that are interpretted as millimeter lengths.
  The tube node points are defined by creating a part and creating points in the new part.
  Connector data is tested using the TestPartConnectorData method.
</p>
<p>
  The code for RouteStringPartInSpace is shown below.
</p>
<div class="code">
<pre><span class="comment">//=============================================================================
//  Place string parts in space.
//=============================================================================
</span>HRESULT CAACloPlacePart<span class="operator">::</span>RouteStringPartInSpace<span class="operator">()
{</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"===       CAACloPlacePart::RouteStringPartInSpace        ==="</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

  HRESULT rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;</span><span class="comment">

  // Interface pointer variables used below in the try section.
</span>  CATObject<span class="operator"> *</span>piAppObject<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIPspPlacePartOnRun<span class="operator"> *</span>piPlacePart<span class="operator"> =</span> NULL<span class="operator">;</span>

  IUnknown<span class="operator"> *</span>piReferencePart<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIProduct<span class="operator"> *</span>piParentProduct<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIPspLogicalLine<span class="operator"> *</span>piLogicalLine<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIUnknownList<span class="operator"> *</span>piListPoints<span class="operator"> =</span> NULL<span class="operator">;</span>

  IUnknown<span class="operator"> *</span>piInstancePart<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIAProducts<span class="operator"> *</span>piParentProducts<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIAProduct<span class="operator"> *</span>piPartForPointsProduct<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATBaseDispatch<span class="operator"> *</span>piPartForPointsShape<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIAPartDocument<span class="operator"> *</span>piPartForPointsDoc<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIAPart<span class="operator"> *</span>piPartForPoints<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIAFactory<span class="operator"> *</span>piShapeFactory<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIAHybridShapeFactory<span class="operator"> *</span>piHybridShapeFactory<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIAHybridShapePointCoord<span class="operator"> *</span>piPoint<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIUnknownListImpl<span class="operator"> *</span>piListImpl<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATUnicodeString uCatalogPartName<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span>

  CATUnicodeString uPlacePartErrorMessage<span class="operator">;</span>
  CATUnicodeString uStandard<span class="operator"> =</span><span class="string"> "SSTL"</span><span class="operator">;</span>
  CATUnicodeString uSpecName<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span>

  CATUnicodeString uPartType<span class="operator">;</span>
  CATUnicodeString uPartNumber<span class="operator">;</span>
  CATUnicodeString uDocumentType<span class="operator">;</span>
  CATBSTR documentTypeBSTR<span class="operator">;</span>
  CATBSTR partNumberBSTR<span class="operator">;</span>

  CATUnicodeString uFunctionType<span class="operator">;</span>
  CATUnicodeString uPlacedPartID<span class="operator">;</span>
  CATMathDirection firstPointUpDirection<span class="operator">;</span>
  CATListOfDouble listBendRadii<span class="operator">;</span>
  CATMathPoint ctrPosition<span class="operator">;</span>

  CATMathDirection ctrAlign<span class="operator">;</span>
  CATMathDirection ctrUp<span class="operator">;</span>

  CATTry<span class="operator"> 
  {</span><span class="comment">
    // Get application object.
</span>    piAppObject<span class="operator"> =</span><span class="keyword"> new</span> CATObject<span class="operator">(</span><span class="string">"CATTubing"</span><span class="operator">);</span>

    cout<span class="operator"> &lt;&lt;</span><span class="string"> "piAppObject = "</span><span class="operator"> &lt;&lt;</span> piAppObject<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

    if</span><span class="operator"> (</span>piAppObject<span class="operator"> &amp;&amp;</span> 
        SUCCEEDED<span class="operator">(</span>piAppObject<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIPspPlacePartOnRun<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piPlacePart<span class="operator">)))
    {</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPlacePart = "</span><span class="operator"> &lt;&lt;</span> piPlacePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

      piParentProduct<span class="operator"> = (</span>CATIProduct<span class="operator">*)</span>GetChildObject<span class="operator">(</span>IID_CATIProduct<span class="operator">,</span><span class="string"> "TubingWP.1"</span><span class="operator">);</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piParentProduct = "</span><span class="operator"> &lt;&lt;</span> piParentProduct<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

      piLogicalLine<span class="operator"> =</span> GetALogicalLine<span class="operator">(</span>piParentProduct<span class="operator">);</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piLogicalLine = "</span><span class="operator"> &lt;&lt;</span> piLogicalLine<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">

      // Get reference part
</span>      uPartType<span class="operator"> =</span><span class="string"> "CATTubBendableTube"</span><span class="operator">;</span>

      uPartNumber<span class="operator"> =</span><span class="string"> "TUBE-BENDABLE-TIV-16S"</span><span class="operator">;</span>
      rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>GetReferencePartFromCatalog<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                     uSpecName<span class="operator">,</span> 
                                                     uPartType<span class="operator">,</span> 
                                                     uPartNumber<span class="operator">,</span> 
                                                     piParentProduct<span class="operator">,</span> 
                                                     piReferencePart<span class="style1">,</span>
                                                     uCatalogPartName<span class="style1">);</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piReferencePart = "</span><span class="operator"> &lt;&lt;</span> piReferencePart<span class="operator"> &lt;&lt;</span><span class="string"> "uCatalogPartName = "</span><span class="operator"> &lt;&lt;</span> uCatalogPartName<span class="operator">.</span>ConvertToChar<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

      if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> 
          piReferencePart<span class="operator">)
      {</span><span class="comment">

        // Create points for bendable routing.
</span><span class="flow">        if</span><span class="operator"> (</span>piParentProduct<span class="operator"> &amp;&amp;</span> 
            SUCCEEDED<span class="operator">(</span>piParentProduct<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIAProducts<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piParentProducts<span class="operator">)))
        {</span>

          cout<span class="operator"> &lt;&lt;</span><span class="string"> "piParentProducts = "</span><span class="operator"> &lt;&lt;</span> piParentProducts<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">

          // Create part to hold points.
</span>          uDocumentType<span class="operator"> =</span><span class="string"> "Part"</span><span class="operator">;</span>

          uDocumentType<span class="operator">.</span>ConvertToBSTR<span class="operator">(&amp;</span>documentTypeBSTR<span class="operator">);</span>
          uPartNumber<span class="operator"> =</span><span class="string"> "PartForPointsTubing"</span><span class="operator">;</span>
          uPartNumber<span class="operator">.</span>ConvertToBSTR<span class="operator">(&amp;</span>partNumberBSTR<span class="operator">);</span>

          HRESULT rcPointsPart<span class="operator"> =</span> piParentProducts<span class="operator">-&gt;</span>AddNewComponent<span class="operator">(</span>documentTypeBSTR<span class="operator">,</span> 
                                                                   partNumberBSTR<span class="operator">,</span> 
                                                                   piPartForPointsProduct<span class="operator">);</span>

          cout<span class="operator"> &lt;&lt;</span><span class="string"> "rcPointsPart = "</span><span class="operator"> &lt;&lt;</span> rcPointsPart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
          cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPartForPointsProduct = "</span><span class="operator"> &lt;&lt;</span> piPartForPointsProduct<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>piPartForPointsProduct<span class="operator">)
          {</span>
            piPartForPointsProduct<span class="operator">-&gt;</span>GetMasterShapeRepresentation<span class="operator">(</span><span class="bool">TRUE</span><span class="operator">,</span> piPartForPointsShape<span class="operator">);</span>

            cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPartForPointsShape = "</span><span class="operator"> &lt;&lt;</span> piPartForPointsShape<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">
            if</span><span class="operator"> (</span>piPartForPointsShape<span class="operator"> &amp;&amp;</span> 
                SUCCEEDED<span class="operator">(</span>piPartForPointsShape<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIAPartDocument<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piPartForPointsDoc<span class="operator">)))
            {</span>

              cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPartForPointsDoc = "</span><span class="operator"> &lt;&lt;</span> piPartForPointsDoc<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
              piPartForPointsDoc<span class="operator">-&gt;</span>get_Part<span class="operator">(</span>piPartForPoints<span class="operator">);</span>

              cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPartForPoints = "</span><span class="operator"> &lt;&lt;</span> piPartForPoints<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">
              if</span><span class="operator"> (</span>piPartForPoints<span class="operator">)
              {</span>

                piPartForPoints<span class="operator">-&gt;</span>get_HybridShapeFactory<span class="operator">(</span>piShapeFactory<span class="operator">);</span><span class="flow">
                if</span><span class="operator"> (</span>piShapeFactory<span class="operator">)</span>
                  piShapeFactory<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIAHybridShapeFactory<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piHybridShapeFactory<span class="operator">);</span>

                cout<span class="operator"> &lt;&lt;</span><span class="string"> "piHybridShapeFactory = "</span><span class="operator"> &lt;&lt;</span> piHybridShapeFactory<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">
                if</span><span class="operator"> (</span>piHybridShapeFactory<span class="operator">)
                {</span>

                  piListImpl<span class="operator"> =</span><span class="keyword"> new</span> CATIUnknownListImpl<span class="operator">();</span><span class="flow">
                  if</span><span class="operator"> (</span>piListImpl<span class="operator">)</span>

                    piListImpl<span class="operator">-&gt;</span>QueryInterface<span class="operator"> (</span>IID_CATIUnknownList<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piListPoints<span class="operator">);</span>         
                  cout<span class="operator"> &lt;&lt;</span><span class="string"> "piListPoints = "</span><span class="operator"> &lt;&lt;</span> piListPoints<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

                  if</span><span class="operator"> (</span>piListPoints<span class="operator">)
                  {</span><span class="type">
                    double</span> points<span class="operator">[</span><span class="int">4</span><span class="operator">][</span><span class="int">3</span><span class="operator">] = { {-</span><span class="float">1500.0</span><span class="operator">, -</span><span class="float">1000.0</span><span class="operator">,</span><span class="float"> 0.0</span><span class="operator">}, 
                                            {-</span><span class="float">2500.0</span><span class="operator">, -</span><span class="float">1000.0</span><span class="operator">,</span><span class="float"> 0.0</span><span class="operator">}, 
                                            {-</span><span class="float">2500.0</span><span class="operator">,</span><span class="float"> 500.0</span><span class="operator">,</span><span class="float"> 0.0</span><span class="operator">}, 
                                            {-</span><span class="float">3500.0</span><span class="operator">,</span><span class="float"> 500.0</span><span class="operator">,</span><span class="float"> 0.0</span><span class="operator">} };</span><span class="flow">

                    for</span><span class="operator"> (</span><span class="type">unsigned int</span> iiPoint<span class="operator"> =</span><span class="int"> 0</span><span class="operator">;</span> iiPoint<span class="operator"> &lt;</span><span class="int"> 4</span><span class="operator">;</span> iiPoint<span class="operator">++)
                    {</span>

                      cout<span class="operator"> &lt;&lt;</span><span class="string"> "iiPoint = "</span><span class="operator"> &lt;&lt;</span> iiPoint<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
                      piHybridShapeFactory<span class="operator">-&gt;</span>AddNewPointCoord<span class="operator">(</span>points<span class="operator">[</span>iiPoint<span class="operator">][</span><span class="int">0</span><span class="operator">],</span> 
                                                             points<span class="operator">[</span>iiPoint<span class="operator">][</span><span class="int">1</span><span class="operator">],</span> 
                                                             points<span class="operator">[</span>iiPoint<span class="operator">][</span><span class="int">2</span><span class="operator">],</span> 
                                                             piPoint<span class="operator">);</span>

                      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPoint = "</span><span class="operator"> &lt;&lt;</span> piPoint<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
                      piListPoints<span class="operator">-&gt;</span>Add<span class="operator">(</span>iiPoint<span class="operator">,</span> piPoint<span class="operator">);</span><span class="flow">

                      if</span><span class="operator"> (</span>piPoint<span class="operator">) {</span>piPoint<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPoint<span class="operator"> =</span> NULL<span class="operator">;}
                    }</span><span class="comment"> // End loop on points.

</span><span class="operator">                  }</span><span class="comment"> // End valid list of points.
</span><span class="operator">                }</span><span class="comment"> // End valid shape factory.
</span><span class="operator">              }</span><span class="comment"> // End valid part for points.
</span><span class="operator">            }</span><span class="comment"> // End valid shape.
</span><span class="operator">          }</span><span class="comment"> // End valid part for points product.

</span><span class="operator">        }</span><span class="comment"> // End valid parent product.

        // Place part in space.
</span>        uFunctionType<span class="operator"> =</span><span class="string"> "CATTubTubeFunction"</span><span class="operator">;</span>
        uPlacedPartID<span class="operator"> =</span><span class="string"> "TestTubeWithBends"</span><span class="operator">;</span>

        firstPointUpDirection<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int"> 0</span><span class="operator">,</span><span class="int"> 1</span><span class="operator">);</span><span class="comment"> // Up direction parallel to z-axis.
</span>        listBendRadii<span class="operator">.</span>RemoveAll<span class="operator">();</span>

        listBendRadii<span class="operator">.</span>Append<span class="operator">(</span><span class="float">25.4</span><span class="operator">);</span><span class="comment"> // Bend radius in mm (1in).
</span>        listBendRadii<span class="operator">.</span>Append<span class="operator">(</span><span class="float">25.4</span><span class="operator">);</span>

        listBendRadii<span class="operator">.</span>Append<span class="operator">(</span><span class="float">25.4</span><span class="operator">);</span>
        listBendRadii<span class="operator">.</span>Append<span class="operator">(</span><span class="float">25.4</span><span class="operator">);</span>
        rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>RouteStringPartInSpace<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                  uFunctionType<span class="operator">,</span> 
                                                  piReferencePart<span class="operator">,</span> 
                                                  piParentProduct<span class="operator">,</span> 
                                                  piLogicalLine<span class="operator">,</span> 
                                                  uPlacedPartID<span class="operator">,</span> 
                                                  firstPointUpDirection<span class="operator">,</span> 
                                                  piListPoints<span class="operator">,</span> 
                                                  listBendRadii<span class="operator">,</span> 
                                                  piInstancePart<span class="operator">);</span>

        cout<span class="operator"> &lt;&lt;</span><span class="string"> "piInstancePart = "</span><span class="operator"> &lt;&lt;</span> piInstancePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

        if</span><span class="operator"> (</span>piInstancePart<span class="operator">)
        {</span>
        <span class="comment">  // Set catalog part name</span>
          piPlacePart<span class="operator">-&gt;</span>SetCatalogPartName<span class="operator">(</span>piInstancePart<span class="operator">,</span>uCatalogPartName<span class="operator">);</span>
        <span class="comment">
          // Test part connectors.
</span>          ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">1500</span><span class="operator">,-</span><span class="int">1000</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
          ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

          ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>
          rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                     1</span><span class="operator">,</span> 
                                     piParentProduct<span class="operator">,</span> 
                                     ctrPosition<span class="operator">,</span> 
                                     ctrAlign<span class="operator">,</span> 
                                     ctrUp<span class="operator">);</span><span class="flow">

          if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
          {</span>
            ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">3500</span><span class="operator">,</span><span class="int">500</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

            ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
            ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>

            rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                       2</span><span class="operator">,</span> 
                                       piParentProduct<span class="operator">,</span> 
                                       ctrPosition<span class="operator">,</span> 
                                       ctrAlign<span class="operator">,</span> 
                                       ctrUp<span class="operator">);
          }
        }</span><span class="flow">

        else</span><span class="operator">
        {</span>
          rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;
        }
      }
<span class="flow">      if</span><span class="operator"> (</span>FAILED<span class="operator">(</span>rc<span class="operator">))
      {</span>

        piPlacePart<span class="operator">-&gt;</span>GetErrorMessage<span class="operator">(</span>uPlacePartErrorMessage<span class="operator">);</span>
        cout<span class="operator"> &lt;&lt;</span><span class="string"> "uPlacePartErrorMessage = "</span><span class="operator"> &lt;&lt;</span> uPlacePartErrorMessage<span class="operator"> &lt;&lt;</span> endl<span class="operator">;
      }</span>
    }</span><span class="comment"> // End if valid place part object.
</span><span class="operator">  }</span><span class="comment"> // end CATTry

</span>
	CATCatch<span class="operator"> (</span>CATError<span class="operator">,</span> pError<span class="operator">)
	{</span>
    cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::RouteStringPartInSpace *** Error Caught ***"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

    cout<span class="operator"> &lt;&lt;</span> pError<span class="operator">;</span>

    rc<span class="operator"> =</span> CATReturnError<span class="operator">(</span>pError<span class="operator">);
	}</span><span class="comment"> // end CATCatch

</span>
  CATEndTry<span class="operator">;</span><span class="flow">

  if</span><span class="operator"> (</span>piAppObject<span class="operator">) {</span>piAppObject<span class="operator">-&gt;</span>Release<span class="operator">();</span> piAppObject<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPlacePart<span class="operator">) {</span>piPlacePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPlacePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piReferencePart<span class="operator">) {</span>piReferencePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piReferencePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piParentProduct<span class="operator">) {</span>piParentProduct<span class="operator">-&gt;</span>Release<span class="operator">();</span> piParentProduct<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piLogicalLine<span class="operator">) {</span>piLogicalLine<span class="operator">-&gt;</span>Release<span class="operator">();</span> piLogicalLine<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piListPoints<span class="operator">) {</span>piListPoints<span class="operator">-&gt;</span>Release<span class="operator">();</span> piListPoints<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piInstancePart<span class="operator">) {</span>piInstancePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piParentProducts<span class="operator">) {</span>piParentProducts<span class="operator">-&gt;</span>Release<span class="operator">();</span> piParentProducts<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPartForPointsProduct<span class="operator">) {</span>piPartForPointsProduct<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPartForPointsProduct<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPartForPointsShape<span class="operator">) {</span>piPartForPointsShape<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPartForPointsShape<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPartForPointsDoc<span class="operator">) {</span>piPartForPointsDoc<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPartForPointsDoc<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPartForPoints<span class="operator">) {</span>piPartForPoints<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPartForPoints<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piShapeFactory<span class="operator">) {</span>piShapeFactory<span class="operator">-&gt;</span>Release<span class="operator">();</span> piShapeFactory<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piHybridShapeFactory<span class="operator">) {</span>piHybridShapeFactory<span class="operator">-&gt;</span>Release<span class="operator">();</span> piHybridShapeFactory<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPoint<span class="operator">) {</span>piPoint<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPoint<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piListImpl<span class="operator">) {</span>piListImpl<span class="operator">-&gt;</span>Release<span class="operator">();</span> piListImpl<span class="operator"> =</span> NULL<span class="operator">;}</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::RouteStringPartInSpace rc = "</span><span class="operator"> &lt;&lt;</span> rc<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">
  return</span> rc<span class="operator">;
}</span>
</pre>
</div>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Parts on Run Segments"></a>Parts on Run Segments</h4>
<p>
  The CAACloPlacePart method PlacePartOnRunSegment places parts on run segments.
  PlacePartOnRunSegment performs the same setup as PlacePartInSpace. 
  In addition it finds Run-0043, which is a child of TubingWP.1, using the GetChildObject.
  PlacePartOnRunSegment places a union and a tube two segments of Run-0043.
  The union is flipped twice to test the FlipPlacedPart method.
  The placement of the tube causes the union and tube to be connected.
</p>
<p>
  Parts are placed on run segments using the CATIPspPlacePartOnRun method PlacePartOnRunSegment.
  The major change from placing a part in space is that a run segment is needed.
  The list of run segments is retrieved with CATIArrSegmentsString::ListSegments.
  The union is placed on the first segment and the tube is placed on the second segment.
  Union is flipped using FlipPlacedPart method of CATIPspPlacePartOnRun.
  The run segment defines the part up direction and horizontal alignment.
  Position data is still sent to fix the parts position on the segment.
  Connector data is tested using the TestPartConnectorData method and the connection is tested with the TestConnectedPart method.
</p>
<p>
</p>
<div class="code">
<pre><span class="comment">//=============================================================================
//  Place parts on run segments.
//=============================================================================
</span>HRESULT CAACloPlacePart<span class="operator">::</span>PlacePartOnRunSegment<span class="operator">()
{</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"===       CAACloPlacePart::PlacePartOnRunSegment         ==="</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

  HRESULT rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;</span><span class="comment">

  // Interface pointer variables used below in the try section.
</span>  CATObject<span class="operator"> *</span>piAppObject<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIPspPlacePartOnRun<span class="operator"> *</span>piPlacePart<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIProduct<span class="operator"> *</span>piParentProduct<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIPspLogicalLine<span class="operator"> *</span>piLogicalLine<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIArrSegmentsString<span class="operator"> *</span>piRun<span class="operator"> =</span> NULL<span class="operator">;</span>
  IUnknown<span class="operator"> *</span>piReferencePart<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIArrSegment<span class="operator"> *</span>piSegment<span class="operator"> =</span> NULL<span class="operator">;</span>
  IUnknown<span class="operator"> *</span>piInstancePart<span class="operator"> =</span> NULL<span class="operator">;</span>

  IUnknown<span class="operator"> *</span>piConnectedPart<span class="operator"> =</span> NULL<span class="operator">;</span>
  IUnknown<span class="operator"> *</span>piInstanceUnion<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATUnicodeString uCatalogPartName<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span>

  CATUnicodeString uPlacePartErrorMessage<span class="operator">;</span>
  CATListValCATBaseUnknown_var listOfSegments<span class="operator">;</span>
  CATUnicodeString uStandard<span class="operator"> =</span><span class="string"> "SSTL"</span><span class="operator">;</span>
  CATUnicodeString uSpecName<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span>

  CATUnicodeString uPartType<span class="operator">;</span>
  CATUnicodeString uPartNumber<span class="operator">;</span>
  CATUnicodeString uFunctionType<span class="operator">;</span>
  CATUnicodeString uPlacedPartID<span class="operator">;</span>
  CATMathPoint position<span class="operator">;</span>

  CATMathPoint ctrPosition<span class="operator">;</span>
  CATMathDirection ctrAlign<span class="operator">;</span>
  CATMathDirection ctrUp<span class="operator">;</span>
  CATIArrSegment_var spSegment<span class="operator">;</span>

  CATTry<span class="operator"> 
  {</span><span class="comment">
    // Get application object.
</span>    piAppObject<span class="operator"> =</span><span class="keyword"> new</span> CATObject<span class="operator">(</span><span class="string">"CATTubing"</span><span class="operator">);</span>

    cout<span class="operator"> &lt;&lt;</span><span class="string"> "piAppObject = "</span><span class="operator"> &lt;&lt;</span> piAppObject<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

    if</span><span class="operator"> (</span>piAppObject<span class="operator"> &amp;&amp;</span> 
        SUCCEEDED<span class="operator">(</span>piAppObject<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIPspPlacePartOnRun<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piPlacePart<span class="operator">)))
    {</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPlacePart = "</span><span class="operator"> &lt;&lt;</span> piPlacePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

      piParentProduct<span class="operator"> = (</span>CATIProduct<span class="operator">*)</span>GetChildObject<span class="operator">(</span>IID_CATIProduct<span class="operator">,</span><span class="string"> "TubingWP.1"</span><span class="operator">);</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piParentProduct = "</span><span class="operator"> &lt;&lt;</span> piParentProduct<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">

      //piLogicalLine = GetALogicalLine(piParentProduct);
</span>      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piLogicalLine = "</span><span class="operator"> &lt;&lt;</span> piLogicalLine<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

      piRun<span class="operator"> = (</span>CATIArrSegmentsString<span class="operator">*)</span>GetChildObject<span class="operator">(</span>IID_CATIArrSegmentsString<span class="operator">,</span><span class="string"> "Run-0043"</span><span class="operator">,</span> piParentProduct<span class="operator">);</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piRun = "</span><span class="operator"> &lt;&lt;</span> piRun<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

      if</span><span class="operator"> (</span>piRun<span class="operator">)
      {</span>

        piRun<span class="operator">-&gt;</span>ListSegments<span class="operator">(</span>listOfSegments<span class="operator">);</span>
        cout<span class="operator"> &lt;&lt;</span><span class="string"> "listOfSegments.Size() = "</span><span class="operator"> &lt;&lt;</span> listOfSegments<span class="operator">.</span>Size<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

        do</span><span class="operator">
        {</span><span class="comment"> // Dummy loop to allow easy exit on fail.
          // ==============================================================================
          // Place union on segment
          // ==============================================================================
          // Get reference part
</span>          uPartType<span class="operator"> =</span><span class="string"> "CATTubUnion"</span><span class="operator">;</span>
          uPartNumber<span class="operator"> =</span><span class="string"> "UNION-BULKHEAD-FFSM-16"</span><span class="operator">;</span>

          rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>GetReferencePartFromCatalog<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                         uSpecName<span class="operator">,</span> 
                                                         uPartType<span class="operator">,</span> 
                                                         uPartNumber<span class="operator">,</span> 
                                                         piParentProduct<span class="operator">,</span> 
                                                         piReferencePart<span class="style1">,</span>
                                                         uCatalogPartName<span class="style1">);</span>

          cout<span class="operator"> &lt;&lt;</span><span class="string"> "piReferencePart = "</span><span class="operator"> &lt;&lt;</span> piReferencePart<span class="operator"> &lt;&lt;</span><span class="string"> "uCatalogPartName = "</span><span class="operator"> &lt;&lt;</span> uCatalogPartName<span class="operator">.</span>ConvertToChar<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> 
              piReferencePart<span class="operator">)
          {</span><span class="flow">

            if</span><span class="operator"> (</span>listOfSegments<span class="operator">.</span>Size<span class="operator">() &gt;=</span><span class="int"> 1</span><span class="operator">)
            {</span>
              spSegment<span class="operator"> =</span> listOfSegments<span class="operator">[</span><span class="int">1</span><span class="operator">];</span><span class="flow">

              if</span><span class="operator"> (!!</span>spSegment<span class="operator">)</span>
                spSegment<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIArrSegment<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piSegment<span class="operator">);</span>

              cout<span class="operator"> &lt;&lt;</span><span class="string"> "piSegment = "</span><span class="operator"> &lt;&lt;</span> piSegment<span class="operator"> &lt;&lt;</span> endl<span class="operator">;
            }</span><span class="flow">

            if</span><span class="operator"> (</span>piSegment<span class="operator">)
            {</span><span class="comment">

              // Place part on run segment.
</span>              uFunctionType<span class="operator"> =</span><span class="string"> "CATTubTubeFunction"</span><span class="operator">;</span>
              uPlacedPartID<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span><span class="comment"> // Null string uses name generated by PP engine

</span>              position<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">200</span><span class="operator">,-</span><span class="int">800</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span><span class="comment"> // in mm.
</span>              rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>PlacePartOnRunSegment<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                       uFunctionType<span class="operator">,</span> 
                                                       piReferencePart<span class="operator">,</span> 
                                                       piSegment<span class="operator">,</span> 
                                                       piLogicalLine<span class="operator">,</span> 
                                                       uPlacedPartID<span class="operator">,</span> 
                                                       position<span class="operator">,</span> 
                                                       piInstancePart<span class="operator">);</span>

              cout<span class="operator"> &lt;&lt;</span><span class="string"> "piInstancePart = "</span><span class="operator"> &lt;&lt;</span> piInstancePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

              if</span><span class="operator"> (</span>piInstancePart<span class="operator">)
              {</span>
  	       <span class="comment">  // Set catalog part name</span>
                piPlacePart<span class="operator">-&gt;</span>SetCatalogPartName<span class="operator">(</span>piInstancePart<span class="operator">,</span>uCatalogPartName<span class="operator">);</span>
                
                piInstancePart<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_IUnknown<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piInstanceUnion<span class="operator">);</span><span class="comment">

                // Test part connectors.
</span>                ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="float">171.006</span><span class="operator">,-</span><span class="int">800</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

                ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>
                
                cout<span class="operator"> &lt;&lt;</span><span class="string"> "Union after placement"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

                rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                           1</span><span class="operator">,</span> 
                                           piParentProduct<span class="operator">,</span> 
                                           ctrPosition<span class="operator">,</span> 
                                           ctrAlign<span class="operator">,</span> 
                                           ctrUp<span class="operator">);</span><span class="flow">

                if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                {</span>
                  ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="float">228.994</span><span class="operator">,-</span><span class="int">800</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

                  ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                  ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>

                  rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                             2</span><span class="operator">,</span> 
                                             piParentProduct<span class="operator">,</span> 
                                             ctrPosition<span class="operator">,</span> 
                                             ctrAlign<span class="operator">,</span> 
                                             ctrUp<span class="operator">);</span><span class="comment">

                  // ------------------------------------------
                  // Test flip of union.
                  // ------------------------------------------
</span><span class="flow">                  if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                  {</span><span class="comment">
                    // Flip first time.
</span>                    rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>FlipPlacedPart<span class="operator">(</span>piInstancePart<span class="operator">);</span><span class="flow">

                    if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                    {</span>
                      cout<span class="operator"> &lt;&lt;</span><span class="string"> "Union after first flip"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">

                      // Test part connectors.
</span>                      ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="float">171.006</span><span class="operator">,-</span><span class="int">800</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                      ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

                      ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>
                      rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                                 2</span><span class="operator">,</span> 
                                                 piParentProduct<span class="operator">,</span> 
                                                 ctrPosition<span class="operator">,</span> 
                                                 ctrAlign<span class="operator">,</span> 
                                                 ctrUp<span class="operator">);</span><span class="flow">

                      if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                      {</span>
                        ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="float">228.994</span><span class="operator">,-</span><span class="int">800</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

                        ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                        ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>

                        rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                                   1</span><span class="operator">,</span> 
                                                   piParentProduct<span class="operator">,</span> 
                                                   ctrPosition<span class="operator">,</span> 
                                                   ctrAlign<span class="operator">,</span> 
                                                   ctrUp<span class="operator">);</span><span class="flow">

                        if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                        {</span><span class="comment">
                          // Flip second time. Union should be back to original flip
</span>                          rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>FlipPlacedPart<span class="operator">(</span>piInstancePart<span class="operator">);</span><span class="flow">

                          if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                          {</span>
                            cout<span class="operator"> &lt;&lt;</span><span class="string"> "Union after second flip"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">

                            // Test part connectors.
</span>                            ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="float">171.006</span><span class="operator">,-</span><span class="int">800</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                            ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

                            ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>
                            rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                                       1</span><span class="operator">,</span> 
                                                       piParentProduct<span class="operator">,</span> 
                                                       ctrPosition<span class="operator">,</span> 
                                                       ctrAlign<span class="operator">,</span> 
                                                       ctrUp<span class="operator">);</span><span class="flow">

                            if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                            {</span>
                              ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="float">228.994</span><span class="operator">,-</span><span class="int">800</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

                              ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                              ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>

                              rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                                         2</span><span class="operator">,</span> 
                                                         piParentProduct<span class="operator">,</span> 
                                                         ctrPosition<span class="operator">,</span> 
                                                         ctrAlign<span class="operator">,</span> 
                                                         ctrUp<span class="operator">);
                            }</span><span class="comment"> // End if connector test succeeded

</span><span class="operator">                          }</span><span class="comment"> // End if flip succeeded
</span><span class="operator">                        }</span><span class="comment"> // End if connector test succeeded.
</span><span class="operator">                      }</span><span class="comment"> // End if connector test succeeded
</span><span class="operator">                    }</span><span class="comment"> // End if flip succeeded
</span><span class="operator">                  }</span><span class="comment"> // End if connector test succeeded.

</span><span class="operator">                }</span>
<span class="operator">              }</span><span class="flow">

              else</span><span class="operator">
              {</span>
                rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;
              }
            }</span><span class="comment"> // End if valid segment.
</span><span class="operator">          }</span><span class="comment"> // End if valid reference part.

</span><span class="flow">          if</span><span class="operator"> (</span>FAILED<span class="operator">(</span>rc<span class="operator">))</span><span class="flow"> break</span><span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>piReferencePart<span class="operator">) {</span>piReferencePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piReferencePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piSegment<span class="operator">) {</span>piSegment<span class="operator">-&gt;</span>Release<span class="operator">();</span> piSegment<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piInstancePart<span class="operator">) {</span>piInstancePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="comment">

          // ==============================================================================
          // Place bendable on segment
          // ==============================================================================
          // Get reference part
</span>          uPartType<span class="operator"> =</span><span class="string"> "CATTubBendableTube"</span><span class="operator">;</span>
          uPartNumber<span class="operator"> =</span><span class="string"> "TUBE-BENDABLE-TIV-16S"</span><span class="operator">;</span>

          rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>GetReferencePartFromCatalog<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                         uSpecName<span class="operator">,</span> 
                                                         uPartType<span class="operator">,</span> 
                                                         uPartNumber<span class="operator">,</span> 
                                                         piParentProduct<span class="operator">,</span> 
                                                         piReferencePart<span class="style1">,</span>
                                                         uCatalogPartName<span class="style1">);</span>

          cout<span class="operator"> &lt;&lt;</span><span class="string"> "piReferencePart = "</span><span class="operator"> &lt;&lt;</span> piReferencePart<span class="operator"> &lt;&lt;</span><span class="string"> "uCatalogPartName = "</span><span class="operator"> &lt;&lt;</span> uCatalogPartName<span class="operator">.</span>ConvertToChar<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> 
              piReferencePart<span class="operator">)
          {</span><span class="flow">

            if</span><span class="operator"> (</span>listOfSegments<span class="operator">.</span>Size<span class="operator">() &gt;=</span><span class="int"> 2</span><span class="operator">)
            {</span>
              spSegment<span class="operator"> =</span> listOfSegments<span class="operator">[</span><span class="int">2</span><span class="operator">];</span><span class="flow">

              if</span><span class="operator"> (!!</span>spSegment<span class="operator">)</span>
                spSegment<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIArrSegment<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piSegment<span class="operator">);</span>

              cout<span class="operator"> &lt;&lt;</span><span class="string"> "piSegment = "</span><span class="operator"> &lt;&lt;</span> piSegment<span class="operator"> &lt;&lt;</span> endl<span class="operator">;
            }</span><span class="flow">

            if</span><span class="operator"> (</span>piSegment<span class="operator">)
            {</span><span class="comment">

              // Place part on run segment.
</span>              uFunctionType<span class="operator"> =</span><span class="string"> "CATTubTubeFunction"</span><span class="operator">;</span>
              uPlacedPartID<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span><span class="comment"> // Null string uses name generated by PP engine

</span>              position<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">800</span><span class="operator">,-</span><span class="int">600</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span><span class="comment"> // in mm.
</span>              rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>PlacePartOnRunSegment<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                       uFunctionType<span class="operator">,</span> 
                                                       piReferencePart<span class="operator">,</span> 
                                                       piSegment<span class="operator">,</span> 
                                                       piLogicalLine<span class="operator">,</span> 
                                                       uPlacedPartID<span class="operator">,</span> 
                                                       position<span class="operator">,</span> 
                                                       piInstancePart<span class="operator">);</span>

              cout<span class="operator"> &lt;&lt;</span><span class="string"> "piInstancePart = "</span><span class="operator"> &lt;&lt;</span> piInstancePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

              if</span><span class="operator"> (</span>piInstancePart<span class="operator">)
              {</span>
              <span class="comment">  // Set catalog part name</span>
                piPlacePart<span class="operator">-&gt;</span>SetCatalogPartName<span class="operator">(</span>piInstancePart<span class="operator">,</span>uCatalogPartName<span class="operator">);</span>
              <span class="comment">
                // Test part connectors.
</span>                ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="float">228.994</span><span class="operator">,-</span><span class="int">800</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

                ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>
                rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                           1</span><span class="operator">,</span> 
                                           piParentProduct<span class="operator">,</span> 
                                           ctrPosition<span class="operator">,</span> 
                                           ctrAlign<span class="operator">,</span> 
                                           ctrUp<span class="operator">);</span><span class="flow">

                if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                {</span>
                  rc<span class="operator"> =</span> TestConnectedPart<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                         1</span><span class="operator">,</span> 
                                         piInstanceUnion<span class="operator">,</span><span class="int"> 
                                         2</span><span class="operator">);</span><span class="flow">

                  if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                  {</span>
                    ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">1600</span><span class="operator">,-</span><span class="int">1500</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

                    ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                    ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>

                    rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                               2</span><span class="operator">,</span> 
                                               piParentProduct<span class="operator">,</span> 
                                               ctrPosition<span class="operator">,</span> 
                                               ctrAlign<span class="operator">,</span> 
                                               ctrUp<span class="operator">);
                  }</span><span class="comment"> // End if connected part test succeeded.

</span><span class="operator">                }</span><span class="comment"> // End if ctr 1 test succeeded.
</span><span class="operator">              }</span><span class="comment"> // End if valid instance part.
</span><span class="flow">              else</span><span class="operator">
              {</span>
                rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;
              }
            }</span><span class="comment"> // End if valid segment.

</span><span class="operator">          }</span><span class="comment"> // End if valid reference part.
</span><span class="operator">        }</span><span class="flow"> while</span><span class="operator"> (</span><span class="int">0</span><span class="operator">);</span><span class="comment"> // End dummy loop for easy exit on fail.
</span><span class="operator">      }</span><span class="comment"> // End if valid run.

</span>
<span class="flow">      if</span><span class="operator"> (</span>FAILED<span class="operator">(</span>rc<span class="operator">))
      {</span>

        piPlacePart<span class="operator">-&gt;</span>GetErrorMessage<span class="operator">(</span>uPlacePartErrorMessage<span class="operator">);</span>
        cout<span class="operator"> &lt;&lt;</span><span class="string"> "uPlacePartErrorMessage = "</span><span class="operator"> &lt;&lt;</span> uPlacePartErrorMessage<span class="operator"> &lt;&lt;</span> endl<span class="operator">;
      }</span>
<span class="operator">    }</span><span class="comment"> // End if valid place part object.
</span><span class="operator">  }</span><span class="comment"> // end CATTry
</span>
	CATCatch<span class="operator"> (</span>CATError<span class="operator">,</span> pError<span class="operator">)
	{</span>

    cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::PlacePartOnRunSegment *** Error Caught ***"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
    cout<span class="operator"> &lt;&lt;</span> pError<span class="operator">;</span>

    rc<span class="operator"> =</span> CATReturnError<span class="operator">(</span>pError<span class="operator">);
	}</span><span class="comment"> // end CATCatch
</span>
  CATEndTry<span class="operator">;</span><span class="flow">

  if</span><span class="operator"> (</span>piAppObject<span class="operator">) {</span>piAppObject<span class="operator">-&gt;</span>Release<span class="operator">();</span> piAppObject<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPlacePart<span class="operator">) {</span>piPlacePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPlacePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piParentProduct<span class="operator">) {</span>piParentProduct<span class="operator">-&gt;</span>Release<span class="operator">();</span> piParentProduct<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piLogicalLine<span class="operator">) {</span>piLogicalLine<span class="operator">-&gt;</span>Release<span class="operator">();</span> piLogicalLine<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piRun<span class="operator">) {</span>piRun<span class="operator">-&gt;</span>Release<span class="operator">();</span> piRun<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piReferencePart<span class="operator">) {</span>piReferencePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piReferencePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piSegment<span class="operator">) {</span>piSegment<span class="operator">-&gt;</span>Release<span class="operator">();</span> piSegment<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piInstancePart<span class="operator">) {</span>piInstancePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piConnectedPart<span class="operator">) {</span>piConnectedPart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piConnectedPart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piInstanceUnion<span class="operator">) {</span>piInstanceUnion<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstanceUnion<span class="operator"> =</span> NULL<span class="operator">;}</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::PlacePartOnRunSegment rc = "</span><span class="operator"> &lt;&lt;</span> rc<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">
  return</span> rc<span class="operator">;
}</span></pre>
</div>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Parts on Run Nodes"></a>Parts on Run Nodes</h4>
<p>
  The CAACloPlacePart method PlacePartOnRunNode places parts on run nodes.
  Again setup is very similar to previous methods.
  Run-044 is used for part placement.
  CATIArrSegmentsString::ListNodes finds the run nodes.
  A valve is placed on the first node which is an extremity (or exterior) node at the beginning of the run.
  An elbow is placed on the fifth node which is interior or a corner.
  A bendable tube is placed on the second node.
  It expands to meet the valve and the union and is connected to them.
  The nodes are the only position data needed since they provide location and the connected segments provide up direction and horizontal orientation.
  Connector data is tested using the TestPartConnectorData method and the connections are tested with the TestConnectedPart method.
  Run-044 is broken at an elbow and newly formed Run is connected to the elbow using BreakAndTrimRuns and ConnectRunToPart methods of CATIPspPlacePartOnRun respectively.
</p>
<div class="code">
<pre><span class="comment">//=============================================================================
//  Place parts on run nodes.
//=============================================================================
</span>HRESULT CAACloPlacePart<span class="operator">::</span>PlacePartOnRunNode<span class="operator">()
{</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"===       CAACloPlacePart::PlacePartOnRunNode            ==="</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

  HRESULT rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;</span><span class="comment">

  // Interface pointer variables used below in the try section.
</span>  CATObject<span class="operator"> *</span>piAppObject<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIPspPlacePartOnRun<span class="operator"> *</span>piPlacePart<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIProduct<span class="operator"> *</span>piParentProduct<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIPspLogicalLine<span class="operator"> *</span>piLogicalLine<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIArrSegmentsString<span class="operator"> *</span>piRun<span class="operator"> =</span> NULL<span class="operator">;</span>
  IUnknown<span class="operator"> *</span>piReferencePart<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIArrNode<span class="operator"> *</span>piNode<span class="operator"> =</span> NULL<span class="operator">;</span>
  IUnknown<span class="operator"> *</span>piInstancePart<span class="operator"> =</span> NULL<span class="operator">;</span>

  IUnknown<span class="operator"> *</span>piConnectedPart<span class="operator"> =</span> NULL<span class="operator">;</span>
  IUnknown<span class="operator"> *</span>piInstanceValve<span class="operator"> =</span> NULL<span class="operator">;</span>

  IUnknown<span class="operator"> *</span>piInstanceElbow<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATUnicodeString uCatalogPartName<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span>

  CATUnicodeString uPlacePartErrorMessage<span class="operator">;</span>
  CATListValCATBaseUnknown_var listOfNodes<span class="operator">;</span>
  CATUnicodeString uStandard<span class="operator"> =</span><span class="string"> "SSTL"</span><span class="operator">;</span>

  CATUnicodeString uSpecName<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span>
  CATUnicodeString uPartType<span class="operator">;</span>
  CATUnicodeString uPartNumber<span class="operator">;</span>
  CATUnicodeString uFunctionType<span class="operator">;</span>

  CATUnicodeString uPlacedPartID<span class="operator">;</span>
  CATMathPoint ctrPosition<span class="operator">;</span>
  CATMathDirection ctrAlign<span class="operator">;</span>
  CATMathDirection ctrUp<span class="operator">;</span>
  CATIArrNode_var spNode<span class="operator">;</span>

  CATTry<span class="operator"> 
  {</span><span class="comment">
    // Get application object.
</span>    piAppObject<span class="operator"> =</span><span class="keyword"> new</span> CATObject<span class="operator">(</span><span class="string">"CATTubing"</span><span class="operator">);</span>

    cout<span class="operator"> &lt;&lt;</span><span class="string"> "piAppObject = "</span><span class="operator"> &lt;&lt;</span> piAppObject<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

    if</span><span class="operator"> (</span>piAppObject<span class="operator"> &amp;&amp;</span> 
        SUCCEEDED<span class="operator">(</span>piAppObject<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIPspPlacePartOnRun<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piPlacePart<span class="operator">)))
    {</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPlacePart = "</span><span class="operator"> &lt;&lt;</span> piPlacePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

      piParentProduct<span class="operator"> = (</span>CATIProduct<span class="operator">*)</span>GetChildObject<span class="operator">(</span>IID_CATIProduct<span class="operator">,</span><span class="string"> "TubingWP.1"</span><span class="operator">);</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piParentProduct = "</span><span class="operator"> &lt;&lt;</span> piParentProduct<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">

      //piLogicalLine = GetALogicalLine(piParentProduct);
</span>      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piLogicalLine = "</span><span class="operator"> &lt;&lt;</span> piLogicalLine<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

      piRun<span class="operator"> = (</span>CATIArrSegmentsString<span class="operator">*)</span>GetChildObject<span class="operator">(</span>IID_CATIArrSegmentsString<span class="operator">,</span><span class="string"> "Run-0044"</span><span class="operator">,</span> piParentProduct<span class="operator">);</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piRun = "</span><span class="operator"> &lt;&lt;</span> piRun<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

      if</span><span class="operator"> (</span>piRun<span class="operator">)
      {</span>

        piRun<span class="operator">-&gt;</span>ListNodes<span class="operator">(</span>listOfNodes<span class="operator">);</span>
        cout<span class="operator"> &lt;&lt;</span><span class="string"> "listOfNodes.Size() = "</span><span class="operator"> &lt;&lt;</span> listOfNodes<span class="operator">.</span>Size<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

        do</span><span class="operator">
        {</span><span class="comment"> // Dummy loop to allow easy exit on fail.
          // ==============================================================================
          // Place valve on exterior node
          // ==============================================================================
          // Get reference part
</span>          uPartType<span class="operator"> =</span><span class="string"> "CATTubControlValve"</span><span class="operator">;</span>
          uPartNumber<span class="operator"> =</span><span class="string"> "V_BALL-TF-16S"</span><span class="operator">;</span>

          rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>GetReferencePartFromCatalog<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                         uSpecName<span class="operator">,</span> 
                                                         uPartType<span class="operator">,</span> 
                                                         uPartNumber<span class="operator">,</span> 
                                                         piParentProduct<span class="operator">,</span> 
                                                         piReferencePart<span class="style1">,</span>
                                                         uCatalogPartName<span class="style1">);</span>

          cout<span class="operator"> &lt;&lt;</span><span class="string"> "piReferencePart = "</span><span class="operator"> &lt;&lt;</span> piReferencePart<span class="operator"> &lt;&lt;</span><span class="string"> "uCatalogPartName = "</span><span class="operator"> &lt;&lt;</span> uCatalogPartName<span class="operator">.</span>ConvertToChar<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> 
              piReferencePart<span class="operator">)
          {</span><span class="flow">

            if</span><span class="operator"> (</span>listOfNodes<span class="operator">.</span>Size<span class="operator">() &gt;=</span><span class="int"> 1</span><span class="operator">)
            {</span>
              spNode<span class="operator"> =</span> listOfNodes<span class="operator">[</span><span class="int">1</span><span class="operator">];</span><span class="flow">

              if</span><span class="operator"> (!!</span>spNode<span class="operator">)</span>
                spNode<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIArrNode<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piNode<span class="operator">);</span>

              cout<span class="operator"> &lt;&lt;</span><span class="string"> "piNode = "</span><span class="operator"> &lt;&lt;</span> piNode<span class="operator"> &lt;&lt;</span> endl<span class="operator">;
            }</span><span class="flow">

            if</span><span class="operator"> (</span>piNode<span class="operator">)
            {</span>

              uFunctionType<span class="operator"> =</span><span class="string"> "CATTubControlValveFunction"</span><span class="operator">;</span>
              uPlacedPartID<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span><span class="comment"> // Null string uses name generated by PP engine

</span>              rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>PlacePartOnRunNode<span class="operator">(</span>uStandard<span class="operator">,</span> 
                                                   uFunctionType<span class="operator">,</span> 
                                                   piReferencePart<span class="operator">,</span> 
                                                   piNode<span class="operator">,</span> 
                                                   piLogicalLine<span class="operator">,</span> 
                                                   uPlacedPartID<span class="operator">,</span> 
                                                   piInstancePart<span class="operator">);</span>

              cout<span class="operator"> &lt;&lt;</span><span class="string"> "piInstancePart = "</span><span class="operator"> &lt;&lt;</span> piInstancePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

              if</span><span class="operator"> (</span>piInstancePart<span class="operator">)
              {</span>
		 <span class="comment">  // Set catalog part name</span>
                piPlacePart<span class="operator">-&gt;</span>SetCatalogPartName<span class="operator">(</span>piInstancePart<span class="operator">,</span>uCatalogPartName<span class="operator">);</span>
                
                piInstancePart<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_IUnknown<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piInstanceValve<span class="operator">);</span><span class="comment">

                // Test part connectors.
</span>                ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">500</span><span class="operator">,</span><span class="int">800</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

                ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>

                rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                           1</span><span class="operator">,</span> 
                                           piParentProduct<span class="operator">,</span> 
                                           ctrPosition<span class="operator">,</span> 
                                           ctrAlign<span class="operator">,</span> 
                                           ctrUp<span class="operator">);</span><span class="flow">

                if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                {</span>
                  ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="float">470.79</span><span class="operator">,</span><span class="int">800</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

                  ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                  ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>

                  rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                             2</span><span class="operator">,</span> 
                                             piParentProduct<span class="operator">,</span> 
                                             ctrPosition<span class="operator">,</span> 
                                             ctrAlign<span class="operator">,</span> 
                                             ctrUp<span class="operator">);
                }
              }</span><span class="flow">

              else</span><span class="operator">
              {</span>
                rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;
              }
            }</span><span class="comment"> // End if valid segment.
</span><span class="operator">          }</span><span class="comment"> // End if valid reference part.

</span><span class="flow">          if</span><span class="operator"> (</span>FAILED<span class="operator">(</span>rc<span class="operator">))</span><span class="flow"> break</span><span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>piReferencePart<span class="operator">) {</span>piReferencePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piReferencePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piNode<span class="operator">) {</span>piNode<span class="operator">-&gt;</span>Release<span class="operator">();</span> piNode<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piInstancePart<span class="operator">) {</span>piInstancePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="comment">

          // ==============================================================================
          // Place elbow on interior node.
          // ==============================================================================
          // Get reference part
</span>          uPartType<span class="operator"> =</span><span class="string"> "CATTubNonReducingElbow"</span><span class="operator">;</span>
          uPartNumber<span class="operator"> =</span><span class="string"> "ELBOW-90-BULKHEAD-FFSM-16"</span><span class="operator">;</span>

          rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>GetReferencePartFromCatalog<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                         uSpecName<span class="operator">,</span> 
                                                         uPartType<span class="operator">,</span> 
                                                         uPartNumber<span class="operator">,</span> 
                                                         piParentProduct<span class="operator">,</span> 
                                                         piReferencePart<span class="style1">,</span>
                                                         uCatalogPartName<span class="style1">);</span>

          cout<span class="operator"> &lt;&lt;</span><span class="string"> "piReferencePart = "</span><span class="operator"> &lt;&lt;</span> piReferencePart<span class="operator"> &lt;&lt;</span><span class="string"> "uCatalogPartName = "</span><span class="operator"> &lt;&lt;</span> uCatalogPartName<span class="operator">.</span>ConvertToChar<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> 
              piReferencePart<span class="operator">)
          {</span><span class="flow">

            if</span><span class="operator"> (</span>listOfNodes<span class="operator">.</span>Size<span class="operator">() &gt;=</span><span class="int"> 5</span><span class="operator">)
            {</span>
              spNode<span class="operator"> =</span> listOfNodes<span class="operator">[</span><span class="int">5</span><span class="operator">];</span><span class="flow">

              if</span><span class="operator"> (!!</span>spNode<span class="operator">)</span>
                spNode<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIArrNode<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piNode<span class="operator">);</span>

              cout<span class="operator"> &lt;&lt;</span><span class="string"> "piNode = "</span><span class="operator"> &lt;&lt;</span> piNode<span class="operator"> &lt;&lt;</span> endl<span class="operator">;
            }</span><span class="flow">

            if</span><span class="operator"> (</span>piNode<span class="operator">)
            {</span>

              uFunctionType<span class="operator"> =</span><span class="string"> "CATTubTubeFunction"</span><span class="operator">;</span>
              uPlacedPartID<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span><span class="comment"> // Null string uses name generated by PP engine

</span>              rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>PlacePartOnRunNode<span class="operator">(</span>uStandard<span class="operator">,</span> 
                                                   uFunctionType<span class="operator">,</span> 
                                                   piReferencePart<span class="operator">,</span> 
                                                   piNode<span class="operator">,</span> 
                                                   piLogicalLine<span class="operator">,</span> 
                                                   uPlacedPartID<span class="operator">,</span> 
                                                   piInstancePart<span class="operator">);</span>

              cout<span class="operator"> &lt;&lt;</span><span class="string"> "piInstancePart = "</span><span class="operator"> &lt;&lt;</span> piInstancePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

              if</span><span class="operator"> (</span>piInstancePart<span class="operator">)
              {</span>
		 <span class="comment">  // Set catalog part name</span>
                piPlacePart<span class="operator">-&gt;</span>SetCatalogPartName<span class="operator">(</span>piInstancePart<span class="operator">,</span>uCatalogPartName<span class="operator">);</span>
                
                piInstancePart<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_IUnknown<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piInstanceElbow<span class="operator">);</span><span class="comment">

                // Test part connectors.
</span>                ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="float">741.3</span><span class="operator">,</span><span class="int">2000</span><span class="operator">,</span><span class="int">1800</span><span class="operator">);</span>

                ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,-</span><span class="int">1</span><span class="operator">);</span>

                rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                           1</span><span class="operator">,</span> 
                                           piParentProduct<span class="operator">,</span> 
                                           ctrPosition<span class="operator">,</span> 
                                           ctrAlign<span class="operator">,</span> 
                                           ctrUp<span class="operator">);</span><span class="flow">

                if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                {</span>
                  ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">700</span><span class="operator">,</span><span class="float">2063.53</span><span class="operator">,</span><span class="int">1800</span><span class="operator">);</span>

                  ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                  ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,-</span><span class="int">1</span><span class="operator">);</span>

                  rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                             2</span><span class="operator">,</span> 
                                             piParentProduct<span class="operator">,</span> 
                                             ctrPosition<span class="operator">,</span> 
                                             ctrAlign<span class="operator">,</span> 
                                             ctrUp<span class="operator">);
                }
              }</span><span class="flow">

              else</span><span class="operator">
              {</span>
                rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;
              }
            }</span><span class="comment"> // End if valid segment.
</span><span class="operator">          }</span><span class="comment"> // End if valid reference part.

</span><span class="flow">          if</span><span class="operator"> (</span>FAILED<span class="operator">(</span>rc<span class="operator">))</span><span class="flow"> break</span><span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>piReferencePart<span class="operator">) {</span>piReferencePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piReferencePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piNode<span class="operator">) {</span>piNode<span class="operator">-&gt;</span>Release<span class="operator">();</span> piNode<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piInstancePart<span class="operator">) {</span>piInstancePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="comment">

          // ==============================================================================
          // Place bendable on node.
          // ==============================================================================
          // Get reference part
</span>          uPartType<span class="operator"> =</span><span class="string"> "CATTubBendableTube"</span><span class="operator">;</span>
          uPartNumber<span class="operator"> =</span><span class="string"> "TUBE-BENDABLE-TIV-16S"</span><span class="operator">;</span>

          rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>GetReferencePartFromCatalog<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                         uSpecName<span class="operator">,</span> 
                                                         uPartType<span class="operator">,</span> 
                                                         uPartNumber<span class="operator">,</span> 
                                                         piParentProduct<span class="operator">,</span> 
                                                         piReferencePart<span class="style1">,</span>
                                                         uCatalogPartName<span class="style1">);</span>

          cout<span class="operator"> &lt;&lt;</span><span class="string"> "piReferencePart = "</span><span class="operator"> &lt;&lt;</span> piReferencePart<span class="operator"> &lt;&lt;</span><span class="string"> "uCatalogPartName = "</span><span class="operator"> &lt;&lt;</span> uCatalogPartName<span class="operator">.</span>ConvertToChar<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> 
              piReferencePart<span class="operator">)
          {</span><span class="flow">

            if</span><span class="operator"> (</span>listOfNodes<span class="operator">.</span>Size<span class="operator">() &gt;=</span><span class="int"> 2</span><span class="operator">)
            {</span>
              spNode<span class="operator"> =</span> listOfNodes<span class="operator">[</span><span class="int">2</span><span class="operator">];</span><span class="flow">

              if</span><span class="operator"> (!!</span>spNode<span class="operator">)</span>
                spNode<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIArrNode<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piNode<span class="operator">);</span>

              cout<span class="operator"> &lt;&lt;</span><span class="string"> "piNode = "</span><span class="operator"> &lt;&lt;</span> piNode<span class="operator"> &lt;&lt;</span> endl<span class="operator">;
            }</span><span class="flow">

            if</span><span class="operator"> (</span>piNode<span class="operator">)
            {</span>

              uFunctionType<span class="operator"> =</span><span class="string"> "CATTubTubeFunction"</span><span class="operator">;</span>
              uPlacedPartID<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span><span class="comment"> // Null string uses name generated by PP engine

</span>              rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>PlacePartOnRunNode<span class="operator">(</span>uStandard<span class="operator">,</span> 
                                                   uFunctionType<span class="operator">,</span> 
                                                   piReferencePart<span class="operator">,</span> 
                                                   piNode<span class="operator">,</span> 
                                                   piLogicalLine<span class="operator">,</span> 
                                                   uPlacedPartID<span class="operator">,</span> 
                                                   piInstancePart<span class="operator">);</span>

              cout<span class="operator"> &lt;&lt;</span><span class="string"> "piInstancePart = "</span><span class="operator"> &lt;&lt;</span> piInstancePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

              if</span><span class="operator"> (</span>piInstancePart<span class="operator">)
              {</span>
              <span class="comment">  // Set catalog part name</span>
                piPlacePart<span class="operator">-&gt;</span>SetCatalogPartName<span class="operator">(</span>piInstancePart<span class="operator">,</span>uCatalogPartName<span class="operator">);</span>
              <span class="comment">
                // Test part connectors.
</span>                ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">500</span><span class="operator">,</span><span class="int">800</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

                ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>
                rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                           1</span><span class="operator">,</span> 
                                           piParentProduct<span class="operator">,</span> 
                                           ctrPosition<span class="operator">,</span> 
                                           ctrAlign<span class="operator">,</span> 
                                           ctrUp<span class="operator">);</span><span class="flow">

                if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                {</span>
                  rc<span class="operator"> =</span> TestConnectedPart<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                         1</span><span class="operator">,</span> 
                                         piInstanceValve<span class="operator">,</span><span class="int"> 
                                         1</span><span class="operator">);</span><span class="flow">

                  if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                  {</span>
                    ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="float">741.3</span><span class="operator">,</span><span class="int">2000</span><span class="operator">,</span><span class="int">1800</span><span class="operator">);</span>

                    ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                    ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,-</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

                    rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                               2</span><span class="operator">,</span> 
                                               piParentProduct<span class="operator">,</span> 
                                               ctrPosition<span class="operator">,</span> 
                                               ctrAlign<span class="operator">,</span> 
                                               ctrUp<span class="operator">);</span><span class="flow">

                    if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                    {</span>
                      rc<span class="operator"> =</span> TestConnectedPart<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                             2</span><span class="operator">,</span> 
                                             piInstanceElbow<span class="operator">,</span><span class="int"> 
                                             1</span><span class="operator">);
                    }</span><span class="comment"> // End if part ctr 2 test succeeded.

</span><span class="operator">                  }</span><span class="comment"> // End if part ctr 1 connected part test succeeded
</span><span class="operator">                }</span><span class="comment"> // End if part ctr 1 test succeeded.
</span><span class="operator">              }</span><span class="flow">
              else</span><span class="operator">
              {</span>

                rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;
              }
            }</span><span class="comment"> // End if valid segment.
</span><span class="operator">          }</span><span class="comment"> // End if valid reference part.
</span><span class="comment">
          // ==============================================================================
          // Test BreakAndTrimRuns and ConnectRunToPart
          // ==============================================================================
	    </span>IUnknown <span class="operator">*</span>opiRun1 <span class="operator">=</span> NULL<span class="operator">;
          </span>IUnknown <span class="operator">*</span>opiRun2 <span class="operator">=</span> NULL<span class="operator">;</span>
	    rc <span class="operator">=</span> piPlacePart<span class="operator">-&gt;</span>BreakAndTrimRuns<span class="operator">(</span>piInstanceElbow<span class="operator">,</span>
                                   	    opiRun1<span class="operator">,</span>
		                                 opiRun2<span class="operator">);</span>
	    cout <span class="operator">&lt;&lt;</span> <span class="string">"BreakAndTrimRuns rc = "</span> <span class="style1">&lt;&lt;</span> rc <span class="style1">&lt;&lt;</span> endl<span class="operator">;</span>

	    rc <span class="operator">=</span> piPlacePart<span class="operator">-&gt;</span>ConnectRunToPart<span class="operator">(</span>opiRun2<span class="operator">,</span>piInstanceElbow<span class="operator">);</span>
	    cout <span class="operator">&lt;&lt;</span> <span class="string">"ConnectRunToPart rc = "</span> <span class="operator">&lt;&lt;</span> rc <span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

	    if (opiRun1) {opiRun1-&gt;Release(); opiRun1 = NULL;}
	    if (opiRun2) {opiRun2-&gt;Release(); opiRun2 = NULL;}

<span class="operator">        }</span><span class="flow"> while</span><span class="operator"> (</span><span class="int">0</span><span class="operator">);</span><span class="comment"> // End dummy loop for easy exit on fail.

</span><span class="operator">      }</span><span class="comment"> // End if valid run.
</span>
<span class="flow">      if</span><span class="operator"> (</span>FAILED<span class="operator">(</span>rc<span class="operator">))
      {</span>

        piPlacePart<span class="operator">-&gt;</span>GetErrorMessage<span class="operator">(</span>uPlacePartErrorMessage<span class="operator">);</span>
        cout<span class="operator"> &lt;&lt;</span><span class="string"> "uPlacePartErrorMessage = "</span><span class="operator"> &lt;&lt;</span> uPlacePartErrorMessage<span class="operator"> &lt;&lt;</span> endl<span class="operator">;
      }</span>
<span class="operator">    }</span><span class="comment"> // End if valid place part object.
</span><span class="operator">  }</span><span class="comment"> // end CATTry
</span>
	CATCatch<span class="operator"> (</span>CATError<span class="operator">,</span> pError<span class="operator">)
	{</span>

    cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::PlacePartOnRunNode *** Error Caught ***"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
    cout<span class="operator"> &lt;&lt;</span> pError<span class="operator">;</span>

    rc<span class="operator"> =</span> CATReturnError<span class="operator">(</span>pError<span class="operator">);
	}</span><span class="comment"> // end CATCatch
</span>
  CATEndTry<span class="operator">;</span><span class="flow">

  if</span><span class="operator"> (</span>piAppObject<span class="operator">) {</span>piAppObject<span class="operator">-&gt;</span>Release<span class="operator">();</span> piAppObject<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPlacePart<span class="operator">) {</span>piPlacePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPlacePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piParentProduct<span class="operator">) {</span>piParentProduct<span class="operator">-&gt;</span>Release<span class="operator">();</span> piParentProduct<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piLogicalLine<span class="operator">) {</span>piLogicalLine<span class="operator">-&gt;</span>Release<span class="operator">();</span> piLogicalLine<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piRun<span class="operator">) {</span>piRun<span class="operator">-&gt;</span>Release<span class="operator">();</span> piRun<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piReferencePart<span class="operator">) {</span>piReferencePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piReferencePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piNode<span class="operator">) {</span>piNode<span class="operator">-&gt;</span>Release<span class="operator">();</span> piNode<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piInstancePart<span class="operator">) {</span>piInstancePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piConnectedPart<span class="operator">) {</span>piConnectedPart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piConnectedPart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piInstanceValve<span class="operator">) {</span>piInstanceValve<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstanceValve<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piInstanceElbow<span class="operator">) {</span>piInstanceElbow<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstanceElbow<span class="operator"> =</span> NULL<span class="operator">;}</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::PlacePartOnRunNode rc = "</span><span class="operator"> &lt;&lt;</span> rc<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">
  return</span> rc<span class="operator">;
}</span></pre>
</div>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Parts on Part Connectors"></a>Parts on Part Connectors</h4>
<p>
  The CAACloPlacePart method PlacePartOnPartConnector places parts on part connectors.
  Again a very similar set up to previous methods is used.
  The method begins by placing a valve in space and then a union on one of the valve connectors.
  The part connector provides all of the position data needed for placement.
  A further example is provided of placing parts on part connectors of parts on runs.
  A valve is placed on Segment 5 of Run-044.
  A union is also placed on this valve.
  After that a sleeve and a nut are stacked on the union as would be necessary to connect a tube to the union.
  When the parts are placed on parts connectors they are connected to the existing part.
  Connector data is tested using the TestPartConnectorData method and the connections are tested with the TestConnectedPart method.
</p>
<div class="code">
<pre><span class="comment">//=============================================================================
//  Place parts on part connectors.
//=============================================================================
</span>HRESULT CAACloPlacePart<span class="operator">::</span>PlacePartOnPartConnector<span class="operator">()
{</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"===       CAACloPlacePart::PlacePartOnPartConnector      ==="</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string">"============================================================"</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>

  HRESULT rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;</span><span class="comment">

  // Interface pointer variables used below in the try section.
</span>  CATObject<span class="operator"> *</span>piAppObject<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIPspPlacePartOnRun<span class="operator"> *</span>piPlacePart<span class="operator"> =</span> NULL<span class="operator">;</span>

  IUnknown<span class="operator"> *</span>piReferencePart<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIProduct<span class="operator"> *</span>piParentProduct<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIPspLogicalLine<span class="operator"> *</span>piLogicalLine<span class="operator"> =</span> NULL<span class="operator">;</span>
  IUnknown<span class="operator"> *</span>piInstancePart<span class="operator"> =</span> NULL<span class="operator">;</span>

  IUnknown<span class="operator"> *</span>piInstancePartPrevious<span class="operator"> =</span> NULL<span class="operator">;</span>
  IUnknown<span class="operator"> *</span>piPlaceOnCtr<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATIArrSegmentsString<span class="operator"> *</span>piRun<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIArrSegment<span class="operator"> *</span>piSegment<span class="operator"> =</span> NULL<span class="operator">;</span>

  CATUnicodeString uCatalogPartName<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span>
  
  CATUnicodeString uPlacePartErrorMessage<span class="operator">;</span>
  CATUnicodeString uStandard<span class="operator"> =</span><span class="string"> "SSTL"</span><span class="operator">;</span>
  CATUnicodeString uSpecName<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span>

  CATUnicodeString uPartType<span class="operator">;</span>
  CATUnicodeString uPartNumber<span class="operator">;</span>
  CATUnicodeString uFunctionType<span class="operator">;</span>
  CATUnicodeString uPlacedPartID<span class="operator">;</span>
  CATMathDirection upDirection<span class="operator">;</span>

  CATMathDirection horizontalOrientation<span class="operator">;</span>
  CATMathPoint position<span class="operator">;</span>
  CATMathPoint ctrPosition<span class="operator">;</span>
  CATMathDirection ctrAlign<span class="operator">;</span>
  CATMathDirection ctrUp<span class="operator">;</span>

  CATListValCATBaseUnknown_var listOfSegments<span class="operator">;</span>
  CATIArrSegment_var spSegment<span class="operator">;</span>

  CATTry<span class="operator"> 
  {</span><span class="comment">
    // Get application object.
</span>    piAppObject<span class="operator"> =</span><span class="keyword"> new</span> CATObject<span class="operator">(</span><span class="string">"CATTubing"</span><span class="operator">);</span>

    cout<span class="operator"> &lt;&lt;</span><span class="string"> "piAppObject = "</span><span class="operator"> &lt;&lt;</span> piAppObject<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

    if</span><span class="operator"> (</span>piAppObject<span class="operator"> &amp;&amp;</span> 
        SUCCEEDED<span class="operator">(</span>piAppObject<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIPspPlacePartOnRun<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piPlacePart<span class="operator">)))
    {</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPlacePart = "</span><span class="operator"> &lt;&lt;</span> piPlacePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

      piParentProduct<span class="operator"> = (</span>CATIProduct<span class="operator">*)</span>GetChildObject<span class="operator">(</span>IID_CATIProduct<span class="operator">,</span><span class="string"> "TubingWP.1"</span><span class="operator">);</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piParentProduct = "</span><span class="operator"> &lt;&lt;</span> piParentProduct<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

      piLogicalLine<span class="operator"> =</span> GetALogicalLine<span class="operator">(</span>piParentProduct<span class="operator">);</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piLogicalLine = "</span><span class="operator"> &lt;&lt;</span> piLogicalLine<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

      piRun<span class="operator"> = (</span>CATIArrSegmentsString<span class="operator">*)</span>GetChildObject<span class="operator">(</span>IID_CATIArrSegmentsString<span class="operator">,</span><span class="string"> "Run-0044"</span><span class="operator">,</span> piParentProduct<span class="operator">);</span>

      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piRun = "</span><span class="operator"> &lt;&lt;</span> piRun<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

      if</span><span class="operator"> (</span>piRun<span class="operator">)
      {</span>

        piRun<span class="operator">-&gt;</span>ListSegments<span class="operator">(</span>listOfSegments<span class="operator">);</span>
        cout<span class="operator"> &lt;&lt;</span><span class="string"> "listOfSegments.Size() = "</span><span class="operator"> &lt;&lt;</span> listOfSegments<span class="operator">.</span>Size<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

        if</span><span class="operator"> (</span>listOfSegments<span class="operator">.</span>Size<span class="operator">() &gt;=</span><span class="int"> 5</span><span class="operator">)
        {</span>
          spSegment<span class="operator"> =</span> listOfSegments<span class="operator">[</span><span class="int">5</span><span class="operator">];</span><span class="flow">

          if</span><span class="operator"> (!!</span>spSegment<span class="operator">)</span>
            spSegment<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIArrSegment<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piSegment<span class="operator">);</span>

          cout<span class="operator"> &lt;&lt;</span><span class="string"> "piSegment = "</span><span class="operator"> &lt;&lt;</span> piSegment<span class="operator"> &lt;&lt;</span> endl<span class="operator">;
        }
      }</span><span class="comment"> // End if valid run.
</span><span class="flow">
      if</span><span class="operator"> (</span>piSegment<span class="operator">)
      {</span><span class="flow">

        do</span><span class="operator">
        {</span><span class="comment"> // Dummy loop to allow easy exit on fail.


          // ==============================================================================
          // Place valve in space.
          // ==============================================================================
          // Get reference part
</span>          uPartType<span class="operator"> =</span><span class="string"> "CATTubControlValve"</span><span class="operator">;</span>
          uPartNumber<span class="operator"> =</span><span class="string"> "V_BALL-TF-16S"</span><span class="operator">;</span>

          rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>GetReferencePartFromCatalog<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                         uSpecName<span class="operator">,</span> 
                                                         uPartType<span class="operator">,</span> 
                                                         uPartNumber<span class="operator">,</span> 
                                                         piParentProduct<span class="operator">,</span> 
                                                         piReferencePart<span class="style1">,</span>
                                                         uCatalogPartName<span class="style1">);</span>

          cout<span class="operator"> &lt;&lt;</span><span class="string"> "piReferencePart = "</span><span class="operator"> &lt;&lt;</span> piReferencePart<span class="operator"> &lt;&lt;</span><span class="string"> "uCatalogPartName = "</span><span class="operator"> &lt;&lt;</span> uCatalogPartName<span class="operator">.</span>ConvertToChar<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> 
              piReferencePart<span class="operator">)
          {</span><span class="comment">

            // Place part in space.
</span>            uFunctionType<span class="operator"> =</span><span class="string"> "CATTubControlValveFunction"</span><span class="operator">;</span>
            uPlacedPartID<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span><span class="comment"> // Null string uses name generated by PP engine

</span>            upDirection<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int"> 0</span><span class="operator">,</span><span class="int"> 1</span><span class="operator">);</span><span class="comment"> // Part up direction parallel to z-axis.
</span>            horizontalOrientation<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span><span class="comment"> // Align part parallel to y-axis.

</span>            position<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1000</span><span class="operator">,</span><span class="int">2000</span><span class="operator">,-</span><span class="int">4000</span><span class="operator">);</span><span class="comment"> // Position part at (1000, 2000, 4000) in mm.
</span>            rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>PlacePartInSpace<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                uFunctionType<span class="operator">,</span> 
                                                piReferencePart<span class="operator">,</span> 
                                                piParentProduct<span class="operator">,</span> 
                                                piLogicalLine<span class="operator">,</span> 
                                                uPlacedPartID<span class="operator">,</span> 
                                                upDirection<span class="operator">,</span> 
                                                horizontalOrientation<span class="operator">,</span> 
                                                position<span class="operator">,</span> 
                                                piInstancePart<span class="operator">);</span>

            cout<span class="operator"> &lt;&lt;</span><span class="string"> "piInstancePart = "</span><span class="operator"> &lt;&lt;</span> piInstancePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

            if</span><span class="operator"> (</span>piInstancePart<span class="operator">)
            {</span>
            <span class="comment">  // Set catalog part name</span>
              piPlacePart<span class="operator">-&gt;</span>SetCatalogPartName<span class="operator">(</span>piInstancePart<span class="operator">,</span>uCatalogPartName<span class="operator">);</span>
            <span class="comment">
              // Test part connectors.
</span>              ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="float">1014.61</span><span class="operator">,</span><span class="int">2000</span><span class="operator">,-</span><span class="int">4000</span><span class="operator">);</span>
              ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

              ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>
              rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                         1</span><span class="operator">,</span> 
                                         piParentProduct<span class="operator">,</span> 
                                         ctrPosition<span class="operator">,</span> 
                                         ctrAlign<span class="operator">,</span> 
                                         ctrUp<span class="operator">);</span><span class="flow">

              if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
              {</span>
                ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="float">985.395</span><span class="operator">,</span><span class="int">2000</span><span class="operator">,-</span><span class="int">4000</span><span class="operator">);</span>

                ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>

                rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                           2</span><span class="operator">,</span> 
                                           piParentProduct<span class="operator">,</span> 
                                           ctrPosition<span class="operator">,</span> 
                                           ctrAlign<span class="operator">,</span> 
                                           ctrUp<span class="operator">);
              }
            }</span><span class="flow">

            else</span><span class="operator">
            {</span>
              rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;
            }
          }</span><span class="flow">
          if</span><span class="operator"> (</span>FAILED<span class="operator">(</span>rc<span class="operator">))</span><span class="flow"> break</span><span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>piInstancePartPrevious<span class="operator">) {</span>piInstancePartPrevious<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePartPrevious<span class="operator"> =</span> NULL<span class="operator">;}</span>

          piInstancePart<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_IUnknown<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piInstancePartPrevious<span class="operator">);</span><span class="flow">
          if</span><span class="operator"> (</span>piReferencePart<span class="operator">) {</span>piReferencePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piReferencePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piInstancePart<span class="operator">) {</span>piInstancePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="comment">

          // ==============================================================================
          // Place union on valve.
          // ==============================================================================
          // Get reference part
</span>          uPartType<span class="operator"> =</span><span class="string"> "TubingUnion"</span><span class="operator">;</span>
          uPartNumber<span class="operator"> =</span><span class="string"> "UNION-BULKHEAD-TMFL-16-16S"</span><span class="operator">;</span>

          rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>GetReferencePartFromCatalog<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                         uSpecName<span class="operator">,</span> 
                                                         uPartType<span class="operator">,</span> 
                                                         uPartNumber<span class="operator">,</span> 
                                                         piParentProduct<span class="operator">,</span> 
                                                         piReferencePart<span class="style1">,</span>
                                                         uCatalogPartName<span class="style1">);</span>

          cout<span class="operator"> &lt;&lt;</span><span class="string"> "piReferencePart = "</span><span class="operator"> &lt;&lt;</span> piReferencePart<span class="operator"> &lt;&lt;</span><span class="string"> "uCatalogPartName = "</span><span class="operator"> &lt;&lt;</span> uCatalogPartName<span class="operator">.</span>ConvertToChar<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> 
              piReferencePart<span class="operator">)
          {</span><span class="comment">

            // Get valve ctr 2.
</span>            rc<span class="operator"> =</span> GetPartConnector<span class="operator">(</span>piInstancePartPrevious<span class="operator">,</span><span class="int"> 
                                  2</span><span class="operator">,</span> 
                                  piPlaceOnCtr<span class="operator">);</span>

            cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPlaceOnCtr = "</span><span class="operator"> &lt;&lt;</span> piPlaceOnCtr<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">

            // Place part on connector.
</span>            uFunctionType<span class="operator"> =</span><span class="string"> "CATTubTubeFunction"</span><span class="operator">;</span>

            uPlacedPartID<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span><span class="comment"> // Null string uses name generated by PP engine
</span>            rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>PlacePartOnPartConnector<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                        uFunctionType<span class="operator">,</span> 
                                                        piReferencePart<span class="operator">,</span> 
                                                        piPlaceOnCtr<span class="operator">,</span> 
                                                        piLogicalLine<span class="operator">,</span> 
                                                        uPlacedPartID<span class="operator">,</span> 
                                                        piInstancePart<span class="operator">);</span>

            cout<span class="operator"> &lt;&lt;</span><span class="string"> "piInstancePart = "</span><span class="operator"> &lt;&lt;</span> piInstancePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

            if</span><span class="operator"> (</span>piInstancePart<span class="operator">)
            {</span>
            <span class="comment">  // Set catalog part name</span>
              piPlacePart<span class="operator">-&gt;</span>SetCatalogPartName<span class="operator">(</span>piInstancePart<span class="operator">,</span>uCatalogPartName<span class="operator">);</span>
            <span class="comment">
              // Test part connectors.
</span>              ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="float">985.395</span><span class="operator">,</span><span class="int">2000</span><span class="operator">,-</span><span class="int">4000</span><span class="operator">);</span>
              ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

              ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>
              rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                         1</span><span class="operator">,</span> 
                                         piParentProduct<span class="operator">,</span> 
                                         ctrPosition<span class="operator">,</span> 
                                         ctrAlign<span class="operator">,</span> 
                                         ctrUp<span class="operator">);</span><span class="flow">

              if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
              {</span>
                rc<span class="operator"> =</span> TestConnectedPart<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                       1</span><span class="operator">,</span> 
                                       piInstancePartPrevious<span class="operator">,</span><span class="int"> 
                                       2</span><span class="operator">);</span><span class="flow">

                if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                {</span>
                  ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="float">905.639</span><span class="operator">,</span><span class="int">2000</span><span class="operator">,-</span><span class="int">4000</span><span class="operator">);</span>

                  ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                  ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>

                  rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                             2</span><span class="operator">,</span> 
                                             piParentProduct<span class="operator">,</span> 
                                             ctrPosition<span class="operator">,</span> 
                                             ctrAlign<span class="operator">,</span> 
                                             ctrUp<span class="operator">);
                }
              }
            }</span><span class="flow">

            else</span><span class="operator">
            {</span>
              rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;
            }
          }</span><span class="flow">
          if</span><span class="operator"> (</span>FAILED<span class="operator">(</span>rc<span class="operator">))</span><span class="flow"> break</span><span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>piInstancePartPrevious<span class="operator">) {</span>piInstancePartPrevious<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePartPrevious<span class="operator"> =</span> NULL<span class="operator">;}</span>
          piInstancePart<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_IUnknown<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piInstancePartPrevious<span class="operator">);</span><span class="flow">
          if</span><span class="operator"> (</span>piReferencePart<span class="operator">) {</span>piReferencePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piReferencePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piInstancePart<span class="operator">) {</span>piInstancePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piPlaceOnCtr<span class="operator">) {</span>piPlaceOnCtr<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPlaceOnCtr<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="comment">

          // ==============================================================================
          // Place valve on run segment.
          // ==============================================================================
          // Get reference part
</span>          uPartType<span class="operator"> =</span><span class="string"> "CATTubControlValve"</span><span class="operator">;</span>
          uPartNumber<span class="operator"> =</span><span class="string"> "V_BALL-TF-16S"</span><span class="operator">;</span>

          rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>GetReferencePartFromCatalog<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                         uSpecName<span class="operator">,</span> 
                                                         uPartType<span class="operator">,</span> 
                                                         uPartNumber<span class="operator">,</span> 
                                                         piParentProduct<span class="operator">,</span> 
                                                         piReferencePart<span class="style1">,</span>
                                                         uCatalogPartName<span class="style1">);</span>

          cout<span class="operator"> &lt;&lt;</span><span class="string"> "piReferencePart = "</span><span class="operator"> &lt;&lt;</span> piReferencePart<span class="operator"> &lt;&lt;</span><span class="string"> "uCatalogPartName = "</span><span class="operator"> &lt;&lt;</span> uCatalogPartName<span class="operator">.</span>ConvertToChar<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> 
              piReferencePart<span class="operator">)
          {</span><span class="comment">

            // Place part on segment.
</span>            uFunctionType<span class="operator"> =</span><span class="string"> "CATTubControlValveFunction"</span><span class="operator">;</span>
            uPlacedPartID<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span><span class="comment"> // Null string uses name generated by PP engine

</span>            position<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">700</span><span class="operator">,</span><span class="int">3000</span><span class="operator">,</span><span class="int">1800</span><span class="operator">);</span><span class="comment"> // in mm.
</span>            rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>PlacePartOnRunSegment<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                     uFunctionType<span class="operator">,</span> 
                                                     piReferencePart<span class="operator">,</span> 
                                                     piSegment<span class="operator">,</span> 
                                                     piLogicalLine<span class="operator">,</span> 
                                                     uPlacedPartID<span class="operator">,</span> 
                                                     position<span class="operator">,</span> 
                                                     piInstancePart<span class="operator">);</span>

            cout<span class="operator"> &lt;&lt;</span><span class="string"> "piInstancePart = "</span><span class="operator"> &lt;&lt;</span> piInstancePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

            if</span><span class="operator"> (</span>piInstancePart<span class="operator">)
            {</span>
            <span class="comment">  // Set catalog part name</span>
              piPlacePart<span class="operator">-&gt;</span>SetCatalogPartName<span class="operator">(</span>piInstancePart<span class="operator">,</span>uCatalogPartName<span class="operator">);</span>
            <span class="comment">
              // Test part connectors.
</span>              ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">700</span><span class="operator">,</span><span class="float">2985.395</span><span class="operator">,</span><span class="int">1800</span><span class="operator">);</span>
              ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,-</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

              ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
              rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                         1</span><span class="operator">,</span> 
                                         piParentProduct<span class="operator">,</span> 
                                         ctrPosition<span class="operator">,</span> 
                                         ctrAlign<span class="operator">,</span> 
                                         ctrUp<span class="operator">);</span><span class="flow">

              if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
              {</span>
                ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">700</span><span class="operator">,</span><span class="float">3014.61</span><span class="operator">,</span><span class="int">1800</span><span class="operator">);</span>

                ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

                rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                           2</span><span class="operator">,</span> 
                                           piParentProduct<span class="operator">,</span> 
                                           ctrPosition<span class="operator">,</span> 
                                           ctrAlign<span class="operator">,</span> 
                                           ctrUp<span class="operator">);
              }
            }</span><span class="flow">

            else</span><span class="operator">
            {</span>
              rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;
            }
          }</span><span class="flow">
          if</span><span class="operator"> (</span>FAILED<span class="operator">(</span>rc<span class="operator">))</span><span class="flow"> break</span><span class="operator">;</span><span class="flow">
          if</span><span class="operator"> (</span>piInstancePartPrevious<span class="operator">) {</span>piInstancePartPrevious<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePartPrevious<span class="operator"> =</span> NULL<span class="operator">;}</span>

          piInstancePart<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_IUnknown<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piInstancePartPrevious<span class="operator">);</span><span class="flow">
          if</span><span class="operator"> (</span>piReferencePart<span class="operator">) {</span>piReferencePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piReferencePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piInstancePart<span class="operator">) {</span>piInstancePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="comment">

          // ==============================================================================
          // Place union on valve on run.
          // ==============================================================================
          // Get reference part
</span>          uPartType<span class="operator"> =</span><span class="string"> "TubingUnion"</span><span class="operator">;</span>
          uPartNumber<span class="operator"> =</span><span class="string"> "UNION-BULKHEAD-TMFL-16-16S"</span><span class="operator">;</span>

          rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>GetReferencePartFromCatalog<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                         uSpecName<span class="operator">,</span> 
                                                         uPartType<span class="operator">,</span> 
                                                         uPartNumber<span class="operator">,</span> 
                                                         piParentProduct<span class="operator">,</span> 
                                                         piReferencePart<span class="style1">,</span>
                                                         uCatalogPartName<span class="style1">);</span>

          cout<span class="operator"> &lt;&lt;</span><span class="string"> "piReferencePart = "</span><span class="operator"> &lt;&lt;</span> piReferencePart<span class="operator"> &lt;&lt;</span><span class="string"> "uCatalogPartName = "</span><span class="operator"> &lt;&lt;</span> uCatalogPartName<span class="operator">.</span>ConvertToChar<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> 
              piReferencePart<span class="operator">)
          {</span><span class="comment">

            // Get valve ctr 2.
</span>            rc<span class="operator"> =</span> GetPartConnector<span class="operator">(</span>piInstancePartPrevious<span class="operator">,</span><span class="int"> 
                                  2</span><span class="operator">,</span> 
                                  piPlaceOnCtr<span class="operator">);</span>

            cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPlaceOnCtr = "</span><span class="operator"> &lt;&lt;</span> piPlaceOnCtr<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">

            // Place part on connector.
</span>            uFunctionType<span class="operator"> =</span><span class="string"> "CATTubTubeFunction"</span><span class="operator">;</span>

            uPlacedPartID<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span><span class="comment"> // Null string uses name generated by PP engine
</span>            rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>PlacePartOnPartConnector<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                        uFunctionType<span class="operator">,</span> 
                                                        piReferencePart<span class="operator">,</span> 
                                                        piPlaceOnCtr<span class="operator">,</span> 
                                                        piLogicalLine<span class="operator">,</span> 
                                                        uPlacedPartID<span class="operator">,</span> 
                                                        piInstancePart<span class="operator">);</span>

            cout<span class="operator"> &lt;&lt;</span><span class="string"> "piInstancePart = "</span><span class="operator"> &lt;&lt;</span> piInstancePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

            if</span><span class="operator"> (</span>piInstancePart<span class="operator">)
            {</span>
            <span class="comment">  // Set catalog part name</span>
              piPlacePart<span class="operator">-&gt;</span>SetCatalogPartName<span class="operator">(</span>piInstancePart<span class="operator">,</span>uCatalogPartName<span class="operator">);</span>
            <span class="comment">
              // Test part connectors.
</span>              ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">700</span><span class="operator">,</span><span class="float">3014.61</span><span class="operator">,</span><span class="int">1800</span><span class="operator">);</span>
              ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,-</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

              ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
              rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                         1</span><span class="operator">,</span> 
                                         piParentProduct<span class="operator">,</span> 
                                         ctrPosition<span class="operator">,</span> 
                                         ctrAlign<span class="operator">,</span> 
                                         ctrUp<span class="operator">);</span><span class="flow">

              if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
              {</span>
                rc<span class="operator"> =</span> TestConnectedPart<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                       1</span><span class="operator">,</span> 
                                       piInstancePartPrevious<span class="operator">,</span><span class="int"> 
                                       2</span><span class="operator">);</span><span class="flow">

                if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                {</span>
                  ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">700</span><span class="operator">,</span><span class="float">3094.366</span><span class="operator">,</span><span class="int">1800</span><span class="operator">);</span>

                  ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                  ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

                  rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                             2</span><span class="operator">,</span> 
                                             piParentProduct<span class="operator">,</span> 
                                             ctrPosition<span class="operator">,</span> 
                                             ctrAlign<span class="operator">,</span> 
                                             ctrUp<span class="operator">);
                }
              }
            }</span><span class="flow">

            else</span><span class="operator">
            {</span>
              rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;
            }
          }</span><span class="flow">
          if</span><span class="operator"> (</span>FAILED<span class="operator">(</span>rc<span class="operator">))</span><span class="flow"> break</span><span class="operator">;</span><span class="flow">
          if</span><span class="operator"> (</span>piInstancePartPrevious<span class="operator">) {</span>piInstancePartPrevious<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePartPrevious<span class="operator"> =</span> NULL<span class="operator">;}</span>

          piInstancePart<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_IUnknown<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piInstancePartPrevious<span class="operator">);</span><span class="flow">
          if</span><span class="operator"> (</span>piReferencePart<span class="operator">) {</span>piReferencePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piReferencePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piInstancePart<span class="operator">) {</span>piInstancePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piPlaceOnCtr<span class="operator">) {</span>piPlaceOnCtr<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPlaceOnCtr<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="comment">

          // ==============================================================================
          // Place sleeve on union.
          // ==============================================================================
          // Get reference part
</span>          uPartType<span class="operator"> =</span><span class="string"> "TubingBNutSleeve"</span><span class="operator">;</span>
          uPartNumber<span class="operator"> =</span><span class="string"> "SLEEVE-CSFR-16S"</span><span class="operator">;</span>

          rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>GetReferencePartFromCatalog<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                         uSpecName<span class="operator">,</span> 
                                                         uPartType<span class="operator">,</span> 
                                                         uPartNumber<span class="operator">,</span> 
                                                         piParentProduct<span class="operator">,</span> 
                                                         piReferencePart<span class="style1">,</span>
                                                         uCatalogPartName<span class="style1">);</span>

          cout<span class="operator"> &lt;&lt;</span><span class="string"> "piReferencePart = "</span><span class="operator"> &lt;&lt;</span> piReferencePart<span class="operator"> &lt;&lt;</span><span class="string"> "uCatalogPartName = "</span><span class="operator"> &lt;&lt;</span> uCatalogPartName<span class="operator">.</span>ConvertToChar<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> 
              piReferencePart<span class="operator">)
          {</span><span class="comment">

            // Get union ctr 2.
</span>            rc<span class="operator"> =</span> GetPartConnector<span class="operator">(</span>piInstancePartPrevious<span class="operator">,</span><span class="int"> 
                                  2</span><span class="operator">,</span> 
                                  piPlaceOnCtr<span class="operator">);</span>

            cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPlaceOnCtr = "</span><span class="operator"> &lt;&lt;</span> piPlaceOnCtr<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">

            // Place part on connector.
</span>            uFunctionType<span class="operator"> =</span><span class="string"> "CATTubTubeFunction"</span><span class="operator">;</span>

            uPlacedPartID<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span><span class="comment"> // Null string uses name generated by PP engine
</span>            rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>PlacePartOnPartConnector<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                        uFunctionType<span class="operator">,</span> 
                                                        piReferencePart<span class="operator">,</span> 
                                                        piPlaceOnCtr<span class="operator">,</span> 
                                                        piLogicalLine<span class="operator">,</span> 
                                                        uPlacedPartID<span class="operator">,</span> 
                                                        piInstancePart<span class="operator">);</span>

            cout<span class="operator"> &lt;&lt;</span><span class="string"> "piInstancePart = "</span><span class="operator"> &lt;&lt;</span> piInstancePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

            if</span><span class="operator"> (</span>piInstancePart<span class="operator">)
            {</span>
            <span class="comment">  // Set catalog part name</span>
              piPlacePart<span class="operator">-&gt;</span>SetCatalogPartName<span class="operator">(</span>piInstancePart<span class="operator">,</span>uCatalogPartName<span class="operator">);</span>
            <span class="comment">
              // Test part connectors.
</span>              ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">700</span><span class="operator">,</span><span class="float">3094.366</span><span class="operator">,</span><span class="int">1800</span><span class="operator">);</span>
              ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,-</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

              ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
              rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                         1</span><span class="operator">,</span> 
                                         piParentProduct<span class="operator">,</span> 
                                         ctrPosition<span class="operator">,</span> 
                                         ctrAlign<span class="operator">,</span> 
                                         ctrUp<span class="operator">);</span><span class="flow">

              if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
              {</span>
                rc<span class="operator"> =</span> TestConnectedPart<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                       1</span><span class="operator">,</span> 
                                       piInstancePartPrevious<span class="operator">,</span><span class="int"> 
                                       2</span><span class="operator">);</span><span class="flow">

                if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                {</span>
                  ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">700</span><span class="operator">,</span><span class="float">3094.366</span><span class="operator">,</span><span class="int">1800</span><span class="operator">);</span>

                  ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                  ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

                  rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                             2</span><span class="operator">,</span> 
                                             piParentProduct<span class="operator">,</span> 
                                             ctrPosition<span class="operator">,</span> 
                                             ctrAlign<span class="operator">,</span> 
                                             ctrUp<span class="operator">);
                }
              }
            }</span><span class="flow">

            else</span><span class="operator">
            {</span>
              rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;
            }
          }</span><span class="flow">
          if</span><span class="operator"> (</span>FAILED<span class="operator">(</span>rc<span class="operator">))</span><span class="flow"> break</span><span class="operator">;</span><span class="flow">
          if</span><span class="operator"> (</span>piInstancePartPrevious<span class="operator">) {</span>piInstancePartPrevious<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePartPrevious<span class="operator"> =</span> NULL<span class="operator">;}</span>

          piInstancePart<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_IUnknown<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piInstancePartPrevious<span class="operator">);</span><span class="flow">
          if</span><span class="operator"> (</span>piReferencePart<span class="operator">) {</span>piReferencePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piReferencePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piInstancePart<span class="operator">) {</span>piInstancePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piPlaceOnCtr<span class="operator">) {</span>piPlaceOnCtr<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPlaceOnCtr<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="comment">

          // ==============================================================================
          // Place nut on sleeve.
          // ==============================================================================
          // Get reference part
</span>          uPartType<span class="operator"> =</span><span class="string"> "TubingNut"</span><span class="operator">;</span>
          uPartNumber<span class="operator"> =</span><span class="string"> "B-NUT-CSFR-16S"</span><span class="operator">;</span>

          rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>GetReferencePartFromCatalog<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                         uSpecName<span class="operator">,</span> 
                                                         uPartType<span class="operator">,</span> 
                                                         uPartNumber<span class="operator">,</span> 
                                                         piParentProduct<span class="operator">,</span> 
                                                         piReferencePart<span class="style1">,</span>
                                                         uCatalogPartName<span class="style1">);</span>

          cout<span class="operator"> &lt;&lt;</span><span class="string"> "piReferencePart = "</span><span class="operator"> &lt;&lt;</span> piReferencePart<span class="operator"> &lt;&lt;</span><span class="string"> "uCatalogPartName = "</span><span class="operator"> &lt;&lt;</span> uCatalogPartName<span class="operator">.</span>ConvertToChar<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> 
              piReferencePart<span class="operator">)
          {</span><span class="comment">

            // Get sleeve ctr 2.
</span>            rc<span class="operator"> =</span> GetPartConnector<span class="operator">(</span>piInstancePartPrevious<span class="operator">,</span><span class="int"> 
                                  2</span><span class="operator">,</span> 
                                  piPlaceOnCtr<span class="operator">);</span>

            cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPlaceOnCtr = "</span><span class="operator"> &lt;&lt;</span> piPlaceOnCtr<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">

            // Place part on connector.
</span>            uFunctionType<span class="operator"> =</span><span class="string"> "CATTubTubeFunction"</span><span class="operator">;</span>

            uPlacedPartID<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span><span class="comment"> // Null string uses name generated by PP engine
</span>            rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>PlacePartOnPartConnector<span class="operator"> (</span>uStandard<span class="operator">,</span> 
                                                        uFunctionType<span class="operator">,</span> 
                                                        piReferencePart<span class="operator">,</span> 
                                                        piPlaceOnCtr<span class="operator">,</span> 
                                                        piLogicalLine<span class="operator">,</span> 
                                                        uPlacedPartID<span class="operator">,</span> 
                                                        piInstancePart<span class="operator">);</span>

            cout<span class="operator"> &lt;&lt;</span><span class="string"> "piInstancePart = "</span><span class="operator"> &lt;&lt;</span> piInstancePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

            if</span><span class="operator"> (</span>piInstancePart<span class="operator">)
            {</span>
            <span class="comment">  // Set catalog part name</span>
              piPlacePart<span class="operator">-&gt;</span>SetCatalogPartName<span class="operator">(</span>piInstancePart<span class="operator">,</span>uCatalogPartName<span class="operator">);</span>
            <span class="comment">
              // Test part connectors.
</span>              ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">700</span><span class="operator">,</span><span class="float">3094.366</span><span class="operator">,</span><span class="int">1800</span><span class="operator">);</span>
              ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,-</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

              ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
              rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                         1</span><span class="operator">,</span> 
                                         piParentProduct<span class="operator">,</span> 
                                         ctrPosition<span class="operator">,</span> 
                                         ctrAlign<span class="operator">,</span> 
                                         ctrUp<span class="operator">);</span><span class="flow">

              if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
              {</span>
                rc<span class="operator"> =</span> TestConnectedPart<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                       1</span><span class="operator">,</span> 
                                       piInstancePartPrevious<span class="operator">,</span><span class="int"> 
                                       2</span><span class="operator">);</span><span class="flow">

                if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
                {</span>
                  ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">700</span><span class="operator">,</span><span class="float">3094.366</span><span class="operator">,</span><span class="int">1800</span><span class="operator">);</span>

                  ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                  ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>

                  rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                             2</span><span class="operator">,</span> 
                                             piParentProduct<span class="operator">,</span> 
                                             ctrPosition<span class="operator">,</span> 
                                             ctrAlign<span class="operator">,</span> 
                                             ctrUp<span class="operator">);
                }
              }
            }</span><span class="flow">

            else</span><span class="operator">
            {</span>
              rc<span class="operator"> =</span> CATReturnFailure<span class="operator">;
            }
          }</span><span class="flow">
          if</span><span class="operator"> (</span>FAILED<span class="operator">(</span>rc<span class="operator">))</span><span class="flow"> break</span><span class="operator">;</span><span class="flow">

          if</span><span class="operator"> (</span>piInstancePartPrevious<span class="operator">) {</span>piInstancePartPrevious<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePartPrevious<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piReferencePart<span class="operator">) {</span>piReferencePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piReferencePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piInstancePart<span class="operator">) {</span>piInstancePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
          if</span><span class="operator"> (</span>piPlaceOnCtr<span class="operator">) {</span>piPlaceOnCtr<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPlaceOnCtr<span class="operator"> =</span> NULL<span class="operator">;}

        }</span><span class="flow"> while</span><span class="operator"> (</span><span class="int">0</span><span class="operator">);</span><span class="comment"> // End dummy loop for easy exit on fail.

</span><span class="operator">      }</span><span class="comment"> // End if valid run segment.
</span>
<span class="flow">      if</span><span class="operator"> (</span>FAILED<span class="operator">(</span>rc<span class="operator">))
      {</span>

        piPlacePart<span class="operator">-&gt;</span>GetErrorMessage<span class="operator">(</span>uPlacePartErrorMessage<span class="operator">);</span>
        cout<span class="operator"> &lt;&lt;</span><span class="string"> "uPlacePartErrorMessage = "</span><span class="operator"> &lt;&lt;</span> uPlacePartErrorMessage<span class="operator"> &lt;&lt;</span> endl<span class="operator">;
      }</span>
<span class="operator">    }</span><span class="comment"> // End if valid place part object.
</span><span class="operator">  }</span><span class="comment"> // end CATTry
</span>
	CATCatch<span class="operator"> (</span>CATError<span class="operator">,</span> pError<span class="operator">)
	{</span>

    cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::PlacePartInSpace *** Error Caught ***"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>
    cout<span class="operator"> &lt;&lt;</span> pError<span class="operator">;</span>

    rc<span class="operator"> =</span> CATReturnError<span class="operator">(</span>pError<span class="operator">);
	}</span><span class="comment"> // end CATCatch
</span>
  CATEndTry<span class="operator">;</span><span class="flow">

  if</span><span class="operator"> (</span>piAppObject<span class="operator">) {</span>piAppObject<span class="operator">-&gt;</span>Release<span class="operator">();</span> piAppObject<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPlacePart<span class="operator">) {</span>piPlacePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPlacePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piReferencePart<span class="operator">) {</span>piReferencePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piReferencePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piParentProduct<span class="operator">) {</span>piParentProduct<span class="operator">-&gt;</span>Release<span class="operator">();</span> piParentProduct<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piLogicalLine<span class="operator">) {</span>piLogicalLine<span class="operator">-&gt;</span>Release<span class="operator">();</span> piLogicalLine<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piInstancePart<span class="operator">) {</span>piInstancePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piInstancePartPrevious<span class="operator">) {</span>piInstancePartPrevious<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePartPrevious<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piPlaceOnCtr<span class="operator">) {</span>piPlaceOnCtr<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPlaceOnCtr<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piRun<span class="operator">) {</span>piRun<span class="operator">-&gt;</span>Release<span class="operator">();</span> piRun<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">
  if</span><span class="operator"> (</span>piSegment<span class="operator">) {</span>piSegment<span class="operator">-&gt;</span>Release<span class="operator">();</span> piSegment<span class="operator"> =</span> NULL<span class="operator">;}</span>

  cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::PlacePartOnPartConnector rc = "</span><span class="operator"> &lt;&lt;</span> rc<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">
  return</span> rc<span class="operator">;
}</span></pre>
</div>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Place part on part connector and reconnect run to the placed part."></a>Place part on part connector and reconnect run to the placed part.</h4>
<p>
  The CAACloPlacePart method PlacePartOnPartConnectorAndReconnectRun() places part on part connectors and reconnects the run to the placed part. Again a very similar set up to previous methods is used. The part connector provides all of the position data needed for placement. Here the last argument to PlacePartOnPartConnector function is true (i.e. 1) 
	and ipiconnector (second connector of the valve) is not connected to the run. As a result, union is placed on the second connector of the valve, Run is broken and both old and new runs are then connected to the placed part (union). Connector data is tested using the TestPartConnectorData method and the connections are tested with the TestConnectedPart method. 
   
</p>
<div class="code">
<pre><span class="comment">//=============================================================================
//  Place part on part connector and reconnect run to the placed part. 
//=============================================================================
</span>HRESULT CAACloPlacePart<span class="operator">::</span>PlacePartOnPartConnectorAndReconnectRun<span class="operator">()
{</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"===================================================================="</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string">"===   CAACloPlacePart::PlacePartOnPartConnectorAndReconnectRun   ==="</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>  
  cout<span class="operator"> &lt;&lt;</span><span class="string">"===================================================================="</span><span class="operator">&lt;&lt;</span> endl<span class="operator">;</span>
  HRESULT rc<span class="operator"> =</span> E_FAIL<span class="operator">;</span><span class="comment"></span>

  
  CATObject<span class="operator"> *</span>piAppObject<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIPspLogicalLine<span class="operator"> *</span>piLogicalLine<span class="operator"> =</span> NULL<span class="operator">;</span>  
  CATIPspPlacePartOnRun<span class="operator"> *</span>piPlacePart<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIProduct<span class="operator"> *</span>piParentProduct<span class="operator"> =</span> NULL<span class="operator">;</span>
  CATIProduct<span class="operator"> *</span>piValve<span class="operator"> =</span> NULL<span class="operator">;</span>  
  IUnknown<span class="operator"> *</span>pUnkPart<span class="operator"> =</span> NULL<span class="operator">;</span>  
  IUnknown<span class="operator"> *</span>piReferencePart<span class="operator"> =</span> NULL<span class="operator">;</span>
  IUnknown<span class="operator"> *</span>piInstancePart<span class="operator"> =</span> NULL<span class="operator">;</span>
  IUnknown<span class="operator"> *</span>piPlaceOnCtr<span class="operator"> =</span> NULL<span class="operator">;</span>


  CATUnicodeString uStandard<span class="operator"> =</span><span class="string"> "SSTL"</span><span class="operator">;</span>
  CATUnicodeString uSpecName<span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span>
  CATUnicodeString uPartType<span class="operator">;</span>
  CATUnicodeString uPartNumber<span class="operator">;</span>  
  CATUnicodeString uCatalogPartName <span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span>
  CATMathPoint ctrPosition<span class="operator">;</span>
  CATMathDirection ctrAlign<span class="operator">;</span>
  CATMathDirection ctrUp<span class="operator">;</span>
    
  CATTry<span class="operator"> 
  {</span><span class="comment">	
    // Get application object.
   </span> piAppObject<span class="operator"> =</span><span class="keyword"> new</span> CATObject<span class="operator">(</span><span class="string">"CATTubing"</span><span class="operator">);</span>
  
    cout<span class="operator"> &lt;&lt;</span><span class="string"> "piAppObject = "</span><span class="operator"> &lt;&lt;</span> piAppObject<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

    if</span><span class="operator"> (</span>piAppObject<span class="operator"> &amp;&amp;</span>  
              SUCCEEDED<span class="operator">(</span>piAppObject<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_CATIPspPlacePartOnRun<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>piPlacePart<span class="operator">)))
    {</span>
      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPlacePart = "</span><span class="operator"> &lt;&lt;</span> piPlacePart<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>   

      piParentProduct<span class="operator"> = (</span>CATIProduct<span class="operator">*)</span>GetChildObject<span class="operator">(</span>IID_CATIProduct<span class="operator">,</span><span class="string"> "TubingWP.1"</span><span class="operator">);</span>
      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piParentProduct = "</span><span class="operator"> &lt;&lt;</span> piParentProduct<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

      piLogicalLine<span class="operator"> =</span> GetALogicalLine<span class="operator">(</span>piParentProduct<span class="operator">);</span>
      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piLogicalLine = "</span><span class="operator"> &lt;&lt;</span> piLogicalLine<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>

      piValve<span class="operator"> = (</span>CATIProduct<span class="operator">*)</span>GetChildObject<span class="operator">(</span>IID_CATIProduct<span class="operator">,</span><span class="string"> "T-001"</span><span class="operator">,</span> piParentProduct<span class="operator">);</span> 
     
      cout<span class="operator"> &lt;&lt;</span><span class="string"> "piValve = "</span><span class="operator"> &lt;&lt;</span> piValve<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">

      if</span><span class="operator"> (</span>piValve<span class="operator">)
      {</span>
       piValve<span class="operator">-&gt;</span>QueryInterface<span class="operator">(</span>IID_IUnknown<span class="operator">,(</span><span class="type">void</span><span class="operator">**)&amp;</span>pUnkPart<span class="operator">);</span>
       <span class="comment"> // Get reference part </span>
       uPartType<span class="operator"> =</span><span class="string"> "TubingUnion"</span><span class="operator">;</span>
       uPartNumber<span class="operator"> =</span><span class="string"> "UNION-BULKHEAD-TMFL-12-16S"</span><span class="operator">;</span>
       piParentProduct<span class="operator"> =</span> piValve<span class="operator">-&gt;</span>GetFatherProduct<span class="style1">();</span>
       rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>GetReferencePartFromCatalog<span class="operator"> (</span>uStandard<span class="operator">,</span>        
                                                      uSpecName<span class="operator">,</span> 
                                                      uPartType<span class="operator">,</span>  
                                                      uPartNumber<span class="operator">,</span> 
                                                      piParentProduct<span class="operator">,</span>  
                                                      piReferencePart<span class="style1">,</span> 
                                                      uCatalogPartName<span class="style1">);</span>

        cout<span class="operator"> &lt;&lt;</span><span class="string"> "piReferencePart = "</span><span class="operator"> &lt;&lt;</span> piReferencePart<span class="operator"> &lt;&lt;</span><span class="string"> "uCatalogPartName = "</span><span class="operator"> &lt;&lt;</span> uCatalogPartName<span class="operator">.</span>ConvertToChar<span class="operator">() &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">
        if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> 
          piReferencePart<span class="operator">)
        { </span><span class="comment"> </span>        
         
          rc<span class="operator"> =</span> GetPartConnector<span class="operator">(</span>piInstancePartPrevious<span class="operator">,</span><span class="int"> 
                                  2</span><span class="operator">,</span> 
                                  piPlaceOnCtr<span class="operator">);</span>
          cout<span class="operator"> &lt;&lt;</span><span class="string"> "piPlaceOnCtr = "</span><span class="operator"> &lt;&lt;</span> piPlaceOnCtr<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="comment">
          // Place part on connector.
</span>          CATUnicodeString uFunctionType<span class="operator"> =</span><span class="string"> "CATTubTubeFunction"</span><span class="operator">;</span>
        
          CATUnicodeString uPlacedPartID <span class="operator"> =</span><span class="string"> ""</span><span class="operator">;</span><span class="comment"> // Null string uses name generated by PP engine
          
</span>          rc<span class="operator"> =</span> piPlacePart<span class="operator">-&gt;</span>PlacePartOnPartConnector<span class="operator"> (</span>uStandard<span class="operator">,</span>
                                                      uFunctionType<span class="operator">,</span> 
                                                      piReferencePart<span class="operator">,</span>  
                                                      piPlaceOnCtr<span class="operator">,</span>  
                                                      piLogicalLine<span class="operator">,</span> 
                                                      uPlacedPartID<span class="operator">,</span> 
                                                      piInstancePart<span class="operator">,</span>
                                                      1<span class="operator">);</span>
                                                      <span class="flow">
          if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">) &amp;&amp;</span> 
              piInstancePart<span class="operator">)
          {</span><span class="comment">
            // Set catalog part name</span>
            piPlacePart<span class="operator">-&gt;</span>SetCatalogPartName<span class="operator">(</span>piInstancePart<span class="operator">,</span>uCatalogPartName<span class="operator">);</span>
            <span class="comment">
            // Test part connectors.</span>
            ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">646.329</span><span class="operator">,</span><span class="float">1587.59</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>            
            ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(-</span><span class="int">0.05</span><span class="operator">,-</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
            ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">1</span><span class="operator">);</span>
            rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int">
                                       2</span><span class="operator">,</span> 
                                       piParentProduct<span class="operator">,</span>  
                                       ctrPosition<span class="operator">,</span>  
                                       ctrAlign<span class="operator">,</span> 
                                       ctrUp<span class="operator">);</span><span class="flow">
            if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
            {</span>
              rc<span class="operator"> =</span> TestConnectedPart<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                       2</span><span class="operator">,</span> 
                                       pUnkPart<span class="operator">,</span><span class="int"> 
                                       2</span><span class="operator">);</span><span class="flow">
             if</span><span class="operator"> (</span>SUCCEEDED<span class="operator">(</span>rc<span class="operator">))
              {</span>
                ctrPosition<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">651.013</span><span class="operator">,</span><span class="float">1667.21</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                ctrAlign<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">0.05</span><span class="operator">,</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                ctrUp<span class="operator">.</span>SetCoord<span class="operator">(</span><span class="int">1</span><span class="operator">,</span><span class="int">0</span><span class="operator">,</span><span class="int">0</span><span class="operator">);</span>
                rc<span class="operator"> =</span> TestPartConnectorData<span class="operator">(</span>piInstancePart<span class="operator">,</span><span class="int"> 
                                           1</span><span class="operator">,</span> 
                                           piParentProduct<span class="operator">,</span>  
                                           ctrPosition<span class="operator">,</span>  
                                           ctrAlign<span class="operator">,</span> 
                                           ctrUp<span class="operator">);
              }
            }
          }
        }          
      }       
    }
  }</span><span class="comment"> // end CATTry
</span>
 CATCatch<span class="operator"> (</span>CATError<span class="operator">,</span> pError<span class="operator">)
 {</span>
     cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::PlacePartOnPartConnectorAndReconnectRun *** Error Caught ***"</span><span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span>    
     cout<span class="operator"> &lt;&lt;</span> pError<span class="operator">;</span>
     rc<span class="operator"> =</span> CATReturnError<span class="operator">(</span>pError<span class="operator">);
 }</span><span class="comment"> // end CATCatch
</span>
CATEndTry<span class="operator">;</span><span class="flow">  

  if</span><span class="operator"> (</span>piInstancePart<span class="operator">) {</span>piInstancePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piInstancePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">  
  if</span><span class="operator"> (</span>piPlaceOnCtr<span class="operator">) {</span>piPlaceOnCtr<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPlaceOnCtr<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">  
  if</span><span class="operator"> (</span>piReferencePart<span class="operator">) {</span>piReferencePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piReferencePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">  
  if</span><span class="operator"> (</span>pUnkPart<span class="operator">) {</span>pUnkPart<span class="operator">-&gt;</span>Release<span class="operator">();</span> pUnkPart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">  
  if</span><span class="operator"> (</span>piValve<span class="operator">) {</span>piValve<span class="operator">-&gt;</span>Release<span class="operator">();</span> piValve<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">  
  if</span><span class="operator"> (</span>piLogicalLine<span class="operator">) {</span>piLogicalLine<span class="operator">-&gt;</span>Release<span class="operator">();</span> piLogicalLine<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">  
  if</span><span class="operator"> (</span>piParentProduct<span class="operator">) {</span>piParentProduct<span class="operator">-&gt;</span>Release<span class="operator">();</span> piParentProduct<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">  
  if</span><span class="operator"> (</span>piPlacePart<span class="operator">) {</span>piPlacePart<span class="operator">-&gt;</span>Release<span class="operator">();</span> piPlacePart<span class="operator"> =</span> NULL<span class="operator">;}</span><span class="flow">  
  if</span><span class="operator"> (</span>piAppObject<span class="operator">) {</span>piAppObject<span class="operator">-&gt;</span>Release<span class="operator">();</span> piAppObject<span class="operator"> =</span> NULL<span class="operator">;}</span>
  cout<span class="operator"> &lt;&lt;</span><span class="string"> "CAACloPlacePart::PlacePartOnPartConnectorAndReconnectRun rc = "</span><span class="operator"> &lt;&lt;</span> rc<span class="operator"> &lt;&lt;</span> endl<span class="operator">;</span><span class="flow">
  return</span> rc<span class="operator">;
}</span></pre>
</div>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="InShort"></a>In Short</h3>
<p>
  This use case has demonstrated how to use the CATIPspPlacePartOnRun interface to place parts in various situations. 
  Specifically, it has illustrated how to:
</p>
<ul>
  <li>Initialize the CATIA product environment and tubing application.</li>
  <li>Place non-string and string parts in space.</li>
  <li>Place parts on run segments.</li>
  <li>Place parts on run nodes.</li>
  <li>Place parts on part connectors.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td valign="top"><a name="Reference 1"></a>[1]</td>
    <td><a href="../CAADocUseCases/CAADocRunSample.htm">
    Building and Launching a CAA V5 Use Case</a></td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="Footnotes"></a>Footnotes</h3>
<table width="100%">
  <tr>
    <td valign="top">
      <a name="Footnote 1"></a>1. This documents uses Unix-style forward slash (/) to separate directory names. 
         Windows users should use backslash (\) instead of forward slash (/).
    </td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <strong>1</strong>   [January 2008]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<p><i>Copyright  2008, Dassault Systmes. All rights reserved.</i></p>

</body>

</html>
