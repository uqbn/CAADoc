<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
<title>Displaying cgr Files</title>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>3D PLM Enterprise Architecture</h1>
    </td>
    <td valign="top">
      <h2>3D Visualization</h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>Displaying cgr Files</h3>
      <em>Opening a cgr file and displaying it in a viewer</em></td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This article discusses the CAAVisBasics use case. This use case
      explains how to open a cgr file and to display it in a viewer.
      <ul>
        <li><a href="#Learn"><strong>What You Will Learn With This Use Case</strong></a></li>
        <li><a href="#UseCase"><strong>The CAAVisBasics Use Case</strong></a>
          <ul>
            <li><a href="#What">What Does CAAVisBasics Do</a></li>
            <li><a href="#How">How to Launch CAAVisBasics</a></li>
            <li><a href="#Where">Where to Find the CAAVisBasics Code</a></li>
          </ul>
        </li>
        <li><a href="#Step"><strong>Step-by-Step</strong></a></li>
        <li><a href="#InShort"><strong>In Short</strong></a></li>
        <li><a href="#References"><strong>References</strong></a></li>
      </ul>
    </td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>This use case is intended to open a cgr file read from the disk and to
display it in a 3D navigation viewer.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="UseCase"></a>The CAAVisBasics Use Case</h3>
<p>CAAVisBasics is a set of use cases of the CAAVisualization.edu framework that
illustrates Vizualization framework capabilities.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="What"></a>What Does CAAVisBasics Do</h4>
<p>CAAVisBasics is an MDI interactive application that displays viewers in its
document windows. One of these viewers is dedicated to display a cgr file
selected using the File Open command in the file selection box. This article
focuses on the way this cgr file is displayed.</p>
<p>The cubes.cgr file is selected and read from disk and displayed in a 3D
navigation viewer.</p>
<p><img border="0" src="images/CAAVisSampleCGRFile.jpg" width="466" height="456"></p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="How"></a>How to Launch CAAVisBasics</h4>
<p>To launch CAAVisBasics, you will need to set up the build time environment,
then compile CAAVisBasics along with its prerequisites, set up the run time
environment, and then execute the sample [<a href="#References">1</a>]. When you
have launched CAAVisBasics, the following is displayed.</p>
<p><img border="0" src="images/CAAVisSampleCGRFile1.jpg" width="620" height="625"></p>
<p>Then point <b>File</b>, and click <b>Open</b>. In the <b>Select a CGR File</b>
dialog box, select the resources\graphic\cgr directory in the run time view, and
click the <b>CUBES.cgr</b> file that displays the cgr file with the cubes.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Where"></a>Where to Find the CAAVisBasics Code</h4>
<p>CAAVisBasics code is located in the CAAVisBasics.m use case module of the
CAAVisualization.edu framework:</p>
<table>
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAAVisualization.edu\CAAVisBasics.m</code></td>
  </tr>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAAVisualization.edu/CAAVisBasics.m</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the root directory of your CAA V5
installation.
<p>CAAVisBasics includes the following files:</p>
<table width="100%">
  <tr>
    <td><b>LocalInterfaces directory</b></td>
  </tr>
  <tr>
    <td>CAAVisBaseApplication.h</td>
    <td>Header file for the interactive application that hosts the viewer</td>
  </tr>
  <tr>
    <td>CAAVisBaseCGRDocument.h</td>
    <td>Header file for the document that displays a cgr file</td>
  </tr>
  <tr>
    <td>CAAVisBaseDocument.h</td>
    <td>Header file for the document base class</td>
  </tr>
  <tr>
    <td>CAAVisBaseView.h</td>
    <td>Header file for the document window containing a viewer to display the
      document</td>
  </tr>
  <tr>
    <td><b>src directory</b></td>
  </tr>
  <tr>
    <td>CAAVisBaseApplication.cpp</td>
    <td>Source file for the interactive application that hosts the viewer</td>
  </tr>
  <tr>
    <td>CAAVisBaseCGRDocument.cpp</td>
    <td>Source file for the document that displays a cgr file</td>
  </tr>
  <tr>
    <td>CAAVisBaseDocument.cpp</td>
    <td>Source file for the document base class</td>
  </tr>
  <tr>
    <td>CAAVisBaseView.cpp</td>
    <td>Source file for the document window containing a viewer to display the
      document</td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="Step"></a>Step-by-Step</h3>
<p>To open and display a cgr file in a 3D viewer, there are three main steps:</p>
<table width="100%">
  <tr>
    <th>#</th>
    <th>Step</th>
    <th>Where</th>
  </tr>
  <tr>
    <td valign="top"><a href="#Step1">1</a></td>
    <td valign="top">Create a 3D navigation viewer instance</td>
    <td valign="top"><code>CAAVisBaseView::CreateViewer</code> method</td>
  </tr>
  <tr>
    <td valign="top"><a href="#Step2">2</a></td>
    <td valign="top">Create a 3D representation bag from the selected cgr file</td>
    <td valign="top"><code>CAAVisBaseCGRDocument::CreateModel</code> method</td>
  </tr>
  <tr>
    <td valign="top"><a href="#Step3">3</a></td>
    <td valign="top">Display the representation in the viewer</td>
    <td valign="top"><code>CAAVisBaseDocument::AddRepToViewer</code> method</td>
  </tr>
</table>
<p>The preliminary tasks that consist in creating the application and its main
window with menus and commands, displaying the file selection box, retrieving
the input file name from the file selected, and checking that its a cgr file,
are not described. The input file name is a data member of <i>CAAVisBaseCGRDocument</i>
class.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Step1"></a>Creating a 3D Navigation Viewer Instance</h4>
<p>The 3D navigation viewer is an instance of the <i>CATNavigation3DViewer</i>
class. It is created in the <code>CreateViewer</code> method of the <i>CAAVisBaseView</i>
class that is called when the application is launched.
<table class="code">
  <tr>
    <td>
      <pre>void CAAVisBaseView::CreateViewer()
{
  _pViewer = new CATNavigation3DViewer(this, &quot;3DViewer&quot;,
                                      CATDlgFraNoTitle | CATDlgFraNoFrame,
                                      500, 500);
  Attach4Sides(_pViewer);
}</pre>
    </td>
  </tr>
</table>
<p>The <code>_pViewer</code> pointer to the 3D navigation viewer is kept as a
data member of the <i>CAAVisBaseView</i> class. Its parameter are:</p>
<table>
  <tr>
    <td valign="top"><code>this</code></td>
    <td valign="top">The viewer parent in the dialog containment tree structure
      and in the command tree structure [<a href="#References">2</a>]</td>
  </tr>
  <tr>
    <td valign="top"><code>3DViewer</code></td>
    <td valign="top">The viewer identifier</td>
  </tr>
  <tr>
    <td valign="top"><code>CATDlgFraNoTitle</code></td>
    <td valign="top">The viewer has no title [<a href="#References">3</a>]</td>
  </tr>
  <tr>
    <td valign="top"><code>CATDlgFraNoFrame</code></td>
    <td valign="top">The viewer frame is not displayed [<a href="#References">3</a>]</td>
  </tr>
  <tr>
    <td valign="top"><code>500, 500</code></td>
    <td valign="top">The viewer width and height expressed in pixels</td>
  </tr>
</table>
<p>The <code>Attach4Sides</code> method attaches the four sides of the viewer to
those of the window. This makes the viewer occupy the whole window space.
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Step2"></a>Creating a 3D Representation Bag from the Selected cgr
File</h4>
<p>The <i>CAAVisBaseCGRDocument</i> constructor stores the cgr file name as a
data member, and calls methods to create the representation and to display it in
the viewer.</p>
<table class="code">
  <tr>
    <td>
      <pre>CAAVisBaseCGRDocument::CAAVisBaseCGRDocument(const char * fileName,
                                             CATCommand * iParent,
                                             CATDialog  * iDialogParent,
                                             CATString  * iDocumentName)
                     : CAAVisBaseDocument(iParent, iDialogParent, iDocumentName)
{
  _pFileToOpen = (char *)malloc((strlen(fileName)+1)*sizeof(char));
  memset(_pFileToOpen, 0, strlen(fileName)+1);
  strcpy(_pFileToOpen, fileName);

  CreateModel();

  AddRepToViewer();
}</pre>
    </td>
  </tr>
</table>
<p>The representation bag is created thanks to the <code>CreateModel</code>
method.</p>
<table class="code">
  <tr>
    <td>
      <pre>void CAAVisBaseCGRDocument::CreateModel()
{
  _pRootContainer = new CAT3DBagRep;
  //Reading of the CGR file. The rep issued from this reading
  //is added as a children of _pRootContainer
  CAT3DBagRep * cgr = (CAT3DBagRep *)::<b>CATReadCgr</b>((char *) _pFileToOpen,
                                                  USE_LODS_TEXTURE_EDGE);
  if(cgr)
  {
    _pRootContainer-&gt;AddChild(*cgr);
  }
}</pre>
    </td>
  </tr>
</table>
<p>This representation is created as a <i>CAT3DBagRep</i>, since the cgr file
may need several representations to accomodate its data. The global function <code>CATReadCgr</code>
takes the name of the cgr file as parameter. The second parameter is useless,
and must always be set to <code>USE_LODS_TEXTURE_EDGE</code>.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Step3"></a>Displaying the Representation in the Viewer</h4>
<p>The <code>AddRepToViewer</code> method displays the created representation.</p>
<table class="code">
  <tr>
    <td>
      <pre>void CAAVisBaseDocument::AddRepToViewer()
{
  _pView-&gt;Add3DRep(_pRootContainer);
}</pre>
    </td>
  </tr>
</table>
<p><code>_pView</code> is a pointer to the 3D navigation viewer. The
representation is assigned to this viewer thanks to the <code>Add3DRep</code>
method.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="InShort"></a>In Short</h3>
<p>This use case shows the objects involved when displaying a cgr file, namely
the 3D navigation viewer that displays the cgr file and the 3D representation
bag into which the cgr file is put to be passed to the viewer.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td valign="top">[1]</td>
    <td><a href="../CAADocUseCases/CAADocRunSample.htm">Building
      and Launching CAA V5 Samples</a></td>
  </tr>
  <tr>
    <td valign="top">[2]</td>
    <td><a href="../CAADlgTechArticles/CAADlgCreatingDialogs.htm">Creating
      Dialog Objects</a></td>
  </tr>
  <tr>
    <td valign="top">[3]</td>
    <td><a href="../CAADlgQuickRefs/CAADlgCATDlgFrame.htm">Frame</a></td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <strong>1</strong> [Feb 2000]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<p><i>Copyright © 2000, Dassault Systèmes. All rights reserved.</i></p>

</body>

</html>
