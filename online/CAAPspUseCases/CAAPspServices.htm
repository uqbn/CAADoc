<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
<title>Using CATPspServices and CATPspListServices</title>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>Equipment &amp; Systems</h1>
    </td>
    <td valign="top">
      <h2>Distributive Systems</h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>Using CATPspservices and CATPspListServices</h3>
      How to use CATPspservices and CATPspListServices</td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This article discusses the CAAPspServices use case.</p>
      <ul>
        <li><strong><a href="#Learn">What You Will Learn With This Use Case</a></strong></li>
        <li><a href="#UseCase"><strong>The CAAPspServices Use Case</strong></a>
          <ul>
            <li><a href="#What">What Does CAAPspServices Do</a></li>
            <li><a href="#How">How to Launch CAAPspServices</a></li>
            <li><a href="#Where">Where to Find the CAAPspServices Code</a></li>
          </ul>
        </li>
        <li><strong><a href="#Step">Step-by-Step</a></strong></li>
        <li><strong><a href="#InShort">In Short</a></strong></li>
        <li><strong><a href="#References">References</a></strong></li>
      </ul>
    </td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>This use case is intended to show you how to activate a Plant Ship
application and make use of CATPspServices and CATPspListServices functions.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="UseCase"></a>The CAAPspServices Use Case</h3>
<p>CAAPspServices is a use case of the CAAPlantShipInterfaces.edu framework
that illustrates CATPlantShipInterfaces framework capabilities.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="What"></a>What Does CAAPspServices Do</h4>
<p>The goal of&nbsp; CAAPspServices is to show you how to use the
CATPlantShipInterfaces methods to query and obtain application and domain
related information from the objects in a design document.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="How"></a>How to Launch CAAPspServices</h4>
<p>To launch CAAPspServices, you will need to set up the build time
environment, then compile CAAPspServices along with its prerequisites, set up
the run time environment, and then execute the sample. This is fully described
in the referenced article [<a href="#References">1</a>]. When launching the use
case, you must pass the following arguments:</p>
<ul>
  <li><b>CAAPspEduIn.CATProduct</b> - the entire pathname, name and extension
    (.CATProduct) of the input drawing. Normally, it should be stored in the
    CNext/resources/graphic directory of the CAAPlantShipInterfaces.edu
    framework.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Where"></a>Where to Find the CAAPspServices Code</h4>
<p>CAAPspServices code is located in the CAAPspServices.m use case module of
the CAAPlantShipInterfaces.edu framework:</p>
<table>
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAAPlantShipInterfaces.edu\CAAPspServices.m</code></td>
  </tr>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAAPlantShipInterfaces.edu/CAAPspServices.m</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the root directory of your CAA V5
installation. It is made of&nbsp; two unique source files named CAAPspServicesMain.cpp and
CAAPspServices.cpp.</p>
<p>Additional prerequisite code is located in the CAAPspUtilities.m directory of the same framework.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="Step"></a>Step-by-Step</h3>
<p>There are seven logical steps in CAAPspServices:</p>
<ol>
  <li><a href="#Prolog">Prolog</a></li>
  <li><a href="#Initializing">Initializing the Environment</a></li>
  <li><a href="#Use of CATPspListServices::CreateCATIUnknownList">Use of
    CATPspListServices::CreateCATIUnknownList()</a></li>
  <li><a href="#CreateCATICStringList">Use of
    CATPspListServices::CreateCATICStringList()</a></li>
  <li><a href="#CreateCATIStringList">Use of
    CATPspListServices::CreateCATIStringList()</a></li>
  <li><a href="#Retrieving a list of application names">Retrieving a list of&nbsp;
    PSP application names</a></li>
  <li><a href="#Retrieving a list of domain names">Retrieving a list of domain
    names</a></li>
</ol>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Prolog"></a>Prolog</h4>
<p>In this use case, we open an input document containing some Equipment and
Piping Design objects.&nbsp;</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Initializing"></a>Initializing the Environment</h4>
<p>The CAAPspServices code is derived from the CAAPspBaseEnv base class.
The base class contains functionality common to the other CAAPsp samples.
Initializing the environment involves the following method:</p>
<table class="code">
  <tr>
    <td>
      <pre>CAAPspBaseEnv::CreateCATProductEnv</pre>
    </td>
  </tr>
</table>
<p>This method performs the following functions:</p>
<ul>
  <li>Creating a session, namely &quot;Session DSA CAAPspBaseEnv
    CATProduct&quot;.</li>
  <li>Loading the input document.</li>
  <li>Initializing the document using the <i>CATInit</i> interface Init.</li>
  <li>Retrieving the pointer to the root container object.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Use of CATPspListServices::CreateCATIUnknownList"></a>Use of
CATPspListServices::CreateCATIUnknownList() and Locate()&nbsp; functions</h4>
<p>First get a physical object from the input document and then&nbsp;
create CATIUnknownList interface implementation object by calling
CATPspListServices::CreateCATIUnknownList() and then add a IUnknown pointer got
from a physical object.&nbsp; In order to locate physical object just added to CATIUnknownList
object, use CATPspListServices::Locate() as illustrated in the following code.</p>
<table class="code" width="1058">
  <tr>
    <td width="1050">
      <pre>       rc = CATPspListServices::CreateCATIUnknownList(&amp;piUnkList); // Create a list of unknowns

       if( SUCCEEDED (rc) )
       {
          cout &lt;&lt; &quot;CAAPspServices: &quot;
               &lt;&lt; &quot;Succeeded in creating a CATIUnknownList interface implementation object&quot; &lt;&lt; endl;
       }
    
       if ( NULL != piPhysical )
          rc = piPhysical-&gt;QueryInterface (IID_IUnknown, (void **)&amp;piUnknown);

       if (SUCCEEDED(rc) &amp;&amp; (NULL != piUnknown) &amp;&amp; (NULL != piUnkList))
       {
          rc = piUnkList-&gt;Add(0,piUnknown);

          if( SUCCEEDED( rc) )
          {
            int iLocation = 0;
            iLocation = CATPspListServices::Locate(piUnkList, piUnknown);  
                
            if( iLocation &gt;= 0)
            {
               cout &lt;&lt; &quot;Found Physical object in the list at index&quot; &lt;&lt; iLocation&lt;&lt; endl;
            }
            else
            {
               cout &lt;&lt; &quot;Could not find the physical object&quot;  &lt;&lt; endl;
            }                                           
          }     
        }</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="CreateCATICStringList"></a>Use of
CATPspListServices::CreateCATICStringList() and Locate()&nbsp; functions</h4>
<p>First&nbsp;&nbsp; create CATICStringList interface implementation object by
calling CATPspListServices::CreateCATICStringList() and then add a couple of c-
strings to the CreateCATICStringList object. In order to locate character&nbsp;
string&nbsp; just added to CATICStringList object, use
CATPspListServices::Locate() as illustrated in the following code.</p>
<p>&nbsp;</p>
<table class="code" width="1058">
  <tr>
    <td width="1050">
      <pre>if( SUCCEEDED(CATPspListServices::CreateCATICStringList(&amp;pLCStrNames)) &amp;&amp; pLCStrNames )
{
  const char* cStrPiping = &quot;Piping&quot;;
  const char* cStrTubing = &quot;Tubing&quot;;
	
  // Adding strings to the list
	
  pLCStrNames-&gt;Add(0,cStrPiping);
  pLCStrNames-&gt;Add(0,cStrTubing);

  //
  // Calling CATPspListServices::Locate() function to locate &quot;Piping&quot;
  // 
  int iLocation = 0;
  iLocation = CATPspListServices::Locate( pLCStrNames, cStrPiping);
  cout &lt;&lt; &quot;Location index =&quot; &lt;&lt;  iLocation &lt;&lt; endl;
  if( iLocation &gt;= 0)
  {
    cout &lt;&lt; &quot;Found the string&quot; &lt;&lt; endl;
  }
  else
  {
    cout &lt;&lt; &quot;Could not find the string&quot;  &lt;&lt; endl;
  }			

</pre>
    </td>
  </tr>
</table>
<p>&nbsp;</p>
<h4><a name="CreateCATIStringList"></a>Use of
CATPspListServices::CreateCATIStringList() and Locate()&nbsp; functions</h4>
<p>First&nbsp;&nbsp; create CATIStringList interface implementation object by
calling CATPspListServices::CreateCATIStringList() and then add a couple
of&nbsp; wide character strings to the CreateCATIStringList object. In order to
locate one of the wide character&nbsp; string&nbsp; just added to CATIStringList object, use CATPspListServices::Locate() as illustrated in
the following code.</p>
<p>&nbsp;</p>
<table class="code" width="1058">
  <tr>
    <td width="1050">
      <pre>     if ( SUCCEEDED(CATPspListServices::CreateCATICStringList(&amp;pLCStrNames)) &amp;&amp; pLCStrNames )
     {
       const char* cStrPiping = &quot;Piping&quot;;
       const char* cStrTubing = &quot;Tubing&quot;;
            
       // Adding strings to the list
            
       pLCStrNames-&gt;Add(0,cStrPiping);
       pLCStrNames-&gt;Add(0,cStrTubing);

       //
       // Calling CATPspListServices::Locate() function to locate &quot;Piping&quot;
       // 
       int iLocation = 0;
       iLocation = CATPspListServices::Locate( pLCStrNames, cStrPiping);
       cout &lt;&lt; &quot;Location index =&quot; &lt;&lt;  iLocation &lt;&lt; endl;
       if( iLocation &gt;= 0)
       {
          cout &lt;&lt; &quot;Found the string&quot; &lt;&lt; endl;
       }
       else
       {
          cout &lt;&lt; &quot;Could not find the string&quot;  &lt;&lt; endl;
       }            	
</pre>
    </td>
  </tr>
</table>
<h4><a name="Retrieving a list of application names"></a>Retrieving a list
of&nbsp; PSP application names</h4>
<p>Use CATPspServices::ListAllApplicationNames to get a list of application
names</p>
<table class="code" width="1058">
  <tr>
    <td width="1050">
      <pre>if( SUCCEEDED( CATPspServices::ListAllApplicationNames( &amp;pLApplNames) )  )
{
  unsigned int LCStrSize = 0;
  int NumOfCStr = 0;
  if (pLApplNames) 
    HRESULT rc = pLApplNames-&gt;Count (&amp;LCStrSize);
  NumOfCStr = LCStrSize;
  if (NumOfCStr)
  {
    cout &lt;&lt; &quot;Number of Applications = &quot; &lt;&lt; NumOfCStr &lt;&lt;endl;
</pre>
    </td>
  </tr>
</table>
<h4><a name="Retrieving a list of domain names"></a>Retrieving a list of&nbsp;
all domain names</h4>
<p>Use CATPspServices::ListAllDomainNamesto get a list of domain names</p>
<table class="code" width="1058">
  <tr>
    <td width="1050">
      <pre>if( SUCCEEDED( CATPspServices::ListAllDomainNames( &amp;pLDomainNames) ))
{
  unsigned int LCStrSize = 0;
  int NumOfCStr = 0;
  if (pLDomainNames) 
    HRESULT rc = pLDomainNames-&gt;Count (&amp;LCStrSize);
  NumOfCStr = LCStrSize;
  if (NumOfCStr)
  {
    cout &lt;&lt; &quot;Number of Domains =&quot; &lt;&lt; NumOfCStr &lt;&lt;endl;
</pre>
    </td>
  </tr>
</table>
<p>&nbsp;</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="InShort"></a>In Short</h3>
<p>This use case has demonstrated how to use the CATPspServices and
CATPspListServices functions. Specifically, it has illustrated:</p>
<ul>
  <li>Obtaining the necessary Psp Interfaces</li>
  <li>Use of CATPspListServices and CATPspServices functions</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td valign="top">[1]</td>
    <td><a href="../CAADocUseCases/CAADocRunSample.htm">Building
      and Launching a CAA V5 Use Case</a></td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <strong>1</strong>  [March 2003]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<p><i>Copyright © 2003, Dassault Systèmes. All rights reserved.</i></p>

</body>

</html>
