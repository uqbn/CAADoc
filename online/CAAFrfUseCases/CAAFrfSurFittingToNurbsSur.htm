<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
<title>Converting Surfaces into NURBS</title>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>Geometric Modeler</h1>
    </td>
    <td valign="top">
      <h2>Free Form Operators</h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>Converting Surfaces into NURBS</h3>
      <em>How to use the CATSurFittingToNurbsSur operator</em></td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>You can convert surfaces into NURBS by using the
      CATSurFittingToNurbsSur operator. These operator allows you to specify the
      characteristics of the resulting NURBS as well as a maximum deviation you
      would like to obtain with respect to the initial surface.
      <ul>
        <li><a href="#Learn"><strong>What You Will Learn With This Use Case</strong></a></li>
        <li><a href="#CATTopComputePointOnWire"><strong>The
          CATSurFittingToNurbsSur Operator</strong></a></li>
        <li><a href="#UseCase"><strong>The CAASurFittingToNurbsSur Use Case</strong></a>
          <ul>
            <li><a href="#What">What Does CAASurFittingToNurbsSur Do</a></li>
            <li><a href="#How">How to Launch CAASurFittingToNurbsSur</a></li>
            <li><a href="#Where">Where to Find the CAASurFittingToNurbsSur Code</a></li>
          </ul>
        </li>
        <li><a href="#Step"><strong>Step-by-Step</strong></a></li>
        <li><a href="#InShort"><strong>In Short</strong></a></li>
        <li><a href="#References"><strong>References</strong></a></li>
      </ul>
    </td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>This use case is intended to help you use the free form operators. It
particularly illustrates how to convert a curve/surface into a NURBS
curve/surface.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="CATTopComputePointOnWire"></a>The CATSurFittingToNurbsSur Operator</h3>
<p>The CATSurFittingToNurbsSur operator is to be used according to the general
scheme of operators:</p>
<ol>
  <li>creation of an operator instance from a global function. Two modes BASIC
    or ADVANCED are proposed.</li>
  <li>if the ADVANCED mode is choosen, tuning of the parameters by using the
    Setxxx methods then run of the operator</li>
  <li>retrieve the created NURBS by using the GetNurbsxxx method..</li>
</ol>
<p>Note: In ADVANCED mode, you cannot use the same operator to convert several
surfaces. You must replay the sequence below:</p>
<ol>
  <li>operator creation</li>
  <li>set of parameters</li>
  <li>Run</li>
  <li>GetNurbsSurface</li>
  <li>operator deletion.</li>
</ol>
<p>as many times as you need.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="UseCase"></a>The CAASurFittingToNurbsSur Use Case</h3>
<p>CAASurFittingToNurbsSur is a use case of the CAAFreeFormOperators.edu
framework that illustrates the FreeFormOperators framework capabilities.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="What"></a>What Does CAASurFittingToNurbsSur Do</h4>
<p>This use case</p>
<ol>
  <li>creates a revolution surface to be converted into a NURBS surface.</li>
  <li>creates a first CATSurFittingToNurbsSur operator to be used to convert the
    initial surface into a rational surface<em>. </em>No constraints are
    specified.</li>
  <li>creates a second CATSurFittingToNurbsSur operator and set a constraint on
    the minimum length of an arc.</li>
</ol>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="How"></a>How to Launch CAASurFittingToNurbsSur</h4>
<p>To launch CAASurFittingToNurbsSur, you will need to set up the build time
environment, then compile CAASurFittingToNurbsSur.m along with its
prerequisites, set up the run time environment, and then execute the use case [<a href="#References">4</a>].</p>
<p>If you simply type CAASurFittingToNurbsSur with no argument, the use case
executes, but doesn't save the result in an NCGM file. If you want to save this
result, provide the full pathname of the NCGM file to create. For example:</p>
<p>With Windows CAASurFittingToNurbsSur <code>e:\NurbsSur.NCGM</code></p>
<p>With UNIX CAASurFittingToNurbsSur <code>/u/NurbsSur.NCGM</code></p>
<p>This NCGM file can be displayed using the CAAGemBrowser use case.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Where"></a>Where to Find the CAASurFittingToNurbsSur Code</h4>
<p>The CAASurFittingToNurbsSur use case is made of a main named
CAASurFittingToNurbsSur.cpp located in the CAASurFittingToNurbsSur.m module of
the CAAFreeFormOperators.edu framework:</p>
<table>
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAAFreeFormOperators.edu\CAASurFittingToNurbsSur.m\</code></td>
  </tr>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAAFreeFormOperators.edu/CAASurFittingToNurbsSur.m/</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="Step"></a>Step-by-Step</h3>
<p>CAASurFittingToNurbsSur.cpp is divided into five logical steps:
<ol>
  <li><a href="#Creates the Geometry Factory">Creating the Geometry Factory</a></li>
  <li><a href="#Surf">Creating the Surface to Be Converted into NURBS</a></li>
  <li><a href="#Conv1">Converting the Created Surface into a NURBS without
    Specifying Any Constraints</a></li>
  <li><a href="#Conv2">Converting the Created Surface into a NURBS and
    Specifying a Constraint on the Minimum Length of an Arc</a></li>
  <li><a href="#Writes the Model and Closes the Factory">Writing the Model and
    Closing the Container</a></li>
</ol>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Creates the Geometry Factory"></a>Creating the Geometry Factory</h4>
<p>The geometry factory (CATGeoFactory) creates and manages all the
CATICGMObject (and the curves and surfaces in particular) [<a href="#References">1</a>].
This creation is done by the global function <code>::CATCreateCGMContainer</code>.
Notice that the factory can be defined by reading a NCGM file that was
previously stored. In that case, the global function <code>::CATLoadCGMContainer</code>
must be used.</p>
<table class="code">
  <tr>
    <td>
      <pre>CATGeoFactory* piGeomFactory = <strong>::CATCreateCGMContainer</strong>() ;
if (NULL==piGeomFactory) return (1);</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Surf"></a>Creating the Surface to Be Converted into a NURBS</h4>
<p>The surface to be converted is a revolution surface created from a spline
curve. Both the spline and the revolution surface are geometric objects created
from the geometry factory.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Conv1"></a>Converting the Created Surface into a NURBS without
Specifying any Constraints</h4>
<p>This first operator is intended to create an operator instance with the
following parameters:</p>
<ol>
  <li>a 0.001 maximum deviation. It is important to note that this value is the
    CATIA resolution and it would not be meaningful to specify a maximum
    deviation less than this resolution.</li>
  <li>the rational factor is 1 - meaning that resulting curve is to be rational
    (different weights can be assigned to control points.</li>
</ol>
<table class="code">
  <tr>
    <td>
      <pre>CATSurFittingToNurbsSur * pSurFitting1 = 
		::CATCreateSurFittingToNurbsSur(piGeomFactory,
		piSurface,
		surLimits,
		0.001,
		1,
		ADVANCED);</pre>
    </td>
  </tr>
</table>
<p>At this stage, you have just created an instance of operator, if you want to
get the converted NURBS, you must Run the operator and retrieve the resulting
NURBS by using the GetNurbsSurface operator.</p>
<table class="code">
  <tr>
    <td>
      <pre>pSurFitting1-&gt;Run();
CATNurbsSurface * pNurbsSurf1 = pSurFitting1-&gt;GetNurbsSurface();</pre>
    </td>
  </tr>
</table>
<p>The transformation of the surface into NURBS is exact. To check this, you can
use the IsExactTransformation method or retrieve the maximum deviation (0 is
returned in the present use case).</p>
<table class="code">
  <tr>
    <td>
      <pre><font color="#008000"><i>// (g) --- Determine whether the transformation is exact 
// &quot;Transformation exact&quot; expected as the surface
// has been specified rational
//</i></font>
IsExact = pSurFitting1-&gt;IsExactTransformation();
if (IsExact == 0) cout &lt;&lt; &quot;Transformation not exact&quot; &lt;&lt; endl;
else {cout &lt;&lt; &quot;Exact transformation&quot; &lt;&lt; endl;}
<font color="#008000"><i>// (h) --- Display the maximum deviation on the standard output
//</i></font>
maxDeviat = pSurFitting1-&gt;GetMaxDeviation();
cout &lt;&lt; &quot;Maximum deviation of surface 1 &quot; &lt;&lt;  maxDeviat &lt;&lt; endl;</pre>
    </td>
  </tr>
</table>
<p>Modify the rationality factor by replacing 1 with 0 in the argument 4 of the
CATCreateSurFittingToNurbsSur operator. Recompile and rerun, the curve cannot be
converted exactly because actually, you have set a constraint on the control
point weights (1 everywhere).</p>
<h4><a name="Conv2"></a>Converting the Created Surface into a NURBS and
Specifying a Constraint on the Minimum Length of an Arc</h4>
<p>This second operator is intended to create an operator instance with the same
parameters as the first operator. Prior to running the operator, the minimum
length of an arc is set to 32. The resulting transformation is not exact and a
maximum deformation around 0.09 is achieved.</p>
The operator tries first to comply the parameters specified by using the Setxxx
methods.
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Writes the Model and Closes the Factory"></a>Writing the Model and
Closing the Factory</h4>
<p>To save the model in a file, the <code>::CATSaveCGMContainer</code> global
function is used. Notice that in the use case, the save is conditioned by an
input parameter representing the file inside which the model must be saved.</p>
<p>The use case ends with the closure of the geometry factory, done by the <code>::CATCloseCGMContainer</code>
global function.</p>
<table class="code">
  <tr>
    <td>
      <pre> if(1==toStore)
 {
#ifdef _WINDOWS_SOURCE
   ofstream filetowrite(pfileName, ios::binary ) ;
#else
   ofstream filetowrite(pfileName,ios::out,filebuf::openprot) ;
#endif

   <strong>::CATSaveCGMContainer</strong>(piGeomFactory,filetowrite);
   filetowrite.close();
 }	

 <em>//
 // Closes the container
 //</em>	
 <strong>::CATCloseCGMContainer</strong>(piGeomFactory);</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="InShort"></a>In Short</h3>
<p>The CATCreateSurFittingToNurbsSur operators allows you to convert a surface
into a NURBS surface. Apart from the usual parameters, this operator requires
you specify the maximum deviation you would like to obtain from the initial
surface as well as the rationality. Constraints on the resulting surface can be
specified by using Setxxx methods.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td>[1]</td>
    <td><a href="../CAAGobTechArticles/Nurbs.htm">The
      NURBS Curves</a></td>
  </tr>
  <tr>
    <td>[2]</td>
    <td><a href="../CAAGobTechArticles/GeoObjects.htm">The
      CGM Objects</a></td>
  </tr>
  <tr>
    <td>[3]</td>
    <td><a href="../CAAGobTechArticles/Curves.htm">The
      CGM Curves</a></td>
  </tr>
  <tr>
    <td>[4]</td>
    <td><a href="../CAADocUseCases/CAADocRunSample.htm">Building
      and Launching a CAA V5 Use Case</a></td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <strong>1</strong> [Feb 2000]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<p><i>Copyright © 2000, Dassault Systèmes. All rights reserved.</i></p>

</body>

</html>
