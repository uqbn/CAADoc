<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
<title>Creating a New VPM Object</title>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>3D PLM Enterprise Architecture</h1>
    </td>
    <td valign="top">
      <h2>Data Access - Database</h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>Creating a New VPM Object</h3>
      <em>Performing basic VPM Persistency operations</em></td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This article illustrates how to create a new VPM session and how to
      create a new VPM object.</p>
      <ul>
        <li><a href="#Learn"><strong>What You Will Learn With This Use Case</strong></a></li>
        <li><a href="#UseCase"><strong>The CAA</strong></a><a href="#UseCase"><strong>VpyGeneralPersistency</strong></a><a href="#UseCase"><strong>
          Use Case</strong></a>
          <ul>
            <li><a href="#What">What Does CAAVpyGeneraPersistency Do?</a></li>
            <li><a href="#How">How to Launch CAAVpyGeneralPersistency</a></li>
            <li><a href="#Where">Where to Find the CAAVpyGeneralPersistency Code</a></li>
          </ul>
        <li><a href="#Step"><strong>Step-by-Step</strong></a></li>
        <li><a href="#InShort"><strong>In Short</strong></a></li>
        <li><a href="#References"><strong>References</strong></a></li>
      </ul>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>This use case is intended to show you how to use some of the basic operations
available with VPMPersistency interfaces. These include: creating a new login
session, retrieving the VPM factory manager and creating a new VPM object.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="UseCase"></a>The CAAVpyGeneralPersistency Use Case</h3>
<p>CAAVpyGeneralPersistency is a use case of the CAAVPMPersistency.edu framework
that illustrates VPMPersistency framework capabilities.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="What"></a>What Does CAAVpyGeneralPersistency Do?</h4>
<p>CAAVpyGeneralPersistency first of all opens a VPM session and creates a new
login session. Then it retrieves a <i>CATIVPMFactoryManager</i> handler in order
to create a new VPM object.
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="How"></a>How to Launch CAAVpyGeneralPersistency</h4>
<p>To launch CAAVpyGeneralPersistency, you will need to set up the build time
environment, then compile CAAVpyGeneralPersistency along with its prerequisites,
set up the run time environment, and then execute the use case. [<a href="#References">1</a>]
The required interfaces can be found in the VPMPersistency framework. Launch the
use case by executing the following command:</p>
<p><code>mkrun -c &quot;CAA</code><code>VpyGeneralPersistency</code><code>&quot;</code></p>
<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="Where"></a>Where to Find the CAAVpyGeneralPersistency Code</h4>
<p>The CAAVpyGeneralPersistency use case is made of a single file located in the
CAAVpyGeneralPersistency.m module of the CAAVPMPersistency.edu framework:</p>
<table>
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAAVPMPersistency.edu\CAA</code><code>VpyGeneralPersistency</code><code>.m\</code></td>
  </tr>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAAVPMPersistency.edu/CAA</code><code>VpyGeneralPersistency</code><code>.m/</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="Step"></a>Step-by-Step</h3>
<p><b>Before launching this use case, check for <a href="../CAAVpiUseCases/CAAVpiEventsCommonDoc.htm#PreReq">its
prerequisites.</a></b></p>
<p>For demonstration purposes, the code from the CAAVpyGeneralPersistency use
case is shown here. There are four logical steps in the CAAVpyGeneralPersistency
use case:</p>
<ol>
  <li><a href="#OpenSession">Opening a VPM Session</a></li>
  <li><a href="#CreateLogin">Creating the Login Session</a></li>
  <li><a href="#CreateObject">Creating a VPM Object</a></li>
  <li><a href="#CloseSession">Closing the VPM Session</a></li>
</ol>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="OpenSession"></a>Opening a VPM Session</h4>
<table class="code" width="637">
  <tr>
    <td width="629">
      <pre>    VPMSession *pSession = <b>VPMSession::OpenSession</b>();
    if (NULL == pSession)
    {
        cout &lt;&lt; &quot;Failed to Open Session.&quot; &lt;&lt; endl;
	<b>return</b> 1;
    }
    cout &lt;&lt; &quot;Open Session successful.&quot; &lt;&lt; endl;  

...        </pre>
    </td>
  </tr>
</table>
<p>Use the <code>OpenSession</code> static method of <i>VPMSession</i> in order
to open a new VPM session.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<p><b><a name="CreateLogin"></a>Creating the Login Session</b></p>
<table class="code" width="637">
  <tr>
    <td width="629">
      <pre>...</pre>
      <pre>    const int netWorkCommunication = 1;
    CATIVpmLoginSession_var spLogSession = NULL_var;
    HRESULT rc = pSession -&gt; <b>CreateLoginSession</b>(&quot;MySelf&quot;,
	                                        &quot;MyEncodedPsswd&quot;, 
	     	       	                        &quot;MyRole&quot;,
	 				        netWorkCommunication,
						spLogSession);
    if (FAILED(rc))
    {
	cout &lt;&lt; &quot;Failed to create login session.&quot; &lt;&lt; endl;
        <b>VPMSession::CloseSession</b>();
        <b>return</b> 2;
    }
    cout &lt;&lt; &quot;Login session created successfully.&quot; &lt;&lt; endl;</pre>
      <pre>...</pre>
    </td>
  </tr>
</table>
<p>In order to create a new login session, use the <code>CreateLoginSession</code>
method of <i>VPMSession</i>. This method is used to get the login session
corresponding to a specific user or to create one if none exists. The input
arguments are:</p>
<ul>
  <li>&quot;<code>MySelf</code>&quot; - User Id</li>
  <li>&quot;<code>MyEncodedPsswd</code>&quot; - User Password</li>
  <li>&quot;<code>MyRole</code>&quot; - User Role</li>
  <li><code>netWorkCommunication</code> -Type of network communication. 0: a
    local session; no communication bus will be created. 1: a distributed
    session; a communication bus will be created.</li>
</ul>
<p>The method returns a <i>CATIVpmLoginSession</i> smart pointer to the login
session. This is the entry point for all user dependant actions: once a pointer
to this interface has been obtained, it is assumed that the user has been
authenticated and that the implementation of the interface keeps track of the
user's permissions.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<p><b><a name="CreateObject"></a>Creating a VPM Object</b></p>
<p>1. Retrieve the factory manager.</p>
<table class="code" width="637">
  <tr>
    <td width="629">
      <pre>...</pre>
      <pre>    CATIVpmFactoryManager_var spFactoManager = NULL_var;
    rc = pSession -&gt; <b>GetVPMObjectFactory</b>(spFactoManager);
    if (FAILED(rc))
    {
	cout &lt;&lt; &quot;Failed to get Factory Manager.&quot;&lt;&lt; endl;
	<b>VPMSession::CloseSession</b>();
	<b>return</b> 3; 
    }
    cout &lt;&lt; &quot;Factory Manager: OK&quot; &lt;&lt; endl;</pre>
      <pre>...</pre>
    </td>
  </tr>
</table>
<p>Retrieve a <i>CATIVpmFactoryManager</i> smart pointer using the <code>GetVPMObjectFactory</code>
method of <i>VPMSession</i>.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<p>2. Retrieve the domain container.</p>
<table class="code" width="637">
  <tr>
    <td width="629">
      <pre>...</pre>
      <pre>    CATUnicodeString domain (&quot;INDEX&quot;);
    CATIContainer_var spC1;
    rc = pSession -&gt; <b>SeekContainer</b>(domain,
	                           spC1);
    if (FAILED(rc))
    {
	cout &lt;&lt; &quot;Failed to get domain container&quot; &lt;&lt; endl;
	<b>VPMSession::CloseSession</b>();
	<b>return</b> 4;
    }
    cout &lt;&lt; &quot;Domain container: OK&quot; &lt;&lt; endl;</pre>
      <pre>...</pre>
    </td>
  </tr>
</table>
<p>Use the <code>SeekContainer</code> method of <i>VPMSession</i> to retrieve a <i>CATIContainer</i>
smart pointer to the container corresponding to the specified domain, in this
case &quot;INDEX&quot;. The new VPM object will be created in this container.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<p>3. Create a VPM Part object.</p>
<table class="code" width="637">
  <tr>
    <td width="629">
      <pre>...</pre>
      <pre>    CATUnicodeString type (&quot;ENOVIA_Part&quot;);
    CATIVpmFactoryObject_var spMyPart = spFactoManager -&gt; CreateVPMObject(domain,
	                                                                  spC1,
	    							          type);

    if (NULL_var == spMyPart)
    {
	cout &lt;&lt; &quot;Create VPMObject: KO&quot; &lt;&lt; endl;
	<b>VPMSession::CloseSession</b>();
	<b>return</b> 5;
    }	
    cout &lt;&lt; &quot;Create VPMObject: OK&quot; &lt;&lt; endl;</pre>
      <pre>...</pre>
    </td>
  </tr>
</table>
<p>Use the <code>CreateVPMObject</code> method of <i>CATIVpmFactoryManager</i>
in order to create a new VPM object. This method needs the following input
arguments:</p>
<ul>
  <li><code>domain</code> - this is the current domain, in this case,
    &quot;INDEX&quot;.</li>
  <li><code>spC1</code> - this is the container retrieved in the previous
    section. The new VPM object will be created in this container.</li>
  <li><code>type</code> - this is the type of object to be created, in this
    case, an &quot;ENOVIA_Part&quot;.</li>
</ul>
<p>The <code>CreateVPMObject</code> method returns a <i>CATIVpmFactoryObject</i>
smart pointer to the new &quot;ENOVIA_Part&quot;.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<p><b><a name="CloseSession"></a>Closing the VPM Session</b></p>
<table class="code" width="637">
  <tr>
    <td width="629">
      <pre>...  </pre>
      <pre>    rc = pSession -&gt; <b>CloseSession</b>();
    if (FAILED(rc))
    {
	cout &lt;&lt; &quot;Close Session failed.  &quot; &lt;&lt; endl;
	<b>return</b> 6;
    }
    cout &lt;&lt; &quot;Close Session successful. &quot; &lt;&lt; endl;
 	
    <b>return</b> 0;</pre>
    </td>
  </tr>
</table>
<p align="left">Close the session using the <code>CloseSession</code> method of <i>VPMSession</i>.
Then return a 0 value for a successful completion.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>


<!---------------------------------comment------------------------------------->
<h3><a name="InShort"></a>In Short</h3>
<p>This use case has illustrated how to open a new VPM session using the <code>OpenSession</code>
static method of <i>VPMSession</i>, how to create a new login session using the <code>CreateLoginSession</code>
method of <i>VPMSession</i>, how to retrieve a <i>CATIVpmFactoryManager</i>
pointer using the <code>GetVPMObjectFactory</code> method of <i>VPMSession</i>,
how to create a new VPM object in a selected domain container using the <code>CreateVPMObject</code>
method of <i>CATIVpmFactoryManager</i> and finally, how to close the VPM session
using the <code>CloseSession</code> method of <i>VPMSession</i>.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td valign="top">[1]</td>
    <td><a href="../CAADocUseCases/CAADocRunSample.htm">Building
      and Launching a CAA V5 Use Case</a></td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <strong>1</strong> [December 2001]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<p><i>Copyright © 2001, Dassault Systèmes. All rights reserved.</i></p>

</body>

</html>
