<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
<title>Managing Geometry with User Machining Features</title>
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>Machining</h1>
    </td>
    <td valign="top">
      <h2>3 Axis Surface Machining</h2>
    </td>
    <td rowspan="2" align="right" valign="top">
      <h3><a name="Top"></a>Managing Geometry with User Machining Features</h3>
      <i>Customize the geometry tab page of a surface machining operation with
      user machining features</i></td>
  </tr>
  <tr>
    <td class="use" colspan="2">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->

<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This article discusses the CAASmiUserOperationWithUserMF use case. It
      explains how to customize the default geometry tab page of a surface
      machining operation to be able to select geometry through an user
      machining feature's geometry attribute.</p>
      <p>This paper accompanies the first scenario of <i>Surface Machining
      Operation Sample</i> [<a href="#References">1</a>].</p>
      <ul>
        <li><a href="#Learn"><strong>What You Will Learn With This Use Case</strong></a></li>
        <li><a href="#UseCase"><strong>The CAASmiUserOperationWithUserMF Use
          Case</strong></a>
          <ul>
            <li><a href="#What">What Does CAASmiUserOperationWithUserMF Do</a></li>
            <li><a href="#How">How to Launch CAASmiUserOperationWithUserMF</a></li>
            <li><a href="#Where">Where to Find the CAASmiUserOperationWithUserMF
              Code</a></li>
          </ul>
        <li><a href="#Step"><strong>Step-by-Step</strong></a></li>
        <li><b><a href="#InShort">In Short</a></b></li>
        <li><b><a href="#References">References</a></b></li>
      </ul>
    </td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>This use case is intended to help you to manage geometry of a surface
machining operation with a machining feature geometry attribute.</p>
<p>More specifically, the CAASmiUserOperationWithUserMF Use Case shows how to:</p>
<ul>
  <li>Overload the geometry tab page of a surface machining operation.</li>
  <li>Create a new machining feature.</li>
  <li>Connect a machining feature with a surface machining operation.</li>
  <li>Manage geometry selection of surface machining geometry attributes.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="UseCase"></a>The CAASmiUserOperationWithUserMF Use Case</h3>
<p>CAASmiUserOperationWithUserMF is a use case of the CAASurfaceMachiningItf.edu
framework that illustrates Surface Machining capabilities. It is a part of the
sample described in the technical article [<a href="#References">1</a>].</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="What"></a>What Does CAASmiUserOperationWithUserMF Do</h4>
<p>This use case customizes the default geometry tab page of <b>CAASmgOperation</b>.</p>
<p>CAASmgOperation<b> </b>is associated with a new machining feature: <b>CAASmgMachiningFeature</b>.</p>
<p>CAASmgMachiningFeature has a geometry attribute : <b>CAASmgGuide</b>. This
parameter can support manufacturing geometries or nc geometry features.</p>
<p>The geometry management is done by several functionalities:</p>
<table width="100%">
  <tr>
    <td><img border="0" src="images/CAASmiOperationWithuserMFPanel.jpg" width="414" height="268"></td>
    <td>Description of functionalities illustrated:
      <ul>
        <li><i>Select a curve</i> : select an edge with the edge selection
          toolbar.</li>
        <li><i>Select a set of curves</i> : select a NC Geometry Feature of
          edges.</li>
        <li><i>Remove all</i> : remove selection.</li>
        <li><i>Add a empty set</i> : create an empty NC Geometry Feature of
          edges.</li>
        <li><i>Export curves in a new set</i> : create an NC Geometry Feature
          with the edges previously selected.</li>
      </ul>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->
<h4><a name="How"></a>How to Launch CAASmiUserOperationWithUserMF</h4>
<p>This use case is a part of <i>Surface Machining Operation Sample</i> [<a href="#References">1</a>].
You should build all the modules of this sample at a time to be able to launch
it [<a href="#References">2</a>].</p>
<p>Don't forget to edit the interface dictionary located in:</p>
<table width="100%">
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAASurfaceMachiningItf.edu\CNext\code\dictionary\</code></td>
  </tr>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAASurfaceMachiningItf.edu/CNext/code/dictionary/</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed, and uncomment the appropriate lines by removing the '#' character.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Where"></a>Where to Find the CAASmiUserOperationWithUserMF Code</h4>
<p>This use case is made of source files located in the
CAASmiUserOperationGeomUI.m module of the CAASurfaceMachiningItf.edu framework :</p>
<table width="100%">
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAASurfaceMachiningItf.edu\CAASmiUserOperationGeomUI.m</code></td>
  </tr>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAASurfaceMachiningItf.edu/CAASmiUserOperationGeomUI.m</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h3><a name="Step"></a>Step-by-Step</h3>
<p>CAASmiUserOperationWithUserMF is divided into the following steps:</p>
<ul>
  <li>Implementing CATIMfgGeometryActivity:
    <ul>
      <li><a href="#Step1">Declaring CATIMfgGeometryActivity Implementation</a></li>
      <li><a href="#Step2">Coding GetMainPanelEditor</a></li>
      <li><a href="#Step3">Creating a New Machining Feature
        CAASmgMachiningFeature</a></li>
    </ul>
  </li>
  <li>Creating the geometry dialog frame:
    <ul>
      <li><a href="#Step4">Geometry Management: Coding SelectCurve</a></li>
      <li><a href="#Step5">Geometry Management: Coding SelectZone</a></li>
      <li><a href="#Step6">Geometry Management: Coding RemoveAll</a></li>
      <li><a href="#Step7">Geometry Management: Coding NewZone</a></li>
      <li><a href="#Step8">Geometry Management: Coding Export</a></li>
    </ul>
  </li>
</ul>
<p>We now comment each of those sections by looking at the code.</p>
<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="Step1"></a>Declaring CATIMfgGeometryActivity Implementation</h4>
<p>To overload the geometry tab page, we should create an extension class that
will implement <i>CATIMfgGeometryActivity</i>:</p>
<table class="code">
  <tr>
    <td>
      <pre>  ...
  // Tie the implementation to its interface
  #include &quot;TIE_CATIMfgGeometryActivity.h&quot;
  TIE_CATIMfgGeometryActivity( CAAESmiUserOperationGeometryEditor);
  ...</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="Step2"></a>Coding GetMainPanelEditor</h4>
<p>In <i>GetMainPanelEditor, </i>we create a new <b>CAASmgMachiningFeature</b>
and we associate it with <b>CAASmgOperation</b>. Then we call the geometry
dialog frame described below.</p>
<table class="code">
  <tr>
    <td>
      <pre>  ...
  // Associates a machining feature
  CATIMfgActivity * pActivity = NULL;
  oRC = QueryInterface(IID_CATIMfgActivity, (void**) &amp;pActivity);
  if (SUCCEEDED(oRC))
  {
    spMachFeature = pActivity-&gt;GetFeature(); 
    if (NULL_var == spMachFeature)
    {
      // Create a user machining feature
      oRC = CreateCAAMachiningFeature(spMachFeature);
      if (SUCCEEDED(oRC))
      {
        // Link the machining feature to the activity
        pActivity-&gt;SetFeature(spMachFeature);
      }
    }
    pActivity-&gt;Release();
    pActivity = NULL;
  }

  // Creates the frame
  oFrame = new CAASmiUserOperationGeometryPanel(iFather,spMachFeature);
  ...</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="Step3"></a>Creating a New Machining Feature CAASmgMachiningFeature</h4>
<p>The <i>CreateCAAMachiningFeature</i> method is used to create <b>CAASmgMachiningFeature</b>.</p>
<p>At first, we retrieve the startup of <b>CAASmgMachiningFeature</b> from the
catalog generated by CAASmiUserMachFeatureCatalog.m module.</p>
<table class="code">
  <tr>
    <td>
      <pre>  ...
  // Loads catalog	  
  CATUnicodeString CatalogFeature (&quot;CAAUserMachiningFeatures.CATfct&quot;);	
  CATUnicodeString ClientID (&quot;CAAManufacturing&quot;);

  CATICatalog * pCatalogCont = NULL;
  oRC = ::AccessCatalog (&amp;CatalogFeature,&amp;ClientID,spFeatCont,&amp;pCatalogCont);
  if (pCatalogCont == NULL) return oRC;

  // Retrieves startup from catalog	  
  CATBaseUnknown * pNewSUFeat = NULL;
  CATUnicodeString NewSUFeatType(&quot;<b>CAASmgMachiningFeature</b>&quot;);
  oRC = pCatalogCont-&gt;<b>RetrieveSU</b>(&amp;pNewSUFeat,&amp;NewSUFeatType,&quot;CATISpecObject&quot;);
  if (FAILED(oRC)) return oRC;
  ...</pre>
    </td>
  </tr>
</table>
<p>Then, we instanciate <b>CAASmgMachiningFeature</b> and we add the <b>CAASmgGuide</b>
attribute with the <i>AddNcGeometryParameter</i> method of <i>CATISmgNcGeometryManager</i>.
This method adds a geometry attribute which support standard geometries or nc
geometry features.</p>
<table class="code">
  <tr>
    <td>
      <pre>  ...
  // Creates the machining feature (associated in Catalog)	  
  if (pNewSUFeat)
  {
    CATISpecObject * pSpecSUFeat = NULL;
    oRC = pNewSUFeat-&gt;QueryInterface(IID_CATISpecObject, (void**) &amp;pSpecSUFeat);
    if (SUCCEEDED(oRC))
    {
      oFeature = pSpecSUFeat-&gt;Instanciate(&quot;&quot;,spFeatCont);

      // Adds a geometric parameter &quot;CAASmgGuide&quot;
      if (!!oFeature)
      {
        CATISmgNcGeometryManager * pSmgManager = NULL;
        oRC = oFeature-&gt;QueryInterface(IID_CATISmgNcGeometryManager, (void**) &amp;pSmgManager);
        if (SUCCEEDED(oRC))
        {
          oRC = pSmgManager-&gt;<b>AddNcGeometryParameter(&quot;CAASmgGuide&quot;,SmgEdgeType)</b>;

          pSmgManager-&gt;Release();
          pSmgManager = NULL;
        }
      } 
  ...</pre>
    </td>
  </tr>
</table>
<p>Finally, we add our feature in the Manufacturing Container.</p>
<table class="code">
  <tr>
    <td>
      <pre>  ...	
  // Adds the feature in the MfgView
  SEQUENCE(CATBaseUnknown_ptr) ListOfMfgView = spFeatCont-&gt;ListMembers(CATIMfgViewAccess::ClassName());
  int NbMfgView = ListOfMfgView.length();
  if (NbMfgView)
  {
    CATBaseUnknown * pBaseView = ListOfMfgView[NbMfgView - 1];
    if (pBaseView)
    {
      CATIMfgViewAccess * pMfgView = NULL;
      oRC = pBaseView-&gt;QueryInterface(IID_CATIMfgViewAccess, (void**) &amp;pMfgView);
      if (SUCCEEDED(oRC))
      {
        pMfgView-&gt;AddFeature(oFeature);
        pMfgView-&gt;Release();
        pMfgView = NULL;
      }
    pBaseView-&gt;Release();
  } 
  ...</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->

<h4><a name="Step4"></a>Geometry Management: Coding SelectCurve</h4>
<p>In <i>CAASmiUserOperationGeometryPanel</i> class, <i>SelectCurve</i> is
called whenever the user clicks on &quot;<i>Select a curve</i>&quot; button. It
calls the <i>CAASmiUserOperationGeometrySelCom</i> command that manages the
selection of standard geometries (edge or curve).</p>
<table class="code">
  <tr>
    <td>
      <pre>  ...
  // Sends Selection command
  new CAASmiUserOperationGeometrySelCom (this,_spGuide);
  ...</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Step5"></a>Geometry Management: Coding SelectZone</h4>
<p>In <i>CAASmiUserOperationGeometryPanel</i> class, <i>SelectZone</i> is called
whenever the user clicks on &quot;<i>Select a set of curves</i>&quot; button. It
activates the standard dialog editor of NC Geometry Features management via the <i>CATIEdit</i>
interface.</p>
<table class="code">
  <tr>
    <td>
      <pre>  ...
  CATIEdit * pEdit = NULL;
  HRESULT RC = _spGuide-&gt;QueryInterface(IID_CATIEdit, (void**) &amp;pEdit);
  if (SUCCEEDED(RC))
  {
    // For zone management
    pEdit-&gt;<b>Activate</b>(NULL);
    pEdit-&gt;Release();
    pEdit = NULL;
  }
  ...</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Step6"></a>Geometry Management: Coding RemoveAll</h4>
<p>In <i>CAASmiUserOperationGeometryPanel</i> class, <i>RemoveAll</i> is called
whenever the user clicks on &quot;<i>Remove all</i>&quot; button. It uses the <i>RemoveAll</i>
method of <i>CATISmgNcGeometryParameter</i> interface.</p>
<table class="code">
  <tr>
    <td>
      <pre> ...
  CATISmgNcGeometryParameter * pSmgParameter = NULL;
  HRESULT RC = _spGuide-&gt;QueryInterface(IID_CATISmgNcGeometryParameter, (void**) &amp;pSmgParameter);
  if (SUCCEEDED(RC))
  {
    pSmgParameter-&gt;<b>RemoveAll</b>();
    pSmgParameter-&gt;Release();
    pSmgParameter = NULL;
  }
  ...</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Step7"></a>Geometry Management: Coding NewZone</h4>
<p>In <i>CAASmiUserOperationGeometryPanel</i> class, <i>NewZone</i> is called
whenever the user clicks on &quot;<i>Add a empty set</i>&quot; button. A Nc
Geometry Feature is created by the <i>CreateNcGeometryFeature</i> method of <i>CATISmgFactory</i>.
The Nc Geometry Feature is added with <i>Add</i> method of <i>CATISmgNcGeometryParameter</i>.</p>
<table class="code">
  <tr>
    <td>
      <pre>  ...
  // Creates a empty zone
  CATISmgFactory * pSmgFactory = NULL;
  HRESULT RC = spFeatCont-&gt;QueryInterface(IID_CATISmgFactory, (void**)&amp;pSmgFactory);
  if (SUCCEEDED(RC))
  {
    pSmgFactory-&gt;<b>CreateNcGeometryFeature</b>(SmgEdgeType,spNcFeature);
    pSmgFactory-&gt;Release();
  pSmgFactory = NULL;
  }

  // Adds it in the guide parameter
  if (!!_spGuide &amp;&amp; !!spNcFeature)
  {
    CATISmgNcGeometryParameter * pSmgParameter = NULL;
    RC = _spGuide-&gt;QueryInterface(IID_CATISmgNcGeometryParameter, (void**) &amp;pSmgParameter);
    if (SUCCEEDED(RC))
    {
      pSmgParameter-&gt;<b>Add</b>(spNcFeature);
      pSmgParameter-&gt;Release();
      pSmgParameter = NULL;
    }
  }
  ...</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Step8"></a>Geometry Management: Coding Export</h4>
<p>In <i>CAASmiUserOperationGeometryPanel</i> class, <i>Export</i> is called
whenever the user clicks on &quot;<i>Export curves in a new set</i>&quot;
button. It uses the <i>Export</i> method of <i>CATISmgNcGeometryParameter</i>
interface.</p>
<table class="code">
  <tr>
    <td>
      <pre>  ...
  CATISmgNcGeometryParameter * pSmgParameter = NULL;
  HRESULT RC = _spGuide-&gt;QueryInterface(IID_CATISmgNcGeometryParameter, (void**) &amp;pSmgParameter);
  if (SUCCEEDED(RC))
  {
    pSmgParameter-&gt;<b>Export</b>();
    pSmgParameter-&gt;Release();
    pSmgParameter = NULL;
  }
  ...</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="InShort"></a>In Short</h3>
<p>This use case has demonstrated how to manage surface machining operation
geometry interactive with a geometry attribute of an user machining feature.</p>
<ul>
  <li>It first shows how to implement the <i>CATIMfgGeometryActivity</i>
    interface to overload default geometry tab page.</li>
  <li>Then, it shows how to create its own machining feature with a surface
    machining geometry attribute.</li>
  <li>Finally, it describes geometry management illustrating the use of <i>CATISmgNcGeometryParameter</i>,
    <i>CATISmgNcGeometryManager</i> and <i>CATISmgFactory</i> interfaces.</li>
</ul>
<p>We will see now how to compute the tool path of our operation [<a href="#References">3</a>].</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->

<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td valign="top">[1]</td>
    <td><a href="../CAASmiTechArticles/CAASmiOperationSampleOverview.htm">Surface
      Machining Operation Sample Overview</a></td>
  </tr>
  <tr>
    <td valign="top">[2]</td>
    <td><a href="../CAADocUseCases/CAADocRunSample.htm">Building
      and Launching a CAA V5 Use Case</a></td>
  </tr>
  <tr>
    <td valign="top">[3]</td>
    <td><a href="CAASmiUserOperationWithUserMFToolPath.htm">Computing a Tool
      Path with User Machining Features</a></td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <strong>1</strong> [Mar 2002]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td valign="top" align="right" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<p><i>Copyright © 2002, Dassault Systèmes. All rights reserved.</i></p>

</body>

</html>
