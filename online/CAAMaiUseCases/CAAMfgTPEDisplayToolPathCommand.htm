<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Displaying Several Tool Pathes</title>
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>Machining</h1>
    </td>
    <td valign="top">
      <h2>NC Review</h2>
    </td>
    <td align="right" valign="top" rowspan="2">
      <h3><a name="Top"></a>Displaying Several Tool Pathes</h3>
      <i>Manipulating a tool path</i></td>
  </tr>
  <tr>
    <td colspan="2" class="use">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This article discusses the CAAMfgTPEDisplayToolPathCommand use case.</p>
      <ul>
        <li><b><a href="#Learn">What You Will Learn With This Use Case</a></b></li>
        <li><b><a href="#UseCase">The CAAMfgTPEDisplayToolPathCommand Use Case</a></b></li>
        <ul>
          <li><b><a href="#What">What Does CAAMfgTPEDisplayToolPathCommand Do</a></b></li>
          <li><b><a href="#How">How to Launch CAAMfgTPEDisplayToolPathCommand</a></b></li>
          <li><b><a href="#Where">Where to Find the
            CAAMfgTPEDisplayToolPathCommand Code</a></b></li>
        </ul>
        <li><b><a href="#Step">Step-by-Step</a></b></li>
        <li><b><a href="#InShort">In Short</a></b></li>
        <li><b><a href="#References">References</a></b></li>
      </ul>
    </td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>This use case is intended to help you manipulate the tool path structure.
This involves the following:</p>
<ul>
  <li>Creating a command which will select one or several tool pathes, then
    displaying the selected tool pathes.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="UseCase"></a>The CAAMfgTPEDisplayToolPathCommand Use Case</h3>
<p>CAAMfgTPEDisplayToolPathCommand is a use case of the CAAToolPathEditorItf.edu
framework that illustrates ToolPathEditor framework capabilities.</p>
<p align="right">[<a href="#Top">Top</a>]</p>

<!---------------------------------comment------------------------------------->
<h4><a name="What"></a>What Does CAAMfgTPEDisplayToolPathCommand Do</h4>
<p>CAAMfgTPEDisplayToolPathCommand runs with the document CAAMfgToolPath.CATPart
shown on <a href="#Fig1">Fig.1</a>.</p>
<table>
  <caption><a name="Fig1"></a>Fig. 1: The Tool Path of a Sweeping Operation</caption>
  <tr>
    <td><img src="images/CAAMfgTPEDisplayDistance00.jpg" border="0" width="713" height="727"></td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="How"></a>How to Launch CAAMfgTPEDisplayToolPathCommand</h4>
<p>To launch CAAMfgTPEDisplayToolPathCommand, you will need to:</p>
<ul>
  <li>Set up the build time environment, then compile CAAMfgTPEAddToolBar.m,
    CAAMfgTPEDisplayToolPathCommand.m and CAAMfgTPESplitToolPathComand.m modules
    along with its prerequisites [<a href="#References">1</a>]</li>
</ul>
<pre># Decomment this line into file ToolPathEditor.edu.dico to run CAAMfgTPEAddToolBar Sample
# CAAMfgTPEM3xAddin CATISmgProgramAddin libCAAMfgTPEAddToolBar</pre>
<ul>
  <li>Set up the run time environment</li>
  <li>Launch a CATIA V5 session</li>
  <li>Open the CAAMfgToolPath.CATPart file located in:</li>
  <table width="100%">
    <tr>
      <td>Windows</td>
      <td><code>InstallRootDirectory\CAADoc\CAAToolPathEditorItf.edu\CNext\resources\graphic</code></td>
    </tr>
    <tr>
      <td>Unix</td>
      <td><code>InstallRootDirectory/CAADoc/CAAToolPathEditorItf.edu/CNext/resources/graphic</code></td>
    </tr>
  </table>
  <p><img src="images/CAAMfgTPEDisplayDistance01.jpg">
  <li>Using the Start menu, select the Surfacic Machining workbench in Machining</li>
  <p><img src="images/CAAMfgTPEDisplayDistance02.jpg" border="0" width="275" height="417">
  <p>This displays the PPR document:
  <p><img src="images/CAAMfgTPEDisplayDistance03.jpg" border="0" width="327" height="267"></p>
  <li>In the PPR Tree, select Manufacturing Program.1 and create a sweeping
    operation using the Sweeping command in the Insert-&gt;Machining Operations-&gt;Sweeping Operations
      -&gt; Sweeping.&nbsp;</li>
  <li>Select a body, then do replay to compute the tool path.</li>
  <li>In the PPR tree, an icon appears under the activity of sweeping.</li>
  <p><img src="images/CAAMfgTPESplitToolPath04.jpg" width="345" height="368">
  <li>Then select the tool path and click on the icon representing the command
    &quot;Split tool path&quot;. A tool path is displayed, with points.</li>
  <p><img src="images/CAAMfgTPEDisplayToolPath04.jpg" width="351" height="458">
  <li>Select a point on the tool path. Then this tool path is splitted and two
    tool pathes appear in the PPR Tree. Make twice this command</li>
</ul>
<p><img src="images/CAAMfgTPEDisplayToolPath05.jpg" width="919" height="487"></p>
<ul>
  <li>Then select all tool pathes and choose Display tool path command in the
    tool bar.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Where"></a>Where to Find the CAAMfgTPEDisplayToolPathCommand Code</h4>
<p>The CAAMfgTPEDisplayToolPathCommand use case is made of a class named<i>
CAAMfgTPEDisplayToolPathCommand</i> located in the
CAAMfgTPEDisplayToolPathCommand.m module of the CAAToolPathEditorItf.edu
framework:</p>
<table width="100%">
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAADoc\CAAToolPathEditorItf.edu\CAAMfgTPEDisplayToolPathCommand.m</code></td>
  </tr>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAADoc/CAAToolPathEditorItf.edu/CAAMfgTPEDisplayToolPathCommand.m</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Step"></a>Step-by-Step</h4>
<p>There are three logical steps in CAAMfgTPEDisplayToolPathCommand:</p>
<ol>
  <li><a href="#Step1">Creating a Command</a></li>
  <li><a href="#Step2">Selecting Several Tool Pathes</a></li>
  <li><a href="#Step3">Displaying the Selected Tool Pathes</a></li>
</ol>
<p>We now comment each of those sections by looking at the code.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Step1"></a>Creating a Command</h4>
<p>The class that will implement the command is named <i>CAAMfgTPEDisplayToolPathCommand</i>.
Create the <i>CAAMfgTPEDisplayToolPathCommand</i> class header file:</p>
<table class="code">
  <tr>
    <td>
      <pre>class ExportedByCAAMfgTPEDisplayToolPathCommand CAAMfgTPEDisplayToolPathCom : public CATStateCommand
{
  public:
    DeclareResource (CAAMfgTPEDisplayToolPathCom,CATStateCommand)
    CAAMfgTPEDisplayToolPathCom (CATString* argument);
    virtual ~CAAMfgTPEDisplayToolPathCom();
    void BuildGraph();
    void Valuate (const CATBaseUnknown_var&amp; iValue);  
  private:
    // to Create the rep of the tool path
    void CreateController();
    // Delete the rep of the tool path
    void DeleteController();
    // To update the rep of the tool path
    void DispatchInfo();
    //  To Get the factory of tool pathes.
    HRESULT GetToolPathFactory (CATIContainer_var&amp; oContainer);
    // To get the tool path
    boolean GetSelection (void* data);
    // To Terminate the command
    boolean End (void* data);
    CATIMfgToolPath_var _ToolPath;
    CAT3DViewer*         _Viewer;
    CATPathElementAgent* _TPSelectionAgent;
    CATDialogAgent*      _TPEndAgent ;
    CATPathElement* _ToolPahVisu;
    IID*            _iid;
    CATVisManager*  _VisuManager;
};</pre>
    </td>
  </tr>
</table>
<p>The <i>CAAMfgTPEDisplayToolPathCommand</i> class C++-derives from <i>CATStateCommand</i>.
The DeclareResource macro declares that the ressource file is <i>CAAMfgTPEDisplayToolPathCommand.CATNls.</i>
The class has a constructor, a destructor, a <code>SplitToolPath</code> method
to split the selected tool path, severals methods to manage the user's
interaction and the rep of the tool path, and a copy constructor.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Step2"></a>Selecting Several Tool Pathes</h4>
<p>First you have to implement the method BuilGraph, which will provide you with
capturing the user's interactions.</p>
<table class="code">
  <tr>
    <td>
      <pre>void CAAMfgTPEDisplayToolPathCom::BuildGraph()
{  
  _TPSelectionAgent = new CATPathElementAgent(&quot;ToolPathSelection&quot;);
  if (NULL != _TPSelectionAgent) {
    _TPSelectionAgent-&gt;SetOrderedElementType(CATIMfgCompoundTraject::ClassName());
    _TPSelectionAgent-&gt;AddOrderedElementType(CATIMfgActivity::ClassName());
    _TPSelectionAgent-&gt;SetBehavior(CATDlgEngWithPrevaluation|CATDlgEngWithCSO|CATDlgEngMultiAcquisition);
    AddCSOClient(_TPSelectionAgent);
  }
  if ( _TPEndAgent == NULL ) {
    _TPEndAgent = new CATDialogAgent(&quot;End&quot;);
    if (NULL != _TPEndAgent)
      _TPEndAgent-&gt;AcceptOnNotify(NULL, CATEdit::ClassName());
  }
  CATDialogState* firstState = GetInitialState(&quot;TPESelectToolPath&quot;);
  if (NULL != firstState) firstState-&gt;AddDialogAgent(_TPSelectionAgent); 
  CATDialogState* secondState = AddDialogState(&quot;TPEEndCommand&quot;);
  if (NULL != secondState)
    secondState-&gt;AddDialogAgent(_TPEndAgent); 
    CATDialogTransition * firstTransition = 
        AddTransition (firstState, secondState,
                       IsOutputSetCondition(_TPSelectionAgent),
                       Action((ActionMethod) &amp;CAAMfgTPEDisplayToolPathCom::GetSelection));
    AddTransition (secondState, NULL,
                   IsOutputSetCondition(_TPEndAgent),
                   Action((ActionMethod) &amp;CAAMfgTPEDisplayToolPathCom::End));
}</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Step3">Displaying the Selected Tool Pathes</h4>
<p>Now the method GetSelection is implemented. It gets the selected tool path.</p>
<table class="code">
  <tr>
    <td>
      <pre>boolean CAAMfgTPEDisplayToolPathCom::GetSelection (void* data)
{ 
  CATBoolean RESULT = CATFalse;
  CATSO* selectedObjects = NULL;
  if (NULL != _TPSelectionAgent)
    selectedObjects = _TPSelectionAgent-&gt;GetListOfValues();
  if ( selectedObjects ) {
    int NbPath = selectedObjects-&gt;GetSize();
    if ( NbPath &gt; 0 ) {
      RESULT = CATTrue;
      if (NULL_var ==  _ToolPath ) {
         CATIContainer_var spContainer = NULL_var;
         GetToolPathFactory (spContainer);
         if (NULL_var != spContainer) { 
            CATIMfgToolPathFactory_var spTPFactory = spContainer;
            _ToolPath = spTPFactory-&gt;CreateMfgCompoundTraject ();
         }
      }
      CATIMfgToolPathComponents_var itfComponents (_ToolPath);
      if ( !!_ToolPath &amp;&amp; !!itfComponents ) {
        CATPathElement* ptrCurrentElement=NULL;
        CATIMfgCompoundTraject* ptrCTraject=NULL;
        CATIMfgCompoundTraject_var itfCmpTraject;
        CATIMfgActivity* ptrActivity=NULL;
        CATIMfgActivity_var itfActivity;
        for ( int ind=0;  ind &lt; NbPath ; ind++) {
          ptrCurrentElement = (CATPathElement*) (*selectedObjects)[ind];
          if (NULL != ptrCurrentElement) {
            ptrCTraject = (CATIMfgCompoundTraject *) (ptrCurrentElement-&gt;FindElement(CATIMfgCompoundTraject::ClassId()));
            itfCmpTraject = ptrCTraject;
            if (!! itfCmpTraject ) {
              // A Compound traject is selected.
              ptrCTraject-&gt;Release();
              itfComponents-&gt;AddElement(itfCmpTraject,0);
              ptrCTraject=NULL;
            }
            else {
              // An activity is selected.
              // We add all her tool pathes.
              ptrActivity = (CATIMfgActivity *) (ptrCurrentElement-&gt;FindElement(CATIMfgActivity::ClassId()));
              itfActivity = ptrActivity;
              if (!!itfActivity ) {
                ptrActivity-&gt;Release();
                CATIMfgToolPathManagement_var itfManagement = itfActivity;
                CATIMfgToolPath_var ToolPath(NULL_var);
                if (!!itfManagement)
                  HRESULT RC = itfManagement-&gt;GetToolPath(ToolPath);
                itfComponents-&gt;AddElement(ToolPath,0);
                ptrActivity=NULL;
              }
            }
            ptrCurrentElement=NULL;
          }
        }
        // Display the tool path.
        CreateController();
        DispatchInfo();
      }
    }
  }
  return RESULT;
}</pre>
    </td>
  </tr>
</table>
<p>First, we verify that the selected object is a tool path object, then we
display it ( call to methods CreateController to create the image then a call to
method DispatchInfo to display it in the 3d viewer.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="InShort"></a>In Short</h3>
This article provides an example on how to use the structure of the tool path
and how to make to display several tool pathes.
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td valign="top">[1]</td>
    <td><a href="../CAADocUseCases/CAADocRunSample.htm">Building
      and Launching a CAA V5 Use Case</a></td>
  </tr>
  <tr>
    <td valign="top">[2]</td>
    <td><a href="CAAMaiDumpToolPathCommand.htm">Dump of Tool Path Content
      Command</a></td>
  </tr>
  <tr>
    <td align="right" valign="top" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <b>1</b> [March 2002]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td align="right" valign="top" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
  <!---------------------------------comment------------------------------------->
<p><i>Copyright © 2000, Dassault Systèmes. All rights reserved.</i></p>

</body>

</html>
