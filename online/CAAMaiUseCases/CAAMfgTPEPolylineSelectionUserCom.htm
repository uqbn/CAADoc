<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<meta name="Author" content="Rimbaud Christian">
<title>Cutting Polylines of a Tool Path</title>
<link rel="Stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css">
</head>

<body>

<table width="100%">
  <tr>
    <td valign="top">
      <h1>Machining</h1>
    </td>
    <td valign="top">
      <h2>NC Review</h2>
    </td>
    <td align="right" valign="top" rowspan="2">
      <h3><a name="Top"></a>Cutting Polylines of a Tool Path</h3>
      <i>Manipulating a tool path</i></td>
  </tr>
  <tr>
    <td colspan="2" class="use">Use Case</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<table class="abstract">
  <tr>
    <td>
      <h3>Abstract</h3>
      <p>This article discusses the CAAMfgTPEPolylineSelectionUserCom use case.</p>
      <ul>
        <li><b><a href="#Learn">What You Will Learn With This Use Case</a></b></li>
        <li><b><a href="#UseCase">The CAAMfgTPEPolylineSelectionUserCom Use Case</a></b></li>
        <ul>
          <li><b><a href="#What">What Does CAAMfgTPEPolylineSelectionUserCom Do</a></b></li>
          <li><b><a href="#How">How to Launch CAAMfgTPEPolylineSelectionUserCom</a></b></li>
          <li><b><a href="#Where">Where to Find the
            CAAMfgTPEPolylineSelectionUserCom Code</a></b></li>
        </ul>
        <li><b><a href="#Step">Step-by-Step</a></b></li>
        <li><b><a href="#InShort">In Short</a></b></li>
        <li><b><a href="#References">References</a></b></li>
      </ul>
    </td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="Learn"></a>What You Will Learn With This Use Case</h3>
<p>This use case is intended to help you manipulate the tool path structure.
This involves the following:</p>
<ul>
  <li>Creating a command which will select a tool path, then gives to the tool
    path editor the number of polylines to cut.</li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h3><a name="UseCase"></a>The CAAMfgTPEPolylineSelectionUserCom Use Case</h3>
<p>CAAMfgTPEPolylineSelectionUserCom is a use case of the
CAAToolPathEditorItf.edu framework that illustrates ToolPathEditor framework
capabilities.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="What"></a>What Does CAAMfgTPEPolylineSelectionUserCom Do</h4>
<p>CAAMfgTPEPolylineSelectionUserCom runs with the document
CAAMfgToolPath.CATPart shown on <a href="#Fig1">Fig.1</a>.</p>
<table>
  <caption><a name="Fig1"></a>Fig. 1: Cutting polylines of a tool path</caption>
  <tr>
    <td><img border="0" src="images/CAAMfgTPEDisplayDistance00.jpg" width="713" height="727"></td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="How"></a>How to Launch CAAMfgTPEPolylineSelectionUserCom</h4>
<ul>
  <li>Set up the build time environment, then compile
    CAAMfgTPEAddCmdInCutAreaToolBar.m module along with its prerequisites [<a href="#References">1</a>]</li>
  <pre># Decomment this line to run CAAMfgTPEPolylineSelectionUserCom Sample
#CAAMfgTPEM3xAddin                CATISmgProgramAddin          libCAAMfgTPEAddToolBar
#CATM3xAreaModificationAlgoDriver CATIMfgTPECutAreasEditor     libCAAMfgTPEAddCmdInCutAreaToolBar
#CATM3xAreaModificationAlgoDriver CATIMfgTPECutAreasUserHeader libCAAMfgTPEAddCmdInCutAreaToolBar</pre>
  <li>Set up the run time environment&nbsp; [<a href="#References">1</a>]</li>
  <li>Launch a CATIA V5 session</li>
  <li>Open the CAAMfgToolPath.CATPart file located in:
    <table width="100%">
      <tr>
        <td>Windows</td>
        <td><code>InstallRootDirectory\CAADoc\CAAToolPathEditorItf.edu\CNext\resources\graphic</code></td>
      </tr>
      <tr>
        <td>Unix</td>
        <td><code>InstallRootDirectory/CAADoc/CAAToolPathEditorItf.edu/CNext/resources/graphic</code></td>
      </tr>
    </table>
  </li>
</ul>
<p>Once the part is opened, proceed as follows.</p>
<ul>
  <li>Using the Start menu, select the Surfacic Machining workbench in NC
    Manufacturing
    <p><img border="0" src="images/CAAMfgTPEDisplayDistance01.jpg" width="482" height="417"></p>
  </li>
  <li>This displays the PPR document:
    <p><img border="0" src="images/CAAMfgTPEDisplayDistance02.jpg" width="275" height="417"></p>
  </li>
  <li>In the PPR Tree, select Manufacturing Program.1 and create a sweeping
    operation using the Sweeping command in the Insert-&gt;Machining
    Operations-&gt;sweeping
    <p>Select a body, then do replay to compute the tool path.</p>
    <p>In the PPR tree, an icon appears under the activity of sweeping.</p>
    <p><img border="0" src="images/CAAMfgTPEDisplayDistance03.jpg" width="327" height="267"></p>
  </li>
  <li>In the PPR tree, lock the operation.</li>
  <li>An icon appears under the activity of sweeping.</li>
  <li>In Tool Path Management tool bar, click on Edit Tool Path command.</li>
  <li>In new sweeping dialog, click on Area Modification.</li>
  <li>Then, Tool Path Editor tool bar is updated with commands.</li> 
  <li>Then choose the icon &quot;Select polyline to cut
    on a tool path&quot;.
    <p><img border="0" src="images/CAAMfgPolylineCut1.jpg" width="422" height="104"></p>
  </li>
  <li>Click one time or several times on the tool path, polylines are hilighted.
    <p><img border="0" src="images/CAAMfgPolylineCut2.jpg" width="651" height="504"></p>
  </li>
  <li>Then this tool path can be managed in the cut area tool bar. It can be cut
    or translated.
    <p><img border="0" src="images/CAAMfgPolylineCut3.jpg" width="560" height="538"></p>
  </li>
</ul>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Where"></a>Where to Find the CAAMfgTPEPolylineSelectionUserCom Code</h4>
The CAAMfgTPEPolylineSelectionUserCom use case is made of a class named<i>
CAAMfgTPEPolylineSelectionUserCom </i>located in the <i>CAAMfgTPEAddCmdInCutAreaToolBar.m</i>
module of the CAAToolPathEditorItf.edu framework:<br>
<table width="100%">
  <tr>
    <td>Windows</td>
    <td><code>InstallRootDirectory\CAADoc\CAAToolPathEditorItf.edu\CAAMfgTPEAddCmdInCutAreaToolBar.m</code></td>
  </tr>
  <tr>
    <td>Unix</td>
    <td><code>InstallRootDirectory/CAADoc/CAAToolPathEditorItf.edu/CAAMfgTPEAddCmdInCutAreaToolBar.m</code></td>
  </tr>
</table>
<p>where <code>InstallRootDirectory</code> is the directory where the CAA CD-ROM
is installed.
<p align="right">[<a href="#Top">Top</a>]</p>
  <!---------------------------------comment------------------------------------->
<h3><a name="Step"></a>Step-by-Step</h3>
<p>There are four logical steps in CAAMfgTPEPolylineSelectionUserCom</p>
<ol>
  <li><a href="#Step1">Creating a Command</a></li>
  <li><a href="#Step2">Selecting a Tool Path</a></li>
  <li><a href="#Step3">Giving the Number of Polylines to Be Cut by the Tool Path
    Editor</a></li>
</ol>
<p>We now comment each of those sections by looking at the code.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->
<h4><a name="Step1"></a>Creating a Command</h4>
<p>The class that will implement the command is named <i>CAAMfgTPEPolylineSelectionUserCom</i>.<br>
Create the <i>CAAMfgTPEPolylineSelectionUserCom </i>class header file:</p>
<table class="code">
  <tr>
    <td>
      <pre>class ExportedByCAAMfgTPEAddCmdInCutAreaToolBar CAAMfgTPEPolylineSelectionUserCom : public CATStateCommand
{
  public:
    DeclareResource (CAAMfgTPEPolylineSelectionUserCom, CATStateCommand)
    //CAAMfgTPEPolylineSelectionUserCom( CATCommand *iFather,
    // CATM3xAreaModificationAlgoDriver* AlgoDriver);
    CAAMfgTPEPolylineSelectionUserCom (void* ipCutAreasEditor);
    virtual ~CAAMfgTPEPolylineSelectionUserCom ();
    void BuildGraph();
    CATBoolean End(void *Data);
    CATStatusChangeRC Cancel (CATCommand*, CATNotification*);
    CATStatusChangeRC Desactivate (CATCommand*, CATNotification*);
    CATStatusChangeRC Activate (CATCommand*, CATNotification*);
    void Valuate (int iSwitch);
    boolean LineSelection(void* Data);
  private:
    CATIMfgTPECutAreasEditor* _hCutEditor;
    CATSelector* _Selector;
    CAT3DViewer* _Viewer;
    CATPathElementAgent* _EndAgent;
    CATDialogAgent* _PointAgent;
    int _NumPolyline;
};</pre>
    </td>
  </tr>
</table>
<p>The <i>CAAMfgTPEPolylineSelectionUserCom </i>class C++-derives from <i>CATStateCommand</i>.
The DeclareResource macro declares that the ressource file is
CAAMfgTPEPolylineSelectionUserCom.CATNls. The class has a constructor, a
destructor, a LineSelection method which manages the click on the tool path and
gives the number of polyline to the tool path editor, several methods to manage
the user's interaction and the representation of the tool path, and a copy
constructor.</p>
<p>This command will communicate with the tool path editor by the interface <i>CATIMfgTPECutAreasEditor</i>.
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Step2"></a>Selecting a Tool Path</h4>
<p>First you have to create a selector which must work with the representation
of the tool path. This last one can be retrieved by a call to the method <code>GetToolPathRep</code>
of the interface <i>CATIMfgTPECutAreasEditor</i>. A call to the method <code>BeginPolylineToCut</code>
is made to initialize the action.</p>
<p>The first argument of the constructor is used to get the interface <i>CATIMfgTPECutAreasEditor</i>.
This is done in the constructor.</p>
<table class="code">
  <tr>
    <td>
      <pre>CAAMfgTPEPolylineSelectionUserCom::CAAMfgTPEPolylineSelectionUserCom (void* ipCutAreasEditor)
      : CATStateCommand(&quot;TPEPolygonSelection&quot;,NULL,CATCommandModeShared),
        _PointAgent(NULL), _Viewer(NULL), _Selector(NULL),
        _EndAgent(NULL),_NumPolyline(0)
{
  CATFrmLayout* ptrFrmLayout = CATFrmLayout::GetCurrentLayout();
  if ( ptrFrmLayout)
  {
    const CATFrmWindow * ptrFrmWindow = ptrFrmLayout-&gt;GetCurrentWindow ();
    if (ptrFrmWindow &amp;&amp; ptrFrmWindow-&gt;IsAKindOf(CATFrmGraphAnd3DWindow::ClassName()) )
    {
      CATFrmGraphAnd3DWindow* ptr3DWindow = (CATFrmGraphAnd3DWindow*)ptrFrmWindow;
      CATViewer * viewer = ptr3DWindow-&gt;GetGraphicViewer();
      if( viewer &amp;&amp; viewer-&gt;IsAKindOf(CAT3DViewer::ClassName()) )
       _Viewer = (CAT3DViewer*)viewer;
    }
  }
  _hCutEditor = (CATIMfgTPECutAreasEditor*)ipCutAreasEditor;
  // Erase of the last preview
  if (NULL_var != _hCutEditor)
  {
    _hCutEditor-&gt;ClearAll();
    _hCutEditor-&gt;BeginPolylineToCut();
  }
  // Create the selector
  CATRep* Rep = NULL;
  if (NULL != _hCutEditor)
    Rep = _hCutEditor-&gt;GetToolPathRep();
  _Selector = new CATSelector (this,&quot;ToolPathSelector&quot;, Rep);
}</pre>
    </td>
  </tr>
</table>
<p>Now the method BuildGraph is implemented. It gets the click on the tool path
and the double-click to terminate the command.</p>
<table class="code">
  <tr>
    <td>
      <pre>void CAAMfgTPEPolylineSelectionUserCom::BuildGraph()
{
  _PointAgent = new CATDialogAgent(&quot;Point&quot;);
  if (NULL != _Selector)
  {
    _PointAgent-&gt;AcceptOnNotify(_Selector,
    _Selector-&gt;GetCATActivate());
    _PointAgent-&gt;SetBehavior(CATDlgEngWithPrevaluation|CATDlgEngWithUndo|CATDlgEngRepeat|CATDlgEngAcceptOnPrevaluate);
    // Dialog States
    CATDialogState* InitState = GetInitialState(&quot;UserPolylineSelection&quot;);
    if (NULL != InitState)
    {
      InitState-&gt;AddDialogAgent(_PointAgent);
      _EndAgent = new CATPathElementAgent(&quot;End&quot;);
      if (NULL != _EndAgent)
      {  
        _EndAgent-&gt;AcceptOnNotify(NULL, CATEdit::ClassName());
        InitState-&gt;AddDialogAgent(_EndAgent);
        AddTransition( InitState, InitState,
                       IsOutputSetCondition(_PointAgent),
                       Action((ActionMethod)&amp; CAAMfgTPEPolylineSelectionUserCom::LineSelection));
        AddTransition( InitState, NULL,
                       IsOutputSetCondition(_EndAgent),
                       Action((ActionMethod)&amp; CAAMfgTPEPolylineSelectionUserCom::End));
        SetRepeatMode(ON);
      }
    }
  }
}</pre>
    </td>
  </tr>
</table>
<p align="right">[<a href="#Top">Top</a>]</p>
<!---------------------------------comment------------------------------------->

<h4><a name="Step3"></a>Giving the Number of Polylines to Be Cut by the Tool
Path Editor</h4>
<p>This is done by the method LineSelection. Two calls to the method
LoadPolylineToCut of the interface <i>CATIMfgTPECutAreasEditor</i> are made to
give the polylines to the tool path editor.</p>
<table class="code">
  <tr>
    <td>
      <pre>boolean CAAMfgTPEPolylineSelectionUserCom::LineSelection(void* Data)
{
  // Simulate a selection of polyline.
  CATListOfInt* Liste = new CATListOfInt();
  CATIMfgToolPath_var toolPath;
  CATIMfgCompoundTraject_var compoundTraject;
  if ( SUCCEEDED(_hCutEditor-&gt;GetToolPath(toolPath) ) )
  {
    compoundTraject = toolPath;
    if ( !! compoundTraject ) {
      CATListValCATBaseUnknown_var ListofElement;
      boolean result = compoundTraject-&gt;GetAllElementaryTrajects(ListofElement);
      int NbElement = ListofElement.Size();
      if ( NbElement == 1) {
        CATIMfgTPMultipleMotion_var spMultipleMotion (ListofElement[1]);
        if (NULL_var != spMultipleMotion) {
          int number;
          spMultipleMotion-&gt;GetNumberOfSubTrajects(number);
          _NumPolyline++;
          if (_NumPolyline &lt; number)
          Liste-&gt;Append(_NumPolyline);
         _NumPolyline++;
         if (_NumPolyline &lt; number)
          Liste-&gt;Append(_NumPolyline);
        }
      }
    }
  }
  _hCutEditor-&gt;LoadPolylineToCut(Liste);
  ///////////////////////////////////////
  Liste-&gt;RemoveAll();
  if ( !! compoundTraject ) {
    CATListValCATBaseUnknown_var ListofElement;
    boolean result = compoundTraject-&gt;GetAllElementaryTrajects(ListofElement);
    int NbElement = ListofElement.Size();
    if ( NbElement == 1) {
      CATIMfgTPMultipleMotion_var spMultipleMotion (ListofElement[1]);
      if (NULL_var != spMultipleMotion)
      {
        int number;
        spMultipleMotion-&gt;GetNumberOfSubTrajects(number);
        _NumPolyline++;
        if (_NumPolyline &lt; number)
        Liste-&gt;Append(_NumPolyline);
      }
    }
  }
  _hCutEditor-&gt;LoadPolylineToCut(Liste);
  delete Liste;
  if (NULL != _PointAgent)
    _PointAgent-&gt;InitializeAcquisition();
  return CATTrue;
}</pre>
    </td>
  </tr>
</table>
<p>The next step is to end the action.</p>
<p>This is done by the method <code>End</code>. A call to the method <code>EndPolylineToCut</code>
of the interface <i>CATIMfgTPECutAreasEditor</i> is made.</p>
<table class="code">
  <tr>
    <td>
      <pre>CATBoolean CAAMfgTPEPolylineSelectionUserCom::End(void *data)
{
  if ( _Viewer ) {
    _Viewer-&gt;SetCursor(CATDialog::NorthWestArrow);
  }
  // End of the selection of polyline
  CAT3DRep* TPRep = NULL;
  if (NULL_var != _hCutEditor)
  {
    _hCutEditor-&gt;EndPolylineToCut();
  }
  RequestDelayedDestruction();
  return CATTrue;
}</pre>
    </td>
  </tr>
</table>
<p>Then the tool path editor manages this part of the tool path with all the
actions of the cut area tool bar.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="InShort"></a>In Short</h3>
<p>This article provides an example on how to cut some polylines of a tool path
by adding a new command in the cut area tool bar.</p>
<p align="right">[<a href="#Top">Top</a>]</p>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="References"></a>References</h3>
<table width="100%">
  <tr>
    <td valign="top">[1]</td>
    <td><a href="../CAADocUseCases/CAADocRunSample.htm">Building
      and Launching a CAA V5 Use Case</a></td>
  </tr>
  <tr>
    <td valign="top">[2]</td>
    <td><a href="CAAMfgTPECutAreasUserHeader.htm">Use case
      CAAMfgTPECutAreasUserHeader</a></td>
  </tr>
  <tr>
    <td align="right" valign="top" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<h3><a name="History"></a>History</h3>
<table width="100%">
  <tr>
    <td valign="top">Version: <b>1</b> [March 2002]</td>
    <td valign="top">Document created</td>
  </tr>
  <tr>
    <td align="right" valign="top" colspan="2">[<a href="#Top">Top</a>]</td>
  </tr>
</table>
<hr>
<!---------------------------------comment------------------------------------->
<p><i>Copyright © 2000, Dassault Systèmes. All rights reserved.</i>

</body>

</html>
